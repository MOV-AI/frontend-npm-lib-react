!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MovaiReact=t():e.MovaiReact=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=123)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/defineProperty")},function(e,t){e.exports=require("@babylonjs/core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/assertThisInitialized")},function(e,t){e.exports=require("prop-types")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/createClass")},function(e,t){e.exports=require("monet")},function(e,t){e.exports=require("@material-ui/core")},function(e,t){e.exports=require("mov-fe-lib-core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/extends")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/get")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/slicedToArray")},function(e,t){e.exports=require("@material-ui/core/styles")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classPrivateFieldGet")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/asyncToGenerator")},function(e,t){e.exports=require("lodash/get")},function(e,t){e.exports=require("@material-ui/core/MenuItem")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/objectWithoutProperties")},function(e,t){e.exports=require("@material-ui/core/Typography")},function(e,t){e.exports=require("@material-ui/core/IconButton")},function(e,t){e.exports=require("@material-ui/core/FormControl")},function(e,t){e.exports=require("@material-ui/core/Divider")},function(e,t){e.exports=require("@material-ui/icons/Search")},function(e,t){e.exports=require("@material-ui/core/Grid")},function(e,t){e.exports=require("@material-ui/icons/ChevronRight")},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("@material-ui/core/Input")},function(e,t){e.exports=require("@material-ui/core/Menu")},function(e,t){e.exports=require("@babylonjs/gui/2D")},function(e,t){e.exports=require("@material-ui/core/Select")},function(e,t){e.exports=require("@material-ui/core/Avatar")},function(e,t){e.exports=require("@material-ui/icons/Clear")},function(e,t){e.exports=require("@material-ui/core/InputLabel")},function(e,t){e.exports=require("clsx")},function(e,t){e.exports=require("@material-ui/core/Button")},function(e,t){e.exports=require("@material-ui/icons/Close")},function(e,t){e.exports=require("@material-ui/icons/ExpandMore")},function(e,t){e.exports=require("react-resize-detector")},function(e,t){e.exports=require("@material-ui/icons/Settings")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("@material-ui/core/CircularProgress")},function(e,t){e.exports=require("@material-ui/core/colors")},function(e,t){e.exports=require("@material-ui/core/InputAdornment")},function(e,t){e.exports=require("@material-ui/core/ListItemText")},function(e,t){e.exports=require("@material-ui/core/Checkbox")},function(e,t){e.exports=require("@material-ui/pickers")},function(e,t){e.exports=require("react-virtualized")},function(e,t){e.exports=require("lodash/set")},function(e,t){e.exports=require("@material-ui/core/List")},function(e,t){e.exports=require("lodash/capitalize")},function(e,t){e.exports=require("@material-ui/core/TableCell")},function(e,t){e.exports=require("@material-ui/core/FormHelperText")},function(e,t){e.exports=require("lodash/cloneDeep")},function(e,t){e.exports=require("@material-ui/lab/Alert")},function(e,t,n){"use strict";var r,o=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function c(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function u(e,t){for(var n={},r=[],o=0;o<e.length;o++){var a=e[o],u=t.base?a[0]+t.base:a[0],s=n[u]||0,l="".concat(u," ").concat(s);n[u]=s+1;var f=c(l),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==f?(i[f].references++,i[f].updater(d)):i.push({identifier:l,updater:v(d,t),references:1}),r.push(l)}return r}function s(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var o=n.nc;o&&(r.nonce=o)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,f=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function d(e,t,n,r){var o=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=f(t,o);else{var a=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function h(e,t,n){var r=n.css,o=n.media,a=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var m=null,p=0;function v(e,t){var n,r,o;if(t.singleton){var a=p++;n=m||(m=s(t)),r=d.bind(null,n,a,!1),o=d.bind(null,n,a,!0)}else n=s(t),r=h.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=o());var n=u(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var o=c(n[r]);i[o].references--}for(var a=u(e,t),s=0;s<n.length;s++){var l=c(n[s]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}n=a}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(i=r,c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),"/*# ".concat(u," */")),a=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")}));return[n].concat(a).concat([o]).join("\n")}var i,c,u;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(r)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(o[i]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);r&&o[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),t.push(u))}},t}},function(e,t){e.exports=require("@material-ui/icons/Schedule")},function(e,t){e.exports=require("@material-ui/icons/Warning")},function(e,t){e.exports=require("@material-ui/icons/ViewModule")},function(e,t){e.exports=require("@material-ui/icons/Chat")},function(e,t){e.exports=require("@material-ui/core/Drawer")},function(e,t){e.exports=require("@material-ui/core/Collapse")},function(e,t){e.exports=require("material-table")},function(e,t){e.exports=require("@material-ui/icons/AddBox")},function(e,t){e.exports=require("@material-ui/icons/ArrowDownward")},function(e,t){e.exports=require("@material-ui/icons/Check")},function(e,t){e.exports=require("@material-ui/icons/ChevronLeft")},function(e,t){e.exports=require("@material-ui/icons/DeleteOutline")},function(e,t){e.exports=require("@material-ui/icons/Edit")},function(e,t){e.exports=require("@material-ui/icons/FilterList")},function(e,t){e.exports=require("@material-ui/icons/FirstPage")},function(e,t){e.exports=require("@material-ui/icons/LastPage")},function(e,t){e.exports=require("@material-ui/icons/Remove")},function(e,t){e.exports=require("@material-ui/icons/SaveAlt")},function(e,t){e.exports=require("@material-ui/icons/ViewColumn")},function(e,t){e.exports=require("@material-ui/core/Tabs")},function(e,t){e.exports=require("@material-ui/core/Tab")},function(e,t){e.exports=require("@material-ui/core/TextField")},function(e,t){e.exports=require("@material-ui/core/FormControlLabel")},function(e,t){e.exports=require("@material-ui/core/Switch")},function(e,t){e.exports=require("@material-ui/core/InputBase")},function(e,t){e.exports=require("@material-ui/core/Breadcrumbs")},function(e,t){e.exports=require("@material-ui/icons/NavigateNext")},function(e,t){e.exports=require("earcut")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("@babylonjs/core/Maths/math")},function(e,t){e.exports=require("lodash.isequal")},function(e,t){e.exports=require("@material-ui/core/utils")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/taggedTemplateLiteral")},function(e,t){e.exports=require("styled-components")},function(e,t){e.exports=require("@material-ui/core/styles/colorManipulator")},function(e,t){e.exports=require("@material-ui/icons/Label")},function(e,t){e.exports=require("@material-ui/core/Chip")},function(e,t){e.exports=require("@material-ui/icons/Add")},function(e,t){e.exports=require("@material-ui/icons/Today")},function(e,t){e.exports=require("@date-io/date-fns")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/typeof")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' version='1.0' width='400.000000' height='400.000000' preserveAspectRatio='xMidYMid meet'%3E%3Crect id='backgroundrect' width='100%25' height='100%25' x='0' y='0' fill='none' stroke='none'/%3E %3Cg class='currentLayer' style=''%3E%3Ctitle%3ELayer 1%3C/title%3E%3Cg transform='translate(0,400) scale(0.10000000149011612,-0.10000000149011612) ' fill='%23d31b1b' stroke='none' id='svg_1' class='' fill-opacity='1'%3E %3Cpath d='M1770 3990 c-682 -83 -1271 -501 -1570 -1115 -103 -211 -167 -437 -191 -673 -14 -129 -6 -404 14 -522 85 -495 339 -929 729 -1242 232 -187 539 -332 836 -393 957 -199 1909 314 2272 1224 204 512 180 1116 -64 1606 -115 232 -229 387 -412 565 -296 286 -639 460 -1059 536 -106 19 -443 27 -555 14z m-998 -1105 c3 -3 -23 -48 -57 -99 -113 -172 -182 -338 -226 -546 -32 -149 -33 -448 -1 -593 31 -145 70 -258 134 -387 65 -132 64 -140 -28 -140 -66 0 -100 13 -143 53 -74 70 -71 38 -71 748 0 555 2 642 16 690 43 144 129 236 248 265 54 13 119 18 128 9z m2621 -21 c99 -34 192 -157 216 -288 14 -78 15 -1256 1 -1307 -13 -48 -82 -125 -124 -139 -55 -18 -166 -12 -166 9 0 4 25 57 55 118 195 391 215 839 55 1247 -41 105 -117 247 -176 327 -18 25 -30 49 -26 54 10 11 109 -2 165 -21z m-251 -61 c128 -170 217 -370 265 -594 13 -63 18 -129 18 -264 0 -199 -13 -285 -66 -448 -33 -101 -114 -277 -128 -277 -26 0 -31 80 -32 549 0 267 -4 495 -8 505 -6 16 -20 4 -87 -77 -43 -53 -81 -96 -84 -96 -3 -1 -16 41 -29 92 -27 106 -74 215 -132 304 -32 48 -38 66 -31 80 34 61 243 273 271 273 4 0 23 -21 43 -47z m-2206 15 c52 -39 95 -82 171 -170 l74 -88 -42 -61 c-23 -34 -54 -89 -69 -123 -35 -76 -80 -219 -80 -252 0 -13 -4 -24 -8 -24 -4 0 -43 43 -87 95 -43 52 -83 95 -87 95 -4 0 -8 -224 -9 -497 0 -492 -5 -565 -34 -565 -16 0 -94 166 -130 279 -52 159 -69 294 -62 493 8 230 47 384 147 585 56 112 154 255 174 255 7 0 26 -10 42 -22z m458 -511 l133 -157 -20 -58 c-13 -39 -19 -85 -19 -147 -1 -150 44 -260 151 -365 107 -105 214 -150 361 -150 241 0 443 162 500 399 16 69 8 222 -15 278 l-17 43 132 157 c73 87 136 159 140 161 24 9 119 -186 148 -303 11 -44 22 -104 25 -134 l4 -54 -329 -388 c-343 -405 -362 -424 -466 -455 -101 -31 -258 -12 -341 41 -48 29 -83 69 -607 691 -52 62 -94 121 -94 131 0 52 33 202 60 271 33 86 99 204 112 200 5 -2 68 -74 142 -161z m376 -444 c85 -102 167 -194 182 -204 62 -45 81 -30 292 224 76 92 142 165 146 162 13 -8 20 -110 10 -167 -27 -170 -153 -299 -324 -334 -130 -27 -257 9 -356 102 -61 57 -116 162 -125 239 -8 57 1 165 13 164 4 0 77 -84 162 -186z' id='svg_2' fill='%23d31b1b' fill-opacity='1'/%3E %3C/g%3E%3C/g%3E%3C/svg%3E"},function(e,t){e.exports=require("@material-ui/core/Paper")},function(e,t){e.exports=require("react-virtualized-tree")},function(e,t){e.exports=require("@material-ui/core/Box")},function(e,t){e.exports=require("@material-ui/core/Backdrop")},function(e,t){e.exports=require("@material-ui/styles")},function(e,t){e.exports=require("jwt-decode")},function(e,t){e.exports=require("@babylonjs/core/Debug/debugLayer")},function(e,t){e.exports=require("@babylonjs/inspector")},function(e,t){e.exports=require("@babylonjs/loaders")},function(e,t,n){var r=n(60),o=n(115);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var a={insert:"head",singleton:!1};r(o,a);e.exports=o.locals||{}},function(e,t,n){(t=n(61)(!1)).push([e.i,"body.react-confirm-alert-body-element {\n  overflow: hidden;\n}\n\n.react-confirm-alert-blur {\n  filter: url(#gaussian-blur);\n  filter: blur(2px);\n  -webkit-filter: blur(2px);\n}\n\n.react-confirm-alert-overlay {\n  position: fixed;\n  top: calc(100vh - 300px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 99;\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  -ms-align-items: center;\n  align-items: flex-end;\n  opacity: 1;\n}\n\n.react-confirm-alert-body {\n  width: 400px;\n  padding: 30px;\n}\n\n.react-confirm-alert-svg {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.react-confirm-alert-body > h1 {\n  margin-top: 0;\n}\n\n.react-confirm-alert-body > h3 {\n  margin: 0;\n  font-size: 16px;\n}\n\n.react-confirm-alert-button-group {\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  margin-top: 20px;\n}\n\n.react-confirm-alert-button-group > button {\n  outline: none;\n  background: #333;\n  border: none;\n  display: inline-block;\n  padding: 6px 18px;\n  color: #eee;\n  margin-right: 10px;\n  border-radius: 5px;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.icon-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.icon-container:hover {\n  cursor: pointer;\n}\n",""]),e.exports=t},function(e,t){e.exports=require("fontsource-roboto")},function(e,t){e.exports=require("fontsource-open-sans")},function(e,t,n){var r=n(60),o=n(119);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[e.i,o,""]]);var a={insert:"head",singleton:!1};r(o,a);e.exports=o.locals||{}},function(e,t,n){(t=n(61)(!1)).push([e.i,".flow-action {\n  display: flex;\n  background: transparent;\n  width: 35px;\n  height: 35px;\n  margin: 6px;\n  border-radius: 50%;\n  justify-content: center;\n  align-items: center;\n  transition: background-color 0.5s;\n}\n\n.flow-action:hover {\n  background: rgba(11, 106, 138, 0.2);\n  cursor: pointer;\n}\n\n.robot-logs-container {\n  display: flex;\n  flex-direction: column;\n  height: 1px;\n  flex-grow: 1;\n}\n\n.tree-grow-overflow {\n  flex-grow: 0.5;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.logs-grow-overflow {\n  flex-grow: 1;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.saving {\n  /* font-size: 40px; */\n  margin: 0;\n}\n\n.saving span {\n  font-size: 15px;\n  animation-name: blink;\n  animation-duration: 1.4s;\n  animation-iteration-count: infinite;\n  animation-fill-mode: both;\n}\n\n.saving span:nth-child(2) {\n  animation-delay: 0.2s;\n}\n\n.saving span:nth-child(3) {\n  animation-delay: 0.4s;\n}\n\n@keyframes blink {\n  0% {\n    opacity: 0.2;\n  }\n  20% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0.2;\n  }\n}\n",""]),e.exports=t},function(e,t){e.exports=require("material-icons/css/material-icons.css")},function(e,t){e.exports=require("react-virtualized/styles.css")},function(e,t){e.exports=require("react-virtualized-tree/lib/main.css")},function(e,t,n){"use strict";n.r(t),n.d(t,"withOfflineValidation",(function(){return rs})),n.d(t,"withAuthentication",(function(){return is})),n.d(t,"Button",(function(){return l})),n.d(t,"AbstractModal",(function(){return E})),n.d(t,"ConfirmAlertModal",(function(){return M})),n.d(t,"SelectScopeModal",(function(){return Ju})),n.d(t,"RobotLogModal",(function(){return te})),n.d(t,"Drawer",(function(){return ae})),n.d(t,"Collapse",(function(){return ge})),n.d(t,"VerticalBar",(function(){return we})),n.d(t,"ContextMenu",(function(){return Ce})),n.d(t,"Table",(function(){return ct})),n.d(t,"Tabs",(function(){return vt})),n.d(t,"Text",(function(){return wt})),n.d(t,"Themes",(function(){return rc})),n.d(t,"Toggle",(function(){return Rt})),n.d(t,"SearchInput",(function(){return jt})),n.d(t,"Breadcrumb",(function(){return zt})),n.d(t,"SceneViewer",(function(){return Pi})),n.d(t,"Select",(function(){return Di})),n.d(t,"snackbar",(function(){return Zi})),n.d(t,"Style",(function(){return cc})),n.d(t,"Logs",(function(){return su})),n.d(t,"FilterIcon",(function(){return mc})),n.d(t,"LoginForm",(function(){return wu})),n.d(t,"ProfileMenu",(function(){return Pu}));var r=n(0),o=n.n(r),a=n(40),i=n.n(a),c=n(4),u=n.n(c),s=function(e){return o.a.createElement(i.a,{className:e.className,style:e.style,onClick:e.onClick,color:e.color,variant:e.variant,size:e.size,startIcon:e.startIcon,disabled:e.disabled},e.children)};s.propTypes={style:u.a.object,onClick:u.a.func,color:u.a.string,variant:u.a.string.isRequired,size:u.a.string,startIcon:u.a.element,children:u.a.node.isRequired,disabled:u.a.bool},s.defaultProps={style:{},onClick:function(){return console.log("Click MOV.AI button")},color:"default",variant:"contained",size:"medium",startIcon:void 0,children:o.a.createElement("div",null),disabled:!1};var l=s,f=n(1),d=n.n(f),h=n(41),m=n.n(h),p=n(17),v=n(9);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=Object(p.makeStyles)((function(e){return{card:{margin:"auto",position:"absolute",overflow:"auto",display:"flex",flexDirection:"column",maxHeight:"98%"},closeButton:{cursor:"pointer",position:"absolute",color:e.textColor,top:15,right:15,"&:hover":{color:"gray"}}}})),w=function(e){var t=b(),n=function(){e.onSubmit()},r=function(){e.onCancel()};return o.a.createElement(v.Modal,{onKeyPress:function(e){"Enter"===e.key&&n()},open:e.open,onClose:r,style:{display:"flex",alignItems:"center",justifyContent:"center"}},o.a.createElement(v.Card,{className:t.card,style:y(y({},e.style),{},{minWidth:e.width,minHeight:e.height})},o.a.createElement(v.CardContent,{style:{flexGrow:1,maxHeight:"calc(100% - 70px)",overflowY:"auto"}},o.a.createElement(v.Typography,{variant:"h5"},e.title),o.a.createElement(v.Typography,{component:"div",className:t.closeButton,onClick:function(){return e.onCancel()}},o.a.createElement(m.a,null)),o.a.createElement(v.Divider,{style:{marginBottom:"12px"}}),o.a.createElement("div",{style:{maxHeight:"calc(100% - 35px)",overflowY:"auto",paddingTop:5}},e.children)),o.a.createElement(v.Divider,null),o.a.createElement(v.CardActions,null,e.hasSubmitButton&&o.a.createElement(v.Button,{color:e.submitColor,onClick:n},e.submitText),e.hasCancelButton&&o.a.createElement(v.Button,{onClick:r,color:e.cancelColor},e.cancelText))))};w.propTypes={onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,title:u.a.string,submitText:u.a.string,submitColor:u.a.string,cancelText:u.a.string,cancelColor:u.a.string,width:u.a.string,height:u.a.string,style:u.a.object,hasSubmitButton:u.a.bool,hasCancelButton:u.a.bool},w.defaultProps={onSubmit:function(){},onCancel:function(){},open:!1,title:"New",submitText:"Confirm",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary",width:"25%",height:"25%",style:{},hasSubmitButton:!0,hasCancelButton:!0};var E=w,x=function(e){return o.a.createElement(E,{onSubmit:e.onSubmit,onCancel:e.onCancel,open:e.open,title:e.title,submitText:e.submitText,submitColor:e.submitColor,cancelText:e.cancelText,cancelColor:e.cancelColor},o.a.createElement("div",null,e.message),o.a.createElement("div",null,e.children))};x.propTypes={title:u.a.string,message:u.a.string,onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,submitText:u.a.string,submitColor:u.a.string,cancelText:u.a.string,cancelColor:u.a.string},x.defaultProps={title:"Insert Text here",message:"Are you sure?",onSubmit:function(){},onCancel:function(){},open:!1,submitText:"Delete",submitColor:"secondary",cancelText:"Cancel",cancelColor:"primary"};var M=x,k=n(6),P=n.n(k),C=n(7),S=n.n(C),O=n(3),N=n.n(O),R=n(13),T=n.n(R),A=n(12),I=n.n(A),D=n(5),j=n.n(D),B=n(54),F=n.n(B),V=n(36),L=n.n(V),_=n(27),U=n.n(_),z=n(24),q=n.n(z),G=n(62),K=n.n(G),W=n(63),H=n.n(W),Y=n(64),Z=n.n(Y),Q=n(65),X=n.n(Q),J=n(10);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ee=function(e){T()(n,e);var t=$(n);function n(){var e;P()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(N()(e),"state",{data:{},open:!1,hasButton:!1}),d()(N()(e),"open",(function(t){var n=e.state.data,r=new Date(1e3*t.time),o=t.button?JSON.parse(t.button.replace(/'/g,'"')):null;n.time="".concat(r.toLocaleTimeString("pt")),n.action=t.action,n.message=t.message,n.robot=t.robot,n.service=t.service,n.module=t.module,o&&(n.buttonText=o.label,n.buttonAction=e.getRobotAlertAction(o)),e.setState({data:n,open:!0,hasButton:!!o})})),d()(N()(e),"getRobotAlertAction",(function(t){var n=t.callback,r=t.data;return n?function(){J.MasterDB.cloudFunction(n,"",r,(function(t){e.setState({open:!1})}))}:function(){return e.setState({open:!1})}})),d()(N()(e),"renderAlertInfo",(function(){var t=e.state.data,n=e.props,r=n.props,a=n.classes;return o.a.createElement(q.a,{component:"div"},o.a.createElement(F.a,{style:{width:"100%"}},o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemAvatar,null,o.a.createElement(L.a,null,o.a.createElement("i",{className:"fas fa-robot"}))),o.a.createElement(v.ListItemText,{primary:t.robot})),o.a.createElement(U.a,{variant:"inset",component:"li"}),o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemAvatar,null,o.a.createElement(L.a,null,o.a.createElement(K.a,null))),o.a.createElement(v.ListItemText,{primary:t.time})),o.a.createElement(U.a,{variant:"inset",component:"li"}),r.includes("service")&&o.a.createElement("div",null,o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemAvatar,null,o.a.createElement(L.a,null,o.a.createElement(H.a,null))),o.a.createElement(v.ListItemText,{primary:t.service,className:a.breakWord})),o.a.createElement(U.a,{variant:"inset",component:"li"})),r.includes("module")&&o.a.createElement("div",null,o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemAvatar,null,o.a.createElement(L.a,null,o.a.createElement(Z.a,null))),o.a.createElement(v.ListItemText,{primary:t.module,className:a.breakWord})),o.a.createElement(U.a,{variant:"inset",component:"li"})),o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemAvatar,null,o.a.createElement(L.a,null,o.a.createElement(X.a,null))),o.a.createElement(v.ListItemText,{primary:t.message,className:a.breakWord}))),t.action&&o.a.createElement("div",null,o.a.createElement(U.a,null),o.a.createElement(F.a,{style:{width:"100%"}},o.a.createElement(v.ListItem,null,o.a.createElement(v.ListItemText,{primary:t.action,className:a.breakWord})))))})),e}return S()(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.data,r=t.open,a=t.hasButton,i=this.props.title;return o.a.createElement(E,{open:r,title:i,style:{maxWidth:500},onCancel:function(){return e.setState({open:!1})},onSubmit:n.buttonAction,submitText:n.buttonText,submitColor:"primary",hasSubmitButton:a,hasCancelButton:!1},this.renderAlertInfo())}}]),n}(r.Component);ee.propTypes={title:u.a.string,props:u.a.array},ee.defaultProps={title:"Log Details",props:[]};var te=Object(p.withStyles)((function(e){return{breakWord:{wordBreak:"break-all"}}}),{withTheme:!0})(ee),ne=n(66),re=n.n(ne),oe=function(e){return o.a.createElement(re.a,{style:e.style,anchor:e.anchor,open:e.open,onClose:e.onClose},e.children)};oe.propTypes={style:u.a.object,anchor:u.a.string,open:u.a.bool,children:u.a.object},oe.defaultProps={style:{},anchor:"left",open:!1,children:o.a.createElement("div",null)},oe.ANCHOR={left:"left",right:"right",top:"top",bottom:"bottom"};var ae=oe,ie=n(16),ce=n.n(ie),ue=n(30),se=n.n(ue),le=n(42),fe=n.n(le),de=n(67),he=n.n(de);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=function(e){var t=o.a.useState(e.open),n=ce()(t,2),r=n[0],a=n[1];o.a.useEffect((function(){e.open!==r&&a(e.open)}),[e.open]);var i;return o.a.createElement(v.List,null,o.a.createElement(v.ListItem,{button:!0,onClick:(i=e.onClick,function(){a(!r),i()})},r?o.a.createElement(fe.a,{style:pe({},e.iconStyle)}):o.a.createElement(se.a,{style:pe({},e.iconStyle)}),o.a.createElement("div",{style:{width:"100%"}},e.item)),e.divided?o.a.createElement(v.Divider,null):[],o.a.createElement(he.a,{className:e.className,style:e.style,in:r},e.children))};ve.propTypes={item:u.a.object,onClick:u.a.func,open:u.a.bool,divided:u.a.bool,iconStyle:u.a.object},ve.defaultProps={item:o.a.createElement("div",null),onClick:function(){},open:!1,divided:!1,style:{},iconStyle:{}};var ge=ve,ye=Object(p.makeStyles)((function(e){return{container:{height:"100%",backgroundColor:function(e){return e.backgroundColor},width:function(e){return e.width},display:"flex",flexDirection:"column"},logoArea:{padding:"17px",textAlign:"center",alignItems:"center",justifyContent:"center"},navigationArea:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center"},accountArea:{padding:function(e){return e.unsetAccountAreaPadding?"unset":"17px"},textAlign:"center",alignItems:"center",justifyContent:"center"}}})),be=function(e){var t=ye(e);return o.a.createElement("div",{className:t.container},o.a.createElement("div",{className:t.logoArea},e.upperElement),o.a.createElement("div",{className:t.navigationArea},e.navigationList.map((function(e,t){return o.a.createElement("div",{key:t,style:{padding:"15px 0px"}},e)}))),o.a.createElement("div",{className:t.accountArea},e.lowerElement))};be.propTypes={upperElement:u.a.node.isRequired,navigationList:u.a.array,lowerElement:u.a.node.isRequired,width:u.a.string,backgroundColor:u.a.string,unsetAccountAreaPadding:u.a.bool},be.defaultProps={upperElement:o.a.createElement("div",null),navigationList:[o.a.createElement("div",null)],lowerElement:o.a.createElement("div",null),width:"68px",backgroundColor:"#424242",unsetAccountAreaPadding:!1};var we=be,Ee=n(33),xe=n.n(Ee),Me=n(22),ke=n.n(Me),Pe=function(e){var t=e.style,n=o.a.useState(null),r=ce()(n,2),a=r[0],i=r[1],c=function(){i(null)};return o.a.createElement("div",{style:t},o.a.cloneElement(e.element,{onClick:function(t){void 0!==e.element.props.onClick&&e.element.props.onClick(),i(t.currentTarget)}}),o.a.createElement(xe.a,{id:"simple-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:c},e.menuList.reduce((function(e,t,n){return t&&"function"!=typeof t&&e.push(o.a.createElement(ke.a,{onClick:function(){t.onClick(),(t.onClose||void 0===t.onClose)&&c()},key:n},t.element)),e}),[])))};Pe.propTypes={element:u.a.node.isRequired,navigationList:u.a.array,lowerElement:u.a.node.isRequired,width:u.a.string,backgroundColor:u.a.string},Pe.defaultProps={element:o.a.createElement("div",null,"Ahaha"),menuList:[{onClick:function(){return console.log("clicked 1")},element:"Profile",onClose:!0}],lowerElement:o.a.createElement("div",null),width:"68px",backgroundColor:"#424242",style:{}};var Ce=Pe,Se=n(11),Oe=n.n(Se),Ne=n(68),Re=n.n(Ne),Te=n(69),Ae=n.n(Te),Ie=n(70),De=n.n(Ie),je=n(71),Be=n.n(je),Fe=n(72),Ve=n.n(Fe),Le=n(37),_e=n.n(Le),Ue=n(73),ze=n.n(Ue),qe=n(74),Ge=n.n(qe),Ke=n(75),We=n.n(Ke),He=n(76),Ye=n.n(He),Ze=n(77),Qe=n.n(Ze),Xe=n(78),Je=n.n(Xe),$e=n(79),et=n.n($e),tt=n(28),nt=n.n(tt),rt=n(80),ot=n.n(rt),at={Add:Object(r.forwardRef)((function(e,t){return o.a.createElement(Ae.a,Oe()({},e,{ref:t}))})),Check:Object(r.forwardRef)((function(e,t){return o.a.createElement(Be.a,Oe()({},e,{ref:t}))})),Clear:Object(r.forwardRef)((function(e,t){return o.a.createElement(_e.a,Oe()({},e,{ref:t}))})),Delete:Object(r.forwardRef)((function(e,t){return o.a.createElement(ze.a,Oe()({},e,{ref:t}))})),DetailPanel:Object(r.forwardRef)((function(e,t){return o.a.createElement(se.a,Oe()({},e,{ref:t}))})),Edit:Object(r.forwardRef)((function(e,t){return o.a.createElement(Ge.a,Oe()({},e,{ref:t}))})),Export:Object(r.forwardRef)((function(e,t){return o.a.createElement(et.a,Oe()({},e,{ref:t}))})),Filter:Object(r.forwardRef)((function(e,t){return o.a.createElement(We.a,Oe()({},e,{ref:t}))})),FirstPage:Object(r.forwardRef)((function(e,t){return o.a.createElement(Ye.a,Oe()({},e,{ref:t}))})),LastPage:Object(r.forwardRef)((function(e,t){return o.a.createElement(Qe.a,Oe()({},e,{ref:t}))})),NextPage:Object(r.forwardRef)((function(e,t){return o.a.createElement(se.a,Oe()({},e,{ref:t}))})),PreviousPage:Object(r.forwardRef)((function(e,t){return o.a.createElement(Ve.a,Oe()({},e,{ref:t}))})),ResetSearch:Object(r.forwardRef)((function(e,t){return o.a.createElement(_e.a,Oe()({},e,{ref:t}))})),Search:Object(r.forwardRef)((function(e,t){return o.a.createElement(nt.a,Oe()({},e,{ref:t}))})),SortArrow:Object(r.forwardRef)((function(e,t){return o.a.createElement(De.a,Oe()({},e,{ref:t}))})),ThirdStateCheck:Object(r.forwardRef)((function(e,t){return o.a.createElement(Je.a,Oe()({},e,{ref:t}))})),ViewColumn:Object(r.forwardRef)((function(e,t){return o.a.createElement(ot.a,Oe()({},e,{ref:t}))}))},it=function(e){return o.a.createElement(Re.a,{style:e.style,title:e.title,columns:e.columns,data:e.data,icons:at,actions:e.actions,options:e.options,components:e.components,localization:e.localization})};it.propTypes={style:u.a.object,title:u.a.string,columns:u.a.array,data:u.a.array,actions:u.a.array,options:u.a.object,components:u.a.object,localization:u.a.object},it.defaultProps={style:{},title:"",columns:[],data:[],actions:[],options:{actionsColumnIndex:-1,draggable:!1,grouping:!1,search:!1,toolbar:!1,searchFieldAlignment:"left",paging:!1},components:{}};var ct=it,ut=n(23),st=n.n(ut),lt=n(81),ft=n.n(lt),dt=n(82),ht=n.n(dt);function mt(e){var t=e.children,n=e.selectedTab,r=e.index,a=st()(e,["children","selectedTab","index"]);return o.a.createElement(q.a,Oe()({component:"div",role:"tabpanel",hidden:n!==r,id:"tabpanel-".concat(r),"aria-labelledby":"tab-".concat(r)},a),n===r&&t)}mt.propTypes={children:u.a.node,index:u.a.any.isRequired,selectedTab:u.a.any.isRequired};var pt=Object(p.makeStyles)((function(e){return{root:{flexGrow:1,height:"100%"},tabPanel:{flexGrow:1,minHeight:0,height:"calc(100% - 48px)",overflowY:"auto"}}}));function vt(e){var t=pt(),n=o.a.useState(e.selectedTab),r=ce()(n,2),a=r[0],i=r[1];o.a.useEffect((function(){e.selectedTab!==a&&i(e.selectedTab)}),[e.selectedTab]);return o.a.createElement("div",{className:t.root},o.a.createElement(ft.a,{value:a,onChange:function(e,t){i(t)},indicatorColor:"primary",textColor:"primary"},e.tabList.map((function(e,t){return o.a.createElement(ht.a,Oe()({key:t,label:e.label},function(e){return{id:"tab-".concat(e),"aria-controls":"tabpanel-".concat(e)}}(t)))}))),e.tabList.map((function(n,r){return o.a.createElement(mt,{key:r,selectedTab:a,index:r,className:e.scrollable?t.tabPanel:void 0},n.component)})))}vt.propTypes={tabList:u.a.array,selectedTab:u.a.number,scrollable:u.a.bool},vt.defaultProps={tabList:[{label:"Tab 1",component:o.a.createElement("div",null,"Component 1")},{label:"Tab 2",component:o.a.createElement("div",null,"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.")},{label:"Tab 3",component:o.a.createElement("div",null,"Component 3")}],selectedTab:0,scrollable:!0};var gt=n(83),yt=n.n(gt),bt=function(e){return o.a.createElement(yt.a,e)};bt.propTypes={},bt.defaultProps={};var wt=bt,Et=n(84),xt=n.n(Et),Mt=n(85),kt=n.n(Mt),Pt=n(47);function Ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function St(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ct(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ot=Object(p.makeStyles)((function(e){return{label:{fontFamily:"Roboto",fontStyle:"normal",fontWeight:"normal",fontSize:"14px",marginLeft:0,marginRight:0,marginBottom:0},colorSwitchBase:{color:Pt.grey[300],"&$colorChecked":{color:Pt.green[500],"& + $colorBar":{backgroundColor:Pt.green[500]}}},colorBar:{},colorChecked:{}}})),Nt=function(e){var t=Ot();return o.a.createElement(xt.a,{control:o.a.createElement(kt.a,{checked:e.toggle,onChange:e.onToggle,color:e.color,disabled:e.disabled,hidden:e.hidden,size:e.size,classes:{switchBase:t.colorSwitchBase,checked:t.colorChecked,track:t.colorBar}}),labelPlacement:e.labelPlacement,label:e.label,classes:{label:t.label},style:St(St({},e.style),{},{marginLeft:0,marginRight:0,marginBottom:0})})};Nt.propTypes={toggle:u.a.bool,onToggle:u.a.func,label:u.a.string,color:u.a.string,labelPlacement:u.a.string,style:u.a.object},Nt.defaultProps={color:"primary"};var Rt=Nt,Tt=n(86),At=n.n(Tt);function It(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Dt=function(e){T()(n,e);var t=It(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"searchInput",void 0),d()(N()(e),"timer",void 0),d()(N()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.props.enableTimeout?(e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,e.props.time)):e.handleSearch()})),d()(N()(e),"handleSearch",(function(){void 0!==e.searchInput&&e.props.onChange(e.searchInput)})),e}return S()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.style,r=e.placeholder;return o.a.createElement("div",{className:t.search,style:n},o.a.createElement("div",{className:t.searchIcon},o.a.createElement(nt.a,null)),o.a.createElement(At.a,{ref:this.setSearchInput,placeholder:r,classes:{root:t.inputRoot,input:t.inputInput},inputProps:{"aria-label":"search"},onChange:this.handleChange}))}}]),n}(r.Component);Dt.propTypes={placeholder:u.a.string,onChange:u.a.func,time:u.a.number,enableTimeout:u.a.bool,style:u.a.object},Dt.defaultProps={placeholder:"Search...",onChange:function(e){console.log(e)},time:250,enableTimeout:!0,style:{}};var jt=Object(p.withStyles)((function(e){return{search:d()({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(p.fade)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(p.fade)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:d()({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200})}}),{withTheme:!0})(Dt),Bt=n(87),Ft=n.n(Bt),Vt=n(88),Lt=n.n(Vt),_t=Object(p.makeStyles)((function(e){return{root:{"& > * + *":{marginTop:e.spacing(2)}},link:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans","&:hover":{cursor:"pointer",textDecoration:"underline"}},lastLabel:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans"}}})),Ut=function(e){var t=_t();return o.a.createElement("div",{className:t.root},o.a.createElement(Ft.a,{separator:o.a.createElement(Lt.a,{fontSize:"small"}),"aria-label":"breadcrumb",style:e.style},e.pathList.map((function(n,r){if(e.pathList.length-1!==r)return o.a.createElement(q.a,{key:r,color:"primary",variant:"inherit",className:t.link,onClick:n.function},n.label)})),o.a.createElement(q.a,{color:"textPrimary",className:t.lastLabel},e.pathList[e.pathList.length-1].label)))};Ut.propTypes={pathList:u.a.array},Ut.defaultProps={pathList:[{label:"Mov.ai",function:function(){return console.log("pth1/")}},{label:"User",function:function(){return console.log("path1/path2")}},{label:"John Doe"}]};var zt=Ut,qt=n(20),Gt=n.n(qt),Kt=n(15),Wt=n.n(Kt),Ht=n(19),Yt=n.n(Ht),Zt=n(2),Qt=n(43),Xt=n.n(Qt);function Jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Jt(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var en={display:"flex",flexDirection:"column",flexGrow:1},tn=function(e){var t=e.antialias,n=e.engineOptions,a=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,u=e.onSceneReady,s=e.is2render,l=e.sceneFactory,f=st()(e,["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady","is2render","sceneFactory"]),d=Object(r.useRef)(null),h=Object(r.useState)(!1),m=ce()(h,2),p=m[0],v=m[1],g=Object(r.useState)(null),y=ce()(g,2),b=y[0],w=y[1],E=Object(r.useState)({width:100,height:100}),x=ce()(E,2),M=x[0],k=x[1];return Object(r.useEffect)((function(){if(!p){v(!0);var e=new Zt.Engine(d.current,t,n,a);!function(e,t){s&&e.runRenderLoop((function(){"function"==typeof c&&c(t),t&&t.render()}))}(e,function(e){var t=l?l(e):new Zt.Scene(e,i);return w(t),t.isReady()?u(t):t.onReadyObservable.addOnce((function(e){return u(e)})),t}(e))}return function(){console.log("Disposing engine and scene"),b&&b.dispose(),b&&b.getEngine()&&b.getEngine().dispose()}}),[d,p,b]),o.a.createElement("div",{style:$t($t({},en),{},{maxHeight:"100%"})},o.a.createElement("canvas",Oe()({ref:d,width:M.width,height:M.height},f)),o.a.createElement(Xt.a,{handleWidth:!0,handleHeight:!0,onResize:function(e,t){k({width:e,height:t}),b&&b.getEngine().resize()}}))};tn.propTypes={antialias:u.a.bool,engineOptions:u.a.object,adaptToDeviceRatio:u.a.bool,sceneOptions:u.a.object,onSceneReady:u.a.func,onRender:u.a.func,is2render:u.a.bool,sceneFactory:u.a.func},tn.defaultProps={antialias:!0,onSceneReady:function(e){},is2render:!0,engineOptions:{preserveDrawingBuffer:!0,stencil:!0}};var nn=tn,rn=n(8),on=n(14),an=n.n(on),cn=0,un=function(){function e(){P()(this,e)}return S()(e,null,[{key:"copy",value:function(e){J.Clipboard.write("scene",e)}},{key:"paste",value:function(){return J.Clipboard.read("scene")}},{key:"getUID",value:function(){return cn++}}]),e}(),sn=function(){function e(t,n){P()(this,e),this.vec=[t,n].map((function(e){return e||0}))}return S()(e,[{key:"x",get:function(){return this.vec[0]}},{key:"y",get:function(){return this.vec[1]}},{key:"toArray",value:function(){return this.vec}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"div",value:function(e){return this.op(e,(function(e,t){return e/t}))}},{key:"dot",value:function(e){return this.vec.reduce((function(t,n,r){return t+n*e.vec[r]}),0)}},{key:"prod",value:function(t){return new e(this.x*t.x-this.y*t.y,this.x*t.y+this.y*t.x)}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"normalize",value:function(){return this.scale(1/this.length())}},{key:"dual",value:function(){return new e(-this.y,this.x)}},{key:"sym",value:function(){return this.scale(-1)}},{key:"conj",value:function(){return new e(this.x,-this.y)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"map",value:function(t){return e.fromArray(this.vec.map(t))}},{key:"op",value:function(t,n){return e.fromArray(this.vec.map((function(e,r){return n(e,t.vec[r])})))}},{key:"reduce",value:function(e,t){return this.vec.reduce(e,t)}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}},{key:"toString",value:function(){return"{x: ".concat(this.x,", y:").concat(this.y,"}")}}],[{key:"fromArray",value:function(t){if(t.length<2)throw new Error("array must have size > 2");return new e(t[0],t[1])}},{key:"of",value:function(t,n){return new e(t,n)}},{key:"ofBabylon",value:function(t){return new e(t.x,t.y)}}]),e}();d()(sn,"ZERO",new sn(0,0)),d()(sn,"e1",new sn(1,0)),d()(sn,"e2",new sn(0,1));var ln=sn,fn=function(){function e(t){var n=this;if(P()(this,e),d()(this,"normalize",(function(){var e=n.length();if(0===e)throw new Error("You can't normalize a zero norm vector");return n.scale(1/e)})),t.constructor!==Array||t.length<3)throw new Error("".concat(t," is not a valid 3-vector"));this.vec3=Wt()(t)}return S()(e,[{key:"x",get:function(){return this.vec3[0]}},{key:"y",get:function(){return this.vec3[1]}},{key:"z",get:function(){return this.vec3[2]}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"op",value:function(t,n){var r=[];return r[0]=n(this.vec3[0],t.vec3[0]),r[1]=n(this.vec3[1],t.vec3[1]),r[2]=n(this.vec3[2],t.vec3[2]),new e(r)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"dot",value:function(e){return this.vec3[0]*e.vec3[0]+this.vec3[1]*e.vec3[1]+this.vec3[2]*e.vec3[2]}},{key:"map",value:function(t){return new e(this.vec3.map(t))}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"toBabylon",value:function(){return new Zt.Vector3(this.vec3[0],this.vec3[1],this.vec3[2])}},{key:"toArray",value:function(){return this.vec3}},{key:"toVec2",value:function(){return new ln(this.x,this.y)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&e.vec3.map((function(t,n){return e.vec3[n]===t})).reduce((function(e,t){return e&&t}),!0)}},{key:"reduce",value:function(e,t){return this.vec3.reduce(e,t)}},{key:"getMax",value:function(){return this.reduce((function(e,t){return Math.max(e,t)}),-Number.MAX_VALUE)}},{key:"getMin",value:function(){return this.reduce((function(e,t){return Math.min(e,t)}),Number.MAX_VALUE)}},{key:"someNaNOrInfinite",value:function(){return this.vec3.some((function(e){return isNaN(e)||!isFinite(e)}))}}],[{key:"ofBabylon",value:function(t){return new e([t.x,t.y,t.z])}},{key:"of",value:function(t){return new e(t||[0,0,0])}},{key:"fromArray",value:function(t){return e.of(t)}},{key:"random",value:function(){return new e([1,2,3].map(Math.random()))}},{key:"orthogonalBasisFromVector",value:function(t){for(var n=[e.e1,e.e2,e.e3],r=0,o=0;o<3;o++)if(0!==t.vec3[o]){r=o;break}var a=n[(r+1)%3].add(n[r].scale(-t.vec3[(r+1)%3]/t.vec3[r]));a=a.normalize();var i=n[(r+2)%3].add(n[r].scale(-t.vec3[(r+2)%3]/t.vec3[r]));return i=(i=i.normalize()).sub(a.scale(a.dot(i))),{u:t.normalize(),v:a,w:i.normalize()}}}]),e}();d()(fn,"ONES",fn.of([1,1,1])),d()(fn,"ZERO",fn.of([0,0,0])),d()(fn,"e1",new fn([1,0,0])),d()(fn,"e2",new fn([0,1,0])),d()(fn,"e3",new fn([0,0,1]));var dn=fn,hn=n(55),mn=n.n(hn),pn=function(){function e(){var t=this;if(P()(this,e),d()(this,"getAnnotations",(function(){return t.annotations})),vn)return vn;vn=this,this.annotations={},this.observersBySceneId={}}return S()(e,[{key:"load",value:function(){return this.retrieveAnnotationsFromDb(),this}},{key:"pushObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&delete this.observersBySceneId[t]}},{key:"retrieveAnnotationsFromDb",value:function(){var e=this;J.MasterDB.subscribe({Scope:"Annotation",Name:"*"},(function(t){console.log("Annotation update",t);var n={del:function(t){return e.delAnnotation(t)},set:function(t){return e.addAnnotation(t)}},r=t.key.Annotation;t.event in n&&(n[t.event](r),Object.keys(e.observersBySceneId).forEach((function(t){return e.observersBySceneId[t].forEach((function(t){return t(e)}))})))}),(function(t){console.log("Annotation start",t);var n=t.value.Annotation;e.addAnnotation(n)}))}},{key:"delAnnotation",value:function(e){var t=this;if(e){var n=Object.keys(e).reduce((function(e,t){return e.push(t),e}),[]);Object.keys(this.annotations).forEach((function(e){var r=t.annotations[e];r.names=r.names.filter((function(e){return!n.includes(e)})),r.labels=r.labels.filter((function(e){return!n.includes(e)}))}))}}},{key:"addAnnotation",value:function(e){var t=this;e&&Object.keys(e).forEach((function(n){var r=e[n];if(r.Type){var o=r.Type.toLowerCase(),a=r.Label;o in t.annotations||(t.annotations[o]={names:[],labels:[]}),t.annotations[o].names.push(n),t.annotations[o].labels.push(a||n)}}))}}],[{key:"getInstance",value:function(){return new e}},{key:"getAnnotations",value:function(){return e.getInstance().getAnnotations()}}]),e}(),vn=null,gn=pn;function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var wn=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};P()(this,e),d()(this,"getType",(function(){return e.TYPE})),d()(this,"getMouseContextActions",(function(e){return[{title:"Copy",onClick:function(){return un.copy(n.getCopyFunction())}},{title:"Delete",onClick:function(){return e.getNodeFromTree(n.name).forEach((function(t){return e.onDeleteNode(t,!1)}))}}]})),this.name=t.name,this.mesh=t,this.mesh.getMouseContextActions=this.getMouseContextActions,this.mesh.nodeItem=this,this.keyValueMap=r}return S()(e,[{key:"dispose",value:function(){this.mesh.dispose()}},{key:"toDict",value:function(){var e,t,n,r=this;return{name:this.name,type:this.getType(),position:dn.ofBabylon(null===(e=this.mesh)||void 0===e?void 0:e.position).toArray(),quaternion:rn.Maybe.fromNull(null===(t=this.mesh)||void 0===t?void 0:t.rotationQuaternion).map((function(e){return[e.w,e.x,e.y,e.z]})).orLazy((function(){var e=Zt.Quaternion.RotationYawPitchRoll(r.mesh.rotation.y,r.mesh.rotation.x,r.mesh.rotation.z);return[e.w,e.x,e.y,e.z]})),color:rn.Maybe.fromNull(null===(n=this.mesh)||void 0===n?void 0:n.material).flatMap((function(e){return rn.Maybe.fromNull(e.diffuseColor).map((function(e){return[e.r,e.g,e.b]}))})).orSome([0,0,0]),keyValueMap:this.keyValueMap,isVisible:this.mesh.isEnabled()}}},{key:"toForm",value:function(){var t=this.toDict(),n=new Zt.Color3(t.color[0],t.color[1],t.color[2]),r={jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},position:{type:"object",title:"Position",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},quaternion:{type:"object",title:"Orientation",properties:{w:{type:"number",title:"w"},x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},color:{type:"string",title:"Color"}}},uiSchema:{type:{"ui:disabled":!0},color:{"ui:widget":"color"},oldName:{"ui:widget":"hidden"},position:{"ui:widget":"collapse"},quaternion:{"ui:widget":"collapse"}},data:{oldName:t.name,name:t.name,type:t.type,position:{x:t.position[0],y:t.position[1],z:t.position[2]},quaternion:{w:t.quaternion[0],x:t.quaternion[1],y:t.quaternion[2],z:t.quaternion[3]},color:n.toHexString()}};return e.setAnnotations2Form(r,this.keyValueMap),r}},{key:"ofForm",value:function(e){var t=this;this.name=e.name,this.mesh.name=e.name,rn.Maybe.fromNull(null==e?void 0:e.position).forEach((function(e){var n=[e.x,e.y,e.z].map(Number.parseFloat);t.mesh.position=Zt.Vector3.FromArray(n)})),rn.Maybe.fromNull(null==e?void 0:e.quaternion).forEach((function(e){var n=[e.x,e.y,e.z,e.w].map(Number.parseFloat);t.mesh.rotationQuaternion=Zt.Quaternion.FromArray(n).normalize()})),this.mesh.material&&(this.mesh.material.diffuseColor=Zt.Color3.FromHexString(e.color),this.mesh.material.emissiveColor=Zt.Color3.FromHexString(e.color)),this.keyValueMap=bn({},e.annotations)}},{key:"getCopyFunction",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(n,r){return r.getSceneMemory().map((function(o){var a=o.scene,i=r.getRootNode().item,c=e.toDict();c.name+="_copy"+un.getUID();var u=dn.ofBabylon(n).toArray();u[2]=c.position[2],c.position=u;var s=e.ofDict(a,c,r);return s.mesh.parent=i.mesh,r.addNodeItem2Tree(s,Un.NAME,!0,!0,t),s}))}}},{key:"delVertex",value:function(){var e,t=null===(e=this.mesh.graphVertex)||void 0===e?void 0:e.delVertex;if(!t){var n,r=((null===(n=this.mesh)||void 0===n?void 0:n._children)||[]).filter((function(e){return!!e.graphVertex})).map((function(e){return e.graphVertex.delVertex}));t=function(){return r.forEach((function(e){return e()}))}}t()}}],[{key:"mapDict2Mesh",value:function(e,t){if(!t)throw new Error("can't map a null mesh");return rn.Maybe.fromNull(e).forEach((function(n){rn.Maybe.fromNull(e.name).forEach((function(e){return t.name=e})),rn.Maybe.fromNull(n.position).forEach((function(e){return t.position=dn.of(e).toBabylon()})),rn.Maybe.fromNull(n.quaternion).forEach((function(e){var n=new Zt.Quaternion(e[1],e[2],e[3],e[0]);t.rotationQuaternion=n.normalize()})),rn.Maybe.fromNull(n.color).forEach((function(e){var n=new Zt.Color3(e[0],e[1],e[2]);rn.Maybe.fromNull(t.material).forEach((function(e){rn.Maybe.fromNull(e.diffuseColor).forEach((function(e){return t.material.diffuseColor=n})),rn.Maybe.fromNull(e.emissiveColor).forEach((function(e){return t.material.emissiveColor=n}))}))}))})),t}},{key:"setAnnotations2Form",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.jsonSchema.properties.annotations={title:"Annotations",type:"object",properties:{}},e.uiSchema.annotations={"ui:widget":"collapse"},e.data.annotations=bn({},t);var n=gn.getAnnotations();["safety","behaviour","localization","navigation"].forEach((function(t){e.jsonSchema.properties.annotations.properties[t]={title:mn()(t),type:"string"},e.uiSchema.annotations[t]={"ui:widget":"selectScopeModal","ui:options":{scopeList:"Annotation",name:mn()(t),filter:function(e){return n[t].names.includes(e.name)}}}}))}}]),e}();d()(wn,"TYPE","NodeItem");var En=wn,xn=function(){function e(t,n,r){P()(this,e);for(var o=[t,n,r],a=0;a<o.length;a++)if(o[a].constructor!==Array||o[a].length<3)throw Error("One of the inputs is not a array");this.mat3=o.map((function(e){return new dn(e)}))}return S()(e,[{key:"prodVec",value:function(e){for(var t=new dn([0,0,0]),n=0;n<this.mat3.length;n++)t=t.add(this.mat3[n].scale(e.vec3[n]));return t}},{key:"dotVec",value:function(e){for(var t=[0,0,0],n=0;n<this.mat3.length;n++)t[n]=this.mat3[n].dot(e);return new dn(t)}},{key:"prod",value:function(t){var n=this.prodVec(t.mat3[0]),r=this.prodVec(t.mat3[1]),o=this.prodVec(t.mat3[2]);return new e(n.vec3,r.vec3,o.vec3)}},{key:"dot",value:function(t){var n=this.dotVec(t.mat3[0]),r=this.dotVec(t.mat3[1]),o=this.dotVec(t.mat3[2]);return new e(n.vec3,r.vec3,o.vec3)}},{key:"map",value:function(t){var n=this.mat3[0].map(t),r=this.mat3[1].map(t),o=this.mat3[2].map(t);return new e(n.vec3,r.vec3,o.vec3)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&this.mat3.map((function(t,n){return t.equals(e.mat3[n])})).reduce((function(e,t){return e&&t}),!0)}}],[{key:"ofBabylonMatrix",value:function(t){var n=Zt.Matrix.GetAsMatrix3x3(t);return new e([n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]])}},{key:"of",value:function(t,n,r){return new e(t,n,r)}},{key:"eye",value:function(){return new e([1,0,0],[0,1,0],[0,0,1])}}]),e}(),Mn=function(){function e(t){P()(this,e),this._scene=t,this._isPosition=!1,this._isRotation=!1,this._isBoundingBox=!1,this._isScale=!1,this._usePointerToAttachGizmos=!1}return S()(e,[{key:"isPosition",value:function(e){return this._isPosition=e,this}},{key:"isRotation",value:function(e){return this._isRotation=e,this}},{key:"isBoundingBox",value:function(e){return this._isBoundingBox=e,this}},{key:"isScale",value:function(e){return this._isScale=e,this}},{key:"usePointerToAttachGizmos",value:function(e){return this._usePointerToAttachGizmos=e,this}},{key:"build",value:function(){var e=new Zt.GizmoManager(this._scene);return e.positionGizmoEnabled=this._isPosition,e.rotationGizmoEnabled=this._isRotation,e.boundingBoxGizmoEnabled=this._isBoundingBox,e.scaleGizmoEnabled=this._isScale,e.usePointerToAttachGizmos=this._usePointerToAttachGizmos,e}}]),e}(),kn=function(){function e(t){P()(this,e),this._scene=t,this._sphericalCoordinates=null,this._target=null,this._name="camera".concat(Math.floor(1e3*Math.random()))}return S()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"sphericalCoordinates",value:function(e){return this._sphericalCoordinates=e,this}},{key:"target",value:function(e){return this._target=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a camera, e.g ".concat(e))})),new Zt.ArcRotateCamera(this._name,this._sphericalCoordinates.x,this._sphericalCoordinates.y,this._sphericalCoordinates.z,this._target,this._scene)}}]),e}(),Pn=function(){function e(t){P()(this,e),this._scene=t,this._position=null,this._name="light".concat(Math.floor(1e3*Math.random())),this._intensity=1}return S()(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new Zt.PointLight(this._name,this._position,this._scene);return e.intensity=this._intensity,e}}]),e}(),Cn=function(){function e(t){P()(this,e),this._scene=t,this._name="referential".concat(Math.floor(1e3*Math.random())),this._isPickable=!0,this._boxParams={isVisible:!0,size:.25},this._size=1}return S()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"boxParams",value:function(e){return this._boxParams=e,this}},{key:"size",value:function(e){return this._size=e,this}},{key:"build",value:function(){var e=this._size,t=Zt.Mesh.CreateLines("axisX".concat(this._name),[new Zt.Vector3.Zero,new Zt.Vector3(e,0,0),new Zt.Vector3(.95*e,.05*e,0),new Zt.Vector3(e,0,0),new Zt.Vector3(.95*e,-.05*e,0)],this._scene);t.color=new Zt.Color3(1,0,0),t.isPickable=!1;var n=Zt.Mesh.CreateLines("axisY".concat(this._name),[new Zt.Vector3.Zero,new Zt.Vector3(0,e,0),new Zt.Vector3(-.05*e,.95*e,0),new Zt.Vector3(0,e,0),new Zt.Vector3(.05*e,.95*e,0)],this._scene);n.color=new Zt.Color3(0,1,0),n.isPickable=!1;var r=Zt.Mesh.CreateLines("axisZ".concat(this._name),[new Zt.Vector3.Zero,new Zt.Vector3(0,0,e),new Zt.Vector3(0,-.05*e,.95*e),new Zt.Vector3(0,0,e),new Zt.Vector3(0,.05*e,.95*e)],this._scene);r.color=new Zt.Color3(0,0,1),r.isPickable=!1;var o=Zt.MeshBuilder.CreateBox(this._name,{size:this._boxParams.size},this._scene);return o.isVisible=this._boxParams.isVisible,o.isPickable=this._isPickable,t.parent=o,n.parent=o,r.parent=o,o}}]),e}(),Sn=function(){function e(t){P()(this,e),this._scene=t,this._name="camera".concat(Math.floor(1e3*Math.random())),this._width=1,this._height=1,this._textureSrc=null,this._isPickable=!1}return S()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"textureSrc",value:function(e){return this._textureSrc=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"build",value:function(){var e=Zt.Mesh.CreateGround(this._name,this._width,this._height,1,this._scene);return e.translate(new Zt.Vector3(0,-1,0),.1,Zt.Space.WORLD),this._textureSrc&&(e.material=new Zt.StandardMaterial("Texture".concat(this._name),this._scene),e.material.ambientTexture=new Zt.Texture(this._textureSrc,this._scene),e.material.ambientTexture.uScale=1,e.material.ambientTexture.vScale=1),e.isPickable=this._isPickable,e}}]),e}(),On=function(){function e(t){P()(this,e),this._scene=t,this._direction=null,this._name="Dlight".concat(Math.floor(1e3*Math.random())),this._intensity=1}return S()(e,[{key:"direction",value:function(e){return this._direction=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new Zt.DirectionalLight(this._name,this._direction.normalize(),this._scene);return e.intensity=this._intensity,e}}]),e}(),Nn=n(89),Rn=n.n(Nn);function Tn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var An=function(e){T()(n,e);var t=Tn(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_SIZE,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P()(this,n),r=t.call(this,e,a),d()(N()(r),"getType",(function(){return n.TYPE})),r.size=o,r}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=rn.Maybe.fromNull(t),o=r.flatMap((function(e){return rn.Maybe.fromNull(e.size)})).orSome(n.DEFAULT_SIZE),a=r.flatMap((function(e){return rn.Maybe.fromNull(e.name)})).orSome("Box".concat(Math.floor(1e3*Math.random()))),i=r.flatMap((function(e){return rn.Maybe.fromNull(e.keyValueMap)})).orUndefined(),c=Bn.createBox(e,new Zt.Color3(Math.random(),Math.random(),Math.random()),o,a);return En.mapDict2Mesh(t,c),new n(c,o,i)}}]),n}(En);d()(An,"DEFAULT_SIZE",.5),d()(An,"TYPE","Box");var In=An,Dn=function(){function e(){P()(this,e)}return S()(e,null,[{key:"getGlobalCoordinates",value:function(t,n){if(t.parent&&t.parent.name===Un.NAME||t.name===Un.NAME)return dn.ofBabylon(n);var r=t.parent,o=dn.ofBabylon(r.position),a=e.getRotationMatrix(r),i=dn.ofBabylon(r.scaling);return a.prodVec(i.mul(e.getGlobalCoordinates(t.parent,n))).add(o)}},{key:"getGlobalCoord",value:function(t,n){if(t.parent&&t.parent.name===Un.NAME||t.name===Un.NAME)return n;var r=t.parent,o=dn.ofBabylon(r.position),a=e.getRotationMatrix(r),i=dn.ofBabylon(r.scaling),c=a.prodVec(i.mul(dn.ofBabylon(n))).add(o);return e.getGlobalCoord(r,c.toBabylon())}},{key:"getBabylonCoordinates",value:function(e){return Un.forwardCoordinates(e)}},{key:"getLocalCoordFromGlobal",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.parent&&t.parent.name===Un.NAME||t.name===Un.NAME)return dn.ofBabylon(n);var o=t.parent,a=r?dn.ofBabylon(o.position):dn.ZERO,i=e.getRotationMatrix(o),c=dn.ofBabylon(o.scaling);return c.map((function(e){return 1/e})).mul(i.dotVec(e.getLocalCoordFromGlobal(o,n,r).sub(a)))}},{key:"getLocalCoordFromWorld",value:function(t,n){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t.parent)return n;var o=t.parent,a=r?dn.ofBabylon(o.position):dn.ZERO,i=e.getRotationMatrix(o),c=dn.ofBabylon(o.scaling),u=c.map((function(e){return 1/e}));return u.mul(i.dotVec(e.getLocalCoordFromWorld(o,n,r).sub(a)))}},{key:"getRotationMatrix",value:function(e){var t=new Zt.Matrix,n=rn.Maybe.fromNull(null==e?void 0:e.rotationQuaternion);return n.forEach((function(e){return e.toRotationMatrix(t)})),n.orElseRun((function(){Zt.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z).toRotationMatrix(t)})),xn.ofBabylonMatrix(t)}},{key:"showNormals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zt.Color3.Red(),o=t.getVerticesData(Zt.VertexBuffer.NormalKind),a=t.getVerticesData(Zt.VertexBuffer.PositionKind),i=[],c=0;c<o.length;c+=3){var u=Zt.Vector3.FromArray(a,c),s=u.add(Zt.Vector3.FromArray(o,c).scaleInPlace(n));i.push([u.add(t.position),s.add(t.position)])}var l=Zt.MeshBuilder.CreateLineSystem("normalLines",{lines:i},e);return l.color=r,l.parent=t,l}},{key:"orthogonalBasisFromVector",value:function(e){for(var t=[new Zt.Vector3(1,0,0),new Zt.Vector3(0,1,0),new Zt.Vector3(0,0,1)],n=[e.x,e.y,e.z],r=0,o=0;o<3;o++)if(0!==n[o]){r=o;break}var a=t[(r+1)%3].add(t[r].scale(-n[(r+1)%3]/n[r]));a=a.normalize();var i=t[(r+2)%3].add(t[r].scale(-n[(r+2)%3]/n[r]));return i=(i=i.normalize()).subtract(a.scale(Zt.Vector3.Dot(a,i))),{u:Zt.Vector3.FromArray(n).normalize(),v:a,w:i.normalize()}}},{key:"cameraBuilder",value:function(e){return new kn(e)}},{key:"gizmoManagerBuilder",value:function(e){return new Mn(e)}},{key:"meshFromPositionAndFaces",value:function(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=new Zt.VertexData;a.positions=n.flatMap((function(e){return[e.x,e.y,e.z]})),a.indices=r.flatMap((function(e){return e}));var i=new Zt.Mesh(e,t);return a.applyToMesh(i,o),i}},{key:"triangulatePolygon",value:function(e){for(var t=Rn()(e.map((function(e){return[e.x,e.y,e.z]})).flatMap((function(e){return e})),null,3),n=t.length/3,r=[],o=0;o<n;o++){var a=3*o;r.push([t[a],t[a+1],t[a+2]])}return r}},{key:"computeOrientation",value:function(e){var t=e.length,n=e.map((function(e){return dn.ofBabylon(e)})),r=0;return n.forEach((function(e,o){var a=n[(o+1)%t].sub(n[o]);r+=dn.of([-e.y,e.x,e.z]).dot(a)})),r/2}},{key:"pointAverage",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),Zt.Vector3.Zero()).scale(1/e.length):Zt.Vector3.Zero()}},{key:"pointAverageVec3",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),dn.ZERO).scale(1/e.length):dn.ZERO}},{key:"randomVector3",value:function(e,t){return new Zt.Vector3.FromArray([0,0,0].map((function(n){return e+(t-e)*Math.random()})))}},{key:"getMaterialFromColor",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MaterialFromColor".concat(jn()),r=new Zt.StandardMaterial(n,t);return r.diffuseColor=e,r.emissiveColor=e,r}}]),e}();d()(Dn,"toGlobalCoord",(function(e){var t=e.getRootNode().item.mesh;return function(e){var n=function(e){return Dn.getLocalCoordFromWorld({parent:t},dn.ofBabylon(e)).toBabylon()};return Array.isArray(e)?e.map(n):n(e)}})),d()(Dn,"createOrientedCone",(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Zt.Vector3(1,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt.Color3.Gray(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OrientedCone".concat(jn()),o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,i={positions:[],faces:[]},c=t.length()/3,u=Dn.orthogonalBasisFromVector(t),s=u.v,l=u.w,f=Math.sign(Zt.Vector3.Dot(Zt.Vector3.Cross(s,l),t)),d=0;d<a;d++){var h=f*(2*Math.PI/a)*d;i.positions.push(s.scale(c*Math.cos(h)).add(l.scale(c*Math.sin(h))))}i.positions.push(Zt.Vector3.Zero()),i.positions.push(t);for(var m=i.positions.length-1,p=i.positions.length-2,v=0;v<a;v++)i.faces.push([m,(v+1)%a,v]),i.faces.push([p,v,(v+1)%a]);var g=Dn.meshFromPositionAndFaces(r,e,i.positions,i.faces);g.convertToFlatShadedMesh();var y=new Zt.StandardMaterial("OrientedConeMaterial".concat(r),e);return y.diffuseColor=n,y.emissiveColor=n,g.material=y,g.isPickable=o,g})),d()(Dn,"createSphere",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zt.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sphere".concat(jn()),o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=Zt.Mesh.CreateSphere(r,16,n,e),i=Dn.getMaterialFromColor(t,e,"SphereMaterial".concat(r));return a.material=i,a.isPickable=o,a})),d()(Dn,"createBox",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zt.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:In.DEFAULT_SIZE,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Box".concat(jn()),o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=Zt.Mesh.CreateBox(r,n,e),i=new Zt.StandardMaterial("BoxMaterial".concat(r),e);return i.diffuseColor=t,i.emissiveColor=t,a.material=i,a.isPickable=o,a})),d()(Dn,"createTubeFromPoints",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt.Color3.Gray(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Tube".concat(jn()),a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=Zt.MeshBuilder.CreateTube(o,{path:t,radius:r,sideOrientation:Zt.Mesh.DOUBLESIDE,updatable:!0,cap:Zt.Mesh.CAP_ALL},e);return i.material=Dn.getMaterialFromColor(n,e,"Material".concat(o)),i.isPickable=a,i})),d()(Dn,"positionalLightBuilder",(function(e){return new Pn(e)})),d()(Dn,"directionalLightBuilder",(function(e){return new On(e)})),d()(Dn,"referentialBuilder",(function(e){return new Cn(e)})),d()(Dn,"getGroundPosition",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e===t}));return n.hit?rn.Maybe.some(n.pickedPoint):rn.Maybe.none()})),d()(Dn,"pickMesh",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e!==t&&e.isEnabled()}));return n.hit&&n.pickedMesh.isPickable?rn.Maybe.some(n.pickedMesh):rn.Maybe.none()})),d()(Dn,"groundBuilder",(function(e){return new Sn(e)})),d()(Dn,"piecewiseCurveDistance",(function(e){for(var t=0,n=0;n<e.length-1;n++){t+=e[n+1].subtract(e[n]).length()}return t})),d()(Dn,"getCurveOrientations",(function(e){for(var t=[],n=0;n<e.length-1;n++){var r=e[n+1].subtract(e[n]);t.push(Math.atan2(r.y,r.x))}return t.push(t[t.length-1]),t})),d()(Dn,"getSplineFromCurve",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=!1;return{points:Zt.Curve3.CreateCatmullRomSpline(e,t,n).getPoints()}})),d()(Dn,"splineObj2redis",(function(e){var t=Dn.getCurveOrientations(e.points);return e.points.map((function(e,n){return[e.x,e.y,t[n]]}))}));var jn=function(){return Math.floor(1e3*Math.random())},Bn=Dn;function Fn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Vn=-Math.PI/2,Ln={position:[0,0,0],scaling:[1,-1,1],quaternion:[Math.cos(Vn/2),Math.sin(Vn/2),0,0]},_n=function(e){T()(n,e);var t=Fn(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return P()(this,n),r=t.call(this,e,o),d()(N()(r),"getType",(function(){return n.TYPE})),r}return S()(n,[{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);return e.uiSchema.name={"ui:disabled":!0},e}},{key:"getMouseContextActions",value:function(){return[]}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=n.getRosOrigin(e),o=Bn.referentialBuilder(e).name(n.NAME).isPickable(!0).boxParams({isVisible:!0,size:.25}).build();return o.parent=r,En.mapDict2Mesh(t,o),new n(o,rn.Maybe.fromNull(t).flatMap((function(e){return rn.Maybe.fromNull(e.keyValueMap)})).orUndefined())}},{key:"getRosOrigin",value:function(e){var t=Zt.MeshBuilder.CreateBox("ROS_ORIGIN",{size:.001},e);t.isVisible=!1,t.isPickable=!1,t.position=dn.of(Ln.position).toBabylon(),t.scaling=dn.of(Ln.scaling).toBabylon();var n=new Zt.Quaternion(Ln.quaternion[1],Ln.quaternion[2],Ln.quaternion[3],Ln.quaternion[0]);return t.rotationQuaternion=n.normalize(),t}},{key:"inverseCoordinates",value:function(e){var t=Ln.quaternion,n=Bn.getRotationMatrix({rotationQuaternion:new Zt.Quaternion(t[1],t[2],t[3],t[0])}),r=dn.of(Ln.scaling).map((function(e){return 1/e})),o=dn.of(Ln.position);return r.mul(n.dotVec(dn.ofBabylon(e).sub(o))).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}},{key:"forwardCoordinates",value:function(e){var t=Ln.quaternion,n=Bn.getRotationMatrix({rotationQuaternion:new Zt.Quaternion(t[1],t[2],t[3],t[0])}),r=dn.of(Ln.scaling),o=dn.of(Ln.position);return n.prodVec(r.mul(dn.ofBabylon(e))).add(o).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}}]),n}(En);d()(_n,"TYPE","GlobalRef"),d()(_n,"NAME","Global ref");var Un=_n,zn=function(){function e(){P()(this,e),this.memory={}}return S()(e,[{key:"action",value:function(e){e.getSceneMemory().forEach((function(e){e.gizmoManager.attachedMesh=null,e.camera.attachControl(e.canvas,!0)})),e.closeContextDial&&e.closeContextDial(),e.setContextActionIndex&&e.setContextActionIndex()}},{key:"onChange",value:function(e){}}]),e}();function qn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Gn=function(e){T()(n,e);var t=qn(n);function n(e,r){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P()(this,n),o=t.call(this,e,a),d()(N()(o),"getCopyFunction",(function(){return function(e,t){}})),o.assetName=r,o}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.assetName=this.assetName,e}}]),n}(En);function Kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Hn=function(e){T()(n,e);var t=Wn(n);function n(e,r,o,a){var i;return P()(this,n),i=t.call(this,e,a),d()(N()(i),"getType",(function(){return n.TYPE})),i.size=r,i.textureSrc=o,i}return S()(n,[{key:"dispose",value:function(){an()(j()(n.prototype),"dispose",this).call(this)}},{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.size=this.size,e.textureSrc=this.textureSrc,e}},{key:"toForm",value:function(){var e=this.toDict();return{jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},assetName:{type:"string",title:"Asset Name"}}},uiSchema:{type:{"ui:disabled":!0},assetName:{"ui:disabled":!0},oldName:{"ui:widget":"hidden"}},data:{oldName:e.name,name:e.name,type:e.type,assetName:e.assetName}}}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.keyValueMap=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kn(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.annotations)}}]),n}(Gn);d()(Hn,"TYPE","Map");var Yn=Hn,Zn=n(34),Qn=(n(111),n(112),function e(){P()(this,e)});d()(Qn,"createGizmo",(function(e){var t=new Zt.RotationGizmo(new Zt.UtilityLayerRenderer(e));return t.xGizmo.dragBehavior.detach(),t.xGizmo.scaleRatio=0,t.yGizmo.dragBehavior.detach(),t.yGizmo.scaleRatio=0,t})),d()(Qn,"createCamera",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){},r=1,o=Bn.cameraBuilder(e).sphericalCoordinates(new Zt.Vector3(0,0,14)).target(Zt.Vector3.Zero()).name("camera").build();return o.attachControl(t,!1),o.inertia=.7,o.collisionRadius=new Zt.Vector3(r,r,r),o.panningInertia=.5,o.checkCollisions=!0,o.panningSensibility=0,o.lowerRadiusLimit=2,n(o),o})),d()(Qn,"createLight",(function(e){return Bn.directionalLightBuilder(e).name("light").direction(new Zt.Vector3(0,-1,0)).intensity(.35).build()})),d()(Qn,"createMeshGround",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,r=Zt.Mesh.CreateGround("groundMesh",t,n,20,e);return r.translate(new Zt.Vector3(0,-1,0),.01,Zt.Space.WORLD),r.material=new Zt.StandardMaterial("wireframe",e),r.material.wireframe=!0,r.isPickable=!1,r.checkCollisions=!0,r})),d()(Qn,"createScene",(function(e){var t=new Zt.Scene(e);return t.clearColor=Zt.Color3.Black,t.collisionsEnabled=!0,t._uid=t.getUniqueId(),t})),d()(Qn,"createMouseLocationText",(function(e){var t=Zn.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),n=new Zn.TextBlock;return n.text="",n.color="white",n.fontSize=17,n.left=-560,n.top=-145,t.addControl(n),n}));var Xn=Qn;function Jn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var $n=function(e){T()(n,e);var t=Jn(n);function n(){return P()(this,n),t.apply(this,arguments)}return S()(n,[{key:"onPointerDown",value:function(e,t){}},{key:"onPointerMove",value:function(e,t){}},{key:"onPointerUp",value:function(e,t){}},{key:"onKeyUp",value:function(e,t){}}]),n}(zn);function er(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(n){e.push({predicate:function(e){return!0},action:t});for(var r=0;r<e.length;r++){var o=e[r];if(o.predicate(n)){o.action();break}}}}var tr=n(90),nr=n.n(tr);function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var or=function(e){T()(n,e);var t=rr(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"getType",(function(){return n.TYPE})),e}return S()(n,[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=rn.Maybe.fromNull(t).map((function(e){return e.name})).orSome("KeyPoint".concat(Math.floor(1e3*Math.random()))),o=Zt.MeshBuilder.CreatePolyhedron(r,{custom:ar,size:n.DEFAULT_SIZE},e),a=new Zt.StandardMaterial("KeyPointMaterial".concat(r),e);o.material=a,o.convertToFlatShadedMesh();var i=Bn.referentialBuilder(e).isPickable(!1).boxParams({isVisible:!1,size:.1*n.DEFAULT_SIZE}).name("".concat(r,"Axis")).build();return i.parent=o,En.mapDict2Mesh(t,o),new n(o,t.keyValueMap)}}]),n}(En);d()(or,"TYPE","KeyPoint"),d()(or,"DEFAULT_SIZE",.25);var ar={name:"Triangular Antiprism (Octahedron)",category:["Antiprism"],vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},ir=or,cr=function(){function e(t){var n=this;return P()(this,e),t.getSceneMemory().map((function(e){var r=e.scene,o=r._uid;return o in ur?ur[o]:(n.scene=r,n.mainView=t,n.meshSelectionSet=new Set,ur[o]=n,n)})).orSome(this)}return S()(e,[{key:"add",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.meshSelectionSet.has(e)?t&&this.meshSelectionSet.delete(e):this.meshSelectionSet.add(e),this}},{key:"addArray",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.forEach((function(e){return t.add(e,n)})),this}},{key:"clear",value:function(){return this.meshSelectionSet=new Set,this}},{key:"meshes",value:function(){return Wt()(this.meshSelectionSet)}},{key:"has",value:function(e){return this.meshSelectionSet.has(e)}},{key:"filter",value:function(e){var t=new Set;return this.meshSelectionSet.forEach((function(n){e(n)&&t.add(n)})),this.meshSelectionSet=t,this}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),ur={},sr=function(){function e(t){var n=this;return P()(this,e),t.getSceneMemory().map((function(e){var r=e.scene,o=r._uid;return o in mr?mr[o]:(n.scene=r,n.mesh=null,n.arrayOfMeshes=[],n.angleByMeshName={},n.mainView=t,n.theta=0,mr[o]=n,n)})).orSome(this)}return S()(e,[{key:"push",value:function(e){if(0===e.length)return this;e=Array.isArray(e)?e:[e],this.arrayOfMeshes=nr()(this.arrayOfMeshes.concat(e),(function(e){return e.name})),this.angleByMeshName=this.arrayOfMeshes.reduce((function(e,t){return e[t.name]=hr(t),e}),{});var t=Bn.pointAverage(this.arrayOfMeshes.map((function(e){return Bn.getGlobalCoordinates(e,e.position).toBabylon()})));return this.createPlaceHolderIn(t),this}},{key:"clear",value:function(){return this.arrayOfMeshes=[],this.mesh&&this.mesh.dispose(),this}},{key:"createPlaceHolderIn",value:function(t){var n=this;(null===this.mesh||this.mesh.isDisposed())&&(this.mesh=ir.ofDict(this.scene,{name:pr,type:e,position:[0,0,0],quaternion:Zt.Quaternion.Identity(),color:[.5,.5,.5],keyValueMap:{},isVisible:!0}).mesh,this.mesh.material=lr(this.scene)());var r=this;return this.mesh.getMouseContextActions=function(){return[{title:"Delete",onClick:function(){r.mainView.addGizmo2Mesh(),r.clear(),cr.ofMainView(n.mainView).clear(),r.mainView.highlightMeshesInScene(),r.mainView.highlightNodesInTree()}}]},this.mesh.onClick=function(){},this.mesh.isSelectionPlaceHolder=!0,this.mesh.parent=this.mainView.getRootNode().item.mesh,this.mesh.position=t.add(new Zt.Vector3(0,0,vr)),this.mesh.observers=new Zt.Observable,this.mesh.observers.add(this.getPlaceHolderObs()),this.mesh}},{key:"getPlaceHolderObs",value:function(){var e=this;return function(t){var n=t.updatedPointMesh,r=t.is2updateServer,o=t.displacement,a=e.arrayOfMeshes.filter((function(e){return!e.isDisposed()})),i=hr(n),c=i-e.theta;e.theta=i,a.forEach((function(t){!function(e,t,n,r,o,a){Math.abs(e)<.001?function(e,t){var n=Bn.getLocalCoordFromWorld(e,dn.ofBabylon(t),!1),r=dn.ofBabylon(e.position).add(n);e.position=r.toBabylon()}(t,n):function(e,t,n,r,o){var a=dn.ofBabylon(e.position),i=dn.ofBabylon(t.position).sub(a).toVec2(),c=ln.of(Math.cos(n),Math.sin(n)).prod(i),u=dn.of([c.x,c.y,0]).toBabylon();t.position=new Zt.Vector3(e.position.x,e.position.y,t.position.z).add(u);var s=r.angleByMeshName[t.name]+o;t.rotationQuaternion=new Zt.Quaternion(0,0,Math.sin(s/2),Math.cos(s/2))}(r,t,o,a,e)}(i,t,o,n,c,e),r&&(e.mainView.updateNodeInServer(t.name),e.mesh.rotationQuaternion=Zt.Quaternion.Identity(),e.angleByMeshName[t.name]=hr(t),e.theta=0),rn.Maybe.fromNull(t.observers).forEach((function(e){return e.notifyObservers({updatedPointMesh:t,is2updateServer:r,displacement:o})})),rn.Maybe.fromNull(t.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:t,is2updateServer:r,displacement:o})}))})),0===a.length&&e.clear()}}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),lr=function(e){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fr,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dr;Zt.Effect.ShadersStore.customVertexShader=t,Zt.Effect.ShadersStore.customFragmentShader=n;var r=new Zt.ShaderMaterial("shader",e,{vertex:"custom",fragment:"custom"},{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection","time"]});r.backFaceCulling=!1;var o=0,a=(new Date).getTime();return r.onBindObservable.add((function(){var e=((new Date).getTime()-a)/1e3;r.setFloat("time",o),o+=e,a=(new Date).getTime()})),r}},fr="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n    vPosition = position;\n    vNormal = normal;\n}",dr="precision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n// Uniforms\nuniform mat4 world;\nuniform float time;\n\nvoid main(void) {\n    // World values\n    vec3 p = vec3(world * vec4(vPosition, 1.0));\n    vec3 n = normalize(vec3(world * vec4(vNormal, 0.0)));\n    float spatialFreq = 10.;\n    float timeFreq = 10.;\n    float power = sin(spatialFreq * p.y - timeFreq * time);\n    vec3 color = power *  vec3( 1, 0, 0 ) + (1. - power) * vec3(1,0.5,0.5);\n    gl_FragColor = vec4(color, 1.);\n}",hr=function(e){return rn.Maybe.fromNull(e.rotationQuaternion).map((function(e){return 2*Math.atan2(e.z,e.w)})).orSome(0)},mr={},pr="placeholder",vr=1.5;var gr=sr,yr=n(31),br=n.n(yr);function wr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xr(e,t,n){if(e.length===t.length){for(var r=!0,o=0;o<e.length;o++){var a=e[o],i=t[o];if(!n(a,i))return!1;r=r&&xr(a.children,i.children,n)}return r}return!1}function Mr(e){return e.expanded=!0,e}function kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var r=Er({},e);if(t(r)){var o=Mr(r);o.children=kr(o.children,t),n.push(o)}else if(r.children){var a=kr(r.children,t);0!==a.length&&(r.children=a,n.push(Mr(r)))}})),n}function Pr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var r=Er({},e);t(r)&&n.push(r),n=n.concat(Pr(r.children,t))})),n}var Cr=function(){function e(t){P()(this,e),this.tree=t}return S()(e,[{key:"getNode",value:function(e){return function e(t,n){for(var r=0;r<t.length;r++){var o=t[r];if(n(o))return rn.Maybe.some(o);var a=e(o.children,n);if(a.isSome())return a}return rn.Maybe.none()}(this.tree,e)}},{key:"getParentNode",value:function(e){return function e(t,n,r){if(t.map((function(e){return n(e)})).reduce((function(e,t){return e||t}),!1))return rn.Maybe.fromNull(r);for(var o=0;o<t.length;o++){var a=t[o],i=e(a.children,n,a);if(i.isSome())return i}return rn.Maybe.none()}(this.tree,e,null)}},{key:"equals",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};return t.constructor===e?xr(this.tree,t.tree,n):xr(this.tree,t,n)}},{key:"map",value:function(t){return new e(function e(t,n,r){return t.forEach((function(t){var o=Er({},t),a=r(o);a.children=e(o.children,[],r),n.push(a)})),n}(this.tree,[],t))}},{key:"filter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return new e(kr(this.tree,t))}},{key:"flatten",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return Pr(this.tree,e)}},{key:"forEach",value:function(e){!function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.forEach((function(t){n(t),e(t.children,n)}))}(this.tree,e)}}]),e}(),Sr={RADIUS:.4,POINTS_DENSITY:2,CLOUD_FUNCTION_NAME:"backend.viewer"},Or=n(91),Nr=n(18),Rr=n.n(Nr),Tr=new WeakMap,Ar=new WeakMap,Ir=new WeakMap,Dr=function(){function e(){P()(this,e),Tr.set(this,{writable:!0,value:{}}),Ar.set(this,{writable:!0,value:{}}),Ir.set(this,{writable:!0,value:{}})}return S()(e,[{key:"addVertex",value:function(e){e in Rr()(this,Ar)||(Rr()(this,Ar)[e]={},Rr()(this,Tr)[e]={})}},{key:"delVertex",value:function(t){var n=this;t in Rr()(this,Ar)&&(delete Rr()(this,Ar)[t],Object.keys(Rr()(this,Tr)[t]).forEach((function(r){delete Rr()(n,Ir)[e.edgeKey(t,r)],delete Rr()(n,Ir)[e.edgeKey(r,t)]})),delete Rr()(this,Tr)[t],Object.keys(Rr()(this,Tr)).forEach((function(e){t in Rr()(n,Tr)[e]&&delete Rr()(n,Tr)[e][t]})))}},{key:"addEdge",value:function(t,n){this.addVertex(t),this.addVertex(n);var r={};return Rr()(this,Ir)[e.edgeKey(t,n)]=r,Rr()(this,Ir)[e.edgeKey(n,t)]=r,Rr()(this,Tr)[t][n]=!0,Rr()(this,Tr)[n][t]=!0,this}},{key:"delEdge",value:function(t,n){var r=this,o=e.edgeKey(t,n),a=e.edgeKey(n,t);(o in Rr()(this,Ir)||a in Rr()(this,Ir))&&(delete Rr()(this,Ir)[o],delete Rr()(this,Ir)[a],delete Rr()(this,Tr)[t][n],delete Rr()(this,Tr)[n][t]),[t,n].forEach((function(e){0===r.getNeighbors(e).length&&r.delVertex(e)}))}},{key:"hasEdge",value:function(e,t){return this.getEdge(e,t).isSome()}},{key:"getNeighbors",value:function(e){return e in Rr()(this,Tr)?Object.keys(Rr()(this,Tr)[e]):[]}},{key:"getEdge",value:function(t,n){var r=e.edgeKey(t,n);return r in Rr()(this,Ir)?rn.Maybe.some(Rr()(this,Ir)[r]):rn.Maybe.none()}},{key:"getVertex",value:function(e){return e in Rr()(this,Ar)?rn.Maybe.some(Rr()(this,Ar)[e]):rn.Maybe.none()}},{key:"getEdges",value:function(){return Rr()(this,Ir)}},{key:"getVertices",value:function(){return Rr()(this,Ar)}},{key:"getAdjMap",value:function(){return Rr()(this,Tr)}}]),e}();d()(Dr,"edgeKey",(function(e,t){return"".concat(e,"_").concat(t)})),d()(Dr,"key2Edge",(function(e){return e.split("_")}));var jr=Dr,Br=n(21),Fr=n.n(Br);function Vr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Ur=Sr.RADIUS,zr=function(e){T()(n,e);var t=_r(n);function n(e,r,o,a,i){var c,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};return P()(this,n),c=t.call(this,e,s),d()(N()(c),"getType",(function(){return n.TYPE})),c.localPath=r,c.keyPoints=o,c.splinePath=a,c.selectedKeyPointIndex=-1,c.mainView=i,c.weight=u,c}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.localPath=this.localPath,e.splinePath=this.splinePath,e.weight=this.weight,e}},{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);if(this.selectedKeyPointIndex>=0){e.jsonSchema.properties.selectedKeyPoint={type:"object",title:"KeyPoint ".concat(this.selectedKeyPointIndex),properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},e.uiSchema.selectedKeyPoint={"ui:widget":"collapse"},e.uiSchema.position={"ui:widget":"hidden"},e.uiSchema.quaternion={"ui:widget":"hidden"},e.uiSchema.color={"ui:widget":"hidden"},e.uiSchema.annotations={"ui:widget":"hidden"};var t=this.keyPoints[this.selectedKeyPointIndex],r=Bn.getGlobalCoordinates(t,t.position).toArray();return e.data.selectedKeyPoint={x:r[0],y:r[1],z:r[2]},e}var o=Lr({},e.jsonSchema.properties),a={type:"object",properties:{oldName:o.oldName,name:o.name,type:o.type,weight:{type:"number",title:"Weight"},position:o.position,quaternion:o.quaternion,color:o.color,annotations:o.annotations}};return e.jsonSchema=a,e.data.weight=this.weight,e}},{key:"ofForm",value:function(e){if(an()(j()(n.prototype),"ofForm",this).call(this,e),this.selectedKeyPointIndex>=0){var t=this.keyPoints[this.selectedKeyPointIndex],r=e.selectedKeyPoint,o=Zt.Vector3.FromArray([r.x,r.y,r.z].map(Number.parseFloat)),a=Bn.getLocalCoordFromGlobal(t,o).toArray();return t.position=new Zt.Vector3(a[0],a[1],a[2]),void t.observers.notifyObservers({updatedPointMesh:t,is2updateServer:!1})}this.weight=Number(e.weight),this.updatePathEdgeWithForm(this.weight,this.keyValueMap)}},{key:"updatePathEdgeWithForm",value:function(e,t){var n=this;this.mainView.getGraph().forEach((function(r){var o=r.item,a=o.graph,i=[n.keyPoints[0],n.keyPoints[n.keyPoints.length-1]].filter((function(e){var t;return!(null==e||null===(t=e.graphVertex)||void 0===t||!t.vertex)})).map((function(e){return e.graphVertex.vertex}));if(!(i.length<2)){var c=i.map((function(e){return e.id}));a.getEdge.apply(a,Wt()(c)).forEach((function(n){var r=n.data;r.weight=e,r.keyValueMap=t})),n.mainView.updateNodeInServer(o.name)}}))}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}},{key:"getCopyFunction",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return function(r,o){return an()(j()(n.prototype),"getCopyFunction",e).call(e,t)(r,o).map((function(t){var r=null==t?void 0:t.keyPoints;return void 0!==r&&Qr(e)&&n.updateGraph(o,r,t,!0),t}))}}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!r)throw new Error("null dictionary describing path or null mainView");var o=t.name,a=t.localPath.map((function(e){return dn.of(e).toBabylon()})),i=Bn.getSplineFromCurve(a),c=i.points,u=null;(u=1===c.length?Zt.MeshBuilder.CreateLines(o,{points:c,updatable:!0},e):Bn.createTubeFromPoints(e,c,Zt.Color3.Gray(),Ur/8,o)).position=dn.of(t.position).toBabylon(),u.material=Bn.getMaterialFromColor(Zt.Color3.FromArray(t.color),e,"PathMaterial".concat(o)),u.rotationQuaternion=rn.Maybe.fromNull(t.quaternion).map((function(e){return new Zt.Quaternion(e[1],e[2],e[3],e[0]).normalize()})).orSome(Zt.Quaternion.Identity());var s=Bn.splineObj2redis(i),l=Hr(e,Lr(Lr({},t),{},{mesh:u,splinePath:s}),r),f=new n(u,a.map((function(e){return[e.x,e.y,e.z]})),l,s,r,t.weight,t.keyValueMap);return u.onClick=Gr(r,f),u.observers=new Zt.Observable,u.observers.add(Kr(l)),f}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,r,o){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Wr,i=r.mesh,c=Bn.pointAverage(e);e=e.map((function(e){return e.subtract(c)}));var u=Bn.getSplineFromCurve(e),s=Bn.createTubeFromPoints(t,u.points,Zt.Color3.Gray(),Ur/8,i.name),l=Bn.getRotationMatrix(i),f=dn.ofBabylon(i.scaling),d=l.prodVec(dn.ofBabylon(c).mul(f)).toBabylon();s.parent=i.parent,s.rotationQuaternion=i.rotationQuaternion,s.position=d.add(i.position),s.material=i.material,s.visibility=i.visibility,s.onClick=i.onClick,s.getMouseContextActions=i.getMouseContextActions,s.nodeItem=i.nodeItem,s.observers=i.observers,r.localPath=e.map((function(e){return dn.ofBabylon(e).toArray()})),r.splinePath=Bn.splineObj2redis(u),r.mesh=s;var h=r.keyPoints;return r.keyPoints=a(t,o,i,r),r.mesh.observers.clear(),r.mesh.observers.add(Kr(r.keyPoints)),n.updateGraph(o,h,r,h.length!==r.keyPoints.length),i.dispose(),r}},{key:"deleteKeyPoint",value:function(e,t,r){var o=t.index,a=t.parent.name;r.getNodeFromTree(a).forEach((function(t){var i=t.item,c=Lr({},i.mesh.position),u=i.localPath.map((function(e){return dn.of(e).toBabylon()}));r.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,o,c,u,e,i,r))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,r,o,a,i,c){return J.UndoManager.actionBuilder().doAction((function(){var r=Wt()(o);r.splice(t,1),n.createNewMeshFromOldUsingNewPoints(r,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).undoAction((function(){var t=Wt()(o);i.mesh.position=r,n.createNewMeshFromOldUsingNewPoints(t,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,r){return Hr(e,r,t)}},{key:"addKeyPointInBetween",value:function(e,t,r,o){var a=t.index,i=t.parent.name;r.getNodeFromTree(i).forEach((function(t){var c=t.item,u=c.localPath.map((function(e){return dn.of(e).toBabylon()})),s=Lr({},c.mesh.position);r.getUndoManager().doIt(n.getUndoAddKeyPointInBetween(i,a,o,c,u,s,e,r))}))}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,r,o,a,i,c,u){return J.UndoManager.actionBuilder().doAction((function(){var i=t+r,s=o.localPath.length,l=[],f=Wt()(a);if(i<0)l=[f[0].scale(3).subtract(f[1]).scale(.5)].concat(f);else if(i>s-1)l=f.concat([f[s-1].scale(3).subtract(f[s-2]).scale(.5)]);else{for(var d=t+Math.max(0,r),h=0;h<d;h++)l.push(f[h]);l.push(f[i].add(f[t]).scale(.5));for(var m=d;m<s;m++)l.push(f[m])}n.createNewMeshFromOldUsingNewPoints(l,c,o,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).undoAction((function(){var t=Wt()(a);o.mesh.position=i,n.createNewMeshFromOldUsingNewPoints(t,c,o,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).build()}},{key:"updateGraph",value:function(e,t,n,r){r&&e.getGraph().forEach((function(r){var o=r.item;t.forEach((function(e){o.delVertexFromMesh(e,!1)}));var a=n.keyPoints,i=[a[0],a[a.length-1]];o.addEdge.apply(o,i),e.updateNodeInServer(o.name)}))}}]),n}(En);d()(zr,"TYPE","Path");var qr=zr,Gr=function(e,t){return function(){e.closeContextDial(),e.getNodeFromTree(t.name).forEach((function(e){return e.item.selectedKeyPointIndex=-1}))}},Kr=function(e){return function(t){t.updatedPointMesh;var n=t.is2updateServer,r=t.displacement;e.forEach((function(e){e.graphVertex&&e.graphVertex.vertexObs({updatedPointMesh:e,is2updateServer:n,displacement:r})}))}};function Wr(e,t,n,r){var o=Wt()(n._children),a=r.splinePath.map((function(e){return new Zt.Vector3(e[0],e[1],0)}));return o.forEach((function(e){e.parent=r.mesh})),r.keyPoints.map((function(t,o){(t.index=o,t.name="".concat(n.name,"keyPointSpline").concat(o),t.position=dn.of(r.localPath[o]).toBabylon(),t.rotationQuaternion=Zt.Quaternion.Identity(),n.graphVertex&&(t.graphVertex=n.graphVertex),o>0&&o<r.keyPoints.length-1)&&(t._children.forEach((function(e){return e.dispose()})),Yr(e,t.material.diffuseColor,r.mesh,o,a,t.position)().parent=t);return t}))}var Hr=function(e,t,n){var r=new Zt.Color3(.25,.25,.25),a=[],i=t.localPath.map((function(e){return dn.of(e).toBabylon()})),c=t.splinePath.map((function(e){return new Zt.Vector3(e[0],e[1],0)})),u=t.mesh;return i.forEach((function(t,o){var s,l,f=Zr(e,r,u,o),d=0===o||o===i.length-1?f():(s=Yr(e,r,u,o,c,t)(),(l=Zr(e,r,u,o)()).visibility=.1,s.parent=l,l);d.parent=u,d.position=t,d.index=o,d.observers=new Zt.Observable,a.push(d),d.observers.add(function(e,t){return function(n){var r=n.updatedPointMesh,o=n.is2updateServer;n.displacement;r.parent&&t.getNodeFromTree(r.parent.name).forEach((function(n){var a=n.item,i=r.index,c=a.mesh,u=a.localPath.map((function(e){return dn.of(e).toBabylon()}));u[i]=r.position,zr.createNewMeshFromOldUsingNewPoints(u,e,a,t),i>0&&i<u.length-1&&t.highlightMeshesInScene([a.keyPoints[i]._children[0]]),o&&(t.updateNodeInServer(c.name),t.setProperties(a.toForm()))}))}}(e,n))})),a.forEach((function(t){t.onClick=function(){n.setContextActions(function(e,t,n){var r=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){2!==n.item.localPath.length&&r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-trash"},e))},action:function(n){zr.deleteKeyPoint(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-less-than"},e))},action:function(n){zr.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-greater-than"},e))},action:function(n){zr.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),r}(e,t,n)),n.getNodeFromTree(t.parent.name).forEach((function(e){e.item.selectedKeyPointIndex=t.index,n.setProperties(e.item.toForm())}))}})),a};function Yr(e,t,n,r,o,a){return function(){var i=o.map((function(e){return a.subtract(e).length()})).reduce((function(e,t,n){return e.value<t?e:{value:t,index:n}}),{value:Number.MAX_VALUE,index:-1}).index,c=o[i+1].subtract(o[i]).normalize().scale(Ur);return Bn.createOrientedCone(e,c,t,"".concat(n.name,"keyPointCone").concat(r),!1)}}function Zr(e,t,n,r){return function(){return Bn.createSphere(e,t,Ur,"".concat(n.name,"keyPointSpline").concat(r),!0)}}function Qr(e){var t,n;return[null===(t=e.keyPoints[0])||void 0===t?void 0:t.graphVertex,null===(n=e.keyPoints[e.keyPoints.length-1])||void 0===n?void 0:n.graphVertex].every((function(e){return!!e}))}function Xr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Jr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var eo=function(e){T()(n,e);var t=$r(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.NAME,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};P()(this,n);var u=e.getUniqueId();if(u in to&&!to[u].mesh.isDisposed())return I()(a,to[u]);var s=no(e,i);return s.onClick=function(){return a.graphFormMapper=a.getDefaultFormMapper()},a=t.call(this,s,c),d()(N()(a),"getType",(function(){return n.TYPE})),d()(N()(a),"getEdgeMouseCtxActions",(function(e){return function(){return[{title:"Delete",onClick:function(){return a.mainView.getUndoManager().doIt(a.getUndoDeleteEdge(e))}}]}})),d()(N()(a),"getEdgeObs",(function(){return function(e){var t=e.updatedPointMesh,n=e.is2updateServer,r=e.displacement,o=dn.ofBabylon(r),i=Bn.getLocalCoordFromWorld(a.mesh,o,!1);t.position=t.position.add(i.scale(-1).toBabylon()),n&&(a.graphFormMapper=a.getToFormEdge(t),a.mainView.setProperties(a.toForm()))}})),d()(N()(a),"getOnClickEdge",(function(e){return function(){var t=[];t.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-trash"},e))},action:function(){a.mainView.getUndoManager().doIt(a.getUndoDeleteEdge(e))},name:"Delete Edge [Del]"}),a.mainView.setContextActions(t)}})),d()(N()(a),"isMeshBelong2Path",(function(e){var t=e.parent;return a.mainView.getNodeFromTree(null==t?void 0:t.name).filter((function(e){return e.item.getType()===qr.TYPE})).orSome(!1)})),d()(N()(a),"exportBelongToData",(function(e){var t,n=e.index,r=e.name;return null==n?{name:r}:a.mainView.getNodeFromTree(null==e||null===(t=e.parent)||void 0===t?void 0:t.name).map((function(e){return{name:e.item.name,index:n>0?-1:n}})).orUndefined()})),to[u]=N()(a),a.graph=new jr,a.scene=e,a.mainView=r,a.meshByEdgeId={},a.graphFormMapper=a.getDefaultFormMapper(),a.vertexGenerator=0,a}return S()(n,[{key:"toDict",value:function(){var e=this,t=an()(j()(n.prototype),"toDict",this).call(this),r=this.graph,o=Jr({},r.getVertices()),a=Jr({},r.getEdges());return Object.keys(o).forEach((function(e){r.getVertex(e).forEach((function(t){var n=t.data;o[e]={position:dn.ofBabylon(n.position).toArray(),id:String(e)}}))})),Object.keys(a).forEach((function(t){var n=jr.key2Edge(t);r.getEdge.apply(r,Wt()(n)).forEach((function(r){var o=r.data,i=n.map((function(e){return Number(e)})),c=ce()(i,2),u=c[0],s=c[1],l=o.edge.map((function(e){return e.mesh})),f=ce()(l,2),d=f[0],h=f[1];a[t]={ids:n,keyValueMap:o.keyValueMap,weight:o.weight,belongsSrc:u<s?e.exportBelongToData(d):e.exportBelongToData(h),belongsTrg:u<s?e.exportBelongToData(h):e.exportBelongToData(d)},e.doMeshesBelong2SamePath.apply(e,Wt()(l))&&u>s&&delete a[t]}))})),t.vertices=o,t.edges=a,t}},{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);return delete e.jsonSchema.properties.position,delete e.jsonSchema.properties.quaternion,delete e.jsonSchema.properties.color,delete e.uiSchema.position,delete e.uiSchema.quaternion,delete e.uiSchema.color,delete e.data.position,delete e.data.quaternion,delete e.data.color,this.graphFormMapper.toForm(e)}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.graphFormMapper.ofForm(e)}},{key:"getDefaultFormMapper",value:function(){var e=this;return{toForm:function(e){return e},ofForm:function(t){return e.keyValueMap=Jr({},t.annotations)}}}},{key:"getToFormEdge",value:function(e){var t=this.graph;return{toForm:function(n){return t.getEdge.apply(t,Wt()(e.edgeIndexes)).map((function(t){var r=t.data;return n.jsonSchema.properties.weight={type:"number",title:"Weight"},n.data.weight=r.weight,En.setAnnotations2Form(n,r.keyValueMap),n.jsonSchema.properties.annotations.title="Annotations Edge ".concat(e.edgeIndexes),n})).orSome(n)},ofForm:function(n){var r=e.edgeIndexes;t.getEdge.apply(t,Wt()(r)).forEach((function(e){var t=e.data;t.keyValueMap=Jr({},Fr()(n,"annotations",{})),t.weight=Number.parseFloat(n.weight)}))}}}},{key:"delVertex",value:function(){var e=this.mainView.getRootNode();this.delVertexRecursively(null==e?void 0:e.children)}},{key:"addEdge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=ce()(n,2),o=r[0],a=r[1];if(!this.hasEdge(e,t))return this.buildVertex(e,o),this.buildVertex(t,a),this.buildEdge(e,t),this}},{key:"delEdge",value:function(e,t){var n=this,r=this.graph,o=[e,t].map(this.getVertexIdFromMesh),a=ce()(o,2),i=a[0],c=a[1];r.getEdge(i,c).forEach((function(e){e.data;var t=jr.edgeKey(i,c),o=jr.edgeKey(c,i);rn.Maybe.fromNull(n.meshByEdgeId[t]).forEach((function(e){e.dispose(),delete n.meshByEdgeId[t],delete n.meshByEdgeId[o]})),r.delEdge(i,c)}))}},{key:"hasEdge",value:function(e,t){var n=[e,t].map(this.getVertexIdFromMesh),r=ce()(n,2),o=r[0],a=r[1];return this.graph.hasEdge(o,a)}},{key:"delVertexFromMesh",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.graph,o=this.getVertexIdFromMesh(e);r.getVertex(o).forEach((function(a){r.getNeighbors(o).map((function(e){return r.getVertex(e)})).forEach((function(n){return n.forEach((function(n){var r=n.data.mesh;t.delEdge(e,r)}))})),r.delVertex(o),e.graphVertex=void 0,n&&t.mainView.updateNodeInServer(t.name)}))}},{key:"updateVertexPosition",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.graph;o.getVertex(e).forEach((function(e){e.data.position=t})),o.getNeighbors(e).forEach((function(t){var a=e,i=jr.edgeKey(a,t);n.meshByEdgeId[i]&&n.meshByEdgeId[i].dispose(),o.getEdge(a,t).forEach((function(e){var t=e.data,r=ce()(t.edge,2),o=r[0],a=r[1];n.buildEdge(o.mesh,a.mesh)})),r&&n.mainView.updateNodeInServer(n.name)}))}},{key:"delVertexRecursively",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){t.item.getType()!==n.TYPE&&(t.item.delVertex(),e.delVertexRecursively(t.children))}))}},{key:"getVertexIdFromMesh",value:function(e){var t,n;return null==e||null===(t=e.graphVertex)||void 0===t||null===(n=t.vertex)||void 0===n?void 0:n.id}},{key:"buildVertex",value:function(e,t){var n=this,r=this.getVertexIdFromMesh(e);this.graph.getVertex(r).orElseRun((function(){var r=t||n.vertexGenerator++;n.graph.addVertex(r),n.graph.getVertex(r).forEach((function(t){t.data=oo.builder()(r,e),n.addObs2VertexMesh(t.data)}))}))}},{key:"addObs2VertexMesh",value:function(e){var t=this,n=e.mesh;void 0!==n&&(n.graphVertex={vertex:e,delVertex:function(){return t.delVertexFromMesh(n)},vertexObs:this.getVertexMeshObs(e)})}},{key:"getVertexMeshObs",value:function(e){var t=this;return function(n){var r=n.updatedPointMesh,o=n.is2updateServer,a=(n._,Bn.getGlobalCoordinates(r,r.position).toBabylon());t.updateVertexPosition(e.id,a,o)}}},{key:"buildEdge",value:function(e,t){var n=this,r=this.graph,o=[e,t].map(this.getVertexIdFromMesh).sort((function(e,t){return e-t})),a=ce()(o,2),i=a[0],c=a[1];r.addEdge(i,c),r.getVertex(i).forEach((function(e){var t=e.data;return r.getVertex(c).forEach((function(e){var o=e.data;if(r.getEdge(i,c).forEach((function(e){e.data=new ao(t,o)})),!n.doVerticesBelong2SamePath(i,c)){var a=n.getEdgeMesh(t,o);n.meshByEdgeId[jr.edgeKey(i,c)]=a,n.meshByEdgeId[jr.edgeKey(c,i)]=a}}))}))}},{key:"getEdgeMesh",value:function(e,t){var r=[e,t].map((function(e){var t=e.mesh;return Bn.getGlobalCoord(t,t.position)})),o=n.getEdgeMesh(this.scene,r,Zt.Color3.Yellow());return o.parent=this.mesh,o.edgeIndexes=[e,t].map((function(e){return e.id})),o.getMouseContextActions=this.getEdgeMouseCtxActions(o),this.addObserver2EdgeMesh(o),this.addOnClickEdge(o),o}},{key:"addObserver2EdgeMesh",value:function(e){e.observers=new Zt.Observable,e.observers.add(this.getEdgeObs())}},{key:"addOnClickEdge",value:function(e){e.onClick=this.getOnClickEdge(e)}},{key:"getUndoDeleteEdge",value:function(e){var t=this.graph,n=e.edgeIndexes.map((function(e){return t.getVertex(e)})).map((function(e){return e.some()})).map((function(e){return e.data})),r=ce()(n,2),o=r[0],a=r[1];return this.getUndoDelLineEdge(o,a)}},{key:"getUndoDelLineEdge",value:function(e,t){var n=this,r=this.graph,o=[e,t],a=o.map((function(e){return e.id})),i=ce()(a,2),c=i[0],u=i[1],s=o.map((function(e){return e.mesh})),l={keyValueMap:{},weight:1,edge:{}};return r.getEdge(c,u).forEach((function(e){var t=e.data;l.keyValueMap=t.keyValueMap,l.weight=t.weight,l.edge=t.edge})),J.UndoManager.actionBuilder().doAction((function(){n.delEdge.apply(n,Wt()(s)),n.mainView.closeContextDial(),n.mainView.updateNodeInServer(n.name)})).undoAction((function(){n.addEdge.apply(n,Wt()(s).concat([[c,u]])),r.getEdge(c,u).forEach((function(e){var t=e.data;t.keyValueMap=l.keyValueMap,t.weight=l.weight,t.edge=l.edge})),n.mainView.updateNodeInServer(n.name)})).build()}},{key:"doVerticesBelong2SamePath",value:function(e,t){var n=this;return this.graph.getEdge(e,t).map((function(e){var t,r,o=e.data.edge.map((function(e){return e.mesh})),a=ce()(o,2),i=a[0],c=a[1];return void 0!==i&&void 0!==c&&((null==i||null===(t=i.parent)||void 0===t?void 0:t.name)===(null==c||null===(r=c.parent)||void 0===r?void 0:r.name)&&[i,c].map(n.isMeshBelong2Path).every((function(e){return e})))})).orSome(!1)}},{key:"doMeshesBelong2SamePath",value:function(e,t){var n,r,o=null==e||null===(n=e.parent)||void 0===n?void 0:n.nodeItem,a=null==t||null===(r=t.parent)||void 0===r?void 0:r.nodeItem;return!!o&&!!a&&o.name===a.name&&o.getType()===qr.TYPE&&a.getType()===qr.TYPE}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!r)throw new Error("null dictionary describing graphItem or null mainView");var o=new n(e,r,t.name,t.keyValueMap),a=t.edges,i=Number.MIN_VALUE;return Object.values(a).forEach((function(e){var t=e.ids,n=e.belongsSrc,c=e.belongsTrg,u=t.map((function(e){return Number(e)})),s=ce()(u,2),l=s[0],f=s[1];if(i=Math.max(i,Math.max(l,f)),l<f){var d=ro(r,{belongsSrc:n,belongsTrg:c});o.addEdge.apply(o,Wt()(d).concat([[l,f]])),o.graph.getEdge(l,f).forEach((function(e){var t=e.data,n=a[jr.edgeKey(l,f)];t.importFeatures(n)}))}})),o.vertexGenerator=i+1,o}},{key:"getVertexMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt.Color3.Gray(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sr.RADIUS,o=Bn.createSphere(e,n,r);return o.position=t,o}},{key:"getEdgeMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Zt.Color3.Gray(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Sr.RADIUS/4;return Bn.createTubeFromPoints(e,t,n,r)}}]),n}(En);d()(eo,"TYPE","GraphItem"),d()(eo,"NAME","LogicGraph"),d()(eo,"createGraphItemIfNone",(function(e,t){return t.getGraph().orElseRun((function(){var n=new eo(e,t);n.mesh.parent=t.getRootNode().item.mesh,t.addNodeItem2Tree(n)}))}));var to={},no=function(e,t){var n=Bn.createSphere(e,Zt.Color3.Gray(),Number.MIN_VALUE,t,!1);return n.position=Zt.Vector3.Zero(),n.scaling=Zt.Vector3.One(),n.rotationQuaternion=Or.Quaternion.Identity(),n.visibility=0,n},ro=function(e,t){return[t.belongsSrc,t.belongsTrg].map((function(t){var n=t.name,r=t.index;return e.getNodeFromTree(n).map((function(e){var t=e.item;if(null==r)return t.mesh;var n=r<0?t.keyPoints.length-1:r;return t.keyPoints[n]})).orUndefined()}))},oo=function(){function e(t,n,r){P()(this,e),this.id=t,this.mesh=n,this.position=r}return S()(e,null,[{key:"builder",value:function(){return function(t,n){return new e(t,n,Bn.getGlobalCoordinates(n,n.position).toBabylon())}}}]),e}(),ao=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};P()(this,e),this.edge=[t,n],this.keyValueMap=r,this.weight=1}return S()(e,[{key:"importFeatures",value:function(e){var t=e.keyValueMap,n=e.weight;this.keyValueMap=t,this.weight=n}}]),e}(),io=eo;function co(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function uo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?co(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):co(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function so(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var lo=function(e){T()(n,e);var t=so(n);function n(){var e,r,a;return P()(this,n),a=t.call(this),d()(N()(a),"action",(function(t){an()((e=N()(a),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(a))})),d()(N()(a),"onPointerDown",(function(e,t){1!==e.buttons&&2!==e.buttons||t.getSceneMemory().forEach((function(n){var r=n.scene,o=n.ground;a.maybeSelectedMesh=Bn.pickMesh(r,o),a.maybeSelectedMesh.forEach((function(n){return a.dragDownMesh(n,t,e)})),a.maybeSelectedMesh.orLazy((function(){a.dragDownWithoutMesh(t,e)}))}))})),d()(N()(a),"onPointerMove",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(n){var r=n.scene,o=n.ground;a.maybeSelectedMesh.forEach((function(e){Bn.getGroundPosition(r,o).forEach((function(e){a.dragMoveMesh(t,e)}))})),a.maybeSelectedMesh.orLazy((function(){a.dragMoveWithoutMesh(e)}))}))})),d()(N()(a),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.camera,r=e.scene,o=e.ground,i=e.canvas;a.maybeSelectedMesh.forEach((function(e){a.dragUpMesh(e,t,r,o)})),a.maybeSelectedMesh.orLazy((function(){a.dragUpWithoutMesh(t,r)})),n.attachControl(i,!0),a.maybeSelectedMesh=rn.Maybe.none(),a.destroySelectionDiv(),a.corners=[]}))})),d()(N()(a),"onKeyUp",(function(e,t){er([{predicate:function(e){return["Backspace","Delete"].includes(e.code)},action:a.getDeleteButtonAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyC"===e.code},action:a.getCopyAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyV"===e.code},action:a.getPasteAction(t)}],(function(){return an()((r=N()(a),j()(n.prototype)),"onKeyUp",r).call(r,e,t)}))(e)})),d()(N()(a),"handleMeshRightClick",(function(e,t,n){2===e.buttons&&n&&n.getMouseContextActions&&t.setMouseContextActions(e,n.getMouseContextActions(t))})),d()(N()(a),"handleRightClickWithoutMesh",(function(e,t,n){2===e.buttons&&t.setMouseContextActions(e,[{title:"Paste",onClick:a.getPasteOnClick(n,t)}])})),d()(N()(a),"getPasteOnClick",(function(e,t){return function(){var n=un.paste();n&&"function"==typeof n&&n(e,t)}})),d()(N()(a),"setProperties",(function(e,t){return e.setPropertiesWithName(t)})),a.key="dragObject",a.name="Grab Objects [1]",a.icon=function(e){return o.a.createElement("i",Oe()({className:"far fa-hand-paper"},e))},a.maybeSelectedMesh=rn.Maybe.none(),a.clickPointInWorld=dn.ZERO,a.movePointInWorld=dn.ZERO,a.startDivPos=ln.ZERO,a.corners=[],a}return S()(n,[{key:"dragDownMesh",value:function(e,t,n){var r=this;t.getSceneMemory().forEach((function(o){var a=o.camera,i=o.canvas,c=o.scene,u=o.ground;a.detachControl(i),r.addSelectedMesh(n,e,t),r.handleMeshRightClick(n,t,e),Bn.getGroundPosition(c,u).forEach((function(n){r.updateMouseVars(n),e.onClick?e.onClick():t.closeContextDial(),e.isSelectionPlaceHolder?t.addGizmo2Mesh(e,(function(){return r.notifyObservers(e,!0,dn.ZERO,t)}),(function(){return r.notifyObservers(e,!1,dn.ZERO,t)})):r.selectMeshUpdateUI(t)}))}))}},{key:"selectMeshUpdateUI",value:function(e){var t=this,n=cr.ofMainView(e),r=gr.ofMainView(e),o=n.meshes();e.highlightMeshesInScene(o),e.highlightNodesInTree(o.map((function(e){return e.name}))),o.length>1?(e.addGizmo2Name(),r.clear(),r.push(o),this.setProperties(e,o[0].name)):(r.clear(),e.addGizmo2Name(),o.forEach((function(n){e.addGizmo2Name(n.name),t.setProperties(e,n.name)})))}},{key:"dragDownWithoutMesh",value:function(e,t){var n=this;e.getMouseCoordsFromRoot().forEach((function(r){return n.handleRightClickWithoutMesh(t,e,r)})),e.getSceneMemory().forEach((function(e){var r=e.camera,o=e.canvas,a=e.scene;t.shiftKey&&(r.detachControl(o),n.createSelectionDiv(t),n.corners.push(ln.of(a.pointerX,a.pointerY)))}))}},{key:"dragMoveMesh",value:function(e,t){var n=this,r=cr.ofMainView(e).meshes(),o=gr.ofMainView(e),a=dn.ofBabylon(t),i=a.sub(this.movePointInWorld);if(r.forEach((function(t){var r=Bn.getLocalCoordFromWorld(t,i,!1);r=new Zt.Vector3(r.x,r.y,0),t.position=t.position.add(r),n.notifyObservers(t,!1,i,e)})),r.length>1){var c=Bn.getLocalCoordFromWorld(o.mesh,i,!1);c=new Zt.Vector3(c.x,c.y,0),o.mesh.position=o.mesh.position.add(c)}this.movePointInWorld=a}},{key:"dragMoveWithoutMesh",value:function(e){this.updateSelectionDiv(e)}},{key:"dragUpMesh",value:function(e,t,n,r){var o=this,a=cr.ofMainView(t),i=a.meshes(),c=gr.ofMainView(t);Bn.getGroundPosition(n,r).forEach((function(n){var r=dn.ofBabylon(n).sub(o.clickPointInWorld);i.forEach((function(e){o.notifyObservers(e,!0,dn.ZERO,t),t.updateNodeInServer(e.name)})),o.setProperties(t,e.name),r.length()>0&&t.getUndoManager().addIt(o.getUndoAbleAction(i,r,t)),e.isSelectionPlaceHolder&&(a.clear(),a.addArray(c.arrayOfMeshes))}))}},{key:"dragUpWithoutMesh",value:function(e,t){this.selectObjectsInside(t,e)}},{key:"updateMouseVars",value:function(e){var t=dn.ofBabylon(e);this.movePointInWorld=t,this.clickPointInWorld=t}},{key:"addSelectedMesh",value:function(e,t,n){var r=cr.ofMainView(n);if(t.edgeIndexes)return r.clear(),void r.add(t);if(r.filter((function(e){return!e.edgeIndexes})),e.shiftKey)r.add(t);else{if(r.has(t))return;r.clear(),r.add(t)}}},{key:"getDeleteButtonAction",value:function(e){return function(){var t=cr.ofMainView(e),n=t.meshes(),r=1===n.length;n.forEach((function(t){var n=e.getNodeFromTree(t.name);n.forEach((function(t){return e.onDeleteNode(t,r,r)})),n.orElseRun((function(){if(r){var t=e.getContextActions();t[0]&&t[0].action(e)}}))})),e.highlightNodesInTree(),e.highlightMeshesInScene(),e.addGizmo2Mesh(),t.clear(),gr.ofMainView(e).clear(),e.forceUpdate()}}},{key:"getCopyAction",value:function(e){var t=cr.ofMainView(e).meshes(),n=gr.ofMainView(e).mesh;return function(){if(t.length<=1)t.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})).forEach((function(e){un.copy((function(t,n){e.getCopyFunction()(t,n).forEach((function(e){var t=e.mesh;n.addGizmo2Name(t.name),n.highlightMeshesInScene([t]),n.highlightNodesInTree([t.name]),cr.ofMainView(n).clear().add(t)}))}))}));else{var r=t.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})).reduce((function(e,t){return e.push([t,t.getCopyFunction(!1)]),e}),[]);un.copy((function(t,o){var a=r.map((function(r){var a=ce()(r,2),i=a[0];return(0,a[1])(Bn.toGlobalCoord(e)(i.mesh.absolutePosition).subtract(n.position).add(t),o)})).filter((function(e){return e.isSome()})).map((function(e){return e.some()})),i=a.map((function(e){return e.mesh})),c=a.map((function(e){return e.name}));o.addGizmo2Name(),o.highlightMeshesInScene(i),o.highlightNodesInTree(c),cr.ofMainView(o).clear().addArray(i),gr.ofMainView(o).clear().push(i),o.forceUpdate()}))}}}},{key:"getPasteAction",value:function(e){var t=this;return function(){e.getMouseCoordsFromRoot().forEach((function(n){return t.getPasteOnClick(n,e)()}))}}},{key:"notifyObservers",value:function(e,t,n,r){var o=this;rn.Maybe.fromNull(e.observers).forEach((function(r){r.notifyObservers({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),rn.Maybe.fromNull(e.graphVertex).forEach((function(r){(0,r.vertexObs)({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),r.getNodeFromTree(e.name).isSome()&&e._children.filter((function(e){return(!!e.observers||!!e.graphVertex)&&r.getNodeFromTree(e.name).isSome()})).forEach((function(e){return o.notifyObservers(e,t,n,r)}))}},{key:"getUndoAbleAction",value:function(e,t,n){var r=this;return J.UndoManager.actionBuilder().doAction((function(){e.forEach((function(e){var o=Bn.getLocalCoordFromWorld(e,t,!1),a=dn.ofBabylon(e.position).add(o);e.position=a.toBabylon(),r.notifyObservers(e,!0,t,n),n.updateNodeInServer(e.name)}))})).undoAction((function(){e.forEach((function(e){var o=t.scale(-1),a=Bn.getLocalCoordFromWorld(e,o,!1),i=dn.ofBabylon(e.position).add(a);e.position=i.toBabylon(),r.notifyObservers(e,!0,o,n),n.updateNodeInServer(e.name)}))})).build()}},{key:"createSelectionDiv",value:function(e){this.startDivPos=this.findMouseInDom(e);var t=this.startDivPos,n=t.x,r=t.y,a=document.createElement("div");a.id=ho,document.body.appendChild(a),br.a.render(o.a.createElement(fo,{left:n,top:r}),document.getElementById(ho))}},{key:"updateSelectionDiv",value:function(e){var t=this.findMouseInDom(e),n=this.startDivPos,r=t.op(n,Math.min),a=r.x,i=r.y,c=t.op(n,Math.max),u=c.x,s=c.y,l=document.getElementById(ho);l&&br.a.render(o.a.createElement(fo,{left:a,top:i,width:u-a,height:s-i,style:{zIndex:999}}),l)}},{key:"destroySelectionDiv",value:function(){var e=document.getElementById(ho);e&&e.parentNode.removeChild(e)}},{key:"findMouseInDom",value:function(e){var t=e.clientX,n=e.clientY;return new ln(t,n)}},{key:"selectObjectsInside",value:function(e,t){var n=this;if(0!==this.corners.length){this.corners.push(ln.of(e.pointerX,e.pointerY));var r=ce()(this.corners,2),o=r[0],a=r[1],i=a.op(o,Math.min),c=a.op(o,Math.max),u=[i,ln.of(c.x,i.y),c,ln.of(i.x,c.y)].map((function(e){return n.pickPoints(e,t)}));if(!u.some((function(e){return null==e}))){var s=new Cr(t.getObjectTree()).flatten(this.isItemInsideBox(u,t)).map((function(e){return e.item.mesh})),l=cr.ofMainView(t);l.clear(),0!==s.length&&l.addArray(s,!1),this.selectMeshUpdateUI(t)}}}},{key:"pickPoints",value:function(e,t){return t.getSceneMemory().flatMap((function(n){var r=n.scene,o=n.ground,a=r.pick(e.x,e.y,(function(e){return e===o}));if(a.hit){var i=Bn.toGlobalCoord(t)(a.pickedPoint);return rn.Maybe.some(ln.of(i.x,i.y))}return rn.Maybe.none()})).orNull()}},{key:"isItemInsideBox",value:function(e,t){var n=this;return function(r){var o,a=r.item,i=a.getType();if(i===Un.TYPE||i===Yn.TYPE||i===io.TYPE||null!=a&&null!==(o=a.mesh)&&void 0!==o&&o.isSelectionPlaceHolder)return!1;var c=a.mesh;return n.isMeshInsideBox(e,t)(c)}}},{key:"isMeshInsideBox",value:function(e,t){var n=this;return function(r){var o=Bn.toGlobalCoord(t)(r.absolutePosition),a=new ln(o.x,o.y);return n.isPointInsideBox(e)(a)}}},{key:"isPointInsideBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;return function(n){for(var r=0,o=e.length,a=0;a<o;a++){var i=e[a].sub(n),c=e[(a+1)%o].sub(n);r+=Math.acos(i.dot(c)/(i.length()*c.length()))}return Math.abs(r-2*Math.PI)<t}}}]),n}($n),fo=function(e){var t=e.left,n=e.top,r=e.width,a=e.height,i=e.style;return o.a.createElement("div",{style:uo({position:"absolute",top:n,left:t,width:r,height:a,borderRadius:10,border:"solid",borderColor:"#c7c7c7"},i)})};fo.defaultProps={left:0,top:0,width:0,height:0};var ho="SELECTION_TOOL_ID",mo=lo;function po(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var vo=function(e){T()(n,e);var t=po(n);function n(){var e,r;return P()(this,n),r=t.call(this),d()(N()(r),"action",(function(t){an()((e=N()(r),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(r))})),d()(N()(r),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,o=e.camera;r.maybeMousePos=Bn.getGroundPosition(t,n),r.maybeMousePos.forEach((function(t){o.detachControl(e.canvas)}))}))})),d()(N()(r),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground;Bn.getGroundPosition(n,o).forEach((function(e){r.maybeMousePos.forEach((function(o){r.tempMesh&&r.tempMesh.dispose(),r.tempMesh=r.createKeyPoint(e,go,n,t,!1)}))}))}))})),d()(N()(r),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.camera,a=e.ground,i=e.canvas;Bn.getGroundPosition(n,a).forEach((function(e){r.maybeMousePos.forEach((function(o){r.tempMesh&&r.tempMesh.dispose();var a="KeyPoint".concat(Math.floor(1e3*Math.random())),i=r.createKeyPoint(e,a,n,t,!0,new Zt.Color3(Math.random(),Math.random(),Math.random()));t.setPropertiesWithName(a),t.getUndoManager().addIt(r.getUndoAbleAction(i,n,t))}))})),r.maybeMousePos=rn.Maybe.none(),o.attachControl(i,!0)}))})),r.key="addKeyPoint",r.name="Add Key Point [4]",r.maybeMousePos=rn.Maybe.none(),r.tempMesh=null,r.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-map-marker"},e))},r}return S()(n,[{key:"createKeyPoint",value:function(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Zt.Color3.Gray(),i=r.getRootNode().item.mesh,c=ir.ofDict(n,{name:t,color:[a.r,a.g,a.b]}),u=c.mesh;u.parent=i;var s=Bn.getLocalCoordFromWorld({parent:i},dn.ofBabylon(e)).toBabylon();return u.setPositionWithLocalVector(s.add(Zt.Axis.Z.scale(ir.DEFAULT_SIZE))),o&&r.addNodeItem2Tree(c,i.name,o),u}},{key:"getUndoAbleAction",value:function(e,t,n){var r=this;return J.UndoManager.actionBuilder().doAction((function(){r.createKeyPoint(Zt.Vector3.Zero(),e.name,t,n,!0,e.material.diffuseColor).position=e.position,n.updateNodeInServer(e.name)})).undoAction((function(){n.deleteNodeFromTreeUsingName(e.name)})).build()}}]),n}($n),go="temp_key_point",yo=vo,bo=n(92),wo=n.n(bo);function Eo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var xo=function(e){T()(n,e);var t=Eo(n);function n(e,r,o){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return P()(this,n),a=t.call(this,e,i),d()(N()(a),"getType",(function(){return n.TYPE})),a.corners=r,a.keyPoints=o,a}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.corners=this.corners,e}},{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);e.jsonSchema.properties.dimensions={type:"object",title:"Dimensions",properties:{lower:{type:"object",title:"Lower Corner",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"}}},size:{type:"object",title:"Size",properties:{scaleX:{type:"number",title:"scale-X"},scaleY:{type:"number",title:"scale-Y"}}}}},e.uiSchema.dimensions={"ui:widget":"collapse"};var t=this.keyPoints.map((function(e){return Bn.getGlobalCoordinates(e,e.position)})).map((function(e){return e.toArray()}));return e.data.dimensions={lower:{x:t[0][0],y:t[0][1]},size:{scaleX:this.corners[1][0]-this.corners[0][0],scaleY:this.corners[1][1]-this.corners[0][1]}},e}},{key:"ofForm",value:function(e){var t=this.toForm().data.dimensions;wo()(t,e.dimensions)?an()(j()(n.prototype),"ofForm",this).call(this,e):this.ofFormDimensions(e)}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}},{key:"ofFormDimensions",value:function(e){var t=this,n=Zt.Vector3.FromArray([e.dimensions.lower.x,e.dimensions.lower.y,0].map(Number.parseFloat)),r=[e.dimensions.size.scaleX,e.dimensions.size.scaleY].map(Number.parseFloat),o=Bn.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.keyPoints[e].observers.notifyObservers({updatedPointMesh:t.keyPoints[e],is2updateServer:n})};this.keyPoints[0].position=new Zt.Vector3(o[0],o[1],this.keyPoints[0].position.z),a(0),o=Bn.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),this.keyPoints[1].position=new Zt.Vector3(o[0]+r[0],o[1]+r[1],this.keyPoints[1].position.z),a(1)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing Box region");var o=rn.Maybe.fromNull(t.name).orSome("BoxRegion".concat(Math.floor(1e3*Math.random()))),a=Po(t,o,e),i=new Zt.StandardMaterial("BoxRegionMaterial".concat(o),e),c=new Zt.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,i.backFaceCulling=!1,a.material=i,a.visibility=Oo,rn.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new Zt.Quaternion(e[1],e[2],e[3],e[0]);a.rotationQuaternion=t.normalize()}));var u=So(e,t.corners.map((function(e){return dn.of(e).toBabylon()})),a,r);return new n(a,t.corners,u,t.keyValueMap)}}]),n}(En);d()(xo,"TYPE","BoxRegion");var Mo=Sr.RADIUS,ko=[[0,1,2],[2,3,0],[4,5,6],[6,7,4],[0,1,5],[5,4,0],[3,2,6],[6,7,3],[1,2,6],[6,5,1],[0,3,7],[7,4,0]];function Po(e,t,n){var r=e.corners.map((function(e){return dn.of(e).toBabylon()})),o=r[1].subtract(r[0]),a=dn.of(e.position).toBabylon(),i=[r[0],r[0].add(Zt.Axis.X.scale(o.x)),r[0].add(new Zt.Vector3(o.x,o.y,0)),r[0].add(Zt.Axis.Y.scale(o.y))],c=new Zt.Vector3(0,0,o.z),u={positions:[i[0],i[1],i[2],i[3],i[0].add(c),i[1].add(c),i[2].add(c),i[3].add(c)],faces:ko},s=Bn.meshFromPositionAndFaces(t,n,u.positions,u.faces);return s.position=a,s}var Co=function(e,t){return function(n){var r=n.updatedPointMesh,o=n.is2updateServer;e.getNodeFromTree(r.parent.name).forEach((function(n){var a=r.index,i=n.item,c=i.mesh,u=c.name,s={position:dn.ofBabylon(c.position).toArray(),corners:i.corners};s.corners[a]=dn.ofBabylon(r.position).toArray(),function(e,t,n,r){var o=Bn.pointAverageVec3(e.corners.map((function(e){return dn.of(e)})));e.position=o.toArray(),e.corners=e.corners.map((function(e){return dn.of(e).sub(o).toArray()}));var a=Bn.getRotationMatrix(n),i=dn.ofBabylon(n.scaling),c=a.prodVec(o.mul(i)).toBabylon(),u=Po(e,n.name,t);u.parent=n.parent,u.rotationQuaternion=n.rotationQuaternion,u.position=c.add(n.position),u.material=n.material,u.visibility=Oo,u.getMouseContextActions=n.getMouseContextActions,u.nodeItem=n.nodeItem,u.observers=n.observers,n.graphVertex&&(u.graphVertex=n.graphVertex),r.mesh=u,r.corners=e.corners,Wt()(n._children).forEach((function(e){e.parent=u})),r.keyPoints.forEach((function(t,n){t.position=dn.of(e.corners[n]).toBabylon()})),n.dispose()}(s,t,c,i),e.addGizmo2Name(),o&&(e.updateNodeInServer(u),e.getNodeFromTree(u).forEach((function(t){e.setProperties(t.item.toForm())}))),rn.Maybe.fromNull(i.mesh.observers).forEach((function(e){e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:o,displacement:Zt.Vector3.Zero()})})),rn.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:i.mesh,is2updateServer:o,displacement:Zt.Vector3.Zero()})}))}))}},So=function(e,t,n,r){var o=[];return t.forEach((function(t,a){var i=t,c=Bn.createSphere(e,new Zt.Color3(.25,.25,.25),Mo,"".concat(n.name,"keyPoint").concat(a),!0);c.parent=n,c.position=i,c.index=a,c.observers=new Zt.Observable,c.observers.add(Co(r,e)),o.push(c)})),o},Oo=.25,No=xo;function Ro(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var To=function(e){T()(n,e);var t=Ro(n);function n(){var e,r;return P()(this,n),r=t.call(this),d()(N()(r),"action",(function(t){an()((e=N()(r),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(r))})),d()(N()(r),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,o=e.camera,a=Bn.getGroundPosition(t,n);r.maybeMousePos=a,a.forEach((function(t){o.detachControl(e.canvas)}))}))})),d()(N()(r),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground;Bn.getGroundPosition(n,o).forEach((function(e){r.maybeMousePos.forEach((function(o){r.tempMesh&&r.tempMesh.dispose(),r.tempMesh=r.createBoxRegion([o,e],Ao,n,t,!1)}))}))}))})),d()(N()(r),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.camera,a=e.ground;Bn.getGroundPosition(n,a).forEach((function(e){r.maybeMousePos.forEach((function(o){if(!(e.subtract(o).length()<.01)){r.tempMesh.dispose();var a="BoxRegion".concat(Math.floor(1e3*Math.random())),i=r.createBoxRegion([o,e],a,n,t,!0);t.setPropertiesWithName(a),t.getUndoManager().addIt(r.getUndoAbleAction([o,e],i,n,t))}}))})),r.maybeMousePos=rn.Maybe.none(),o.attachControl(e.canvas,!0)}))})),d()(N()(r),"createBoxRegion",(function(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Zt.Color3.Red(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=r.getRootNode().item.mesh,u=e.map((function(e){return Bn.getLocalCoordFromWorld({parent:c},dn.ofBabylon(e))}));u[1]=u[1].add(dn.of([0,0,i]));var s=u[0].add(u[1]).scale(.5),l=u.map((function(e){return e.sub(s)})),f=No.ofDict(n,{name:t,position:s.toArray(),color:[a.r,a.g,a.b],corners:l.map((function(e){return e.toArray()}))},r);return f.mesh.parent=c,o&&r.addNodeItem2Tree(f,c.name,o),f.mesh})),r.key="drawBoxRegion",r.name="Draw Box Region [3]",r.maybeMousePos=rn.Maybe.none(),r.tempMesh=null,r.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-square"},e))},r}return S()(n,[{key:"getUndoAbleAction",value:function(e,t,n,r){var o=this;return J.UndoManager.actionBuilder().doAction((function(){o.createBoxRegion(e,t.name,n,r,!0)})).undoAction((function(){r.deleteNodeFromTreeUsingName(t.name)})).build()}}]),n}($n),Ao="temp_box_region",Io=To;function Do(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var jo=function(e){T()(n,e);var t=Do(n);function n(){var e,r,a,i;return P()(this,n),i=t.call(this),d()(N()(i),"action",(function(t){an()((e=N()(i),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(i))})),d()(N()(i),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,o=e.camera,a=e.canvas;Bn.getGroundPosition(n,r).forEach((function(r){o.detachControl(a),i.mouseCurve.push(r),t.getUndoManager().doIt(i.getUndoAbleClickAction(i.mouseCurve,n,t,e))}))}))})),d()(N()(i),"onPointerMove",(function(e,t){})),d()(N()(i),"onPointerUp",(function(e,t){})),d()(N()(i),"onKeyUp",(function(e,t){var o=function(){return an()((r=N()(i),j()(n.prototype)),"onKeyUp",r).call(r,e,t)};t.getSceneMemory().forEach((function(r){var c=r.scene,u=r.camera,s=r.canvas,l=i.getDrawPathContextAction(u,s,c);er([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return l[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return l[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){0===i.mouseCurve.length&&an()((a=N()(i),j()(n.prototype)),"onKeyUp",a).call(a,e,t),l[0].action(t)}}],o)(e)}))})),d()(N()(i),"createCurve",(function(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Zt.Color3.Gray(),i=r.getRootNode().item.mesh,c=Bn.toGlobalCoord(r)(e),u=Bn.pointAverage(c),s=c.map((function(e){return e.subtract(u)})),l=qr.ofDict(n,{name:t,position:dn.ofBabylon(u).toArray(),color:[a.r,a.g,a.b],localPath:s.map((function(e){return dn.ofBabylon(e).toArray()}))},r);return l.mesh.parent=i,r.addNodeItem2Tree(l,i.name,o,!0,o),l})),d()(N()(i),"getDrawPathContextAction",(function(e,t,n){var r=[];return r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(Bo,!1),i.mouseCurve=[],n.closeContextDial()},name:"Clear Path [ESC | DEL | Backspace]"}),i.mouseCurve.length>1&&r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-check"},e))},action:function(r){e.attachControl(t,!0),r.getUndoManager().doIt(i.getUndoAbleEnterAction(i.mouseCurve,n,r))},name:"Create Path [Enter]"}),r})),i.key="drawPath",i.name="Draw Path [2]",i.mouseCurve=[],i.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-bezier-curve"},e))},i}return S()(n,[{key:"getUndoAbleClickAction",value:function(e,t,n,r){var o=this,a=r.camera,i=r.canvas,c=Wt()(e);return J.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:c;n.deleteNodeFromTreeUsingName(Bo,!1,!1),o.createCurve(e,Bo,t,n,!1),c.length<=2&&n.setContextActions(o.getDrawPathContextAction(a,i,t)),o.mouseCurve=c})).undoAction((function(){n.deleteNodeFromTreeUsingName(Bo);var e=c.slice(0,c.length-1),r=1===e.length?[e[0],e[0]]:e;e.length>0&&o.createCurve(r,Bo,t,n,!1),o.mouseCurve=e})).build()}},{key:"getUndoAbleEnterAction",value:function(e,t,r){var o=this,a=Wt()(e),i="Path".concat(Math.floor(1e3*Math.random()));return J.UndoManager.actionBuilder().doAction((function(){r.deleteNodeFromTreeUsingName(Bo,!1);var e=o.createCurve(a,i,t,r,!0);o.mouseCurve=[],r.setPropertiesWithName(i),r.closeContextDial();var c=e.keyPoints;n.addEdgesInKeyPoints(c,t,r)})).undoAction((function(){o.deleteEdgeInKeyPoints(i,r),r.deleteNodeFromTreeUsingName(i),o.createCurve(a,Bo,t,r,!1),o.mouseCurve=a})).build()}},{key:"deleteEdgeInKeyPoints",value:function(e,t){t.getGraph().forEach((function(n){var r=n.item;t.getNodeFromTree(e).forEach((function(e){var n=e.item.keyPoints,o=[n[0],n[n.length-1]];r.delEdge.apply(r,o),t.updateNodeInServer(r.name)}))}))}}],[{key:"addEdgesInKeyPoints",value:function(e,t,n){io.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var r=t.item,o=[e[0],e[e.length-1]];r.addEdge.apply(r,o),n.updateNodeInServer(r.name)}))}}]),n}($n),Bo="temp_curve",Fo=jo;function Vo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vo(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Uo=Sr.RADIUS,zo=J.Utils.mod,qo=function(e){T()(n,e);var t=_o(n);function n(e,r,o,a){var i,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return P()(this,n),i=t.call(this,e,c),d()(N()(i),"getType",(function(){return n.TYPE})),i.localPolygon=r,i.height=o,i.keyPoints=a,i}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.localPolygon=this.localPolygon,e.height=this.height,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!r)throw new Error("null dictionary describing polygon or null mainView");var o=t.localPolygon.map((function(e){return dn.of(e).toBabylon()})),a=dn.of(t.position).toBabylon(),i=Ko(e,o,t.height,t.name);i.position=a;var c=new Zt.StandardMaterial("PolygonMaterial".concat(t.name),e),u=new Zt.Color3(t.color[0],t.color[1],t.color[2]);c.diffuseColor=u,c.emissiveColor=u,i.material=c,i.visibility=.5,rn.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new Zt.Quaternion(e[1],e[2],e[3],e[0]);i.rotationQuaternion=t.normalize()}));var s=Yo(e,o,i,r);return new n(i,o.map((function(e){return[e.x,e.y,e.z]})),t.height,s,t.keyValueMap)}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Wo,a=n.mesh,i=Bn.pointAverage(e);e=e.map((function(e){return e.subtract(i)}));var c=Bn.getRotationMatrix(a),u=dn.ofBabylon(a.scaling),s=c.prodVec(dn.ofBabylon(i).mul(u)).toBabylon(),l=Ko(t,e,n.height,a.name);return l.parent=a.parent,l.rotationQuaternion=a.rotationQuaternion,l.position=s.add(a.position),l.material=a.material,l.visibility=a.visibility,l.onClick=a.onClick,l.getMouseContextActions=a.getMouseContextActions,l.nodeItem=a.nodeItem,l.observers=a.observers,a.graphVertex&&(l.graphVertex=a.graphVertex),n.localPolygon=e.map((function(e){return dn.ofBabylon(e).toArray()})),n.mesh=l,n.keyPoints=o(t,r,a,n),a.dispose(),e}},{key:"deleteKeyPoint",value:function(e,t,r){var o=t.index,a=t.parent.name;r.getNodeFromTree(a).forEach((function(t){var i=t.item,c=Lo({},i.mesh.position),u=i.localPolygon.map((function(e){return dn.of(e).toBabylon()}));r.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,o,c,u,e,i,r))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,r,o,a,i,c){return J.UndoManager.actionBuilder().doAction((function(){var r=Wt()(o);r.splice(t,1),n.createNewMeshFromOldUsingNewPoints(r,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).undoAction((function(){var t=Wt()(o);i.mesh.position=r,n.createNewMeshFromOldUsingNewPoints(t,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,r){return Yo(e,r.localPolygon.map((function(e){return dn.of(e).toBabylon()})),r.mesh,t)}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,r,o,a,i,c,u){return J.UndoManager.actionBuilder().doAction((function(){for(var i=a.length,s=zo(t+r,i),l=[],f=t+Math.max(0,r),d=0;d<f;d++)l.push(a[d]);l.push(a[s].add(a[t]).scale(.5));for(var h=f;h<i;h++)l.push(a[h]);n.createNewMeshFromOldUsingNewPoints(l,c,o,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).undoAction((function(){var t=Wt()(a);o.mesh.position=i,n.createNewMeshFromOldUsingNewPoints(t,c,o,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).build()}}]),n}(En);d()(qo,"TYPE","PolygonRegion"),d()(qo,"addKeyPointInBetween",(function(e,t,n,r){var o=t.index,a=t.parent.name;n.getNodeFromTree(a).forEach((function(t){var i=t.item,c=Lo({},i.mesh.position),u=i.localPolygon.map((function(e){return dn.of(e).toBabylon()}));n.getUndoManager().doIt(qo.getUndoAddKeyPointInBetween(a,o,r,i,u,c,e,n))}))}));var Go=function(e){var t=[];return t.push(e[1]),t.push(e[0]),t.push(e[2]),t},Ko=function(e,t,n,r){var o=new Zt.Vector3(0,0,n),a={positions:[],faces:[]};a.positions=Wt()(t);for(var i=0;i<t.length;i++)a.positions.push(t[i].add(o));var c=t.length,u=Bn.triangulatePolygon(t),s=Bn.triangulatePolygon(a.positions.slice(c)).map((function(e){return e.map((function(e){return e+c}))})).map(Go),l=function(e){for(var t=e.length,n=Bn.computeOrientation(e),r=[],o=0;o<t;o++){var a=(o+1)%t;r.push([o,t+a,a]),r.push([o,t+o,t+a])}return n>0?r:r.map(Go)}(t);return a.faces=u.concat(s).concat(l),Bn.meshFromPositionAndFaces(r,e,a.positions,a.faces)};function Wo(e,t,n,r){return Wt()(n._children).forEach((function(e){e.parent=r.mesh,console.log("Moving parents of child",e.name)})),r.keyPoints.map((function(o,a){return o.observers=new Zt.Observable,o.observers.add(Ho(e,t)),o.index=a,o.name="".concat(n.name,"keyPoint").concat(a),o.position=dn.of(r.localPolygon[a]).toBabylon(),o}))}var Ho=function(e,t){return function(n){var r=n.updatedPointMesh,o=n.is2updateServer;r.parent&&t.getNodeFromTree(r.parent.name).forEach((function(n){var a=r.index,i=n.item,c=i.mesh.name,u=i.localPolygon.map((function(e){return dn.of(e).toBabylon()}));u[a]=r.position,qo.createNewMeshFromOldUsingNewPoints(u,e,i,t),o&&t.updateNodeInServer(c),rn.Maybe.fromNull(i.mesh.observers).forEach((function(e){i.mesh.getAbsolutePosition(),e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:o,displacement:Zt.Vector3.Zero()})})),rn.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){var t=e.vertexObs;i.mesh.getAbsolutePosition(),t({updatedPointMesh:i.mesh,is2updateServer:o,displacement:Zt.Vector3.Zero()})}))}))}},Yo=function(e,t,n,r){var a=[];return t.forEach((function(t,o){var i=new Zt.Color3(.25,.25,.25),c=Bn.createSphere(e,i,Uo,"".concat(n.name,"keyPointPolygon").concat(o),!0);c.parent=n,c.position=t,c.index=o,c.observers=new Zt.Observable,a.push(c),c.observers.add(Ho(e,r))})),a.forEach((function(t){t.onClick=function(){r.setContextActions(function(e,t,n){var r=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){n.item.localPolygon.length>3&&r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-trash"},e))},action:function(n){qo.deleteKeyPoint(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-less-than"},e))},action:function(n){qo.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-greater-than"},e))},action:function(n){qo.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),r}(e,t,r))}})),a},Zo=qo;function Qo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Xo=function(e){T()(n,e);var t=Qo(n);function n(){var e,r,a,i;return P()(this,n),i=t.call(this),d()(N()(i),"action",(function(t){an()((e=N()(i),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(i))})),d()(N()(i),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,o=e.camera;Bn.getGroundPosition(n,r).forEach((function(r){o.detachControl(e.canvas),i.mouseCurve.push(r),t.getUndoManager().doIt(i.getUndoAbleClickAction(i.mouseCurve,n,t,e))}))}))})),d()(N()(i),"getDrawPolygonContextAction",(function(e,t,n){var r=[];return r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(Jo,!1),i.mouseCurve=[],n.closeContextDial()},name:"Clear Polygon [ESC | DEL | Backspace]"}),i.mouseCurve.length>2&&r.push({icon:function(e){return o.a.createElement("i",Oe()({className:"fas fa-check"},e))},action:function(r){e.attachControl(t,!0),r.getUndoManager().doIt(i.getUndoAbleEnterAction(i.mouseCurve,n,r))},name:"Create Polygon [Enter]"}),r})),d()(N()(i),"onPointerMove",(function(e,t){})),d()(N()(i),"onPointerUp",(function(e,t){})),d()(N()(i),"onKeyUp",(function(e,t){var o=function(){return an()((r=N()(i),j()(n.prototype)),"onKeyUp",r).call(r,e,t)};t.getSceneMemory().forEach((function(r){var c=r.scene,u=r.camera,s=r.canvas,l=i.getDrawPolygonContextAction(u,s,c);er([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return l[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return l[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){0===i.mouseCurve.length&&an()((a=N()(i),j()(n.prototype)),"onKeyUp",a).call(a,e,t),l[0].action(t)}}],o)(e)}))})),d()(N()(i),"createPolygonRegion",(function(e,t,n,r){var o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Zt.Color3.Yellow(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=r.getRootNode().item.mesh,u=e.map((function(e){return Bn.getLocalCoordFromWorld({parent:c},dn.ofBabylon(e))})),s=Bn.pointAverageVec3(u),l=u.map((function(e){return e.sub(s)})),f=Zo.ofDict(n,{name:t,position:s.toArray(),color:[a.r,a.g,a.b],localPolygon:l.map((function(e){return e.toArray()})),height:i},r);f.mesh.parent=c,r.addNodeItem2Tree(f,c.name,o,!0,o)})),i.key="drawPolygonRegion",i.name="Draw Polygon Region [5]",i.mouseCurve=[],i.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-draw-polygon"},e))},i}return S()(n,[{key:"getUndoAbleClickAction",value:function(e,t,n,r){var o=this,a=r.camera,i=r.canvas,c=Wt()(e);return J.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:c;n.deleteNodeFromTreeUsingName(Jo,!1,!1),o.createPolygonRegion(e,Jo,t,n,!1),n.setContextActions(o.getDrawPolygonContextAction(a,i,t)),o.mouseCurve=c})).undoAction((function(){n.deleteNodeFromTreeUsingName(Jo);var e=c.slice(0,c.length-1),r=1===e.length?[e[0],e[0]]:e;e.length>0&&o.createPolygonRegion(r,Jo,t,n,!1),o.mouseCurve=e})).build()}},{key:"getUndoAbleEnterAction",value:function(e,t,n){var r=this,o=Wt()(e),a="PolygonRegion".concat(Math.floor(1e3*Math.random()));return J.UndoManager.actionBuilder().doAction((function(){n.deleteNodeFromTreeUsingName(Jo,!1),r.createPolygonRegion(o,a,t,n,!0),r.mouseCurve=[],n.setPropertiesWithName(a),n.closeContextDial()})).undoAction((function(){n.deleteNodeFromTreeUsingName(a),r.createPolygonRegion(o,Jo,t,n,!1),r.mouseCurve=o})).build()}}]),n}($n),Jo="temp_polygon_region",$o=Xo;function ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ta=function(e){T()(n,e);var t=ea(n);function n(){var e,r;return P()(this,n),r=t.call(this),d()(N()(r),"action",(function(t){an()((e=N()(r),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(r))})),d()(N()(r),"onPointerDown",(function(e,t){})),d()(N()(r),"onPointerMove",(function(e,t){})),d()(N()(r),"onPointerUp",(function(e,t){})),r.key="orbit",r.name="Orbit [ESC]",r.maybeSelectedMesh=rn.Maybe.none(),r.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-globe"},e))},r}return n}($n);function na(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ra=function(e){T()(n,e);var t=na(n);function n(){var e,r;return P()(this,n),r=t.call(this),d()(N()(r),"action",(function(t){an()((e=N()(r),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(r))})),d()(N()(r),"onPointerDown",(function(e,t){1===e.buttons&&r.mousePosConsumer(t)((function(e,n){var o=n.scene,a=n.ground,i=Bn.pickMesh(o,a).filter(r.isConnectableMesh(t));i.forEach((function(o){t.highlightMeshesInScene([o],Zt.Color3.Green()),r.onPointerDownLine(e,o,n,t)})),i.orElseRun((function(){t.highlightMeshesInScene(),r.resetPreview()}))}))})),d()(N()(r),"onPointerMove",(function(e,t){r.mousePosConsumer(t)((function(e,n){var o=n.scene,a=n.ground;Bn.pickMesh(o,a).filter(r.isConnectableMesh(t)).cata((function(){return t.highlightMeshesInScene()}),(function(e){return t.highlightMeshesInScene([e],Zt.Color3.Green())})),r.firstMousePos&&r.onPointerMoveLine(e,n,t)}))})),d()(N()(r),"onPointerUp",(function(e,t){})),d()(N()(r),"onKeyUp",(function(e,t){er([{predicate:function(e){return["Backspace","Delete","Escape"].includes(e.code)},action:function(){return r.resetPreview()}}])(e)})),d()(N()(r),"resetPreview",(function(){r.firstMousePos&&(r.deletePreviewMeshes(),r.firstMousePos=void 0,r.firstClickedMesh=void 0)})),d()(N()(r),"deletePreviewMeshes",(function(){r.previewMeshes.forEach((function(e){return e.dispose()})),r.previewMeshes=[]})),d()(N()(r),"mousePosConsumer",(function(e){return function(t){e.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground;Bn.getGroundPosition(n,r).forEach((function(n){return t(n,e)}))}))}})),d()(N()(r),"isConnectableMesh",(function(e){return function(t){return e.getNodeFromTree(t.name).cata((function(){var n,r=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(r).filter((function(e){return e.item.getType()===qr.TYPE})).filter((function(e){var n=e.item,r=t.index;return 0===r||r===n.keyPoints.length-1}))}),(function(e){var n=e.item;return rn.Maybe.some(t).filter((function(e){return n.getType()!==qr.TYPE&&n.getType()!==Un.TYPE}))})).orSome(!1)}})),d()(N()(r),"belongsToPath",(function(e){return function(t){var n,r=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(r).filter((function(e){return e.item.getType()===qr.TYPE})).map((function(e){return e.item.name}))}})),d()(N()(r),"belongs2SamePath",(function(e){return function(t,n){var o=r.belongsToPath(e);return o(t).flatMap((function(e){return o(n).map((function(t){return e===t}))})).orSome(!1)}})),d()(N()(r),"onPointerDownLine",(function(e,t,n,o){var a=n.scene;r.firstMousePos?r.belongs2SamePath(o)(t,r.firstClickedMesh)?r.resetPreview():o.getUndoManager().doIt(r.getUndoAbleLineEdge([r.firstClickedMesh,t],a,o,t)):(r.firstMousePos=e,r.firstClickedMesh=t)})),d()(N()(r),"getUndoAbleLineEdge",(function(e,t,n){return J.UndoManager.actionBuilder().doAction((function(){r.createEdge(e,t,n),r.resetPreview()})).undoAction((function(){r.deleteEdge(e,n)})).build()})),d()(N()(r),"onPointerMoveLine",(function(e,t,n){var o=t.scene,a=n.getRootNode().item.mesh,i=oa(n)([r.firstMousePos,e]);r.deletePreviewMeshes(),r.previewMeshes=[io.getEdgeMesh(o,i,Zt.Color3.Blue(),Sr.RADIUS/4)],r.previewMeshes.forEach((function(e){e.visibility=.25,e.parent=a,e.isPickable=!1}))})),d()(N()(r),"createEdge",(function(e,t,n){io.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var r=t.item;r.addEdge.apply(r,Wt()(e)),n.updateNodeInServer(r.name)}))})),d()(N()(r),"deleteEdge",(function(e,t){t.getGraph().forEach((function(n){var r=n.item;r.delEdge.apply(r,Wt()(e)),t.updateNodeInServer(r.name)}))})),r.key="drawGraph",r.name="Draw Graph [6]",r.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-project-diagram"},e))},r.previewMeshes=[],r.firstMousePos=void 0,r.firstClickedMesh=void 0,r}return n}($n),oa=Bn.toGlobalCoord,aa=ra;function ia(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ca=function(e){T()(n,e);var t=ia(n);function n(){var e,r;return P()(this,n),r=t.call(this),d()(N()(r),"action",(function(t){an()((e=N()(r),j()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(N()(r))})),d()(N()(r),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(n){var o=n.scene,a=n.ground;Bn.getGroundPosition(o,a).forEach((function(n){var a=Bn.toGlobalCoord(t)(n);if(r.ruler.push(a),r.ruler.length>2&&(r.mesh&&r.mesh.dispose(),r.tempMesh&&r.tempMesh.dispose(),r.text&&r.text.dispose(),r.ruler=[]),2===r.ruler.length){r.mesh=Zt.MeshBuilder.CreateLines("ruler",{points:r.ruler,updatable:!0},o),r.addTextGUI(o,r.calculateDistance(r.ruler[0],a),e);var i=t.getRootNode().item.mesh;r.mesh.parent=i}}))}))})),d()(N()(r),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(n){var o=n.scene,a=n.ground;Bn.getGroundPosition(o,a).forEach((function(n){var a=Bn.toGlobalCoord(t)(n);if(1===r.ruler.length){r.tempMesh&&r.tempMesh.dispose(),r.tempMesh=Zt.MeshBuilder.CreateLines("ruler",{points:[r.ruler[0],a],updatable:!0},o),r.addTextGUI(o,r.calculateDistance(r.ruler[0],a),e);var i=t.getRootNode().item.mesh;r.tempMesh.parent=i}}))}))})),d()(N()(r),"onPointerUp",(function(e,t){})),d()(N()(r),"calculateDistance",(function(e,t){var n=ln.ofBabylon(e),r=ln.ofBabylon(t);return n.sub(r).length().toFixed(3)})),d()(N()(r),"addTextGUI",(function(e,t,n){this.advancedTexture&&this.advancedTexture.removeControl(this.text),this.advancedTexture=Zn.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),this.text=new Zn.TextBlock,this.text.text="".concat(t,"m"),this.text.fontSize=17,this.text.left=e.pointerX-n.target.width/2+20,this.text.top=e.pointerY-n.target.height/2+20,this.text.color="white",this.advancedTexture.addControl(this.text)})),r.key="drawWall",r.name="Measure [7]",r.ruler=[],r.tempMesh=null,r.mesh=null,r.advancedTexture=null,r.text=null,r.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-ruler"},e))},r}return n}($n),ua=function(){return{measure:new ca,drawGraph:new aa,drawRegion:new $o,addKeyPoint:new yo,drawBoxRegion:new Io,drawPath:new Fo,dragObjects:new mo,orbit:new ta}},sa=function(){function e(t){P()(this,e),this.yamlSrc=t,this.cachedMap=null}var t,n;return S()(e,[{key:"load",value:(n=Gt()(Yt.a.mark((function t(){var n,r,o;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cachedMap){t.next=2;break}return t.abrupt("return",this.cachedMap);case 2:return t.next=4,fetch(e.getMapUrl(this.yamlSrc));case 4:return n=t.sent,t.t0=this,t.next=8,n.text();case 8:return t.t1=t.sent,t.next=11,t.t0.parseYaml.call(t.t0,t.t1);case 11:return r=t.sent,o={textureSrc:r.image,resolution:r.resolution,origin:r.origin,imageSize:r.size},this.cachedMap=o,t.abrupt("return",o);case 15:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"parseYaml",value:(t=Gt()(Yt.a.mark((function t(n){var r,o;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={},o={image:function(t,n){return r[t]=e.getMapUrl(n)},resolution:function(e,t){return r[e]=Number.parseFloat(t)},origin:function(e,t){return r[e]=JSON.parse(t)}},console.log("Yaml text",n),n.split("\n").map((function(e){return e.split(": ")})).filter((function(e){return e.length>=2})).filter((function(e){return e[0]in o})).forEach((function(e){return o[e[0]](e[0],e[1])})),t.next=6,this.getImageSize(r.image);case 6:return r.size=t.sent,t.abrupt("return",r);case 8:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getImageSize",value:function(e){return new Promise((function(t,n){var r=new Image;r.src=e,r.onload=function(){return t([r.naturalWidth,r.naturalHeight])}}))}}]),e}();d()(sa,"getMapUrl",(function(e){return"/static/maps/".concat(e)}));var la=function(){function e(){var t=this;if(P()(this,e),d()(this,"getAssets",(function(){return t.assets})),d()(this,"getAssetsActionMap",(function(){return t.assetsActionMap})),d()(this,"load",Gt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.retrieveAssetsFromDb();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))),d()(this,"signalObservers",(function(){Object.keys(t.observersBySceneId).forEach((function(e){t.observersBySceneId[e].forEach((function(e){return e(t)}))}))})),d()(this,"subs",[function(e){return J.MasterDB.subscribe({Scope:"Robot",Name:"*",RobotName:"*"},t.getRobotNameUpdate(),t.getRobotNameSub((function(e){return e.value}),(function(){return t.finishSub("RobotName",e)})))},function(e){return J.MasterDB.subscribe({Scope:"Package",File:"*",Name:"maps",FileLabel:"*"},t.getMapUpdater((function(e){return e.key})),t.getMapSubscriber((function(e){return e.value}),(function(){return t.finishSub("Maps",e)})))},function(e){return J.MasterDB.subscribe({Scope:"Package",File:"*",Name:"meshes",FileLabel:"*"},t.getMeshUpdater(),t.getMeshSubscriber((function(e){return e.value}),(function(){return t.finishSub("Meshes",e)})))}]),d()(this,"finishSub",(function(e,n){console.log("FINISH SUB ",e,t.finishInitialSubscribers),++t.finishInitialSubscribers>t.subs.length-1&&(t.afterLoad.forEach((function(e){return e(t)})),t.afterLoad=[],t.isLoading=!1,n(!0))})),d()(this,"deleteRobot",(function(e){t.delAsset(t.robots[e].name),e in t.robots&&delete t.robots[e]})),d()(this,"getMapSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(r){return t.getMapFileData(e,r).forEach((function(e){Object.keys(e).filter((function(e){return e.includes(".yaml")})).forEach(t.addMap),n()}))}})),d()(this,"getMapUpdater",(function(e){var n={del:function(n){t.getMapFileData(e,n).forEach((function(e){var n=Object.keys(e)[0];n=n.split(".")[0],t.delAsset(n)}))},set:t.getMapSubscriber(e),subscribe:t.getMapSubscriber(e)};return function(e){console.log("MAP UPDATE",e),n[e.event](e)}})),d()(this,"addMap",(function(e){var n={name:e.split(".")[0],loader:new sa(e),type:Ha.Map};t.addAsset(n.name,n)})),d()(this,"getMapFileData",(function(e,t){return da(e(t)).flatMap(ha("Package")).flatMap(ha("maps")).flatMap(ha("File"))})),d()(this,"getMeshSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(r){t.getMeshFileData(e,r).forEach((function(e){return Object.keys(e).forEach((function(n){var r={id:n,name:e[n].FileLabel,type:Ha.Mesh};t.addAsset(r.name,r)}))})),n()}})),d()(this,"getMeshUpdater",(function(){var e={del:function(e){t.getMeshFileData((function(e){return e.key}),e).forEach((function(e){var n=Object.keys(e)[0];t.delAsset(n)}))},set:t.getMeshSubscriber((function(e){return e.key})),subscribe:t.getMeshSubscriber((function(e){return e.key}))};return function(t){return e[t.event](t)}})),d()(this,"getMeshFileData",(function(e,t){return da(e(t)).flatMap(ha("Package")).flatMap(ha("meshes")).flatMap(ha("File"))})),fa)return fa;fa=this,this.assets={},this.assetsActionMap={},this.robots={},this.observersBySceneId={},this.afterLoad=[],this.finishInitialSubscribers=0,this.isLoading=!0}return S()(e,[{key:"addAfterLoad",value:function(e){return this.afterLoad.push(e),this}},{key:"addObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"addAsset",value:function(e,t){try{this.assets[e]=t,this.assetsActionMap[e]=Ya[t.type](t),this.isLoading||this.signalObservers()}catch(e){throw console.log("Caught exception while adding asset",e),Error("Caught exception while adding asset ".concat(e))}}},{key:"delAsset",value:function(e){e in this.assets&&delete this.assets[e],e in this.assetsActionMap&&delete this.assetsActionMap[e],this.signalObservers()}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&(console.log("Clear asset observer",t),delete this.observersBySceneId[t])}},{key:"retrieveAssetsFromDb",value:function(){var e=this;return new Promise((function(t,n){e.subs.forEach((function(e){return e(t)}))}))}},{key:"addRobot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e in this.robots||(this.robots[e]={id:e,name:null}),da(n).forEach((function(n){return t.robots[e].name=n})),Object.values(this.robots[e]).every((function(e){return null!==e}))){var r=this.robots[e];this.addAsset(r.name,{name:r.name,id:e,type:Ha.Robot,robotTree:{name:r.name,position:{x:0,y:0,z:0},orientation:{w:1,x:0,y:0,z:0},child:[]}})}}},{key:"getRobotNameSub",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(r){da(e(r)).flatMap(ha("Robot")).forEach((function(e){return Object.keys(e).forEach((function(n){return t.addRobot(n,e[n].RobotName)}))})),n()}}},{key:"getRobotNameUpdate",value:function(){var e=this,t={del:function(t){return da(t.key).flatMap(ha("Robot")).forEach((function(t){return Object.keys(t).forEach(e.deleteRobot)}))},set:this.getRobotNameSub((function(e){return e.key}))};return function(e){console.log("Robot NAME UPDATE",e),t[e.event](e)}}}],[{key:"getInstance",value:function(){return new e}}]),e}(),fa=null,da=rn.Maybe.fromNull,ha=function(e){return(t=da,function(e){return function(n){return t(e(n))}})(function(e){return function(t){return t[e]}}(e));var t},ma=la;function pa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var va=function(e){T()(n,e);var t=pa(n);function n(e,r){var a;return P()(this,n),a=t.call(this),d()(N()(a),"getType",(function(){return n.TYPE})),d()(N()(a),"deleteAsset",(function(){})),d()(N()(a),"download",Gt()(Yt.a.mark((function e(){var t,n,r;return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.mapLoader.load();case 2:t=e.sent,n=t.textureSrc,r=a.mapLoader.yamlSrc,o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{marginRight:"5px"}},"Image:"),o.a.createElement("a",{href:n,download:!0},n)),o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{marginRight:"5px"}},"Yaml:"),o.a.createElement("a",{href:sa.getMapUrl(r),download:!0},r)));case 6:case"end":return e.stop()}}),e)})))),a.name=e,a.key="addMap".concat(e),a.mapLoader=r,a.icon=function(e){return o.a.createElement("i",Oe()({},e,{className:"fas fa-map"}))},a.firstTimeLoad=!0,a}return S()(n,[{key:"addMap",value:function(e){var t=this;e.getSceneMemory().forEach(function(){var n=Gt()(Yt.a.mark((function n(r){var o,a,i,c,u,s,l,f,d,h,m,p,v,g,y,b;return Yt.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r.scene,a=r.camera,n.next=3,t.mapLoader.load();case 3:i=n.sent,c=i.textureSrc,u=i.resolution,s=i.origin,l=i.imageSize,f=u*l[0],d=u*l[1],h=Bn.groundBuilder(o).name(rn.Maybe.fromNull(t.memory.name).orSome(t.name)).width(f).height(d).textureSrc(c).build(),m=dn.of([-f/2,-d/2,0]).sub(dn.of(s)),p=e.getRootNode(),(v=p.item.mesh.parent).position=Un.inverseCoordinates(m.toBabylon()),a.setTarget(new Zt.Vector3(v.position.x,v.position.y,v.position.z)),g=new Yn(h,[f,d],t.textureSrc,rn.Maybe.fromNull(t.memory.assetName).orSome(t.name)),y=rn.Maybe.fromNull(t.memory.isVisible).orSome(!0),b=rn.Maybe.fromNull(t.memory.isImport).map((function(e){return!e})).orSome(!0),h.setEnabled(y),e.addNodeItem2Tree(g,null,b,y),r.ground.dispose(),r.ground=Xn.createMeshGround(o,f,d),t.memory.isImport=!1;case 24:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"action",value:function(e){var t=this;an()(j()(n.prototype),"action",this).call(this,e),e.getNodeFromTree(this.name).orElseRun((function(){t.memory.isImport&&t.firstTimeLoad?(t.addMap(e),t.firstTimeLoad=!1):e.getUndoManager().doIt(t.getUndoAction(e))})),e.setSelectedAction(ua().orbit)}},{key:"getUndoAction",value:function(e){var t=this;if(e.getObjectTree().length<2)return J.UndoManager.actionBuilder().doAction((function(){t.addMap(e)})).undoAction((function(){var t=e.getObjectTree()[1].title;e.deleteNodeFromTreeUsingName(t)})).build();var n=e.getObjectTree()[1].title,r=this.name;return J.UndoManager.actionBuilder().doAction((function(){t.switchMaps(n,r,e)})).undoAction((function(){e.deleteNodeFromTreeUsingName(r),rn.Maybe.fromNull(ma.getInstance().getAssetsActionMap()[n]).forEach((function(t){return t.action(e)}))})).build()}},{key:"switchMaps",value:function(e,t,n){}}]),n}(zn);d()(va,"TYPE","AddMapAction");var ga=va;function ya(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ba=function(e){T()(n,e);var t=ya(n);function n(e,r){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P()(this,n),o=t.call(this,e.mesh,r,a),d()(N()(o),"updateRobot",(function(e,t,n){var r=(new Date).getTime();n(e,.001*(r-t)),o.requestAnimationFrameId=requestAnimationFrame((function(){return o.updateRobot(e,r,n)}))})),d()(N()(o),"animate",(function(e){o.requestAnimationFrameId=requestAnimationFrame((function(){return o.updateRobot(N()(o),(new Date).getTime(),e)}))})),d()(N()(o),"getType",(function(){return n.TYPE})),o.requestAnimationFrameId=null,o.meshTree=e,o.timeSinceLastUpdate=0,o.isOnline=!0,o.speed=Zt.Vector3.Zero(),o.qSpeed=Zt.Quaternion.Zero(),o.newPos=Zt.Vector3.Zero(),o.newOri=Zt.Quaternion.Identity(),o.db=new J.Database,o}return S()(n,[{key:"toDict",value:function(){return an()(j()(n.prototype),"toDict",this).call(this)}},{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);return e.jsonSchema.properties={oldName:e.jsonSchema.properties.oldName,name:e.jsonSchema.properties.name,type:e.jsonSchema.properties.type,assetName:{type:"string",title:"Asset Name"},position:e.jsonSchema.properties.position,quaternion:e.jsonSchema.properties.quaternion,color:e.jsonSchema.properties.color,annotations:e.jsonSchema.properties.annotations},e.uiSchema.assetName={"ui:disabled":!0},e.data.assetName=this.assetName,e}},{key:"dispose",value:function(){an()(j()(n.prototype),"dispose",this).call(this),this.db.unsubscribe({Scope:"Robot",Name:this.meshTree.id,Parameter:"tf"}),window.cancelAnimationFrame(this.requestAnimationFrameId)}},{key:"toOffline",value:function(){this.mesh.isDisposed()||(this.mesh._children[0]._children[0].visibility=.1,this.speed=Zt.Vector3.Zero(),this.qSpeed=Zt.Quaternion.Zero(),this.isOnline=!1)}},{key:"toOnline",value:function(){this.mesh.isDisposed()||(this.mesh._children[0]._children[0].visibility=1,this.isOnline=!0)}}],[{key:"updateRobotMeshTree",value:function(e,t){var n=t.mesh.position,r=t.mesh.rotationQuaternion,o=new Zt.Vector3(e.position.x,e.position.y,e.position.z),a=new Zt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w).normalize(),i=1/t.timeSinceLastUpdate;t.speed=o.subtract(n).scale(i),t.qSpeed=a.subtract(r).scale(i),t.newPos=o,t.newOri=a,t.timeSinceLastUpdate=0}},{key:"setOnOffLine",value:function(e){e.timeSinceLastUpdate>n.TIME_2_BE_OFFLINE_IN_SEC?e.toOffline():e.isOnline||e.toOnline()}},{key:"transformMesh",value:function(e,t){var n=Math.PI/2,r=e.getBoundingInfo().boundingSphere;e.position.set(-r.center.x,-r.center.y,-r.center.z);var o=Bn.createSphere(t,new Zt.Color3(0,0,0),.5*r.radius,"tfsphere".concat(e.name),!1);o.visibility=.25,o.scaling=dn.ONES.scale(1/r.radius).toBabylon(),o.addRotation(n,0,0),o.position.set(0,0,.25);var a=Bn.createSphere(t,new Zt.Color3(0,0,0),1.9,e.name,!0);return a.visibility=.1,e.parent=o,o.parent=a,a}},{key:"createRobotMeshTreeRecursive",value:function(e,t,n,r){var o=this;t||(t=Bn.createSphere(r,new Zt.Color3(0,0,0),.5,e.name,!1));var a={mesh:t,children:[]},i=new Zt.Vector3(e.position.x,e.position.y,e.position.z),c=new Zt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w);return t.position=i,t.rotationQuaternion=c,n&&(t.parent=n),a.children=e.child.map((function(e){return o.createRobotMeshTreeRecursive(e,Bn.referentialBuilder(r).boxParams({isVisible:!1,size:.1}).build(),t,r)})),a}},{key:"createRobotMeshTree",value:function(e,t,r){return n.createRobotMeshTreeRecursive(e,t,null,r)}},{key:"builder",value:function(){return new wa}}]),n}(Gn);d()(ba,"ROBOT_MESH_NAME","Tugbot.stl"),d()(ba,"TYPE","Robot"),d()(ba,"TIME_2_BE_OFFLINE_IN_SEC",10),d()(ba,"getDefaultAnimator",(function(e){return function(e,t){var n=e.mesh,r=Bn.getRotationMatrix(n).prodVec(new dn([3,0,0])).toBabylon();n.position=n.position.add(r.scale(t)),n.rotate(Zt.Axis.Z,-Math.PI/2*t,Zt.Space.LOCAL)}})),d()(ba,"getSocketAnimator",(function(e,t){return e.db.subscribe({Scope:"Robot",Name:e.meshTree.id,Parameter:"tf"},(function(t){var n=Fr()(t,"key.Robot.".concat(e.meshTree.id,".Parameter.tf.Value"),void 0);n&&ba.updateRobotMeshTree(n,e)}),(function(t){var n=Fr()(t,"key.Robot.".concat(e.meshTree.id,".Parameter.tf.Value"),void 0);n&&ba.updateRobotMeshTree(n,e)})),function(t,n){var r=t.timeSinceLastUpdate%100;t.timeSinceLastUpdate+=n,dn.ofBabylon(t.speed).someNaNOrInfinite()||dn.ofBabylon(t.qSpeed).someNaNOrInfinite()||(t.mesh.position=r?t.newPos:t.mesh.position.add(t.speed.scale(n)),t.mesh.rotationQuaternion=r?t.newOri:t.mesh.rotationQuaternion.add(e.qSpeed.scale(n)).normalize(),ba.setOnOffLine(t))}}));var wa=function(){function e(){P()(this,e),this._name=null,this._meshTree=null,this._parentMesh=null,this._scene=null,this._isPickable=!0,this._id=null,this._keyValueMap={},this._assetName=null}return S()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"meshTree",value:function(e){return this._meshTree=e,this}},{key:"parentMesh",value:function(e){return this._parentMesh=e,this}},{key:"scene",value:function(e){return this._scene=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"id",value:function(e){return this._id=e,this}},{key:"keyValueMap",value:function(e){return this._keyValueMap=e,this}},{key:"assetName",value:function(e){return this._assetName=e,this}},{key:"build",value:function(){var e=this;return Object.keys(this).filter((function(e){return"_parentMesh"!==e})).map((function(t){return e[t]})).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a robot, e.g ".concat(e))})),this._meshTree.id=this._id,this._meshTree.name=this._name,this._meshTree.mesh.name=this._name,this._meshTree.mesh.isPickable=this._isPickable,this._meshTree.mesh.parent=this._parentMesh,Bn.referentialBuilder(this._scene).isPickable(!1).boxParams({isVisible:!1,size:.1}).name("".concat(this._name,"Axis")).build().parent=this._meshTree.mesh,new ba(this._meshTree,this._assetName,this._keyValueMap)}}]),e}(),Ea=ba;function xa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Ma=J.Utils.ofNull,ka=function(e){T()(n,e);var t=xa(n);function n(e,r){var o;return P()(this,n),o=t.call(this,e),d()(N()(o),"getType",(function(){return n.TYPE})),o.robot=r,o.pointCloudSubscribe(),o}return S()(n,[{key:"pointCloudSubscribe",value:function(){var e=this;J.MasterDB.subscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"},(function(t){rn.Maybe.fromNull(t).flatMap((function(e){return Ma(e.key)})).flatMap((function(t){return Ma(t.Robot[e.robot.id])})).flatMap((function(e){return Ma(e.Parameter)})).flatMap((function(e){return Ma(e.front_lidar)})).flatMap((function(e){return Ma(e.Value)})).flatMap((function(e){return Ma(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}),(function(t){rn.Maybe.fromNull(t.value).flatMap((function(e){return Ma(e.Robot)})).flatMap((function(t){return Ma(t[e.robot.id])})).flatMap((function(e){return Ma(e.Parameter)})).flatMap((function(e){return Ma(e.front_lidar)})).flatMap((function(e){return Ma(e.Value)})).flatMap((function(e){return Ma(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}))}},{key:"updatePointCloud",value:function(e){var t=new Zt.VertexData;t.positions=e.flatMap((function(e){return e}));var n=new Array(4*e.length);t.colors=n.fill(1),t.applyToMesh(this.mesh,!0)}},{key:"dispose",value:function(){an()(j()(n.prototype),"dispose",this).call(this),J.MasterDB.unsubscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"})}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!r)throw new Error("null dictionary describing point cloud or null mainView");var o=new Zt.Mesh("cloudPoint".concat(t.name),e),a=new Zt.StandardMaterial("cloudPoint".concat(t.name,"Material"),e);return a.emissiveColor=new Zt.Color3(1,1,1),a.disableLighting=!0,a.pointsCloud=!0,a.pointSize=2,o.material=a,new n(o,t)}}]),n}(En);d()(ka,"TYPE","PointCloud");var Pa=ka,Ca=function(){function e(){if(P()(this,e),Oa)return Oa;Oa=this,this.meshCacheBySceneId={},this.count=0}return S()(e,[{key:"hasKey",value:function(e,t){var n=t._uid;return rn.Maybe.fromNull(this.meshCacheBySceneId[n]).flatMap((function(t){return Sa(t[e])})).cata((function(){return!1}),(function(){return!0}))}},{key:"put",value:function(e,t,n){var r=t._uid;return r in this.meshCacheBySceneId||(this.meshCacheBySceneId[r]={}),this.meshCacheBySceneId[r][e]=n,n.setEnabled(!1),this}},{key:"get",value:function(e,t){var n=this,r=t._uid;return rn.Maybe.fromNull(this.meshCacheBySceneId[r]).flatMap((function(t){return Sa(t[e])})).map((function(t){console.log("#Mesh: Found Mesh in cache, retrieving copy number",n.count);var r=t.clone("".concat(e).concat(n.count++));return console.log("#Mesh:",r),r.setEnabled(!0),r})).orNull()}},{key:"del",value:function(e){var t=e._uid;t in this.meshCacheBySceneId&&delete this.meshCacheBySceneId[t]}}],[{key:"getInstance",value:function(){return new e}}]),e}(),Sa=function(e){return rn.Maybe.fromNull(e)},Oa=null,Na=Ca,Ra=(n(113),function(){function e(t){var n=this;P()(this,e),d()(this,"load",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e};return new Promise((function(r,o){var a=Na.getInstance();if(a.hasKey(e,n.scene))console.log("Found Mesh ".concat(e," in cache for scene ").concat(n.scene)),r(t(a.get(e,n.scene)));else{console.log("Loading mesh....");var i=new Zt.AssetsManager(n.scene),c=i.addMeshTask("","",Ta,e);c.onSuccess=function(t){console.log("Load Success",e);var r=t.loadedMeshes[0];r.name=e,a.put(e,n.scene,r)},c.onError=function(e,t,n){return o({message:t,exception:n})},i.onFinish=function(o){console.log("Load finish "),r(t(a.get(e,n.scene)))},i.load()}}))})),this.scene=t}return S()(e,null,[{key:"of",value:function(t){return new e(t)}}]),e}());d()(Ra,"getMeshUrl",(function(e){return"".concat(Ta).concat(e)}));var Ta="/static/meshes/",Aa=Ra;function Ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Da(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var ja=function(e){T()(n,e);var t=Da(n);function n(e){var r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return Ea.getDefaultAnimator(t)};return P()(this,n),a=t.call(this),d()(N()(a),"action",(function(e){an()((r=N()(a),j()(n.prototype)),"action",r).call(r,e),e.getNodeFromTree(a.robot.name).orElseRun((function(){return a.addRobot(e)})),e.setSelectedAction(ua().dragObjects)})),d()(N()(a),"getRobot",(function(e,t,n){var r=Ea.createRobotMeshTree(a.robot.robotTree,t,e),o=rn.Maybe.fromNull(a.memory.nodeItemDict);return Ea.builder().id(a.robot.id).name(rn.Maybe.fromNull(a.memory.name).orSome(a.robot.name)).assetName(rn.Maybe.fromNull(a.memory.assetName).orSome(a.robot.name)).meshTree(r).parentMesh(n).scene(e).keyValueMap(o.map((function(e){return e.keyValueMap})).orSome({})).build()})),d()(N()(a),"getCloudPoint",(function(e,t,n){var r=Pa.ofDict(e,{name:a.robot.name,id:a.robot.id},t);return r.mesh.parent=n.mesh,r})),d()(N()(a),"getParentMesh",(function(e){return rn.Maybe.fromNull(a.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(N()(a),"getType",(function(){return n.TYPE})),a.key="robotAction".concat(e.name),a.name=e.name,a.robot=e,a.robotAnimatorFactory=i,a.icon=function(e){return o.a.createElement("i",Oe()({className:"fas fa-robot"},e))},a}return S()(n,[{key:"addRobot",value:function(e){var t=this;e.getSceneMemory().forEach((function(n){var r=n.scene,o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ia(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ia(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.memory);o.isImport?t.loadRobot(r,e,o):e.getUndoManager().doIt(t.getUndoAbleAction(e,r,o))})),this.memory.isImport=!1}},{key:"getUndoAbleAction",value:function(e,t,n){var r=this;return J.UndoManager.actionBuilder().doAction((function(){r.loadRobot(t,e,n)})).undoAction((function(){e.deleteNodeFromTreeUsingName(r.name)})).build()}},{key:"loadRobot",value:function(e,t,n){var r=this;Aa.of(e).load(Ea.ROBOT_MESH_NAME,(function(t){return Ea.transformMesh(t,e)})).then((function(o){return r.createRobotFromMesh(o,e,t,n)}))}},{key:"createRobotFromMesh",value:function(e,t,n,r){var o=this.getParentMesh(n),a=rn.Maybe.fromNull(r.isImport).orSome(!1),i=rn.Maybe.fromNull(r.isVisible).orSome(!0);e.setEnabled(i);var c=this.getRobot(t,e,o);c.animate(this.robotAnimatorFactory(c,n)),n.addNodeItem2Tree(c,o.name,!a,i);var u=this.getCloudPoint(t,n,c);n.addNodeItem2Tree(u,c.name,!1,i)}}]),n}(zn);d()(ja,"TYPE","RobotAction");var Ba=ja;function Fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Va=function(e){T()(n,e);var t=Fa(n);function n(e,r){var o,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return P()(this,n),o=t.call(this,e,r,a),d()(N()(o),"getType",(function(){return n.TYPE})),o}return S()(n,[{key:"toDict",value:function(){return an()(j()(n.prototype),"toDict",this).call(this)}},{key:"toForm",value:function(){var e=an()(j()(n.prototype),"toForm",this).call(this);return e.jsonSchema.properties={oldName:e.jsonSchema.properties.oldName,name:e.jsonSchema.properties.name,type:e.jsonSchema.properties.type,assetName:{type:"string",title:"Asset Name"},position:e.jsonSchema.properties.position,quaternion:e.jsonSchema.properties.quaternion,color:e.jsonSchema.properties.color,annotations:e.jsonSchema.properties.annotations},e.uiSchema.assetName={"ui:disabled":!0},e.data.assetName=this.assetName,e}},{key:"getMouseContextActions",value:function(e){return an()(j()(n.prototype),"getMouseContextActions",this).call(this,e).filter((function(e){return"Delete"===e.title}))}}]),n}(Gn);d()(Va,"TYPE","Mesh");var La=Va;function _a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var za=function(e){T()(n,e);var t=Ua(n);function n(e){var r;return P()(this,n),r=t.call(this),d()(N()(r),"addMesh",(function(e){e.getSceneMemory().forEach((function(t){var n=t.scene,o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_a(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.memory),a=r.getIsImport(o),i=r.getFinalNameFromMemory(o,a);a?r.loadMesh(e,n,o,a,i):e.getUndoManager().doIt(r.getUndoAbleAction(e,n,o,a,i))})),r.memory.isImport=!1})),d()(N()(r),"transformMesh",(function(e,t,n,o){return function(a){var i=r.getParentMesh(e);a.parent=i,a.createNormals();var c=qa(n.nodeItemDict);a.position=c.flatMap((function(e){return o?Ka(e.position):Ga()})).map(Zt.Vector3.FromArray).orSome(Zt.Vector3.Zero()),a.rotationQuaternion=c.flatMap((function(e){return o?Ka(e.quaternion):Ga()})).map((function(e){return new Zt.Quaternion(e[1],e[2],e[3],e[0])})).orSome(Zt.Quaternion.Identity());var u=new Zt.StandardMaterial("Mesh".concat(a.name),t),s=c.flatMap((function(e){return o?Ka(e.color):Ga()})).map(Zt.Color3.FromArray).orSome(Zt.Color3.Gray());return u.diffuseColor=s,u.emissiveColor=s,a.material=u,a}})),d()(N()(r),"addMesh2Scene",(function(e,t,n,o){return function(a){var i=r.getParentMesh(e);a.name=o;var c=new La(a,r.name,qa(t.nodeItemDict).flatMap((function(e){return n?Ka(e.keyValueMap):Ga()})).orSome({}));e.addNodeItem2Tree(c,i.name,!n),e.renderMenus()}})),d()(N()(r),"getParentMesh",(function(e){return qa(r.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(N()(r),"getType",(function(){return n.TYPE})),d()(N()(r),"deleteAsset",(function(){})),d()(N()(r),"download",Gt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},o.a.createElement("div",{style:{marginRight:"5px"}},"Mesh:"),o.a.createElement("a",{href:Aa.getMeshUrl(r.key),download:!0},r.key)));case 1:case"end":return e.stop()}}),e)})))),r.key=e.id,r.name=e.name,r.icon=function(e){return o.a.createElement("i",Oe()({},e,{className:"fas fa-draw-polygon"}))},r}return S()(n,[{key:"action",value:function(e){an()(j()(n.prototype),"action",this).call(this,e),console.log("Mesh ".concat(this.key," : ").concat(this.name),this.memory),this.addMesh(e),e.setSelectedAction(ua().dragObjects)}},{key:"getIsImport",value:function(e){return qa(e.isImport).orSome(!1)}},{key:"getFinalNameFromMemory",value:function(e,t){return qa(e.nodeItemDict).flatMap((function(e){return t?Ka(e.name):Ga()})).orSome("".concat(this.name).concat(Math.floor(100*Math.random())))}},{key:"getUndoAbleAction",value:function(e,t,n,r,o){var a=this;return J.UndoManager.actionBuilder().doAction((function(){a.loadMesh(e,t,n,r,o)})).undoAction((function(){e.deleteNodeFromTreeUsingName(o)})).build()}},{key:"loadMesh",value:function(e,t,n,r,o){Aa.of(t).load(this.key).then(this.transformMesh(e,t,n,r)).then(this.addMesh2Scene(e,n,r,o))}}]),n}(zn);d()(za,"TYPE","AddMeshAction");var qa=rn.Maybe.fromNull,Ga=rn.Maybe.none,Ka=rn.Maybe.some,Wa=za,Ha={Map:"Map",Robot:"Robot",Mesh:"Mesh"},Ya={Map:function(e){return new ga(e.name,e.loader)},Robot:function(e){return new Ba(e,Ea.getSocketAnimator)},Mesh:function(e){return new Wa(e)}};function Za(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Qa=function(e){T()(n,e);var t=Za(n);function n(e,r,o){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return P()(this,n),a=t.call(this,e,c),d()(N()(a),"getType",(function(){return n.TYPE})),a.localWall=r,a.size=o,a.keyPoints=i,a}return S()(n,[{key:"toDict",value:function(){var e=an()(j()(n.prototype),"toDict",this).call(this);return e.localWall=this.localWall,e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,r)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing wall");var o=rn.Maybe.fromNull(t.name).orSome("Wall".concat(Math.floor(1e3*Math.random()))),a=$a(t,o,e),i=new Zt.StandardMaterial("WallMaterial".concat(o),e),c=new Zt.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,a.material=i,a.position.z+=.001;var u=ti(e,t.localWall.map((function(e){return dn.of(e).toBabylon()})),a,r);return new n(a,t.localWall,t.size,u,t.keyValueMap)}}]),n}(En);d()(Qa,"TYPE","Wall");var Xa=Sr.RADIUS,Ja=[[0,1,2],[2,3,0],[4,6,5],[6,4,7],[0,5,1],[5,0,4],[3,2,6],[6,7,3],[1,6,2],[6,1,5],[0,3,7],[7,4,0]];function $a(e,t,n){var r=e.localWall.map((function(e){return dn.of(e).toBabylon()})),o=dn.of(e.position).toBabylon(),a=r[1].subtract(r[0]).normalize(),i=new Zt.Vector3(-a.y,a.x,0),c=[r[0].add(i.scale(e.size.width)),r[0].subtract(i.scale(e.size.width)),r[1].subtract(i.scale(e.size.width)),r[1].add(i.scale(e.size.width))],u=new Zt.Vector3(0,0,e.size.height),s={positions:[c[0],c[1],c[2],c[3],c[0].add(u),c[1].add(u),c[2].add(u),c[3].add(u)],faces:Ja},l=Bn.meshFromPositionAndFaces(t,n,s.positions,s.faces);return l.position=o,l}var ei=function(e,t){return function(n){var r=n.updatedPointMesh,o=n.is2updateServer;e.getNodeFromTree(r.parent.name).forEach((function(n){var a=r.index,i=n.item,c=i.mesh,u={position:dn.ofBabylon(c.position).toArray(),localWall:i.localWall,size:i.size};u.localWall[a]=dn.ofBabylon(r.position).toArray(),function(e,t,n,r){var o=Bn.pointAverageVec3(e.localWall.map((function(e){return dn.of(e)})));e.position=o.toArray(),e.localWall=e.localWall.map((function(e){return dn.of(e).sub(o).toArray()}));var a=$a(e,n.name,t);a.position=n.position,a.rotationQuaternion=n.rotationQuaternion,a.locallyTranslate(o.toBabylon()),a.material=n.material,a.visibility=n.visibility,a.parent=n.parent,a.getMouseContextActions=n.getMouseContextActions,a.nodeItem=n.nodeItem,r.mesh=a,r.localWall=e.localWall,Wt()(n._children).forEach((function(e){n.removeChild(e),e.parent=a})),r.keyPoints.forEach((function(t,n){t.position=dn.of(e.localWall[n]).toBabylon()})),n.dispose()}(u,t,c,i),o&&e.updateNodeInServer(c.name)}))}},ti=function(e,t,n,r){var o=[];return t.forEach((function(t,a){var i=Bn.createSphere(e,new Zt.Color3(.25,.25,.25),Xa,"".concat(n.name,"keyPointWall").concat(a),!0);i.parent=n,i.position=t,i.index=a,i.observers=new Zt.Observable,i.observers.add(ei(r,e)),o.push(i)})),o},ni={GlobalRef:Un,Box:In,KeyPoint:ir,Path:qr,Wall:Qa,BoxRegion:No,PolygonRegion:Zo,GraphItem:io},ri=function(){function e(){P()(this,e)}return S()(e,null,[{key:"importScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];console.log("Importing scene...",e,t);var o=[];return t.length>0?ii(e,t,n,o,r):ci(e),console.log("End Importing scene"),o}},{key:"importNodeItem",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=ni[t.type];o&&e.getSceneMemory().forEach((function(a){var i=a.scene,c=o.ofDict(i,t,e),u=void 0===t.isVisible||t.isVisible;c.mesh.setEnabled(u),e.getNodeFromTree(n).forEach((function(e){c.mesh.parent=e.item.mesh})),e.addNodeItem2Tree(c,n,r,u,!1)}))}}]),e}();function oi(e){return e.type in Ha}function ai(e,t,n,r){var o=t.type,a=rn.Maybe.fromNull(t.assetName).orSome(t.name),i=e.getAssetsActionMap(),c=rn.Maybe.fromNull(i[a]).orLazy((function(){return i[a.split(".")[0]]}));c?(c.memory.parentObj={parent:n},c.memory.nodeItemDict=t,c.memory.assetName=a,c.memory.name=t.name,c.memory.isImport=!0,c.memory.isVisible=void 0===t.isVisible||t.isVisible,c.action(e)):r.push({cause:"Asset of type ".concat(o," with name ").concat(a,", was not found"),solution:"please upload ".concat(o," ").concat(a)})}function ii(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){var a=t.sort((function(e,t){return e.item.type===ni.GlobalRef.TYPE?-1:t.item.type===ni.GlobalRef.TYPE||e.item.type===ni.GraphItem.TYPE?1:t.item.type===ni.GraphItem.TYPE||e.name<t.name?-1:e.name>t.name?1:0}));a.forEach((function(t){oi(t.item)?ai(e,t.item,n,r):ri.importNodeItem(e,t.item,n,o),t.children.length>0&&ii(e,t.children,t.name,r,o)}))}}function ci(e){e.getSceneMemory().forEach((function(t){var n=t.scene;e.addNodeItem2Tree(Un.ofDict(n),null,!0)}))}var ui=ri,si=function e(){P()(this,e)};d()(si,"retrieveScene",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fi,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:li("retrieving scene");J.MasterDB.cloudFunction(Sr.CLOUD_FUNCTION_NAME,"retrieveScene",e,(function(e){return di(e,t,n)}))}));var li=function(e){return function(t){throw new Error("Exception caught in ".concat(e,": ").concat(t.error))}},fi=function(e){},di=function(e,t,n){e.success?t(e):n(e)},hi=si,mi=function(){function e(t,n,r,o,a){P()(this,e),this.title=t,this.item=n,this.children=r,this.expanded=o,this.isVisible=a}return S()(e,null,[{key:"dispose",value:function(t){t.item.dispose(),t.children.forEach((function(t){e.dispose(t)}))}},{key:"toDict",value:function(t){return{name:t.title,item:t.item.toDict(),children:t.children.map((function(t){return e.toDict(t)}))}}},{key:"builder",value:function(){return new pi}}]),e}(),pi=function(){function e(){P()(this,e),this._title=null,this._item={},this._children=[],this._expanded=!1,this._isVisible=!0}return S()(e,[{key:"title",value:function(e){return this._title=e,this}},{key:"item",value:function(e){return this._item=e,this}},{key:"children",value:function(e){return this._children=e,this}},{key:"expanded",value:function(e){return this._expanded=e,this}},{key:"isVisible",value:function(e){return this._isVisible=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a TreeNode, e.g ".concat(e))})),new mi(this._title,this._item,this._children,this._expanded,this._isVisible)}}]),e}(),vi=mi,gi=Sr.CLOUD_FUNCTION_NAME,yi=function(){function e(t){var n=this;P()(this,e),d()(this,"getNodeFromTree",(function(e,t){return new Cr(t).getNode((function(t){return e===t.title}))})),d()(this,"getParentFromChild",(function(e,t){return new Cr(t).getParentNode((function(t){return e===t.title}))})),d()(this,"deleteNodeFromTreeUsingName",(function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return n.getNodeFromTree(e,t).forEach((function(o){vi.dispose(o),r&&n.deleteNodeInServer(e),n.getParentFromChild(e,t).forEach((function(t){t.children=t.children.filter((function(t){return t.title!==e}))})),t=t.filter((function(t){return t.title!==e}))})),t})),d()(this,"getNodeFromTreeWithPredicate",(function(e,t){return new Cr(t).getNode(e)})),d()(this,"addNodeItem2Tree",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Un.NAME,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];n.deleteNodeFromTreeUsingName(t.name,e,o);var i=vi.builder().title(t.name).item(t).isVisible(a).build();if(r){var c=n.getNodeFromTree(r,e);c.forEach((function(e){o&&n.addNodeItem2Server(i,e.title),e.children.push(i)}))}else e.push(i),o&&n.addNodeItem2Server(i,null);return e})),d()(this,"updateNodeInServer",(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("updateNodeInServer!",e,n.sceneName),n.getNodeFromTree(e,t).forEach((function(o){var a=n.getParentFromChild(e,t).map((function(e){return e.title})).orNull();J.MasterDB.cloudFunction(gi,"updateNode",[vi.toDict(o),a,r,n.sceneName],(function(e){console.log("Update node with success?",e.success,e.error)}))}))})),d()(this,"addNodeItem2Server",(function(e,t){J.MasterDB.cloudFunction(gi,"addNodeItem",[vi.toDict(e),t,n.sceneName],(function(e){console.log("Add node with success?",e.success)}))})),d()(this,"deleteNodeInServer",(function(e){J.MasterDB.cloudFunction(gi,"deleteNodeByName",[e,n.sceneName],(function(e){console.log("Deleted node with success?",e.success)}))})),this.sceneName=t}return S()(e,null,[{key:"ofScene",value:function(t){return new e(t)}}]),e}(),bi=function(){function e(t,n,r){P()(this,e),this.state=t,this.next=n,this.while=r,this.requestAnimeId=null}return S()(e,[{key:"play",value:function(){var e=this;return this.requestAnimeId=requestAnimationFrame((function(){if(!e.while(e.state))return e.stop();e.state=e.next(e.state),e.play()})),this}},{key:"stop",value:function(){return cancelAnimationFrame(this.requestAnimeId),this}}],[{key:"builder",value:function(){return new wi}}]),e}(),wi=function(){function e(){P()(this,e),this._state=null,this._next=null,this._end=null}return S()(e,[{key:"initialState",value:function(e){return this._state=e,this}},{key:"nextState",value:function(e){return this._next=e,this}},{key:"while",value:function(e){return this._end=e,this}},{key:"build",value:function(){if([this._state,this._next,this._end].some((function(e){return null==e})))throw new Error("Animator properties are missing");return new bi(this._state,this._next,this._end)}}]),e}(),Ei=function e(){P()(this,e)};function xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}d()(Ei,"onPointerDown",(function(e){return function(t){e.mousePosClick=e.getMouseCoordsFromRoot().orSome(Zt.Vector3.Zero()),e.mousePosMove=e.mousePosClick,e.sceneMemory.forEach((function(e){var n=e.camera,r=e.canvas;(2===t.buttons||4===t.buttons||t.ctrlKey)&&n.detachControl(r)}))}})),d()(Ei,"onPointerUp",(function(e){return function(t){e.sceneMemory.forEach((function(e){var t=e.camera,n=e.canvas;t.attachControl(n,!0)}))}})),d()(Ei,"onPointerMove",(function(e){return function(t){e.sceneMemory.forEach((function(n){var r=n.mouseLocationText,o=n.camera;e.getMouseCoordsFromRoot().forEach((function(n){!function(e,t){e.text="x: ".concat(t.x.toFixed(2),", y: ").concat(t.y.toFixed(2))}(r,n);var a=function(){var t=n.subtract(e.mousePosMove),r=Bn.getBabylonCoordinates(t).scale(-1);!function(e,t){bi.builder().initialState({camera:e,time:0,T:(new Date).getTime()}).nextState((function(e){var n=e.camera,r=e.time,o=t.scale(.1);return n.position=n.position.add(o),n.setTarget(n.target.add(o)),{camera:n,time:r+.1,T:(new Date).getTime()}})).while((function(e){return e.time<=1})).build().play()}(o,r),e.mousePosMove=n},i=[{predicate:t.ctrlKey&&1===t.buttons,action:a},{predicate:4===t.buttons,action:a}].filter((function(e){return e.predicate}));i.length>0&&i[0].action()}))}))}}));var ki=function(e){T()(n,e);var t=Mi(n);function n(e){var r;return P()(this,n),r=t.call(this,e),d()(N()(r),"getSceneMemory",(function(){return r.sceneMemory})),d()(N()(r),"getAssetsActionMap",(function(){return ma.getInstance().getAssetsActionMap()})),d()(N()(r),"getRootNode",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Wt()(r.objectTree);return e.filter((function(e){return e.title===Un.NAME}))[0]})),d()(N()(r),"getObjectTree",(function(){return r.objectTree})),d()(N()(r),"setSelectedAction",(function(){})),d()(N()(r),"getUndoManager",(function(){return r.undoManager})),d()(N()(r),"getNodeFromTree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt()(r.objectTree);return yi.ofScene(r.sceneName).getNodeFromTree(e,t)})),d()(N()(r),"deleteNodeFromTreeUsingName",(function(){throw new Error("Delete Node in viewer Exception")})),d()(N()(r),"updateNodeInServer",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;yi.ofScene(r.sceneName).updateNodeInServer(e,Wt()(r.objectTree),t)})),d()(N()(r),"addNodeItem2Tree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Un.NAME,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=yi.ofScene(r.sceneName).addNodeItem2Tree(Wt()(r.objectTree),e,t,n,o);r.objectTree=a})),d()(N()(r),"setCameraToTarget",(function(){r.sceneMemory.forEach((function(e){var t=e.camera,n=r.isPanned?"":r.props.focusObject.Value;r.getNodeFromTree(n).forEach((function(e){console.log("Set Camera, Found Object",e.item.mesh);var n=.001*(new Date).getTime()-r.time;r.time=.001*(new Date).getTime();var o=e.item.mesh._absolutePosition.clone();r.cameraSpeed=r.targetPos?o.subtract(r.targetPos):Zt.Vector3.Zero(),r.targetPos=o,t.setTarget(o),t.position=t.position.add(r.cameraSpeed.scale(n)),t.beta=r.isRotated?t.beta:0}))}))})),d()(N()(r),"onPointerDown",(function(e){r.isRotated=!0,Ei.onPointerDown(N()(r))(e)})),d()(N()(r),"onPointerUp",(function(e){Ei.onPointerUp(N()(r))(e)})),d()(N()(r),"onPointerMove",(function(e){4===e.buttons&&(r.isPanned=!0),Ei.onPointerMove(N()(r))(e)})),d()(N()(r),"onResize",(function(e,t){0===e&&0===t||r.getSceneMemory().forEach((function(n){var r=n.mouseLocationText;r.left=-e/2+e/17,r.top=-t/2+t/30}))})),d()(N()(r),"retrieveSceneFromServer",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};hi.retrieveScene(r.sceneName,(function(t){var n=ui.importScene(N()(r),t.result);r.setState({errorList:n}),e()}))})),d()(N()(r),"loadAssets",Gt()(Yt.a.mark((function e(){var t;return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ma.getInstance(),0!==Object.values(t.getAssets()).length){e.next=4;break}return e.next=4,t.load();case 4:case"end":return e.stop()}}),e)})))),d()(N()(r),"loadScene",Gt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.loadAssets();case 2:r.retrieveSceneFromServer(r.renderScene);case 3:case"end":return e.stop()}}),e)})))),d()(N()(r),"renderScene",(function(){r.getSceneMemory().forEach((function(e){var t=e.engine,n=e.scene;return t.runRenderLoop((function(){r.time=.001*(new Date).getTime(),n.render(),r.setCameraToTarget()}))}))})),d()(N()(r),"onSceneReady",(function(e){var t=e.getEngine(),n=t.getRenderingCanvas();r.addCanvasEventListeners(n);var o=Xn.createMouseLocationText(e);return r.sceneMemory=rn.Maybe.some({engine:t,canvas:n,scene:e,camera:Xn.createCamera(e,n),light:Xn.createLight(e),ground:Xn.createMeshGround(e),gizmoManager:Xn.createGizmo(e),highlightLayer:{layer:new Zt.HighlightLayer("hl1",e),lastHlMeshes:[]},mouseLocationText:o}),e})),d()(N()(r),"renderMenus",(function(){})),d()(N()(r),"componentDidUpdate",(function(e){[{propVar:function(e){return e.sceneName.Value},action:function(){return r.sceneName=r.props.sceneName.Value}},{propVar:function(e){return e.focusObject.Value},action:function(){r.isPanned=!1,r.isRotated=!1,r.setCameraToTarget()}}].forEach((function(t){var n=t.propVar,o=t.action;n(r.props)!==n(e)&&o()}))})),d()(N()(r),"componentDidMount",(function(){console.log("SceneViewer Did Mount!! "),r.loadScene()})),r.state={errorList:[]},r.sceneName=e.sceneName.Value,r.sceneMemory=rn.Maybe.none(),r.objectTree=[],r.undoManager=new J.UndoManager,r.isPanned=!1,r.isRotated=!1,r.targetPos=void 0,r.cameraSpeed=Zt.Vector3.Zero(),r.time=.001*(new Date).getTime(),r}return S()(n,[{key:"getGraph",value:function(){return new Cr(this.objectTree).getNode((function(e){return io.TYPE===e.item.getType()}))}},{key:"addCanvasEventListeners",value:function(e){var t=this;[{name:"pointerdown",function:function(e){return t.onPointerDown(e)}},{name:"pointerup",function:function(e){return t.onPointerUp(e)}},{name:"pointermove",function:function(e){return t.onPointerMove(e)}}].forEach((function(t){return e.addEventListener(t.name,t.function,!1)}))}},{key:"getMouseCoordsFromRoot",value:function(){var e=this;return this.sceneMemory.flatMap((function(t){var n=t.scene,r=t.ground;return Bn.getGroundPosition(n,r).flatMap((function(t){return rn.Maybe.fromNull(e.getRootNode()).map((function(e){return Bn.getLocalCoordFromWorld(e.item.mesh,dn.ofBabylon(t)).toBabylon()}))}))}))}},{key:"render",value:function(){var e=this,t=this.state.errorList,n=function(){return e.setState({errorList:[]})};return o.a.createElement("div",{style:{display:"flex",flexGrow:1,maxHeight:"100%"}},o.a.createElement(nn,{onSceneReady:this.onSceneReady,is2render:!1,sceneFactory:Xn.createScene}),o.a.createElement(M,{onSubmit:n,onCancel:n,open:(null==t?void 0:t.length)>0,title:"Scene Viewer",message:"An error occurred while loading the scene",submitText:"OK",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary"},function(e){return e?o.a.createElement("ul",null,e.map((function(e,t){var n=e.cause,r=e.solution;return o.a.createElement("li",{key:"error"+t},"".concat(n,", ").concat(r))}))):[]}(t)),o.a.createElement(Xt.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}))}}],[{key:"getComponentFactory",value:function(e){return function(t){var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xi(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({sceneName:e},t);return o.a.createElement(n,r)}}}]),n}(r.Component);d()(ki,"EXTENSION",".3d"),ki.propTypes={sceneName:u.a.shape({Value:u.a.string}),focusObject:u.a.shape({Value:u.a.string})},ki.defaultProps={sceneName:{Value:"Pedro"},focusObject:{Value:""}};var Pi=ki,Ci=n(38),Si=n.n(Ci),Oi=n(26),Ni=n.n(Oi),Ri=n(35),Ti=n.n(Ri),Ai=Object(p.makeStyles)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),Ii=function(e){var t=Ai(),n=o.a.createElement("div",null);return e.noneOption&&(n=o.a.createElement(ke.a,{value:""},o.a.createElement("em",null,"None"))),o.a.createElement(Ni.a,{variant:e.variant,className:t.formControl,style:e.style,hiddenLabel:void 0===e.label},o.a.createElement(Si.a,{id:"movai-react-select"},e.label),o.a.createElement(Ti.a,{labelId:"movai-react-select",id:e.id,value:e.value,onChange:e.onChange,inputProps:e.inputProps},n,e.options.map((function(e,t){return o.a.createElement(ke.a,{key:t,value:e},e)}))))};Ii.propTypes={value:u.a.string,options:u.a.array,noneOption:u.a.bool,label:u.a.string,variant:u.a.string,style:u.a.object,onChange:u.a.func,id:u.a.string,inputProps:u.a.object},Ii.defaultProps={value:"option2",options:["option1","option2","option3"],variant:"filled",noneOption:!0,onChange:function(e){return console.log(e.target.value)},id:"movai-react-select"};var Di=Ii,ji=n(39),Bi=n.n(ji),Fi=n(25),Vi=n.n(Fi),Li=n(93),_i=function(e){var t=e.path,n=void 0===t?"":t,r=e.style,a=void 0===r?{}:r,i=e.fill,c=void 0===i?"#fff":i,u=e.width,s=void 0===u?"100%":u,l=e.height,f=void 0===l?"100%":l,d=e.className,h=void 0===d?"":d,m=e.viewBox,p=void 0===m?"0 0 24 24":m;return o.a.createElement("svg",{width:s,style:a,height:f,viewBox:p,xmlns:"http://www.w3.org/2000/svg",className:"svg-icon ".concat(h||""),xmlnsXlink:"http://www.w3.org/1999/xlink"},o.a.createElement("path",{fill:c,d:n}))},Ui={Close:o.a.createElement(_i,{width:24,path:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),ErrorOutline:o.a.createElement(_i,{width:24,path:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),InfoOutlined:o.a.createElement(_i,{width:24,path:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),ReportProblemOutlined:o.a.createElement(_i,{width:24,path:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),SuccessOutlined:o.a.createElement(_i,{width:24,path:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"})},zi={success:Ui.SuccessOutlined,warning:Ui.ReportProblemOutlined,error:Ui.ErrorOutline,info:Ui.InfoOutlined},qi=function(e){var t=e.action,n=e.children,o=e.classes,a=e.className,i=e.closeText,c=void 0===i?"Close":i,u=e.color,s=e.icon,l=e.iconMapping,f=void 0===l?zi:l,d=e.onClose,h=(e.role,e.severity),m=void 0===h?"success":h,p=e.variant,v=void 0===p?"standard":p,g=(e.theme,st()(e,["action","children","classes","className","closeText","color","icon","iconMapping","onClose","role","severity","variant","theme"]));return r.createElement("div",Oe()({className:Bi()(o.root,o["".concat(v).concat(Object(Li.capitalize)(u||m))],a)},g),!1!==s?r.createElement("div",{className:o.icon},s||f[m]||zi[m]):null,r.createElement("div",{className:o.message},n),null!=t?r.createElement("div",{className:o.action},t):null,null==t&&d?r.createElement("div",{className:o.action},r.createElement(Vi.a,{size:"small","aria-label":c,title:c,color:"inherit",onClick:d},Ui.Close)):null)};qi.propTypes={action:u.a.node,children:u.a.node,classes:u.a.object,className:u.a.string,closeText:u.a.string,color:u.a.oneOf(["error","info","success","warning"]),icon:u.a.node,iconMapping:u.a.shape({error:u.a.node,info:u.a.node,success:u.a.node,warning:u.a.node}),onClose:u.a.func,role:u.a.string,severity:u.a.oneOf(["error","info","success","warning"]),variant:u.a.oneOf(["filled","outlined","standard"])};var Gi=Object(p.withStyles)((function(){return{root:{backgroundColor:"transparent",display:"flex",padding:"6px 16px"},filledSuccess:{color:"#fff",backgroundColor:"#4caf50"},filledInfo:{color:"#fff",backgroundColor:"#2196f3"},filledWarning:{color:"#fff",backgroundColor:"#ff9800"},filledError:{color:"#fff",backgroundColor:"#f44336"},icon:{marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9},message:{padding:"8px 0",display:"flex",flexDirection:"column",justifyContent:"center"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiAlert"})(qi);n(114);function Ki(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Wi=function(e){T()(n,e);var t=Ki(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"autoClose",null),d()(N()(e),"handleClickButton",(function(t){t.onClick&&t.onClick(),e.close()})),d()(N()(e),"handleClickOverlay",(function(t){var n=e.props,r=n.closeOnClickOutside,o=n.onClickOutside,a=t.target===e.overlay;r&&a&&(o(),e.close())})),d()(N()(e),"close",(function(){Yi(),Hi()})),d()(N()(e),"keyboardClose",(function(t){var n=e.props,r=n.closeOnEscape,o=n.onKeypressEscape,a=27===t.keyCode;r&&a&&(o(t),e.close())})),d()(N()(e),"componentDidMount",(function(){document.addEventListener("keydown",e.keyboardClose,!1),e.autoClose=setTimeout((function(){(document.getElementById("react-confirm-alert")||document.getElementById("react-confirm-alert-body-element"))&&e.close()}),e.props.autoHideDuration)})),d()(N()(e),"componentWillUnmount",(function(){document.removeEventListener("keydown",e.keyboardClose,!1),clearTimeout(e.autoClose),e.props.willUnmount()})),d()(N()(e),"renderCustomUI",(function(){var t=e.props,n=t.title,r=t.message;return(0,t.customUI)({title:n,message:r,onClose:e.close})})),e}return S()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.message,r=t.customUI,a=t.severity,i=t.closeText,c=t.closable,u=t.theme;return o.a.createElement("div",{className:"react-confirm-alert-overlay",ref:function(t){return e.overlay=t},onClick:this.handleClickOverlay},o.a.createElement("div",{className:"react-confirm-alert"},r?this.renderCustomUI():o.a.createElement("div",{className:"react-confirm-alert-body"},o.a.createElement(Gi,{theme:u,elevation:6,variant:"filled",severity:a,closeText:i,action:c?o.a.createElement("div",{className:"icon-container",onClick:function(){return e.close()}},Ui.Close):void 0},n))))}}]),n}(r.Component);function Hi(){var e=document.getElementById("react-confirm-alert");Object(yr.unmountComponentAtNode)(e),e.parentNode.removeChild(e)}function Yi(){document.body.classList.remove("react-confirm-alert-body-element")}function Zi(e,t){document.body.classList.add("react-confirm-alert-body-element"),function(e,t){var n=document.getElementById("react-confirm-alert");n||(document.body.children[0].classList.add("react-confirm-alert-blur"),(n=document.createElement("div")).id="react-confirm-alert",document.body.appendChild(n)),Object(yr.render)(o.a.createElement(Wi,Oe()({},e,{theme:t})),n)}(e,t)}d()(Wi,"propTypes",{message:u.a.string,customUI:u.a.func,closeOnClickOutside:u.a.bool,closeOnEscape:u.a.bool,willUnmount:u.a.func,onClickOutside:u.a.func,onKeypressEscape:u.a.func,severity:u.a.string,closeText:u.a.string,autoHideDuration:u.a.number,closable:u.a.bool}),d()(Wi,"defaultProps",{closeOnClickOutside:!0,closeOnEscape:!0,willUnmount:function(){return null},onClickOutside:function(){return null},onKeypressEscape:function(){return null},severity:"info",closeText:"Close",autoHideDuration:6e3,closable:!0});n(116),n(117);function Qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qi(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ji,$i={borderBottom:"1px solid #212121",textColor:"white",background:{primary:"#424242",secondary:"#212121"}},ec={borderBottom:"1px solid #ccc",textColor:"rgba(0, 0, 0, 0.87)",background:{primary:"#e2e2e2",secondary:"#b2b2b2"}},tc=function(e){return Xi(Xi({},e),{},{typography:{fontFamily:"Open Sans",h1:{fontFamily:"Open Sans"},h2:{fontFamily:"Open Sans"},h3:{fontFamily:"Open Sans"},h4:{fontFamily:"Open Sans"},h5:{fontFamily:"Open Sans"},h6:{fontFamily:"Open Sans"},body1:{fontFamily:"Roboto"}},cursorDefault:{cursor:"default"},cursorPointer:{cursor:"pointer"}})},nc={dark:Object(p.createMuiTheme)(tc({label:"dark",textColor:$i.textColor,backgroundColor:"linear-gradient(114.01deg, #212121 0%, #050505 100.43%)",bottomNavigation:{background:"#212121"},globalStats:{borderColor:"#474747",subTextColor:"#CDCDCD",upperTextColor:"#E6E6E6"},palette:{type:"dark",primary:{main:"#36b5e6"},secondary:{main:"#CF6679"},green:{main:"#03DAC5"},background:{primary:$i.background.primary,secondary:$i.background.secondary},accent:{background:"#f5f5f9",color:"rgba(0, 0, 0, 0.87)",border:"#dadde9"}},icon:{color:"#c6c6c6",hoverColor:"white"},table:{stripColor:"#505050"},overrides:{MuiTableCell:{body:{color:$i.textColor}},MuiAppBar:{colorDefault:{color:$i.textColor,borderColor:"black",backgroundColor:$i.background.secondary},colorInherit:{color:$i.textColor,backgroundColor:"#353535"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"inherit",margin:"8px"},containedSecondary:{color:"inherit",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#36b5e6"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(255,255,255,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}}}})),light:Object(p.createMuiTheme)(tc({font:{Roboto:{fontFamily:"Roboto"},OpenSans:{fontFamily:"Open Sans"}},label:"light",textColor:ec.textColor,backgroundColor:"linear-gradient(122.19deg, #FFFFFF 2.58%, #FFFFFF 76.23%)",bottomNavigation:{background:"#c3c3c3"},icon:{color:"#757575",hoverColor:"black"},table:{stripColor:"whitesmoke"},globalStats:{borderColor:"#E6E6E6",subTextColor:"#717171",upperTextColor:"#474747"},palette:{primary:{main:"#007197"},secondary:{main:"#BE2424"},green:{main:"#03DAC5"},background:{primary:ec.background.primary,secondary:ec.background.secondary},accent:{background:"whitesmoke",color:ec.textColor,border:"darkgray"}},overrides:{MuiTableCell:{body:{color:ec.textColor}},MuiAppBar:{colorDefault:{color:ec.textColor,borderColor:ec.borderBottom,backgroundColor:ec.background.secondary},colorInherit:{color:ec.textColor,backgroundColor:"#d2d2d2"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"white",margin:"8px"},containedSecondary:{color:"white",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#007197"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(0,113,151, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(0,0,0,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}},MuiPaper:{root:{color:"#272727",backgroundColor:ec.background.primary}},MuiTableRow:{head:{"& th":{backgroundColor:ec.background.primary,borderBottom:ec.borderBottom}},root:{"& td":{borderBottom:ec.borderBottom}}}}})),getTheme:function(){var e=window.localStorage.getItem("movai.theme");return e||"dark"},setTheme:function(e){window.localStorage.setItem("movai.theme",e)}},rc=nc,oc=n(94),ac=n.n(oc),ic=n(95),cc=Object(ic.createGlobalStyle)(Ji||(Ji=ac()(["",""])),J.Style),uc=n(48),sc=n.n(uc),lc=n(96);function fc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var dc=Object(p.withStyles)((function(e){return{paper:{borderRadius:"8px",width:"242px",height:"411px",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.25)"}}}))((function(e){return o.a.createElement(xe.a,Oe()({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},autoFocus:!1},e))})),hc=function(e){T()(n,e);var t=fc(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"state",{anchorEl:null,otherFilters:[]}),d()(N()(e),"handleClick",(function(t){e.setState({anchorEl:t.currentTarget})})),d()(N()(e),"handleClose",(function(){e.setState({anchorEl:null,otherFilters:[]})})),e}return S()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=(e.t,e.disabled),r=e.tooltip,a=e.title;return o.a.createElement(o.a.Fragment,null,o.a.createElement(v.Tooltip,{title:r||a},o.a.createElement(Vi.a,{size:"small",onClick:this.handleClick,disabled:n,className:this.props.isActive?t.iconActive:t.icon},this.props.icon)),o.a.createElement(dc,{id:"customized-menu",anchorEl:this.state.anchorEl,open:Boolean(this.state.anchorEl),onClose:this.handleClose,className:t.height},o.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"-webkit-fill-available"}},o.a.createElement(v.Typography,{component:"div",style:{padding:"10px 10px 0px 20px",display:"flex",flexDirection:"row"}},o.a.createElement(v.Typography,{component:"div",style:{fontSize:"24px",fontFamily:"Open Sans",fontWeight:500}},this.props.title),o.a.createElement(v.Typography,{component:"div",style:{flexGrow:1}}),o.a.createElement(v.Typography,{component:"div",onClick:this.handleClose,className:t.icon},o.a.createElement("i",{className:"fas fa-times"}))),o.a.createElement("div",{style:{flexGrow:1,display:"flex",flexDirection:"column",margin:"10px 0px 0px 10px"}},this.props.children))))}}]),n}(r.Component);hc.propTypes={isActive:u.a.bool,disabled:u.a.bool,tooltip:u.a.string,title:u.a.string},hc.defaultProps={isActive:!1,disabled:!1,tooltip:"",title:"Filters"};var mc=Object(p.withStyles)((function(e){return{button:{margin:e.spacing(1),color:e.palette.primary.main,borderColor:e.palette.primary.main},iconActive:{color:e.palette.primary.main,borderColor:e.palette.primary.main,backgroundColor:Object(lc.fade)(e.palette.primary.main,.1)},buttonApplyFilters:{background:e.palette.primary.main,fontFamily:"Roboto",fontStyle:"normal",fontWeight:"bold",fontSize:"14px",color:"#FAFAFA",margin:"0px 20px 10px 20px","&:hover":{background:e.palette.primary.dark}},icon:{"&:hover":{cursor:"pointer"}},height:{height:"100%"},checkbox:{marginLeft:"10px"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)}}}),{withTheme:!0})(hc),pc=n(97),vc=n.n(pc),gc=n(98),yc=n.n(gc),bc=n(99),wc=n.n(bc),Ec=n(100),xc=n.n(Ec),Mc=n(32),kc=n.n(Mc),Pc=n(49),Cc=n.n(Pc),Sc=n(44),Oc=n.n(Sc),Nc=n(50),Rc=n.n(Nc),Tc=n(51),Ac=n(101),Ic=n.n(Ac),Dc=n(45),jc=n.n(Dc),Bc=Object(p.makeStyles)((function(e){return{input:{flex:1,paddingLeft:"10px",fontSize:"medium"},searchText:{minWidth:150,paddingLeft:e.spacing(3)},addTagText:{width:"100%"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)},toggleContainer:{margin:e.spacing(2)},tagsContainer:{display:"flex",flexDirection:"column",padding:e.spacing(.5),margin:e.spacing(0,3,0,3)},tagsList:{marginTop:e.spacing(3)},chip:{margin:e.spacing(.5)},formControl:{margin:e.spacing(1),minWidth:120,maxWidth:300},filtersButton:{display:"flex",flexDirection:"row"},columnsFilter:{display:"flex",flexDirection:"column",marginTop:6},iconButton:{color:"#0B6A8A","&:hover":{color:"#22c7ff"}}}})),Fc=function(e){var t,n=Bc(),r=o.a.useState(""),a=ce()(r,2),i=a[0],c=a[1],u=function(t){var n,r=null==t||null===(n=t.target)||void 0===n?void 0:n.value,o=r[r.length-1];e.updateRobotSelection(o)};return o.a.createElement(v.AppBar,{position:"static",color:"inherit"},o.a.createElement(v.Toolbar,{variant:"dense"},o.a.createElement("div",{className:n.toggleContainer},o.a.createElement("svg",{width:"20",height:"18",viewBox:"0 0 30 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{paddingTop:"5px",paddingRight:"5px"}},o.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7753 1.35706L15.9587 2.61119L16.3648 2.87846L18.4001 4.18898L17.1052 6.20016H25.437C26.5487 6.20016 27.45 7.10137 27.45 8.21307V12.8244H28.0955C28.6514 12.8244 29.102 13.275 29.102 13.8308V16.0643C29.102 16.6201 28.6514 17.0707 28.0955 17.0707H27.45V21.2901C27.45 22.4018 26.5487 23.303 25.437 23.303H4.12161C3.00991 23.303 2.1087 22.4017 2.1087 21.29V17.0707H1.42467C0.868819 17.0707 0.418213 16.6201 0.418213 16.0643V13.8308C0.418213 13.275 0.868819 12.8244 1.42467 12.8244H2.1087V8.21307C2.1087 7.10137 3.00991 6.20016 4.12161 6.20016H13.5141L14.8252 4.16395L13.2875 3.15192L13.2966 3.13812L13.2875 3.1322L15.1377 0.290771L16.7753 1.35706ZM24.4306 9.21953H5.12807V20.2836H24.4306V9.21953ZM7.18098 12.1324C6.68518 12.1324 6.28325 12.5343 6.28325 13.0301C6.28325 13.5259 6.68518 13.9278 7.18098 13.9278H9.04635C9.54216 13.9278 9.94409 13.5259 9.94409 13.0301C9.94409 12.5343 9.54216 12.1324 9.04635 12.1324H7.18098ZM20.6901 12.1324C20.1943 12.1324 19.7924 12.5343 19.7924 13.0301C19.7924 13.5259 20.1943 13.9278 20.6901 13.9278H22.5555C23.0513 13.9278 23.4532 13.5259 23.4532 13.0301C23.4532 12.5343 23.0513 12.1324 22.5555 12.1324H20.6901ZM9.17669 17.6512H11.3239V19.253H9.17669V17.6512ZM14.3432 17.6513H12.196V19.253H14.3432V17.6513ZM15.2154 17.6513H17.3626V19.253H15.2154V17.6513ZM20.382 17.6513H18.2348V19.253H20.382V17.6513ZM10.9568 23.69H18.6019V25.7029C18.6019 26.2587 18.1513 26.7093 17.5954 26.7093H11.9632C11.4074 26.7093 10.9568 26.2587 10.9568 25.7029V23.69Z",fill:"#9E9E9E"})),o.a.createElement(Ni.a,{className:n.formControl},o.a.createElement(Ti.a,{labelId:"select-label",id:"select",multiple:!0,value:e.selectedRobots,onChange:u,renderValue:function(e){var t=e.filter((function(e){return e.isSelected})).map((function(e){return e.name}));return t.length>2?[t[0],t[1]].join(" , ")+"...":t.join(" , ")},input:o.a.createElement(kc.a,null),MenuProps:Vc},e.selectedRobots.map((function(e,t){return o.a.createElement(ke.a,{key:"robotList-".concat(t),value:e.id},o.a.createElement(Rc.a,{checked:e.isSelected}),o.a.createElement(Cc.a,{primary:e.name}))}))))),o.a.createElement(v.TextField,{className:n.searchText,label:"",placeholder:"Search (regex)",value:e.messageRegex,onChange:function(t){return e.handleMessageRegex(t.target.value)},InputProps:{startAdornment:o.a.createElement(sc.a,{style:{paddingRight:8}},o.a.createElement(nt.a,{fontSize:"small"})),endAdornment:o.a.createElement(sc.a,{position:"end"},o.a.createElement(Vi.a,{disabled:!e.messageRegex,onClick:function(){return e.handleMessageRegex("")}},o.a.createElement(m.a,{color:"inherit",fontSize:"small"})))},size:"small"}),o.a.createElement("div",{className:n.toggleContainer},o.a.createElement(Ni.a,{className:n.formControl},o.a.createElement(Ti.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",style:{minWidth:"290px"},multiple:!0,value:e.levels,onChange:e.handleLevels,input:o.a.createElement(kc.a,null),renderValue:function(t){return e.levelsList.filter((function(e){return t.includes(e.value)})).map((function(e){return e.label})).join(", ")},MenuProps:Vc},e.levelsList.map((function(t){return o.a.createElement(ke.a,{key:t.value,value:t.value},o.a.createElement(Rc.a,{checked:e.levels.indexOf(t.value)>-1}),o.a.createElement(Cc.a,{primary:t.label}))}))))),(t=e.advancedMode,o.a.createElement(mc,{icon:o.a.createElement(vc.a,null),title:"Tags",disabled:!t,isActive:e.tags.length>0},o.a.createElement("div",{className:n.tagsContainer},o.a.createElement(v.TextField,{className:n.addTagText,value:i,onChange:function(e){return c(e.target.value)},onKeyUp:function(t){13===t.keyCode&&(e.handleAddTag(i),c(""))},label:"Add Tag",InputProps:{endAdornment:o.a.createElement(sc.a,null,o.a.createElement(Vi.a,{onClick:function(){e.handleAddTag(i),c("")}},o.a.createElement(wc.a,null)))},size:"small"}),o.a.createElement("div",{className:n.tagsList},e.tags.map((function(t){return o.a.createElement("li",{key:t.key},o.a.createElement(yc.a,{label:t.label,onDelete:function(){return e.handleDeleteTag(t)},className:n.chip,size:"small"}))})))))),o.a.createElement(mc,{icon:o.a.createElement(xc.a,null),title:e.t("Date Range"),isActive:null!==e.selectedFromDate||null!==e.selectedToDate},o.a.createElement(Tc.MuiPickersUtilsProvider,{utils:Ic.a},o.a.createElement(Tc.KeyboardDateTimePicker,{key:"time-picker",size:"small",variant:"inline",ampm:!1,label:e.t("From date"),value:e.selectedFromDate,onChange:function(t){return e.handleDateChange(t,"selectedFromDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}),o.a.createElement(Tc.KeyboardDateTimePicker,{key:"time-picker2",size:"small",variant:"inline",ampm:!1,label:e.t("To date"),value:e.selectedToDate,onChange:function(t){return e.handleDateChange(t,"selectedToDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}))),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(mc,{icon:o.a.createElement(Oc.a,null),title:e.t("Configuration")},o.a.createElement(v.FormControlLabel,{control:o.a.createElement(v.Switch,{checked:e.advancedMode,onChange:e.handleAdvancedMode}),label:e.advancedMode?"Advanced":"Simple"}),o.a.createElement("div",{className:n.filtersButton},o.a.createElement(v.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Limit p/Robot"),":")),o.a.createElement(v.TextField,{value:e.limit,onChange:e.handleLimit,className:n.limitText,id:"outlined-number",placeholder:e.t("limit"),type:"number",InputLabelProps:{shrink:!0},size:"small"})),o.a.createElement("div",{className:n.columnsFilter},o.a.createElement(v.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Columns"),":")),o.a.createElement(Ni.a,{className:n.formControl},o.a.createElement(Ti.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",multiple:!0,value:e.columns,onChange:e.handleColumns,input:o.a.createElement(kc.a,null),renderValue:function(t){return t.map((function(t){return Fr()(e,"columnList[".concat(t,"].label"),"")})).join(", ")},MenuProps:Vc},Object.keys(e.columnList).map((function(t,n){return o.a.createElement(ke.a,{key:n,value:t},o.a.createElement(Rc.a,{checked:e.columns.indexOf(t)>-1}),o.a.createElement(Cc.a,{primary:e.columnList[t].label}))}))))))))},Vc={PaperProps:{style:{maxHeight:224,width:250}},getContentAnchorEl:null};function Lc(e,t){return jc()(e,t)}Fc.propTypes={levels:u.a.array,levelsList:u.a.array,handleLevels:u.a.func,limit:u.a.number,handleLimit:u.a.func,columns:u.a.array,columnList:u.a.object,handleColumns:u.a.func,handleDeleteTag:u.a.func,messageRegex:u.a.string,handleMessageRegex:u.a.func,selectedFromDate:u.a.string,selectToDate:u.a.string,handleDateChange:u.a.func,selectedRobots:u.a.array,updateRobotSelection:u.a.func,advancedMode:u.a.bool,handleAdvancedMode:u.a.func,t:u.a.func},Fc.defaultProps={levels:[],levelsList:[],handleLevels:function(){},limit:1,handleLimit:function(){},columns:[],columnList:{},handleColumns:function(){},handleDeleteTag:function(){},messageRegex:"",handleMessageRegex:function(){},selectedFromDate:"",selectToDate:"",handleDateChange:function(){},selectedRobots:[],updateRobotSelection:function(){},advancedMode:!1,handleAdvancedMode:function(){},t:function(e){return e}};var _c=Object(r.memo)(Fc,Lc),Uc=(n(118),n(102),n(103)),zc=n.n(Uc);var qc={INFO:{backgroundColor:"rgba(33, 150, 243, 0.1)"},WARNING:{backgroundColor:"rgba(255, 152, 0, 0.1)"},DEBUG:{backgroundColor:"rgba(76, 175, 80, 0.1)"},ERROR:{backgroundColor:"rgba(244, 67, 54, 0.1)"},CRITICAL:{backgroundColor:"rgba(255, 19, 1, 0.1)"}};function Gc(e,t){var n=e.length;if(0===n||void 0===e)return 0;for(var r=0;r<n;r++)for(var o=0;o<n&&r!==e[o][t];o++)if(o===n-1)return r;return n}function Kc(e,t){var n="";if(Array.isArray(e)&&e.length===t.length)return n;try{return e.forEach((function(e){n=""===n?"".concat(e.toLowerCase()):"".concat(n,",").concat(e.toLowerCase())})),"level=".concat(n)}catch(e){return""}}function Wc(e){var t="";return zc()(e)?t:(e.forEach((function(e){t=""===t?"".concat(e.label):"".concat(t,",").concat(e.label)})),"&tags=".concat(t))}function Hc(e){return e&&""!==e?"&message=".concat(e):""}function Yc(e,t){for(var n,r=0,o=e.length-1,a=null;r<=o;){var i=t(e[n=(r+o)/2|0]);"right"===i[0]?r=n+1:o=n-1,i[1]&&(a=n)}return a}var Zc=function(e,t,n){if(!e)return[];var r=0,o=e.length;if(!t&&!n)return e;var a=e.map((function(e){return e.time}));return n&&(r=Yc(a,(function(e){return e>=n.getTime()/1e3?["right",!1]:["left",!0]}))),t&&(o=Yc(a,(function(e){return e<=t.getTime()/1e3?["left",!1]:["right",!0]}))),e.slice(r,o+1)},Qc=n(56),Xc=n.n(Qc),Jc=n(52);function $c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function eu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$c(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tu=Object(p.makeStyles)((function(e){return eu({flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:"rgba(0, 5, 58, 0.3)"}},tableCell:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block"},flexColumn:{flex:1,alignItems:"center"},noClick:{cursor:"initial"}},qc)})),nu=function(e){var t=e.columns,n=e.rowHeight,r=e.headerHeight,a=e.onRowClick,i=st()(e,["columns","rowHeight","headerHeight","onRowClick"]),c=tu(),u=function(t){var n=t.index,r=e.data[n];return Bi()(c.tableRow,c.flexContainer,-1!==n&&c[r.level],d()({},c.tableRowHover,-1!==n&&null!=a))},s=function(e){return function(r){var a=r.cellData,i=r.columnIndex;return o.a.createElement(Xc.a,{component:"div",className:"".concat(c.tableCell," ").concat(c.flexContainer),variant:"body",style:{height:n},align:null!=i&&t[i].numeric?"right":"left"},e?e(a):a)}};return o.a.createElement(Jc.AutoSizer,null,(function(e){var l=e.height,f=e.width;return o.a.createElement(Jc.Table,Oe()({height:l,width:f,onRowClick:a,rowHeight:n,gridStyle:{direction:"inherit"},headerHeight:r,className:c.table},i,{rowClassName:u}),t.map((function(e,n){var a=e.dataKey,i=e.render,u=st()(e,["dataKey","render"]);return o.a.createElement(Jc.Column,Oe()({key:a,headerRenderer:function(e){return a=eu(eu({},e),{},{columnIndex:n}),i=a.label,u=a.columnIndex,o.a.createElement(Xc.a,{component:"div",className:Bi()(c.tableCell,c.flexContainer,c.noClick),variant:"head",style:{height:r},align:t[u].numeric?"right":"left"},o.a.createElement("span",null,i));var a,i,u},flexGrow:"message"===a?1:void 0,className:c.flexContainer,cellRenderer:s(i),dataKey:a},u))})))}))};function ru(e){return o.a.createElement(nu,{rowHeight:48,headerHeight:48,rowCount:e.logsData.length,rowGetter:function(t){var n=t.index;return e.logsData[n]},data:e.logsData,columns:e.columns.map((function(t){return e.columnList[t]})),onRowClick:e.onRowClick})}function ou(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function au(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ou(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ou(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function iu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}ru.propTypes={columns:u.a.array,columnList:u.a.object,logsData:u.a.array,height:u.a.number,onRowClick:u.a.func},ru.defaultProps={columns:[],columnList:{},logsData:[],height:10};var cu={key:0,label:"ui"},uu=function(e){T()(n,e);var t=iu(n);function n(){var e;P()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(N()(e),"state",{selectedRobots:[],levels:["INFO","ERROR"],limit:50,logsData:[],messageRegex:"",selectedFromDate:null,selectedToDate:null,columns:["Time","Robot","Message"],tags:e.props.advancedMode?[]:[cu],height:0,levelsList:e.props.advancedMode?[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]:[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}],advancedMode:e.props.advancedMode}),d()(N()(e),"logsTimeout",void 0),d()(N()(e),"logModal",Object(r.createRef)()),d()(N()(e),"simpleLevelsList",[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}]),d()(N()(e),"advancedLevelsList",[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]),d()(N()(e),"updateSelectedRobots",(function(){e.props.robotsData.length&&e.props.robotsData.filter((function(e){return e.ip})).length&&e.setSelectedRobots(e.props.robotsData.map((function(e){return au(au({},e),{},{isSelected:!0})})))})),d()(N()(e),"updateRobotSelection",(function(t){var n=Wt()(e.state.selectedRobots),r=n[n.findIndex((function(e){return e.id===t}))];r.isSelected=!r.isSelected,e.setState({selectedRobots:n})})),d()(N()(e),"setSelectedRobots",(function(t){clearTimeout(e.logsTimeout),e.setState({selectedRobots:t}),e.getLogs(t)})),d()(N()(e),"getLogs",function(){var t=Gt()(Yt.a.mark((function t(n){return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.filter((function(t){return t.robotState!==e.props.robotStates.off})).filter((function(e){return e.isSelected})).map((function(t){return e.getRobotLogData(t)}))).then((function(t){e.setState((function(n){var r=t.reduce((function(e,t){return t&&t.forEach((function(t){return e.push(t)})),e}),[]);return e.logsTimeout=setTimeout(e.getLogs,3e3,n.selectedRobots),{logsData:r.sort((function(e,t){return t.time-e.time}))}}))}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d()(N()(e),"getRobotLogData",(function(t){return new Promise((function(n,r){var o=setTimeout((function(){console.error("MOV.AI: One of the promises reached timeout"),n([])}),2e3);if(t.ip){var a="http://".concat(t.ip,"/api/v1/logs/?").concat(Kc(e.state.levels,e.state.levelsList),"&limit=").concat(e.state.limit).concat(Wc(e.state.tags)).concat(Hc(e.state.messageRegex));J.MasterDB.get(a,(function(e,t){n((null==e?void 0:e.data)||[]),clearTimeout(o)}))}else n([])})).catch((function(){return console.log("Failed getRobotLogData")}))})),d()(N()(e),"onRowClick",(function(t){e.logModal.current.open(t.rowData)})),e}return S()(n,[{key:"resizeHandler",value:function(){var e=this.divElement.clientHeight;this.setState({height:e})}},{key:"componentDidMount",value:function(){this.updateSelectedRobots()}},{key:"componentDidUpdate",value:function(e,t){jc()(e.robotsData,this.props.robotsData)||this.updateSelectedRobots()}},{key:"componentWillUnmount",value:function(){this.logsTimeout&&clearTimeout(this.logsTimeout)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},o.a.createElement("div",{style:{flexGrow:"1",height:"100%",display:"flex",flexDirection:"column"}},o.a.createElement(_c,{selectedRobots:this.state.selectedRobots,updateRobotSelection:this.updateRobotSelection,levels:this.state.levels,levelsList:this.state.levelsList,handleLevels:function(t){e.setState({levels:t.target.value})},limit:this.state.limit,handleLimit:function(t){""===t.target.value?e.setState({limit:0}):e.setState({limit:t.target.value})},columns:this.state.columns,columnList:this.props.columnList,handleColumns:function(t){var n=Object.keys(e.props.columnList).filter((function(e){return t.target.value.includes(e)}));e.setState({columns:n})},tags:this.state.tags,handleAddTag:function(t){var n=e.state.tags;""!==t&&n.findIndex((function(e){return e.label===t}))<0&&(n.push({key:Gc(n,"key"),label:t}),e.setState({tags:n}))},handleDeleteTag:function(t){var n=e.state.tags.filter((function(e){return e.key!==t.key}));e.setState({tags:n})},messageRegex:this.state.messageRegex,handleMessageRegex:function(t){return e.setState({messageRegex:t})},selectedFromDate:this.state.selectedFromDate,selectedToDate:this.state.selectedToDate,handleDateChange:function(t,n){e.setState(d()({},n,t))},advancedMode:this.state.advancedMode,handleAdvancedMode:function(t){var n=!e.state.advancedMode;e.setState({advancedMode:n,levelsList:e.state.advancedMode?e.simpleLevelsList:e.advancedLevelsList,tags:n?[]:[cu]})}}),o.a.createElement("div",{ref:function(t){e.divElement=t},className:this.props.classes.tableContainer},o.a.createElement(ru,{columns:this.state.columns,columnList:this.props.columnList,logsData:Zc(this.state.logsData,this.state.selectedFromDate,this.state.selectedToDate),height:this.state.height,levelsList:this.state.levelsList,onRowClick:this.onRowClick}))),o.a.createElement(te,{ref:this.logModal,props:["module","service"]}))}}]),n}(r.Component);uu.propTypes={robotsData:u.a.array,robotStates:u.a.object,columnList:u.a.object,advancedMode:u.a.bool},uu.defaultProps={robotsData:[{name:"robot",id:"032cf6207ff34ad0a68cc45034f61b41",timestamp:1604334778.6494586,robotState:"okay",battery:78,ip:"127.0.0.1"},{name:"robot_test",id:"4df900e30cb44adba33ae74bb2596d88",timestamp:1603969723.997914,robotState:"off",battery:22,ip:"127.0.0.1"}],robotStates:{error:"error",temp:"temp",okay:"okay",off:"off"},columnList:{Date:{label:"Date",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleDateString("pt"))}(e)}},Time:{label:"Time",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleTimeString("pt"))}(e)}},Level:{label:"Level",dataKey:"level",width:100},Module:{label:"Module",dataKey:"module",width:100},Robot:{label:"Robot",dataKey:"robot",width:100},Message:{label:"Message",dataKey:"message",width:100}},advancedMode:!1};var su=Object(p.withStyles)((function(e){return{tableContainer:{flexGrow:1,minHeight:0,overflow:"hidden"}}}),{withTheme:!0})(uu),lu=n(29),fu=n.n(lu),du=n(104),hu=n.n(du),mu=n(105),pu=n.n(mu),vu=n(57),gu=n.n(vu);function yu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var bu=function(e){T()(n,e);var t=yu(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"state",{username:"",password:"",remember:!1,error:!1,errorMessage:"",capsLockOn:!1}),d()(N()(e),"sendCreds",Gt()(Yt.a.mark((function t(){var n;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,J.Authentication.login(e.state.username,e.state.password,e.state.remember);case 3:(n=t.sent).error?e.setState({error:!0,errorMessage:n.error}):e.props.setLoggedIn(!0),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.setState({error:!0,errorMessage:t.t0});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),d()(N()(e),"checkCapsLock",(function(t){if("CapsLock"===t.key&&e.state.capsLockOn)e.setState({capsLockOn:!1});else{var n=t.getModifierState("CapsLock");e.setState({capsLockOn:n})}})),e}return S()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,r=t.logo;return o.a.createElement(fu.a,{style:{paddingTop:"5%"},container:!0,direction:"column",alignItems:"center",justify:"space-evenly"},o.a.createElement(pu.a,{elevation:10,className:n.root},o.a.createElement(fu.a,{item:!0},o.a.createElement("img",{src:r||hu.a,className:"center",alt:"logo",style:{display:"block",marginLeft:"auto",marginRight:"auto",width:"50%"}})),o.a.createElement(fu.a,null,o.a.createElement(q.a,{align:"center",variant:"subtitle1",gutterBottom:!0},o.a.createElement(Ni.a,{className:n.formControl,error:this.state.error},o.a.createElement(Si.a,{htmlFor:"component-username-error"},"Username"),o.a.createElement(kc.a,{id:"component-username-error",value:this.state.username,"aria-describedby":"component-username-error-text",onChange:function(t){return e.setState({username:t.target.value})}})))),o.a.createElement(fu.a,null,o.a.createElement(q.a,{align:"center",variant:"subtitle1",gutterBottom:!0},o.a.createElement(Ni.a,{className:n.formControl,error:this.state.error},o.a.createElement(Si.a,{htmlFor:"component-password-error"},"Password"),o.a.createElement(kc.a,{id:"component-password-error",type:"password",value:this.state.password,"aria-describedby":"component-password-error-text",onChange:function(t){return e.setState({password:t.target.value})},onKeyUp:function(t){e.checkCapsLock(t),"Enter"===t.key&&e.sendCreds()}}),this.state.error&&o.a.createElement(gu.a,{id:"component-error-text"},this.state.errorMessage),this.state.capsLockOn&&o.a.createElement(gu.a,{id:"component-warning-text"},"Warning: Caps lock is ON!")))),o.a.createElement(fu.a,null,o.a.createElement(q.a,{align:"center",gutterBottom:!0},o.a.createElement(i.a,{onClick:function(){return e.sendCreds()}},"Login")))))}}]),n}(r.Component);bu.propTypes={logs:u.a.any,setLoggedIn:u.a.func},bu.defaultProps={setLoggedIn:function(e){return console.log(e)}};var wu=Object(p.withStyles)((function(e){return{root:{padding:e.spacing(4,4),borderRadius:10}}}),{withTheme:!0})(bu);function Eu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Eu(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Eu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Mu=Object(p.makeStyles)((function(e){return{menuItemSpacing:xu({fontSize:"18px",minHeight:"18px",padding:e.spacing(1.25,2)},e.cursorDefault),profileMenuFooter:{fontSize:"14px",textAlign:"end"}}})),ku=function(e){var t,n=Mu(),r=o.a.useState(null),a=ce()(r,2),i=a[0],c=a[1];return o.a.createElement("div",null,o.a.createElement(Vi.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)}},o.a.createElement(Oc.a,null)),o.a.createElement(xe.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(){c(null)}},o.a.createElement(v.Typography,{component:"div",variant:"body1"},o.a.createElement("div",{className:n.menuItemSpacing},e.welcomeLabel,", ",e.userName),o.a.createElement(U.a,{variant:"middle"}),null===(t=e.extraItems)||void 0===t?void 0:t.map((function(e){return o.a.createElement(ke.a,{className:n.menuItemSpacing,onClick:function(){return e.func}},e.label)})),o.a.createElement("div",{className:n.menuItemSpacing},e.darkThemeLabel,o.a.createElement(Rt,{onToggle:function(){return e.handleToggleTheme()},toggle:e.isDarkTheme})),o.a.createElement(ke.a,{className:(n.menuItemSpacing,n.cursorPointer),onClick:e.handleLogout},e.logoutLabel),o.a.createElement(U.a,{variant:"middle"}),o.a.createElement("div",{className:n.menuItemSpacing+" "+n.profileMenuFooter},e.version))))};ku.propTypes={welcomeLabel:u.a.string,userName:u.a.string,darkThemeLabel:u.a.string,logoutLabel:u.a.string,version:u.a.string,extraItems:u.a.array,isDarkTheme:u.a.bool,handleLogout:u.a.func,handleToggleTheme:u.a.func},ku.defaultProps={welcomeLabel:"Hello",userName:"User",darkThemeLabel:"Dark Theme",logoutLabel:"Logout",version:"",extraItems:[],isDarkTheme:!0,handleLogout:function(){return console.log("logout")},handleToggleTheme:function(){return console.log("toggle")}};var Pu=ku,Cu=n(53),Su=n.n(Cu),Ou=n(58),Nu=n.n(Ou),Ru=n(106),Tu=n.n(Ru),Au=(n(120),n(121),n(122),n(107)),Iu=n.n(Au);function Du(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ju(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Du(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Du(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}var Fu=function(e){T()(n,e);var t=Bu(n);function n(){var e;P()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(N()(e),"searchInput",null),d()(N()(e),"timer",null),d()(N()(e),"inputRef",o.a.createRef()),d()(N()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,250)})),d()(N()(e),"handleSearch",(function(){null!==e.searchInput&&e.props.search(e.searchInput)})),e}return S()(n,[{key:"resetValue",value:function(){var e=this.inputRef.current.children[0];e.value="",e.focus(),this.searchInput="",this.handleSearch(),this.forceUpdate()}},{key:"isEmpty",value:function(){return null===this.searchInput||""===this.searchInput.trim()}},{key:"render",value:function(){var e=this;return o.a.createElement(v.Typography,{component:"div",style:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%"}},o.a.createElement(v.InputBase,{ref:this.inputRef,style:{marginLeft:10,flex:1},placeholder:"Search",onChange:this.handleChange}),o.a.createElement(v.IconButton,{style:{padding:10},onClick:function(){e.isEmpty()||e.resetValue()}},this.isEmpty()?o.a.createElement(nt.a,null):o.a.createElement(_e.a,null)))}}]),n}(r.Component),Vu=function(e){return o.a.createElement(v.List,{style:ju({paddingLeft:"0px",paddingRight:"0px"},e.style),dense:!0,component:"div",onKeyUp:e.onKeyUp},e.children)},Lu=function(e){return o.a.createElement(Vu,{style:{flexGrow:1,paddingBottom:"0px",paddingTop:"0px"},onKeyUp:e.onKeyUp},o.a.createElement(v.ListItem,null,o.a.createElement(Fu,{search:function(t){return e.onSearch(t)}})),o.a.createElement(v.Divider,null),o.a.createElement(v.Typography,{style:e.style,component:"div"},o.a.Children.map(e.children,(function(e){return e}))))};function _u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Uu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_u(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=j()(e);if(t){var o=j()(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I()(this,n)}}Lu.propTypes={onSearch:u.a.func},Lu.defaultProps={onSearch:function(e){return console.log(e)}};for(var qu=[],Gu=0;Gu<100;Gu++)qu.push({id:Gu,name:"1.0.".concat(Gu)});var Ku=function(e){T()(n,e);var t=zu(n);function n(){var e;P()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(N()(e),"state",{selectedGroup:"EXPANDED",groupsEnabled:!0,searchValue:""}),d()(N()(e),"searchFilter",(function(e,t){var n=t.toLowerCase(),r=e.filter((function(e){return!e.name.includes("@SM")&&e.name.toLowerCase().includes(n)||e.children.findIndex((function(e){return e.name.toLowerCase().includes(n)}))>=0})).map((function(e){return Uu(Uu({},e),{},{children:((null==e?void 0:e.children)||[]).filter((function(t){return t.name&&!t.name.includes("@SM")&&(e.name.toLowerCase().includes(n)||t.name.toLowerCase().includes(n))}))})}));return r.forEach((function(e){e.children.forEach((function(e,t){e.id=e.id?e.id:t,e.children&&e.children.forEach((function(e,t){e.id=e.id?e.id:t}))}))})),r})),d()(N()(e),"handleSelectedGroupChange",(function(t){e.setState({selectedGroup:t})})),d()(N()(e),"handleExpansion",(function(e,t,n,r){})),e}return S()(n,[{key:"render",value:function(){var e=this,t=this.props.classes,n=o.a.createElement("i",{className:"fas fa-home"}),r=this.props.data;return o.a.createElement("div",null,o.a.createElement(Lu,{style:{overflow:"auto"},icon:n,onSearch:function(t){e.setState({searchValue:t})}},o.a.createElement("div",{style:{height:this.props.height}},o.a.createElement(Tu.a,{nodes:this.searchFilter(r,this.state.searchValue),onChange:this.props.handleChange},(function(n){var a,i,c=n.style,u=n.node;st()(n,["style","node"]);return c.paddingLeft=c.marginLeft/1.5,c.marginLeft=0,o.a.createElement("div",{style:c,onClick:function(){return e.props.onClickNode(u)},onDoubleClick:function(){return e.props.onDoubleClickNode(u)},p:2,className:Fr()(u,"children",!1)?"":t.preContainer},o.a.createElement(Iu.a,{p:1,className:t.inlineFlex},o.a.createElement(fu.a,{alignContent:"space-between",container:!0},Fr()(u,"children",!1)&&(null===(a=u.state)||void 0===a?void 0:a.expanded)&&o.a.createElement(fe.a,{onClick:function(t){return e.handleExpansion(t,r,u,!1)}}),Fr()(u,"children",!1)&&!(null!==(i=u.state)&&void 0!==i&&i.expanded)&&o.a.createElement(se.a,{onClick:function(t){return e.handleExpansion(t,r,u,!0)}}),o.a.createElement("div",{className:Fr()(u,"children",!1)?"":t.spaceBetween},o.a.createElement("div",{className:t.ellipsis},u.name)))))})))))}}]),n}(r.Component);Ku.propTypes={data:u.a.array,onClickNode:u.a.func,onDoubleClickNode:u.a.func,handleChange:u.a.func,height:u.a.oneOfType([u.a.string,u.a.number])},Ku.defaultProps={data:[],onClickNode:function(){},onDoubleClickNode:function(){},handleChange:function(){},height:700};var Wu=Object(p.withStyles)((function(e){return{horizFlex:{display:"flex",flexDirection:"row",alignItems:"center"},spaceBetween:{display:"flex",width:"100%",justifyContent:"space-between"},preContainer:{justifyContent:"space-between","& button":{display:"none"},"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)","& button":{display:"inline-flex"}}},ellipsis:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:2},iconSpace:{flex:1,textAlign:"right",minWidth:"45px","& button":{position:"relative",bottom:"7px",padding:"7px"}}}}),{withTheme:!0})(Ku),Hu=n(108),Yu=n.n(Hu),Zu=n(46),Qu=n.n(Zu),Xu=function(e){var t=[{id:0,name:"Annotations",scope:"Annotation",children:[]},{id:1,name:"Callback",scope:"Callback",children:[]},{id:2,name:"Configuration",scope:"Configuration",children:[]},{id:3,name:"Flow",scope:"Flow",children:[]},{id:4,name:"Nodes",scope:"Node",children:[]},{id:5,name:"Layouts",scope:"Layout",children:[]},{id:6,name:"Scenes",scope:"GraphicScene",children:[]}],n=o.a.useState(t),r=ce()(n,2),a=r[0],i=r[1],c=o.a.useState("global"),u=ce()(c,2),s=u[0],l=u[1],f=o.a.useState(e.selected),d=ce()(f,2),h=d[0],m=d[1],p=o.a.useState({}),g=ce()(p,2),y=g[0],b=g[1],w=o.a.useState(!0),x=ce()(w,2),M=x[0],k=x[1],P=!0,C=t.filter((function(t){return e.scopeList.includes(t.scope)}));o.a.useEffect((function(){return P&&(J.Workspace.getAll().then((function(e){return b(e)})).catch((function(e){return console.log(e)})),N(s),P=!1),function(){}}),[e.scopeList]);var S,O,N=function(t){var n=Nu()(C);n.forEach((function(r,o){J.Workspace.getDocs({workspace:t,scope:r.scope}).then((function(r){var a=r.scopes.sort((function(e,t){return e.ref.toLowerCase()>t.ref.toLowerCase()})).map((function(e,t){return{id:t,url:e.url,name:e.ref,children:[{name:""}]}}));"global"===t&&(a=a.filter((function(t,n){return e.filter(t,n)}))),n[o].children=a,i(n),k(!1)})).catch((function(e){return console.error(e)}))}))};return o.a.createElement(E,{onSubmit:function(){return e.onSubmit(h)},onCancel:e.onCancel,open:e.open,title:(S=e.scopeList[0],O=["a","e","i","o","u"].includes(S[0].toLowerCase())?"an":"a","Select ".concat(O," ").concat(S)),width:"50%"},o.a.createElement(v.Grid,{container:!0},o.a.createElement(v.Grid,{item:!0,xs:12,style:{textAlign:"center",paddingBottom:"6px",paddingTop:"10px"}},o.a.createElement(v.FormControl,{style:{width:"50%"}},o.a.createElement(v.InputLabel,null,"Workspace"),o.a.createElement(v.Select,{value:s,onChange:function(e){l(e.target.value),N(e.target.value),k(!0)}},Object.keys(y).map((function(e,t){return o.a.createElement(v.MenuItem,{key:t,value:e},y[e].label)}))))),o.a.createElement(v.Typography,{component:"div",style:{overflowY:"auto",overflowX:"hidden",justifyContent:"center",width:"100%"}},M?o.a.createElement(Yu.a,{style:{position:"relative",height:"50vh",width:"inherit",color:"#fff",zIndex:99999},open:M},o.a.createElement(Qu.a,{color:"inherit"})):o.a.createElement(Wu,{onClickNode:function(e){return function(e){var t=Nu()(a),n={0:function(){var n=t.findIndex((function(t){return t.id===e.id})),r=Fr()(t,[n,"state","expanded"],!1);Su()(t,[n,"state"],{expanded:!r}),i(t)},1:function(){var n=t.findIndex((function(t){return t.id===e.parents[0]}));J.Workspace.getDocs({workspace:s,scope:t[n].scope,id:e.name}).then((function(r){var o=r.versions.map((function(e,t){return{url:e.url,name:e.tag,id:t}})),a=t[n].children.findIndex((function(t){return t.id===e.id})),c=Fr()(t,[n,"children",a,"state","expanded"],!1);Su()(t,[n,"children",a,"state"],{expanded:!c}),Su()(t,[n,"children",a,"children"],o),i(t)})).catch((function(e){return console.error(e)}))},2:function(){m("".concat(e.url))}};Fr()(n,e.deepness,(function(){}))()}(e)},onDoubleClickNode:function(t){return n=t,void("global"!==s&&n.deepness<=1||(m(n.url),e.onSubmit(n.url)));var n},data:a,handleChange:function(e){return i(e)},showIcons:!1,height:"400px"})),o.a.createElement(v.Grid,{item:!0,xs:12,style:{textAlign:"center"}},o.a.createElement(v.Typography,{label:"Message",value:"selected",margin:"normal"},""===h?"Nothing selected":h))))};Xu.propTypes={onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,scopeList:u.a.array,message:u.a.string,selected:u.a.string,filter:u.a.func},Xu.defaultProps={title:"Insert Text here",message:"Are you sure?",onSubmit:function(){},onCancel:function(){},open:!1,scopeList:["Callback"],selected:"",filter:function(){return!0}};var Ju=Xu,$u=n(59),es=n.n($u),ts=n(109),ns=Object(ts.makeStyles)((function(e){return{alert:{position:"absolute",bottom:0,width:"100%"}}}));function rs(e){return function(t){var n=o.a.useState(!0),a=ce()(n,2),i=a[0],c=a[1],u=o.a.useState(!1),s=ce()(u,2),l=s[0],f=s[1],d=o.a.useState(null),h=ce()(d,2),m=h[0],p=h[1],g=o.a.useState(!1),y=ce()(g,2),b=y[0],w=y[1],E=ns();Object(r.useEffect)((function(){var e=J.MasterDB.offlineValidation({onOnline:x,onOffline:M});p(e)}),[]);var x=function(){c(!0),f(!0),setTimeout((function(){return f(!1)}),2e3)},M=function(){c(!1)};return o.a.createElement(o.a.Fragment,null,o.a.createElement(o.a.Fragment,null,o.a.createElement(e,t),!i&&o.a.createElement(es.a,{className:E.alert,variant:"filled",severity:"error",action:o.a.createElement(v.Button,{color:"inherit",size:"small",onClick:function(){w(!0),m.retryConnection().then((function(){return w(!1)}))}},b?o.a.createElement(Qu.a,{size:20,color:"inherit"}):"RETRY")},"Connection failed... You're now in offline mode, please wait to reconnect."),i&&l&&o.a.createElement(es.a,{className:E.alert,variant:"filled",severity:"success"},"You're now online!")))}}var os=n(110),as=n.n(os);function is(e){return function(t){var n=Object(r.useRef)(!0),a=Object(r.useState)(!1),i=ce()(a,2),c=i[0],u=i[1],s=Object(r.useState)(0),l=ce()(s,2),f=l[0],d=l[1];Object(r.useEffect)((function(){function e(){return(e=Gt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J.Authentication.checkLogin();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u(function(){return e.apply(this,arguments)}())}),[]),Object(r.useEffect)((function(){var e=Math.floor(.001*Date.now()),t=window.localStorage.getItem("movai.refreshToken");try{var n=(as()(t).exp||e)-e;if(n<=0)throw new Error("Token expired");setTimeout((function(){return d(e)}),1e3*n+2e3),u(!0)}catch(e){u(!1)}}),[f,c]);return o.a.createElement(o.a.Fragment,null,!c&&n.current?(n.current=!1,o.a.createElement(wu,{setLoggedIn:function(e){return u(e)}})):o.a.createElement(o.a.Fragment,null,o.a.createElement(e,Oe()({handleLogOut:function(){J.Authentication.logout()},loggedIn:c},t)),o.a.createElement(v.Modal,{open:!c},o.a.createElement(wu,{setLoggedIn:function(e){return u(e)}}))))}}}])}));
//# sourceMappingURL=index.js.map