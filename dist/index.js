!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MovaiReact=t():e.MovaiReact=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=151)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/defineProperty")},function(e,t){e.exports=require("@babylonjs/core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/assertThisInitialized")},function(e,t){e.exports=require("prop-types")},function(e,t,n){"use strict";var o=n(16),r=n.n(o),a=n(7),i=n.n(a),c=n(9),s=n.n(c),u=n(1),l=n.n(u),f=n(2),d=n(27),h=function(){function e(t){var n=this;if(i()(this,e),l()(this,"normalize",(function(){var e=n.length();if(0===e)throw new Error("You can't normalize a zero norm vector");return n.scale(1/e)})),t.constructor!==Array||t.length<3)throw new Error("".concat(t," is not a valid 3-vector"));this.vec3=r()(t)}return s()(e,[{key:"x",get:function(){return this.vec3[0]}},{key:"y",get:function(){return this.vec3[1]}},{key:"z",get:function(){return this.vec3[2]}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"op",value:function(t,n){var o=[];return o[0]=n(this.vec3[0],t.vec3[0]),o[1]=n(this.vec3[1],t.vec3[1]),o[2]=n(this.vec3[2],t.vec3[2]),new e(o)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"dot",value:function(e){return this.vec3[0]*e.vec3[0]+this.vec3[1]*e.vec3[1]+this.vec3[2]*e.vec3[2]}},{key:"map",value:function(t){return new e(this.vec3.map(t))}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"toBabylon",value:function(){return new f.Vector3(this.vec3[0],this.vec3[1],this.vec3[2])}},{key:"toArray",value:function(){return this.vec3}},{key:"toVec2",value:function(){return new d.a(this.x,this.y)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&e.vec3.map((function(t,n){return e.vec3[n]===t})).reduce((function(e,t){return e&&t}),!0)}},{key:"reduce",value:function(e,t){return this.vec3.reduce(e,t)}},{key:"getMax",value:function(){return this.reduce((function(e,t){return Math.max(e,t)}),-Number.MAX_VALUE)}},{key:"getMin",value:function(){return this.reduce((function(e,t){return Math.min(e,t)}),Number.MAX_VALUE)}},{key:"someNaNOrInfinite",value:function(){return this.vec3.some((function(e){return isNaN(e)||!isFinite(e)}))}}],[{key:"ofBabylon",value:function(t){return new e([t.x,t.y,t.z])}},{key:"of",value:function(t){return new e(t||[0,0,0])}},{key:"fromArray",value:function(t){return e.of(t)}},{key:"random",value:function(){return new e([1,2,3].map(Math.random()))}},{key:"orthogonalBasisFromVector",value:function(t){for(var n=[e.e1,e.e2,e.e3],o=0,r=0;r<3;r++)if(0!==t.vec3[r]){o=r;break}var a=n[(o+1)%3].add(n[o].scale(-t.vec3[(o+1)%3]/t.vec3[o]));a=a.normalize();var i=n[(o+2)%3].add(n[o].scale(-t.vec3[(o+2)%3]/t.vec3[o]));return i=(i=i.normalize()).sub(a.scale(a.dot(i))),{u:t.normalize(),v:a,w:i.normalize()}}}]),e}();l()(h,"ONES",h.of([1,1,1])),l()(h,"ZERO",h.of([0,0,0])),l()(h,"e1",new h([1,0,0])),l()(h,"e2",new h([0,1,0])),l()(h,"e3",new h([0,0,1])),t.a=h},function(e,t){e.exports=require("@babel/runtime/helpers/esm/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classCallCheck")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),s=n.n(c),u=n(5),l=n(2),f=function(){function e(t,n,o){r()(this,e);for(var a=[t,n,o],i=0;i<a.length;i++)if(a[i].constructor!==Array||a[i].length<3)throw Error("One of the inputs is not a array");this.mat3=a.map((function(e){return new u.a(e)}))}return i()(e,[{key:"prodVec",value:function(e){for(var t=new u.a([0,0,0]),n=0;n<this.mat3.length;n++)t=t.add(this.mat3[n].scale(e.vec3[n]));return t}},{key:"dotVec",value:function(e){for(var t=[0,0,0],n=0;n<this.mat3.length;n++)t[n]=this.mat3[n].dot(e);return new u.a(t)}},{key:"prod",value:function(t){var n=this.prodVec(t.mat3[0]),o=this.prodVec(t.mat3[1]),r=this.prodVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"dot",value:function(t){var n=this.dotVec(t.mat3[0]),o=this.dotVec(t.mat3[1]),r=this.dotVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"map",value:function(t){var n=this.mat3[0].map(t),o=this.mat3[1].map(t),r=this.mat3[2].map(t);return new e(n.vec3,o.vec3,r.vec3)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&this.mat3.map((function(t,n){return t.equals(e.mat3[n])})).reduce((function(e,t){return e&&t}),!0)}}],[{key:"ofBabylonMatrix",value:function(t){var n=l.Matrix.GetAsMatrix3x3(t);return new e([n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]])}},{key:"of",value:function(t,n,o){return new e(t,n,o)}},{key:"eye",value:function(){return new e([1,0,0],[0,1,0],[0,0,1])}}]),e}(),d=n(10),h=function(){function e(t){r()(this,e),this._scene=t,this._isPosition=!1,this._isRotation=!1,this._isBoundingBox=!1,this._isScale=!1,this._usePointerToAttachGizmos=!1}return i()(e,[{key:"isPosition",value:function(e){return this._isPosition=e,this}},{key:"isRotation",value:function(e){return this._isRotation=e,this}},{key:"isBoundingBox",value:function(e){return this._isBoundingBox=e,this}},{key:"isScale",value:function(e){return this._isScale=e,this}},{key:"usePointerToAttachGizmos",value:function(e){return this._usePointerToAttachGizmos=e,this}},{key:"build",value:function(){var e=new l.GizmoManager(this._scene);return e.positionGizmoEnabled=this._isPosition,e.rotationGizmoEnabled=this._isRotation,e.boundingBoxGizmoEnabled=this._isBoundingBox,e.scaleGizmoEnabled=this._isScale,e.usePointerToAttachGizmos=this._usePointerToAttachGizmos,e}}]),e}(),m=function(){function e(t){r()(this,e),this._scene=t,this._sphericalCoordinates=null,this._target=null,this._name="camera".concat(Math.floor(1e3*Math.random()))}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"sphericalCoordinates",value:function(e){return this._sphericalCoordinates=e,this}},{key:"target",value:function(e){return this._target=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a camera, e.g ".concat(e))})),new l.ArcRotateCamera(this._name,this._sphericalCoordinates.x,this._sphericalCoordinates.y,this._sphericalCoordinates.z,this._target,this._scene)}}]),e}(),p=function(){function e(t){r()(this,e),this._scene=t,this._position=null,this._name="light".concat(Math.floor(1e3*Math.random())),this._intensity=1}return i()(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new l.PointLight(this._name,this._position,this._scene);return e.intensity=this._intensity,e}}]),e}(),v=function(){function e(t){r()(this,e),this._scene=t,this._name="referential".concat(Math.floor(1e3*Math.random())),this._isPickable=!0,this._boxParams={isVisible:!0,size:.25},this._size=1}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"boxParams",value:function(e){return this._boxParams=e,this}},{key:"size",value:function(e){return this._size=e,this}},{key:"build",value:function(){var e=this._size,t=l.Mesh.CreateLines("axisX".concat(this._name),[new l.Vector3.Zero,new l.Vector3(e,0,0),new l.Vector3(.95*e,.05*e,0),new l.Vector3(e,0,0),new l.Vector3(.95*e,-.05*e,0)],this._scene);t.color=new l.Color3(1,0,0),t.isPickable=!1;var n=l.Mesh.CreateLines("axisY".concat(this._name),[new l.Vector3.Zero,new l.Vector3(0,e,0),new l.Vector3(-.05*e,.95*e,0),new l.Vector3(0,e,0),new l.Vector3(.05*e,.95*e,0)],this._scene);n.color=new l.Color3(0,1,0),n.isPickable=!1;var o=l.Mesh.CreateLines("axisZ".concat(this._name),[new l.Vector3.Zero,new l.Vector3(0,0,e),new l.Vector3(0,-.05*e,.95*e),new l.Vector3(0,0,e),new l.Vector3(0,.05*e,.95*e)],this._scene);o.color=new l.Color3(0,0,1),o.isPickable=!1;var r=l.MeshBuilder.CreateBox(this._name,{size:this._boxParams.size},this._scene);return r.isVisible=this._boxParams.isVisible,r.isPickable=this._isPickable,t.parent=r,n.parent=r,o.parent=r,r}}]),e}(),g=function(){function e(t){r()(this,e),this._scene=t,this._name="camera".concat(Math.floor(1e3*Math.random())),this._width=1,this._height=1,this._textureSrc=null,this._isPickable=!1}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"textureSrc",value:function(e){return this._textureSrc=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"build",value:function(){var e=l.Mesh.CreateGround(this._name,this._width,this._height,1,this._scene);return e.translate(new l.Vector3(0,-1,0),.1,l.Space.WORLD),this._textureSrc&&(e.material=new l.StandardMaterial("Texture".concat(this._name),this._scene),e.material.ambientTexture=new l.Texture(this._textureSrc,this._scene),e.material.ambientTexture.uScale=1,e.material.ambientTexture.vScale=1),e.isPickable=this._isPickable,e}}]),e}(),y=n(49),b=function(){function e(t,n){r()(this,e),this._mesh=t,this._scene=n,this._name="tooltip".concat(Math.floor(1e3*Math.random())),this._width=null,this._height=null,this._thickness=2,this._linkOffsetX="100px",this._linkOffsetY="-50px",this._background="grey",this._alpha=.7,this._scaleX=0,this._scaleY=0,this._cornerRadius=30,this._text="",this._color="White",this._fontSize=14,this._padding="20px"}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"mesh",value:function(e){return this._mesh=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"linkOffsetX",value:function(e){return this._linkOffsetX=e,this}},{key:"linkOffsetY",value:function(e){return this._linkOffsetY=e,this}},{key:"background",value:function(e){return this._background=e,this}},{key:"alpha",value:function(e){return this._alpha=e,this}},{key:"scaleX",value:function(e){return this._scaleX=e,this}},{key:"scaleY",value:function(e){return this._scaleY=e,this}},{key:"cornerRadius",value:function(e){return this._cornerRadius=e,this}},{key:"text",value:function(e){return this._text=e,this}},{key:"color",value:function(e){return this._color=e,this}},{key:"fontSize",value:function(e){return this._fontSize=e,this}},{key:"padding",value:function(e){return this._padding=e,this}},{key:"build",value:function(){var e=this,t=y.AdvancedDynamicTexture.CreateFullscreenUI("UI");t.useInvalidateRectOptimization=!1;var n=new y.Rectangle(this._name);t.addControl(n),n.thickness=2,this._width&&(n.width=this._width),this._height&&(n.height=this._height),n.linkOffsetX=this._linkOffsetX,n.linkOffsetY=this._linkOffsetY,n.transformCenterX=0,n.transformCenterY=1,n.background=this._background,n.alpha=this._alpha,n.scaleX=this._scaleX,n.scaleY=this._scaleY,n.cornerRadius=this._cornerRadius,n.adaptWidthToChildren=!0,n.adaptHeightToChildren=!0,n.linkWithMesh(this._mesh);var o=new y.TextBlock;o.text=this._text,o.color=this._color,o.fontSize=this._fontSize,o.textVerticalAlignment=y.Control.VERTICAL_ALIGNMENT_TOP,o.textHorizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(o),o.alpha=1/o.parent.alpha,o.paddingTop=this._padding,o.paddingBottom=this._padding,o.paddingLeft=this._padding,o.paddingRight=this._padding,o.resizeToFit=!0;var r=new l.ActionManager(this._scene);this._mesh.actionManager=r;var a=new l.Animation("tooltipAnimation","scaleX",30,l.Animation.ANIMATIONTYPE_FLOAT,l.Animation.ANIMATIONLOOPMODE_CONSTANT),i=new l.Animation("tooltipAnimation","scaleY",30,l.Animation.ANIMATIONTYPE_FLOAT,l.Animation.ANIMATIONLOOPMODE_CONSTANT),c=[{frame:0,value:0},{frame:10,value:1}];return a.setKeys(c),i.setKeys(c),n.animations=[],n.animations.push(a),n.animations.push(i),r.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOverTrigger,(function(t){e._scene.beginAnimation(n,0,10,!1)}))),r.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOutTrigger,(function(t){e._scene.beginAnimation(n,10,0,!1)}))),o}}]),e}(),A=function(){function e(t){r()(this,e),this._scene=t,this._direction=null,this._name="Dlight".concat(Math.floor(1e3*Math.random())),this._intensity=1}return i()(e,[{key:"direction",value:function(e){return this._direction=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new l.DirectionalLight(this._name,this._direction.normalize(),this._scene);return e.intensity=this._intensity,e}}]),e}(),w=n(113),M=n.n(w),E=n(24),x=n(59),P=n(23),k=function(){function e(){if(r()(this,e),S)return S;S=this,this.materialCacheBySceneId={},this.count=0}return i()(e,[{key:"hasKey",value:function(e,t){var n=t._uid;return d.Maybe.fromNull(this.materialCacheBySceneId[n]).flatMap((function(t){return C(t[e])})).cata((function(){return!1}),(function(){return!0}))}},{key:"put",value:function(e,t,n){var o=t._uid;return o in this.materialCacheBySceneId||(this.materialCacheBySceneId[o]={}),this.materialCacheBySceneId[o][e]=n,this}},{key:"get",value:function(e,t){var n=this,o=t._uid;return d.Maybe.fromNull(this.materialCacheBySceneId[o]).flatMap((function(t){return C(t[e])})).map((function(e){return n.count++,e}))}},{key:"del",value:function(e){var t=e._uid;t in this.materialCacheBySceneId&&delete this.materialCacheBySceneId[t]}}],[{key:"getInstance",value:function(){return new e}}]),e}(),C=function(e){return d.Maybe.fromNull(e)},S=null,O=k,N=function(){function e(){r()(this,e)}return i()(e,null,[{key:"getGlobalCoordinates",value:function(t,n){if(t.parent&&t.parent.name===E.b.NAME||t.name===E.b.NAME)return u.a.ofBabylon(n);var o=t.parent,r=u.a.ofBabylon(o.position),a=e.getRotationMatrix(o),i=u.a.ofBabylon(o.scaling);return a.prodVec(i.mul(e.getGlobalCoordinates(t.parent,n))).add(r)}},{key:"getParentCoord",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.parent,a=o?u.a.ofBabylon(r.position):u.a.ZERO,i=e.getRotationMatrix(r),c=u.a.ofBabylon(r.scaling);return i.prodVec(c.mul(n)).add(a)}},{key:"getGlobalCoord",value:function(t,n){if(t.parent&&t.parent.name===E.b.NAME||t.name===E.b.NAME)return n;var o=t.parent,r=u.a.ofBabylon(o.position),a=e.getRotationMatrix(o),i=u.a.ofBabylon(o.scaling),c=a.prodVec(i.mul(u.a.ofBabylon(n))).add(r);return e.getGlobalCoord(o,c.toBabylon())}},{key:"getBabylonCoordinates",value:function(e){return E.b.forwardCoordinates(e)}},{key:"getLocalCoordFromGlobal",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.parent&&t.parent.name===E.b.NAME||t.name===E.b.NAME)return u.a.ofBabylon(n);var r=t.parent,a=o?u.a.ofBabylon(r.position):u.a.ZERO,i=e.getRotationMatrix(r),c=u.a.ofBabylon(r.scaling);return c.map((function(e){return 1/e})).mul(i.dotVec(e.getLocalCoordFromGlobal(r,n,o).sub(a)))}},{key:"getLocalCoordFromWorld",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t.parent)return n;var r=t.parent,a=o?u.a.ofBabylon(r.position):u.a.ZERO,i=e.getRotationMatrix(r),c=u.a.ofBabylon(r.scaling),s=c.map((function(e){return 1/e}));return s.mul(i.dotVec(e.getLocalCoordFromWorld(r,n,o).sub(a)))}},{key:"getRotationMatrix",value:function(e){var t=new l.Matrix,n=d.Maybe.fromNull(null==e?void 0:e.rotationQuaternion);return n.forEach((function(e){return e.toRotationMatrix(t)})),n.orElseRun((function(){l.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z).toRotationMatrix(t)})),f.ofBabylonMatrix(t)}},{key:"showNormals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.Color3.Red(),r=t.getVerticesData(l.VertexBuffer.NormalKind),a=t.getVerticesData(l.VertexBuffer.PositionKind),i=[],c=0;c<r.length;c+=3){var s=l.Vector3.FromArray(a,c),u=s.add(l.Vector3.FromArray(r,c).scaleInPlace(n));i.push([s.add(t.position),u.add(t.position)])}var f=l.MeshBuilder.CreateLineSystem("normalLines",{lines:i},e);return f.color=o,f.parent=t,f}},{key:"orthogonalBasisFromVector",value:function(e){for(var t=[new l.Vector3(1,0,0),new l.Vector3(0,1,0),new l.Vector3(0,0,1)],n=[e.x,e.y,e.z],o=0,r=0;r<3;r++)if(0!==n[r]){o=r;break}var a=t[(o+1)%3].add(t[o].scale(-n[(o+1)%3]/n[o]));a=a.normalize();var i=t[(o+2)%3].add(t[o].scale(-n[(o+2)%3]/n[o]));return i=(i=i.normalize()).subtract(a.scale(l.Vector3.Dot(a,i))),{u:l.Vector3.FromArray(n).normalize(),v:a,w:i.normalize()}}},{key:"cameraBuilder",value:function(e){return new m(e)}},{key:"gizmoManagerBuilder",value:function(e){return new h(e)}},{key:"meshFromPositionAndFaces",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=new l.VertexData;a.positions=n.flatMap((function(e){return[e.x,e.y,e.z]})),a.indices=o.flatMap((function(e){return e}));var i=new l.Mesh(e,t);return a.applyToMesh(i,r),i}},{key:"triangulatePolygon",value:function(e){for(var t=M()(e.map((function(e){return[e.x,e.y,e.z]})).flatMap((function(e){return e})),null,3),n=t.length/3,o=[],r=0;r<n;r++){var a=3*r;o.push([t[a],t[a+1],t[a+2]])}return o}},{key:"computeOrientation",value:function(e){var t=e.length,n=e.map((function(e){return u.a.ofBabylon(e)})),o=0;return n.forEach((function(e,r){var a=n[(r+1)%t].sub(n[r]);o+=u.a.of([-e.y,e.x,e.z]).dot(a)})),o/2}},{key:"pointAverage",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),l.Vector3.Zero()).scale(1/e.length):l.Vector3.Zero()}},{key:"pointAverageVec3",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),u.a.ZERO).scale(1/e.length):u.a.ZERO}},{key:"randomVector3",value:function(e,t){return new l.Vector3.FromArray([0,0,0].map((function(n){return e+(t-e)*Math.random()})))}},{key:"getMaterialFromColor",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MaterialFromColor".concat(R()),o=new l.StandardMaterial(n,t);return o.diffuseColor=e,o.emissiveColor=e,o}},{key:"setOrthoView",value:function(e,t){e.mode=l.Camera.ORTHOGRAPHIC_CAMERA;var n=t.getEngine().getAspectRatio(e),o=e.position.length();e.orthoLeft=-o/2,e.orthoRight=o/2,e.orthoBottom=e.orthoLeft*n,e.orthoTop=e.orthoRight*n}},{key:"setPerspectiveView",value:function(e,t){e.mode=l.Camera.PERSPECTIVE_CAMERA}},{key:"getArrow",value:function(t,n,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=e.createTubeFromPoints(t,[o,r],l.Color3.Gray(),a,n+"tube"),c=e.createOrientedCone(t,r.subtract(o).normalize().scale(7*a),l.Color3.Gray(),n+"cone");c.position=r;var s=new l.Mesh(n,t);return i.parent=s,c.parent=s,s}},{key:"addTooltipToMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new b(e,t).text(n).build()}},{key:"addClickActionToMesh",value:function(e,t,n){var o=new l.ActionManager(t);e.actionManager=o,o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPickDownTrigger,(function(e){n()}))),o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOverTrigger,(function(t){e.material.unfreeze(),e.material.emissiveColor=l.Color3.Gray()}))),o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOutTrigger,(function(t){e.material.emissiveColor=l.Color3.White(),setTimeout((function(){return e.material.freeze()}),10)})))}}]),e}();s()(N,"toGlobalCoord",(function(e){var t=e.getRootNode().item.mesh;return function(e){var n=function(e){return N.getLocalCoordFromWorld({parent:t},u.a.ofBabylon(e)).toBabylon()};return Array.isArray(e)?e.map(n):n(e)}})),s()(N,"createOrientedCone",(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Vector3(1,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OrientedCone".concat(R()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,i={positions:[],faces:[]},c=t.length()/3,s=N.orthogonalBasisFromVector(t),u=s.v,f=s.w,d=Math.sign(l.Vector3.Dot(l.Vector3.Cross(u,f),t)),h=0;h<a;h++){var m=d*(2*Math.PI/a)*h;i.positions.push(u.scale(c*Math.cos(m)).add(f.scale(c*Math.sin(m))))}i.positions.push(l.Vector3.Zero()),i.positions.push(t);for(var p=i.positions.length-1,v=i.positions.length-2,g=0;g<a;g++)i.faces.push([p,(g+1)%a,g]),i.faces.push([v,g,(g+1)%a]);var y=N.meshFromPositionAndFaces(o,e,i.positions,i.faces);y.convertToFlatShadedMesh();var b="OrientedConeMaterial".concat(o);return y.material=j.get(b,e).orLazy((function(){var t=N.getMaterialFromColor(n,e,b);return j.put(b,e,t),t})),y.isPickable=r,y})),s()(N,"createSphere",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sphere".concat(R()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=l.Mesh.CreateSphere(o,16,n,e),i=N.getMaterialFromColor(t,e,"SphereMaterial".concat(o));return a.material=i,a.isPickable=r,a})),s()(N,"createBox",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:x.a.DEFAULT_SIZE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Box".concat(R()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=l.Mesh.CreateBox(o,n,e),i=new l.StandardMaterial("BoxMaterial".concat(o),e);return i.diffuseColor=t,i.emissiveColor=t,a.material=i,a.isPickable=r,a})),s()(N,"createTubeFromPoints",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Tube".concat(R()),a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=l.MeshBuilder.CreateTube(r,{path:t,radius:o,sideOrientation:l.Mesh.DOUBLESIDE,updatable:!0,cap:l.Mesh.CAP_ALL},e),c="Material".concat(r);return i.material=j.get(c,e).orLazy((function(){var t=N.getMaterialFromColor(n,e,c);return j.put(c,e,t),t})),i.isPickable=a,i})),s()(N,"positionalLightBuilder",(function(e){return new p(e)})),s()(N,"directionalLightBuilder",(function(e){return new A(e)})),s()(N,"referentialBuilder",(function(e){return new v(e)})),s()(N,"getGroundPosition",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e===t}));return n.hit?d.Maybe.some(n.pickedPoint):d.Maybe.none()})),s()(N,"pickMesh",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e!==t&&e.isEnabled()}));return n.hit&&n.pickedMesh.isPickable?d.Maybe.some(n.pickedMesh):d.Maybe.none()})),s()(N,"groundBuilder",(function(e){return new g(e)})),s()(N,"piecewiseCurveDistance",(function(e){for(var t=0,n=0;n<e.length-1;n++){t+=e[n+1].subtract(e[n]).length()}return t})),s()(N,"getCurveOrientations",(function(e){for(var t=[],n=0;n<e.length-1;n++){var o=e[n+1].subtract(e[n]);t.push(Math.atan2(o.y,o.x))}return t.push(t[t.length-1]),t})),s()(N,"getSplineFromCurve",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=!1;return{points:l.Curve3.CreateCatmullRomSpline(e,t,n).getPoints()}})),s()(N,"splineObj2redis",(function(e){var t=N.getCurveOrientations(e.points);return e.points.map((function(e,n){return[e.x,e.y,t[n]]}))})),s()(N,"getShaderMaterial",(function(e){var t=e.name,n=void 0===t?"CustomShader".concat(R()):t,o=e.vertex,r=void 0===o?B:o,a=e.frag,i=void 0===a?D:a,c=e.onBindObservable,s=void 0===c?F:c,u=e.preProcessShader,f=void 0===u?L:u;return function(e){var t=new l.ShaderMaterial(n,e,{vertexSource:r,fragmentSource:i},{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection"]});return f(e,t),t.onBindObservable.add((function(){s(e,t)})),t}})),s()(N,"getNodeItemTypeFromMesh",(function(e){var t,n;return(null===(t=e.parent)||void 0===t?void 0:t.nodeItem.getType())===P.a.TYPE?null===(n=e.parent)||void 0===n?void 0:n.nodeItem.getType():e.nodeItem.getType()}));var T,I,R=function(){return Math.floor(1e3*Math.random())},B="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n\n    vUV = uv;\n    vPosition = position;\n    vNormal = normal;\n}",D="\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n// Uniforms\nuniform mat4 world;\n\n// Refs\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nuniform float time;\n\nvoid main(void) {\n    vec3 vLightPosition = lightPosition;\n\n    // World values\n    vec3 vPositionW = vec3(world * vec4(vPosition, 1.0));\n    vec3 vNormalW = normalize(vec3(world * vec4(vNormal, 0.0)));\n    vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n    // Light\n    vec3 lightVectorW = normalize(vLightPosition - vPositionW);\n    vec3 color = vec3(0.5,0.,1.);\n\n    // diffuse\n    float ndl = max(0., dot(vNormalW, lightVectorW));\n\n    // Specular\n    vec3 angleW = normalize(viewDirectionW + lightVectorW);\n    float specComp = max(0., dot(vNormalW, angleW));\n    specComp = pow(specComp, max(1., 64.)) * 2.;\n\n    gl_FragColor = vec4(color * ndl + vec3(specComp), 1.);\n}\n",F=(T=0,I=(new Date).getTime(),function(e,t){var n=((new Date).getTime()-I)/1e3;t.setFloat("time",T),t.setVector3("cameraPosition",e.activeCamera.position),e.lights.length>0&&t.setVector3("lightPosition",e.lights[0].position),T+=n,I=(new Date).getTime()}),L=function(e,t){t.backFaceCulling=!1,t.setFloat("time",0),t.setVector3("cameraPosition",e.activeCamera.position),t.setVector3("lightPosition",new l.Vector3(0,20,10))},j=O.getInstance();t.a=N},function(e,t){e.exports=require("@babel/runtime/helpers/esm/createClass")},function(e,t){e.exports=require("monet")},function(e,t){e.exports=require("@mov-ai/mov-fe-lib-core")},function(e,t){e.exports=require("@material-ui/core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/extends")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/get")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/slicedToArray")},function(e,t){e.exports=require("@material-ui/core/styles")},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(2),r={RADIUS:.25,POINTS_DENSITY:2,CLOUD_FUNCTION_NAME:"backend.viewer",NAV_CLOUD_NAME:"backend.generate_path",RAD2DEG:180/Math.PI,DEG2RAD:Math.PI/180,DEBUG:!1},a={dark:o.Color3.Black(),light:o.Color3.Gray(),default:o.Color3.Black()};t.b=r},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classPrivateFieldGet")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t,n){"use strict";var o=n(14),r=n.n(o),a=n(16),i=n.n(a),c=n(7),s=n.n(c),u=n(9),l=n.n(u),f=n(3),d=n.n(f),h=n(17),m=n.n(h),p=n(15),v=n.n(p),g=n(13),y=n.n(g),b=n(6),A=n.n(b),w=n(1),M=n.n(w),E=n(25),x=n(5),P=n(8),k=n(0),C=n.n(k),S=n(10),O=n(20),N=n(2),T=n(11),I=n(29);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){M()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=A()(e);if(t){var r=A()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y()(this,n)}}var F=O.b.RADIUS,L=function(e){v()(n,e);var t=D(n);function n(e,o,r,a,i){var c,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};return s()(this,n),c=t.call(this,e,l),M()(d()(c),"getType",(function(){return n.TYPE})),c.localPath=o,c.keyPoints=r,c.splinePath=a,c.selectedKeyPointIndex=-1,c.mainView=i,c.weight=u,c}return l()(n,[{key:"toDict",value:function(){var e=m()(A()(n.prototype),"toDict",this).call(this);return e.localPath=this.localPath,e.splinePath=this.splinePath,e.weight=this.weight,e}},{key:"toForm",value:function(){var e=m()(A()(n.prototype),"toForm",this).call(this);if(this.selectedKeyPointIndex>=0){e.jsonSchema.properties.selectedKeyPoint={type:"object",title:"KeyPoint ".concat(this.selectedKeyPointIndex),properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},e.uiSchema.selectedKeyPoint={"ui:widget":"collapse"},e.uiSchema.position={"ui:widget":"hidden"},e.uiSchema.rotation={"ui:widget":"hidden"},e.uiSchema.color={"ui:widget":"hidden"},e.uiSchema.annotations={"ui:widget":"hidden"};var t=this.keyPoints[this.selectedKeyPointIndex],o=P.a.getGlobalCoordinates(t,t.position).toArray();return e.data.selectedKeyPoint={x:o[0],y:o[1],z:o[2]},e}var r=B({},e.jsonSchema.properties),a={type:"object",properties:{oldName:r.oldName,name:r.name,type:r.type,weight:{type:"number",title:"Weight"},position:r.position,rotation:r.rotation,color:r.color,annotations:r.annotations}};return e.jsonSchema=a,e.data.weight=this.weight,e}},{key:"ofForm",value:function(e){if(m()(A()(n.prototype),"ofForm",this).call(this,e),this.selectedKeyPointIndex>=0){var t=this.keyPoints[this.selectedKeyPointIndex],o=e.selectedKeyPoint,r=N.Vector3.FromArray([o.x,o.y,o.z].map(Number.parseFloat)),a=P.a.getLocalCoordFromGlobal(t,r).toArray();return t.position=new N.Vector3(a[0],a[1],a[2]),void t.observers.notifyObservers({updatedPointMesh:t,is2updateServer:!1})}this.weight=Number(e.weight),this.updatePathEdgeWithForm(this.weight,this.keyValueMap)}},{key:"updatePathEdgeWithForm",value:function(e,t){var n=this;this.mainView.getGraph().forEach((function(o){var r=o.item,a=r.graph,c=[n.keyPoints[0],n.keyPoints[n.keyPoints.length-1]].filter((function(e){var t;return!(null==e||null===(t=e.graphVertex)||void 0===t||!t.vertex)})).map((function(e){return e.graphVertex.vertex}));if(!(c.length<2)){var s=c.map((function(e){return e.id}));a.getEdge.apply(a,i()(s)).forEach((function(n){var o=n.data;o.weight=e,o.keyValueMap=t})),n.mainView.updateNodeInServer(r.name)}}))}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"getCopyFunction",value:function(e,t){var o=this;return function(r,a){return m()(A()(n.prototype),"getCopyFunction",o).call(o,e,t)(r,a).map((function(e){var t,r,i,c=null==e?void 0:e.keyPoints;return void 0!==c&&[null===(r=(t=o).keyPoints[0])||void 0===r?void 0:r.graphVertex,null===(i=t.keyPoints[t.keyPoints.length-1])||void 0===i?void 0:i.graphVertex].every((function(e){return!!e}))&&n.updateGraph(a,c,e,!0),e}))}}},{key:"importFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n({},{},{},{},{});this.keyValueMap=e.keyValueMap,this.weight=e.weight}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing path or null mainView");var r=t.name,a=t.localPath.map((function(e){return x.a.of(e).toBabylon()})),i=P.a.getSplineFromCurve(a),c=i.points,s=null;(s=1===c.length?N.MeshBuilder.CreateLines(r,{points:c,updatable:!0},e):P.a.createTubeFromPoints(e,c,N.Color3.Gray(),F/8,r)).position=x.a.of(t.position).toBabylon(),s.material=P.a.getMaterialFromColor(N.Color3.FromArray(t.color),e,"PathMaterial".concat(r)),s.rotationQuaternion=S.Maybe.fromNull(t.quaternion).map((function(e){return new N.Quaternion(e[1],e[2],e[3],e[0]).normalize()})).orSome(N.Quaternion.Identity());var u=P.a.splineObj2redis(i),l=z(e,B(B({},t),{},{mesh:s,splinePath:u}),o),f=new n(s,a.map((function(e){return[e.x,e.y,e.z]})),l,u,o,t.weight,t.keyValueMap);return s.onClick=j(o,f),s.observers=new N.Observable,s.observers.add(V(l)),f}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:U,c=o.mesh,s=P.a.pointAverage(e);e=e.map((function(e){return e.subtract(s)}));var u=P.a.getSplineFromCurve(e),l=P.a.createTubeFromPoints(t,u.points,N.Color3.Gray(),F/8,c.name),f=P.a.getRotationMatrix(c),d=x.a.ofBabylon(c.scaling),h=f.prodVec(x.a.ofBabylon(s).mul(d)).toBabylon();l.parent=c.parent,l.rotationQuaternion=c.rotationQuaternion,l.position=h.add(c.position),l.material=c.material,l.visibility=c.visibility,l.onClick=c.onClick,l.getMouseContextActions=c.getMouseContextActions,l.nodeItem=c.nodeItem,l.observers=c.observers,o.localPath=e.map((function(e){return x.a.ofBabylon(e).toArray()})),o.splinePath=P.a.splineObj2redis(u),o.mesh=l;var m=i()(o.keyPoints);o.keyPoints=a(t,r,c,o);var p=i()(c._children);return p.filter((function(e){return r.getNodeFromTree(e.name).isJust()})).forEach((function(e){e.parent=o.mesh})),o.mesh.observers.clear(),o.mesh.observers.add(V(o.keyPoints)),n.updateGraph(r,m,o,m.length!==o.keyPoints.length),c.dispose(),o}},{key:"deleteKeyPointWithUndo",value:function(e,t,o){var r=t.index,a=t.parent.name;o.getNodeFromTree(a).forEach((function(t){var i=t.item,c=B({},i.mesh.position),s=i.localPath.map((function(e){return x.a.of(e).toBabylon()}));2!==s.length&&o.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,r,c,s,e,i,o))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,o,r,a,c,s){return T.UndoManager.actionBuilder().doAction((function(){var o=i()(r);o.splice(t,1),n.createNewMeshFromOldUsingNewPoints(o,a,c,s,n.onAddNewPointKeyPointUpdate),s.updateNodeInServer(e)})).undoAction((function(t){var u=t.is2UpdateInServer,l=void 0===u||u,f=i()(r);c.mesh.position=o,n.createNewMeshFromOldUsingNewPoints(f,a,c,s,n.onAddNewPointKeyPointUpdate),l&&s.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,o){return z(e,o,t)}},{key:"addKeyPointInBetween",value:function(e,t,o,r){var a=t.index,i=t.parent.name;o.getNodeFromTree(i).forEach((function(t){var c=t.item,s=c.localPath.map((function(e){return x.a.of(e).toBabylon()})),u=B({},c.mesh.position);o.getUndoManager().doIt(n.getUndoAddKeyPointInBetween(i,a,r,c,s,u,e,o))}))}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,o,r,a,c,s,u){return T.UndoManager.actionBuilder().doAction((function(){var c=t+o,l=r.localPath.length,f=[],d=i()(a);if(c<0)f=[d[0].scale(3).subtract(d[1]).scale(.5)].concat(d);else if(c>l-1)f=d.concat([d[l-1].scale(3).subtract(d[l-2]).scale(.5)]);else{for(var h=t+Math.max(0,o),m=0;m<h;m++)f.push(d[m]);f.push(d[c].add(d[t]).scale(.5));for(var p=h;p<l;p++)f.push(d[p])}n.createNewMeshFromOldUsingNewPoints(f,s,r,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).undoAction((function(t){var o=t.is2UpdateInServer,l=void 0===o||o,f=i()(a);r.mesh.position=c,n.createNewMeshFromOldUsingNewPoints(f,s,r,u,n.onAddNewPointKeyPointUpdate),l&&u.updateNodeInServer(e)})).build()}},{key:"updateGraph",value:function(e,t,n,o){o&&e.getGraph().forEach((function(o){var r=o.item,a=n.keyPoints,i=[a[0],a[a.length-1]],c=[],s=[t[0],t[t.length-1]];r.getEdge.apply(r,s).forEach((function(t){s.forEach((function(e){var t=[];r.getNeighbors(e).filter((function(t){return!r.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){t.push({edge:r.getEdge(e,n.mesh),vertex:n})})),c.push(t)})),s.forEach((function(e){return r.delVertexFromMesh(e)})),r.addEdge.apply(r,i),r.getEdge.apply(r,i).forEach((function(e){e.importFeatures(t)})),c.forEach((function(e,t){e.forEach((function(e){r.addEdge(i[t],e.vertex.mesh),r.getEdge(i[t],e.vertex.mesh).forEach((function(t){return e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),e.updateNodeInServer(r.name)}))}))}},{key:"isKeyPointMesh",value:function(e,t){return Number.isInteger(e.index)&&t.getNodeFromTree(e.parent.name).filter((function(e){return e.item.getType()===n.TYPE})).orSome(!1)}},{key:"areKeyPointsCompatible",value:function(e,t,n){return n.getNodeFromTree(e.parent.name).flatMap((function(o){var r=o.item;return n.getNodeFromTree(t.parent.name).map((function(n){var o=n.item,a=e.index,i=t.index,c=r.localPath.length,s=o.localPath.length;return!(0!==a&&a!==c-1||0!==i&&i!==s-1)&&!((a=0===a?1:-1)*(i=0===i?1:-1)>0)}))})).orSome(!1)}},{key:"mergePaths",value:function(e,t,o,r){r.getNodeFromTree(e).forEach((function(e){var a=e.item;r.getNodeFromTree(t).forEach((function(e){var t=e.item,i=a.mesh.parent,c=a.mesh._children.filter((function(e){return void 0===e.index})),s=t.mesh._children.filter((function(e){return void 0===e.index})),u=a.toDict(),l=t.keyPoints.splice(1).map((function(e){return P.a.getLocalCoordFromWorld({parent:a.mesh},x.a.ofBabylon(e.absolutePosition))}));u.name=o,u.localPath=u.localPath.concat(l.map((function(e){return e.toArray()})));var f=P.a.pointAverageVec3(u.localPath.map((function(e){return x.a.of(e)})));u.localPath=u.localPath.map((function(e){return x.a.of(e).sub(f).toArray()})),r.getSceneMemory().forEach((function(e){var o=e.scene,l=n.ofDict(o,u,r);l.mesh.parent=i,l.mesh.translate(f.toBabylon(),1,N.Space.LOCAL),l.importFeatures(),r.addNodeItem2Tree(l,i.name),n.addEdgesInKeyPoints(l.keyPoints,o,r),c.forEach((function(e){r.getNodeFromTree(e.name).forEach((function(t){var n=t.item;r.updateNodeItemInTree(n,l.name);var o=P.a.getLocalCoordFromWorld({parent:l.mesh},x.a.ofBabylon(e.absolutePosition));e.position=o.toBabylon(),e.parent=l.mesh}))})),s.forEach((function(e){r.getNodeFromTree(e.name).forEach((function(t){var n=t.item;r.updateNodeItemInTree(n,l.name);var o=P.a.getLocalCoordFromWorld({parent:l.mesh},x.a.ofBabylon(e.absolutePosition));e.position=o.toBabylon(),e.parent=l.mesh}))})),r.deleteNodeFromTreeUsingName(a.name),r.deleteNodeFromTreeUsingName(t.name)}))}))}))}},{key:"unMergePaths",value:function(e,t,o){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.forEach((function(e){o.getSceneMemory().forEach((function(t){var a=t.scene,i=n.ofDict(a,e.dict,o);i.mesh.parent=e.parent,o.addNodeItem2Tree(i,e.parent.name,r),n.addEdgesInKeyPoints(i.keyPoints,a,o,r),e.children.forEach((function(e){o.getNodeFromTree(e.name).forEach((function(t){var n=t.item;o.updateNodeItemInTree(n,i.name,r);var a=P.a.getLocalCoordFromWorld({parent:i.mesh},x.a.ofBabylon(e.absolutePosition));e.position=a.toBabylon(),e.parent=i.mesh}))}))}))})),o.deleteNodeFromTreeUsingName(t,r)}},{key:"addEdgesInKeyPoints",value:function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];I.a.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var r=t.item,a=[e[0],e[e.length-1]];r.addEdge.apply(r,a),o&&n.updateNodeInServer(r.name)}))}}]),n}(E.a);M()(L,"TYPE","Path"),t.a=L;var j=function(e,t){return function(){e.closeContextDial(),e.getNodeFromTree(t.name).forEach((function(e){return e.item.selectedKeyPointIndex=-1}))}},V=function(e){return function(t){t.updatedPointMesh;var n=t.is2updateServer,o=t.displacement;e.forEach((function(e){e.graphVertex&&e.graphVertex.vertexObs({updatedPointMesh:e,is2updateServer:n,displacement:o})}))}};function U(e,t,n,o){var r=i()(n._children),a=o.splinePath.map((function(e){return new N.Vector3(e[0],e[1],0)}));return r.forEach((function(e){e.parent=o.mesh})),o.keyPoints.map((function(t,r){(t.index=r,t.name="".concat(n.name,"keyPointSpline").concat(r),t.position=x.a.of(o.localPath[r]).toBabylon(),t.rotationQuaternion=N.Quaternion.Identity(),n.graphVertex&&(t.graphVertex=n.graphVertex),r>0&&r<o.keyPoints.length-1)&&(t._children.forEach((function(e){return e.dispose()})),G(e,t.material.diffuseColor,o.mesh,r,a,t.position)().parent=t);return t}))}var z=function(e,t,n){var o=new N.Color3(.25,.25,.25),a=[],i=t.localPath.map((function(e){return x.a.of(e).toBabylon()})),c=t.splinePath.map((function(e){return new N.Vector3(e[0],e[1],0)})),s=t.mesh;return i.forEach((function(t,r){var u,l,f=K(e,o,s,r),d=0===r||r===i.length-1?f():(u=G(e,o,s,r,c,t)(),(l=K(e,o,s,r)()).visibility=.1,u.parent=l,l);d.parent=s,d.position=t,d.index=r,d.observers=new N.Observable,a.push(d),d.observers.add(function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;n.displacement;o.parent&&t.getNodeFromTree(o.parent.name).forEach((function(n){var a=n.item,i=o.index,c=a.mesh,s=a.localPath.map((function(e){return x.a.of(e).toBabylon()}));s[i]=o.position,L.createNewMeshFromOldUsingNewPoints(s,e,a,t),i>0&&i<s.length-1&&t.highlightMeshesInScene([a.keyPoints[i]._children[0]]),r&&(t.updateNodeInServer(c.name),t.setProperties(a.toForm()))}))}}(e,n))})),a.forEach((function(o){o.onClick=function(){n.setContextActions(function(e,t,n){var o=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){2!==n.item.localPath.length&&o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-trash"},e))},action:function(n){L.deleteKeyPointWithUndo(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-less-than"},e))},action:function(n){L.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-greater-than"},e))},action:function(n){L.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),o}(e,o,n)),n.getNodeFromTree(o.parent.name).forEach((function(e){e.item.selectedKeyPointIndex=o.index,n.setProperties(e.item.toForm())}))},o.getMouseContextActions=function(e,t,n){return function(o){var r=[];return o.getNodeFromTree(n).forEach((function(n){var a=n.item,i=a.localPath.length;i<=2||t.index>0&&t.index<i-1&&r.push({title:"Split curve",onClick:function(){o.getUndoManager().doIt(T.UndoManager.actionBuilder().doAction((function(){!function(e,t,n,o){e.getGraph().forEach((function(r){var a=r.item;e.getNodeFromTree(o).forEach((function(r){var i=r.item,c=[[],[]],s=i.localPath,u=x.a.ofBabylon(i.mesh.position),l=null==i?void 0:i.mesh.parent,f=n.index,d=[[],[]];s.forEach((function(e,t){t<=f?d[0].push(e):(t===f+1&&d[1].push(s[f]),d[1].push(e))}));var h=i.keyPoints,m=[h[0],h[h.length-1]];m.forEach((function(e,t){a.getNeighbors(e).filter((function(t){return!a.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){c[t].push({edge:a.getEdge(e,n.mesh),vertex:n})}))})),m.forEach((function(e){a.delVertexFromMesh(e)})),e.deleteNodeFromTreeUsingName(o),d.forEach((function(n,r){var s=P.a.pointAverage(n.map((function(e){return x.a.of(e).toBabylon()}))),f=n.map((function(e){return x.a.of(e).sub(x.a.ofBabylon(s)).toBabylon()})),d=[];i.mesh.material.diffuseColor.toArray(d);var h=i.mesh.rotationQuaternion.clone()||N.Quaternion.Identity(),m=[h.w,h.x,h.y,h.z],p=L.ofDict(t,{name:0===r?o:"".concat(o,"_split").concat(W++),position:u.toArray(),quaternion:m,color:d,localPath:f.map((function(e){return x.a.ofBabylon(e).toArray()}))},e);p.mesh.translate(s,1,N.Space.LOCAL),p.mesh.parent=l,p.importFeatures(i),e.addNodeItem2Tree(p,l.name);var v=p.keyPoints,g=[v[0],v[v.length-1]];a.addEdge.apply(a,g),a.getEdge.apply(a,g).forEach((function(e){e.importFeatures(p)})),c[r].forEach((function(e){a.addEdge(g[r],e.vertex.mesh),a.getEdge(g[r],e.vertex.mesh).forEach((function(t){e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),e.updateNodeInServer(a.name)}))}))}(o,e,t,a.name)})).undoAction((function(t){var n=t.is2UpdateInServer;!function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.getGraph().forEach((function(r){var a=r.item,i=n.name,c="".concat(i,"_split").concat(--W);e.getNodeFromTree(i).forEach((function(r){var s=r.item;e.getNodeFromTree(c).forEach((function(r){var u=r.item,l=s.mesh.parent,f=[[],[]],d=[s.keyPoints[0],u.keyPoints[u.keyPoints.length-1]];d.forEach((function(e,t){a.getNeighbors(e).filter((function(t){return!a.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){f[t].push({edge:a.getEdge(e,n.mesh),vertex:n})}))})),d.forEach((function(e){a.delVertexFromMesh(e)})),e.deleteNodeFromTreeUsingName(i,o),e.deleteNodeFromTreeUsingName(c,o);var h=[];n.mesh.material.diffuseColor.toArray(h);var m=L.ofDict(t,{name:i,position:x.a.ofBabylon(n.mesh.position).toArray(),color:h,localPath:n.localPath},e);m.mesh.parent=l,m.importFeatures(n),e.addNodeItem2Tree(m,l.name,o);var p=m.keyPoints,v=[p[0],p[p.length-1]];a.addEdge.apply(a,v),a.getEdge.apply(a,v).forEach((function(e){e.importFeatures(m)})),f.forEach((function(e,t){e.forEach((function(e){a.addEdge(v[t],e.vertex.mesh),a.getEdge(v[t],e.vertex.mesh).forEach((function(t){e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),o&&e.updateNodeInServer(a.name)}))}))}))}(o,e,a,void 0===n||n)})).build())}})})),r.push({title:"Delete point",onClick:function(){L.deleteKeyPointWithUndo(e,t,o)}}),r}}(e,o,t.name),o.onDel=function(){return L.deleteKeyPointWithUndo(e,o,n)}})),a};function G(e,t,n,o,r,a){return function(){var i=r.map((function(e){return a.subtract(e).length()})).reduce((function(e,t,n){return e.value<t?e:{value:t,index:n}}),{value:Number.MAX_VALUE,index:-1}).index,c=r[i+1]?r[i+1]:r[i],s=r[i],u=c.subtract(s).normalize().scale(F);return P.a.createOrientedCone(e,u,t,"".concat(n.name,"keyPointCone").concat(o),!1)}}function K(e,t,n,o){return function(){return P.a.createSphere(e,t,F,"".concat(n.name,"keyPointSpline").concat(o),!0)}}var W=0},function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(3),s=n.n(c),u=n(17),l=n.n(u),f=n(15),d=n.n(f),h=n(13),m=n.n(h),p=n(6),v=n.n(p),g=n(1),y=n.n(g),b=n(25),A=n(5),w=n(8),M=n(10),E=n(2);function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m()(this,n)}}var P=-Math.PI/2,k={position:[0,0,0],scaling:[1,-1,1],quaternion:[Math.cos(P/2),Math.sin(P/2),0,0]},C=function(e){d()(n,e);var t=x(n);function n(e){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r()(this,n),o=t.call(this,e,a),y()(s()(o),"getType",(function(){return n.TYPE})),o}return i()(n,[{key:"toForm",value:function(){var e=l()(v()(n.prototype),"toForm",this).call(this);return e.uiSchema.name={"ui:disabled":!0},e}},{key:"getMouseContextActions",value:function(){return[]}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=n.getRosOrigin(e),r=w.a.referentialBuilder(e).name(n.NAME).isPickable(!0).boxParams({isVisible:!0,size:.25}).build();return r.parent=o,b.a.mapDict2Mesh(t,r),new n(r,M.Maybe.fromNull(t).flatMap((function(e){return M.Maybe.fromNull(e.keyValueMap)})).orUndefined())}},{key:"getRosOrigin",value:function(e){var t=E.MeshBuilder.CreateBox("ROS_ORIGIN",{size:.001},e);t.isVisible=!1,t.isPickable=!1,t.position=A.a.of(k.position).toBabylon(),t.scaling=A.a.of(k.scaling).toBabylon();var n=new E.Quaternion(k.quaternion[1],k.quaternion[2],k.quaternion[3],k.quaternion[0]);return t.rotationQuaternion=n.normalize(),t}},{key:"inverseCoordinates",value:function(e){var t=k.quaternion,n=w.a.getRotationMatrix({rotationQuaternion:new E.Quaternion(t[1],t[2],t[3],t[0])}),o=A.a.of(k.scaling).map((function(e){return 1/e})),r=A.a.of(k.position);return o.mul(n.dotVec(A.a.ofBabylon(e).sub(r))).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}},{key:"forwardCoordinates",value:function(e){var t=k.quaternion,n=w.a.getRotationMatrix({rotationQuaternion:new E.Quaternion(t[1],t[2],t[3],t[0])}),o=A.a.of(k.scaling),r=A.a.of(k.position);return n.prodVec(o.mul(A.a.ofBabylon(e))).add(r).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}}]),n}(b.a);y()(C,"TYPE","GlobalRef"),y()(C,"NAME","Global ref"),t.b=C},function(e,t,n){"use strict";var o=n(16),r=n.n(o),a=n(7),i=n.n(a),c=n(9),s=n.n(c),u=n(1),l=n.n(u),f=n(37),d=n(5),h=n(10),m=n(76),p=n.n(m),v=n(2),g=n(11),y=function(){function e(){var t=this;if(i()(this,e),l()(this,"getAnnotations",(function(){return t.annotations})),b)return b;b=this,this.annotations={},this.observersBySceneId={}}return s()(e,[{key:"load",value:function(){return this.retrieveAnnotationsFromDb(),this}},{key:"pushObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&delete this.observersBySceneId[t]}},{key:"retrieveAnnotationsFromDb",value:function(){var e=this;g.MasterDB.subscribe({Scope:"Annotation",Name:"*"},(function(t){console.log("Annotation update",t);var n={del:function(t){return e.delAnnotation(t)},set:function(t){return e.addAnnotation(t)}},o=t.key.Annotation;t.event in n&&(n[t.event](o),Object.keys(e.observersBySceneId).forEach((function(t){return e.observersBySceneId[t].forEach((function(t){return t(e)}))})))}),(function(t){console.log("Annotation start",t);var n=t.value.Annotation;e.addAnnotation(n)}))}},{key:"delAnnotation",value:function(e){var t=this;if(e){var n=Object.keys(e).reduce((function(e,t){return e.push(t),e}),[]);Object.keys(this.annotations).forEach((function(e){var o=t.annotations[e];o.names=o.names.filter((function(e){return!n.includes(e)})),o.labels=o.labels.filter((function(e){return!n.includes(e)}))}))}}},{key:"addAnnotation",value:function(e){var t=this;e&&Object.keys(e).forEach((function(n){var o=e[n];if(o.Type){var r=o.Type.toLowerCase(),a=o.Label;r in t.annotations||(t.annotations[r]={names:[],labels:[]}),t.annotations[r].names.push(n),t.annotations[r].labels.push(a||n)}}))}}],[{key:"getInstance",value:function(){return new e}},{key:"getAnnotations",value:function(){return e.getInstance().getAnnotations()}}]),e}(),b=null,A=y,w=n(24),M=n(20);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(){function e(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,e),l()(this,"getType",(function(){return e.TYPE})),l()(this,"getMouseContextActions",(function(e){return[{title:"Copy",onClick:function(){return f.a.copy(n.getCopyFunction())}},{title:"Delete",onClick:function(){return e.getNodeFromTree(n.name).forEach((function(t){return e.onDeleteNode(t,!1)}))}}]})),this.name=t.name,this.mesh=t,this.mesh.getMouseContextActions=this.getMouseContextActions,this.mesh.nodeItem=this,this.keyValueMap=o}return s()(e,[{key:"dispose",value:function(){this.delVertex(),this.mesh.dispose()}},{key:"toDict",value:function(){var e,t,n,o=this;return{name:this.name,type:this.getType(),position:d.a.ofBabylon(null===(e=this.mesh)||void 0===e?void 0:e.position).toArray(),quaternion:h.Maybe.fromNull(null===(t=this.mesh)||void 0===t?void 0:t.rotationQuaternion).map((function(e){return[e.w,e.x,e.y,e.z]})).orLazy((function(){var e=v.Quaternion.RotationYawPitchRoll(o.mesh.rotation.y,o.mesh.rotation.x,o.mesh.rotation.z);return[e.w,e.x,e.y,e.z]})),color:h.Maybe.fromNull(null===(n=this.mesh)||void 0===n?void 0:n.material).flatMap((function(e){return h.Maybe.fromNull(e.diffuseColor).map((function(e){return[e.r,e.g,e.b,o.mesh.visibility]}))})).orSome([0,0,0,1]),keyValueMap:this.keyValueMap,isVisible:this.mesh.isEnabled()}}},{key:"toForm",value:function(){var t=this.toDict(),n=new v.Color3(t.color[0],t.color[1],t.color[2]),o=new v.Quaternion(t.quaternion[1],t.quaternion[2],t.quaternion[3],t.quaternion[0]).toEulerAngles(),r={jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},position:{type:"object",title:"Position",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},rotation:{type:"object",title:"Rotation",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},color:{type:"object",title:"Color",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"},a:{type:"number"}}}}},uiSchema:{type:{"ui:disabled":!0},color:{"ui:widget":"color"},oldName:{"ui:widget":"hidden"},position:{"ui:widget":"collapse"},rotation:{"ui:widget":"collapse"}},data:{oldName:t.name,name:t.name,type:t.type,position:{x:t.position[0],y:t.position[1],z:t.position[2]},rotation:{x:o.x*M.b.RAD2DEG,y:o.y*M.b.RAD2DEG,z:o.z*M.b.RAD2DEG},color:{r:n.r,g:n.g,b:n.b,a:this.mesh.visibility}}};return e.setAnnotations2Form(r,this.keyValueMap),r}},{key:"ofForm",value:function(e){var t=this;if(this.name=e.name,this.mesh.name=e.name,h.Maybe.fromNull(null==e?void 0:e.position).forEach((function(e){var n=[e.x,e.y,e.z].map(Number.parseFloat);t.mesh.position=v.Vector3.FromArray(n)})),h.Maybe.fromNull(null==e?void 0:e.rotation).forEach((function(e){var n=[e.x,e.y,e.z].map(Number.parseFloat).map((function(e){return e*M.b.DEG2RAD}));t.mesh.rotationQuaternion=v.Quaternion.FromEulerAngles.apply(v.Quaternion,r()(n))})),this.mesh.material){var n=new v.Color3(e.color.r,e.color.g,e.color.b);this.mesh.material.diffuseColor=n,this.mesh.material.emissiveColor=n,this.mesh.visibility=e.color.a}this.keyValueMap=x({},e.annotations)}},{key:"getCopyFunction",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e+"_copy"+f.a.getUID()};return function(o,r){return r.getSceneMemory().map((function(a){var i=a.scene,c=r.getRootNode().item,s=e.toDict();s.name=n(s.name);var u=d.a.ofBabylon(o).toArray();u[2]=s.position[2],s.position=u;var l=e.ofDict(i,s,r);return l.mesh.parent=c.mesh,r.addNodeItem2Tree(l,w.b.NAME,!0,!0,t),l}))}}},{key:"delVertex",value:function(){var e,t=null===(e=this.mesh.graphVertex)||void 0===e?void 0:e.delVertex;if(!t){var n,o=((null===(n=this.mesh)||void 0===n?void 0:n._children)||[]).filter((function(e){return!!e.graphVertex})).map((function(e){return e.graphVertex.delVertex}));t=function(){return o.forEach((function(e){return e()}))}}t()}}],[{key:"mapDict2Mesh",value:function(e,t){if(!t)throw new Error("can't map a null mesh");return h.Maybe.fromNull(e).forEach((function(n){h.Maybe.fromNull(e.name).forEach((function(e){return t.name=e})),h.Maybe.fromNull(n.position).forEach((function(e){return t.position=d.a.of(e).toBabylon()})),h.Maybe.fromNull(n.quaternion).forEach((function(e){var n=new v.Quaternion(e[1],e[2],e[3],e[0]);t.rotationQuaternion=n.normalize()})),h.Maybe.fromNull(n.color).forEach((function(e){var n=new v.Color3(e[0],e[1],e[2]);h.Maybe.fromNull(t.material).forEach((function(e){h.Maybe.fromNull(e.diffuseColor).forEach((function(e){return t.material.diffuseColor=n})),h.Maybe.fromNull(e.emissiveColor).forEach((function(e){return t.material.emissiveColor=n}))}))}))})),t}},{key:"setAnnotations2Form",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.jsonSchema.properties.annotations={title:"Annotations",type:"object",properties:{}},e.uiSchema.annotations={"ui:widget":"collapse"},e.data.annotations=x({},t);var n=A.getAnnotations();["safety","behaviour","localization","navigation"].forEach((function(t){e.jsonSchema.properties.annotations.properties[t]={title:p()(t),type:"string"},e.uiSchema.annotations[t]={"ui:widget":"selectScopeModal","ui:options":{scopeList:"Annotation",name:p()(t),filter:function(e){return n[t]&&n[t].names.includes(e.name)}}}}))}},{key:"randomId",value:function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}]),e}();l()(P,"TYPE","NodeItem");t.a=P},function(e,t){e.exports=require("@babel/runtime/helpers/esm/asyncToGenerator")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),s=n.n(c),u=function(){function e(t,n){r()(this,e),this.vec=[t,n].map((function(e){return e||0}))}return i()(e,[{key:"x",get:function(){return this.vec[0]}},{key:"y",get:function(){return this.vec[1]}},{key:"toArray",value:function(){return this.vec}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"div",value:function(e){return this.op(e,(function(e,t){return e/t}))}},{key:"dot",value:function(e){return this.vec.reduce((function(t,n,o){return t+n*e.vec[o]}),0)}},{key:"prod",value:function(t){return new e(this.x*t.x-this.y*t.y,this.x*t.y+this.y*t.x)}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"normalize",value:function(){return this.scale(1/this.length())}},{key:"dual",value:function(){return new e(-this.y,this.x)}},{key:"sym",value:function(){return this.scale(-1)}},{key:"conj",value:function(){return new e(this.x,-this.y)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"map",value:function(t){return e.fromArray(this.vec.map(t))}},{key:"op",value:function(t,n){return e.fromArray(this.vec.map((function(e,o){return n(e,t.vec[o])})))}},{key:"reduce",value:function(e,t){return this.vec.reduce(e,t)}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}},{key:"toString",value:function(){return"{x: ".concat(this.x,", y:").concat(this.y,"}")}}],[{key:"fromArray",value:function(t){if(t.length<2)throw new Error("array must have size > 2");return new e(t[0],t[1])}},{key:"of",value:function(t,n){return new e(t,n)}},{key:"ofBabylon",value:function(t){return new e(t.x,t.y)}}]),e}();s()(u,"ZERO",new u(0,0)),s()(u,"e1",new u(1,0)),s()(u,"e2",new u(0,1)),t.a=u},function(e,t){e.exports=require("lodash/get")},function(e,t,n){"use strict";var o=n(18),r=n.n(o),a=n(16),i=n.n(a),c=n(14),s=n.n(c),u=n(7),l=n.n(u),f=n(9),d=n.n(f),h=n(3),m=n.n(h),p=n(17),v=n.n(p),g=n(15),y=n.n(g),b=n(13),A=n.n(b),w=n(6),M=n.n(w),E=n(1),x=n.n(E),P=n(25),k=n(8),C=n(2),S=n(20),O=n(114),N=n(21),T=n.n(N),I=n(10),R=new WeakMap,B=new WeakMap,D=new WeakMap,F=function(){function e(){l()(this,e),R.set(this,{writable:!0,value:{}}),B.set(this,{writable:!0,value:{}}),D.set(this,{writable:!0,value:{}})}return d()(e,[{key:"addVertex",value:function(e){e in T()(this,B)||(T()(this,B)[e]={},T()(this,R)[e]={})}},{key:"delVertex",value:function(t){var n=this;t in T()(this,B)&&(delete T()(this,B)[t],Object.keys(T()(this,R)[t]).forEach((function(o){delete T()(n,D)[e.edgeKey(t,o)],delete T()(n,D)[e.edgeKey(o,t)]})),delete T()(this,R)[t],Object.keys(T()(this,R)).forEach((function(e){t in T()(n,R)[e]&&delete T()(n,R)[e][t]})))}},{key:"addEdge",value:function(t,n){this.addVertex(t),this.addVertex(n);var o=this.getEdge(t,n).orSome({});return T()(this,D)[e.edgeKey(t,n)]=o,T()(this,D)[e.edgeKey(n,t)]=o,T()(this,R)[t][n]=!0,T()(this,R)[n][t]=!0,this}},{key:"delEdge",value:function(t,n){var o=this,r=e.edgeKey(t,n),a=e.edgeKey(n,t);(r in T()(this,D)||a in T()(this,D))&&(delete T()(this,D)[r],delete T()(this,D)[a],delete T()(this,R)[t][n],delete T()(this,R)[n][t]),[t,n].forEach((function(e){0===o.getNeighbors(e).length&&o.delVertex(e)}))}},{key:"hasEdge",value:function(e,t){return this.getEdge(e,t).isSome()}},{key:"getNeighbors",value:function(e){return e in T()(this,R)?Object.keys(T()(this,R)[e]):[]}},{key:"getEdge",value:function(t,n){var o=e.edgeKey(t,n);return o in T()(this,D)?I.Maybe.some(T()(this,D)[o]):I.Maybe.none()}},{key:"getVertex",value:function(e){return e in T()(this,B)?I.Maybe.some(T()(this,B)[e]):I.Maybe.none()}},{key:"getEdges",value:function(){return T()(this,D)}},{key:"getVertices",value:function(){return T()(this,B)}},{key:"getAdjMap",value:function(){return T()(this,R)}}]),e}();x()(F,"edgeKey",(function(e,t){return"".concat(e,"_").concat(t)})),x()(F,"key2Edge",(function(e){return e.split("_")}));var L=F,j=n(5),V=n(0),U=n.n(V),z=n(28),G=n.n(z),K=n(11),W=n(23),q=n(33);function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){x()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=M()(e);if(t){var r=M()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return A()(this,n)}}var Q=function(e){y()(n,e);var t=Y(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.NAME,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};l()(this,n);var c=e.getUniqueId();if(c in Z&&!Z[c].mesh.isDisposed())return A()(r,Z[c]);var u=X(e,a);return u.onClick=function(){return r.graphFormMapper=r.getDefaultFormMapper()},r=t.call(this,u,i),x()(m()(r),"getType",(function(){return n.TYPE})),x()(m()(r),"getEdgeMouseCtxActions",(function(e){return function(){return[{title:"Delete",onClick:r.getUndoDeleteEdgeLineAction(e)}]}})),x()(m()(r),"onDeleteEdgeLine",(function(e){return function(){r.mainView.confirmationAlert({title:"Confirm to delete",message:"Are you sure you want to delete this edge?",onConfirm:r.getUndoDeleteEdgeLineAction(e)})}})),x()(m()(r),"getUndoDeleteEdgeLineAction",(function(e){return function(){return r.mainView.getUndoManager().doIt(r.getUndoDeleteEdge(e))}})),x()(m()(r),"getEdgeObs",(function(){return function(e){var t=e.updatedPointMesh,n=e.is2updateServer,o=e.displacement,a=j.a.ofBabylon(o),i=k.a.getLocalCoordFromWorld(r.mesh,a,!1);t.position=t.position.add(i.scale(-1).toBabylon()),n&&(r.graphFormMapper=r.getToFormEdge(t),r.mainView.setProperties(r.toForm()))}})),x()(m()(r),"getOnClickEdge",(function(e){return function(){var t=[];t.push({icon:function(e){return U.a.createElement("i",s()({className:"fas fa-trash"},e))},action:function(){r.mainView.getUndoManager().doIt(r.getUndoDeleteEdge(e))},name:"Delete Edge [Del]"}),r.mainView.setContextActions(t)}})),x()(m()(r),"isMeshBelong2Path",(function(e){var t=e.parent;return r.mainView.getNodeFromTree(null==t?void 0:t.name).filter((function(e){return e.item.getType()===W.a.TYPE})).orSome(!1)})),x()(m()(r),"getMeshName",(function(e){return r.isMeshBelong2Path(e)?e.parent.name:e.name})),x()(m()(r),"exportBelongToData",(function(e){var t,n=e.index,o=e.name;return null==n?{name:o}:r.mainView.getNodeFromTree(null==e||null===(t=e.parent)||void 0===t?void 0:t.name).map((function(e){return{name:e.item.name,index:n>0?-1:n}})).orUndefined()})),Z[c]=m()(r),r.graph=new L,r.scene=e,r.mainView=o,r.meshByEdgeId={},r.graphFormMapper=r.getDefaultFormMapper(),r.vertexGenerator=0,r}return d()(n,[{key:"toDict",value:function(){var e=this,t=v()(M()(n.prototype),"toDict",this).call(this),o=this.graph,a=H({},o.getVertices()),c=H({},o.getEdges());return Object.keys(a).forEach((function(e){o.getVertex(e).forEach((function(t){var n=t.data;a[e]={position:j.a.ofBabylon(n.position).toArray(),id:String(e)}}))})),Object.keys(c).forEach((function(t){var n=L.key2Edge(t);o.getEdge.apply(o,i()(n)).forEach((function(o){var a=o.data,s=n.map((function(e){return Number(e)})),u=r()(s,2),l=u[0],f=u[1],d=a.edge.map((function(e){return e.mesh})),h=r()(d,2),m=h[0],p=h[1];c[t]={ids:n,keyValueMap:a.keyValueMap,weight:a.weight,belongsSrc:l<f?e.exportBelongToData(m):e.exportBelongToData(p),belongsTrg:l<f?e.exportBelongToData(p):e.exportBelongToData(m)},e.doMeshesBelong2SamePath.apply(e,i()(d))?l>f&&delete c[t]:e.checkInvalidEdges.apply(e,i()(d).concat([c[t]]))&&delete c[t]}))})),t.vertices=a,t.edges=c,t}},{key:"toForm",value:function(){var e=v()(M()(n.prototype),"toForm",this).call(this);return delete e.jsonSchema.properties.position,delete e.jsonSchema.properties.rotation,delete e.jsonSchema.properties.color,delete e.uiSchema.position,delete e.uiSchema.rotation,delete e.uiSchema.color,delete e.data.position,delete e.data.rotation,delete e.data.color,this.graphFormMapper.toForm(e)}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.graphFormMapper.ofForm(e)}},{key:"getDefaultFormMapper",value:function(){var e=this;return{toForm:function(e){return e},ofForm:function(t){return e.keyValueMap=H({},t.annotations)}}}},{key:"getToFormEdge",value:function(e){var t=this.graph;return{toForm:function(n){return t.getEdge.apply(t,i()(e.edgeIndexes)).map((function(t){var o=t.data;return n.jsonSchema.properties.weight={type:"number",title:"Weight"},n.data.weight=o.weight,P.a.setAnnotations2Form(n,o.keyValueMap),n.jsonSchema.properties.annotations.title="Annotations Edge ".concat(e.edgeIndexes),n})).orSome(n)},ofForm:function(n){var o=e.edgeIndexes;t.getEdge.apply(t,i()(o)).forEach((function(e){var t=e.data;t.keyValueMap=H({},G()(n,"annotations",{})),t.weight=Number.parseFloat(n.weight)}))}}}},{key:"delVertex",value:function(){var e=this.mainView.getRootNode();this.delVertexRecursively(null==e?void 0:e.children)}},{key:"addEdge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=r()(n,2),a=o[0],i=o[1];if(!this.hasEdge(e,t))return this.buildVertex(e,a),this.buildVertex(t,i),this.buildEdge(e,t),this}},{key:"getEdge",value:function(e,t){var n=this.graph,o=[e,t].map(this.getVertexIdFromMesh),a=r()(o,2),i=a[0],c=a[1];return n.getEdge(i,c).map((function(e){return e.data}))}},{key:"delEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t].map(this.getVertexIdFromMesh),i=r()(a,2),c=i[0],s=i[1];o.getEdge(c,s).forEach((function(e){e.data;var t=L.edgeKey(c,s),r=L.edgeKey(s,c);I.Maybe.fromNull(n.meshByEdgeId[t]).forEach((function(e){e.dispose(),delete n.meshByEdgeId[t],delete n.meshByEdgeId[r]})),o.delEdge(c,s)})),this.mainView.setProperties()}},{key:"hasEdge",value:function(e,t){var n=[e,t].map(this.getVertexIdFromMesh),o=r()(n,2),a=o[0],i=o[1];return this.graph.hasEdge(a,i)}},{key:"delVertexFromMesh",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.graph,r=this.getVertexIdFromMesh(e);o.getVertex(r).forEach((function(a){o.getNeighbors(r).map((function(e){return o.getVertex(e)})).forEach((function(n){return n.forEach((function(n){var o=n.data.mesh;t.delEdge(e,o)}))})),o.delVertex(r),e.graphVertex=void 0,n&&t.mainView.updateNodeInServer(t.name)}))}},{key:"getVertex",value:function(e){var t=this.graph,n=this.getVertexIdFromMesh(e);return t.getVertex(n).map((function(e){return e.data}))}},{key:"getNeighbors",value:function(e){var t=this.graph,n=this.getVertexIdFromMesh(e);return t.getNeighbors(n).map((function(e){return t.getVertex(e).orNull()})).map((function(e){return e.data})).filter((function(e){return!!e}))}},{key:"doMeshesBelong2SamePath",value:function(e,t){var n,o,r=null==e||null===(n=e.parent)||void 0===n?void 0:n.nodeItem,a=null==t||null===(o=t.parent)||void 0===o?void 0:o.nodeItem;return!!r&&!!a&&r.name===a.name&&r.getType()===W.a.TYPE&&a.getType()===W.a.TYPE}},{key:"updateVertexPosition",value:function(e,t){var n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.graph;a.getVertex(e).forEach((function(e){e.data.position=t})),a.getNeighbors(e).forEach((function(t){var i=e,c=L.edgeKey(i,t);n.meshByEdgeId[c]&&n.meshByEdgeId[c].dispose(),a.getEdge(i,t).forEach((function(e){var t=e.data,o=r()(t.edge,2),a=o[0],i=o[1];n.buildEdge(a.mesh,i.mesh)})),o&&n.mainView.updateNodeInServer(n.name)}))}},{key:"getDirectionFromMeshes",value:function(e,t){if(n.isInvalidEdge(e,t,!0))return 0;var o=[this.getVertexIdFromMesh(e),this.getVertexIdFromMesh(t)].map((function(e){return Number(e)})),a=r()(o,2),i=a[0],c=a[1];return(c-i)/Math.abs(c-i)}},{key:"delVertexRecursively",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){t.item.getType()!==n.TYPE&&(t.item.delVertex(),e.delVertexRecursively(t.children))}))}},{key:"getVertexIdFromMesh",value:function(e){var t,n;return null==e||null===(t=e.graphVertex)||void 0===t||null===(n=t.vertex)||void 0===n?void 0:n.id}},{key:"buildVertex",value:function(e,t){var n=this,o=this.getVertexIdFromMesh(e);this.graph.getVertex(o).orElseRun((function(){var o=t||n.vertexGenerator++;n.graph.addVertex(o),n.graph.getVertex(o).forEach((function(t){t.data=$.builder()(o,e),n.addObs2VertexMesh(t.data)}))}))}},{key:"addObs2VertexMesh",value:function(e){var t=this,n=e.mesh;void 0!==n&&(n.graphVertex={vertex:e,delVertex:function(){return t.delVertexFromMesh(n)},vertexObs:this.getVertexMeshObs(e)})}},{key:"getVertexMeshObs",value:function(e){var t=this;return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;n._;if(!o.isDisposed()){var a=k.a.getGlobalCoordinates(o,o.position).toBabylon();t.updateVertexPosition(e.id,a,r)}}}},{key:"buildEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t].map(this.getVertexIdFromMesh).sort((function(e,t){return e-t})),i=r()(a,2),c=i[0],s=i[1];o.addEdge(c,s),o.getVertex(c).forEach((function(r){var a=r.data;return o.getVertex(s).forEach((function(r){var i=r.data;if(o.getEdge(c,s).forEach((function(e){e.data?e.data.edge=[a,i]:e.data=new ee(a,i)})),!n.doMeshesBelong2SamePath(e,t)){var u=n.getDirectionFromMeshes(e,t)+n.getDirectionFromMeshes(t,e),l=n.getEdgeMesh(a,i,u);n.meshByEdgeId[L.edgeKey(c,s)]=l,n.meshByEdgeId[L.edgeKey(s,c)]=l}}))}))}},{key:"getEdgeMesh",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[e,t].map((function(e){var t=e.mesh;return k.a.getGlobalCoord(t,t.position)})),a=n.getEdgeMesh(this.scene,r,"edgeMesh".concat(e.id,"_").concat(t.id),C.Color3.Yellow());return a.visibility=.99,a.material=n.getEdgeMaterial(this.scene,{speed:8*o}),a.parent=this.mesh,a.edgeIndexes=[e,t].map((function(e){return e.id})),a.getMouseContextActions=this.getEdgeMouseCtxActions(a),a.onDel=this.onDeleteEdgeLine(a),this.addObserver2EdgeMesh(a),this.addOnClickEdge(a),a}},{key:"addObserver2EdgeMesh",value:function(e){e.observers=new C.Observable,e.observers.add(this.getEdgeObs())}},{key:"addOnClickEdge",value:function(e){e.onClick=this.getOnClickEdge(e)}},{key:"getUndoDeleteEdge",value:function(e){var t=this.graph,n=e.edgeIndexes.map((function(e){return t.getVertex(e)})).map((function(e){return e.some()})).map((function(e){return e.data})),o=r()(n,2),a=o[0],i=o[1];return this.getUndoDelLineEdge(a,i)}},{key:"getUndoDelLineEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t],c=a.map((function(e){return e.id})),s=r()(c,2),u=s[0],l=s[1],f=a.map((function(e){return e.mesh})),d={keyValueMap:{},weight:1,edge:{}};return o.getEdge(u,l).forEach((function(e){var t=e.data;d.keyValueMap=t.keyValueMap,d.weight=t.weight,d.edge=t.edge})),K.UndoManager.actionBuilder().doAction((function(){n.delEdge.apply(n,i()(f)),n.mainView.closeContextDial(),n.mainView.updateNodeInServer(n.name)})).undoAction((function(e){var t=e.is2UpdateInServer,r=void 0===t||t;n.addEdge.apply(n,i()(f).concat([[u,l]])),o.getEdge(u,l).forEach((function(e){var t=e.data;t.keyValueMap=d.keyValueMap,t.weight=d.weight,t.edge=d.edge})),r&&n.mainView.updateNodeInServer(n.name)})).build()}},{key:"checkInvalidEdges",value:function(e,t,o){var r=this;if(![e,t].map(this.isMeshBelong2Path).some((function(e){return e})))return!1;var a=[e,t].filter((function(e){return r.getMeshName(e)===o.belongsSrc.name}))[0],i=[e,t].filter((function(e){return r.getMeshName(e)===o.belongsTrg.name}))[0];return!(!a||!i)&&n.isInvalidEdge(a,i,!0)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing graphItem or null mainView");var a=new n(e,o,t.name,t.keyValueMap),c=t.edges,s=Number.MIN_VALUE;return Object.values(c).forEach((function(e){var t=e.ids,n=e.belongsSrc,u=e.belongsTrg,l=t.map((function(e){return Number(e)})),f=r()(l,2),d=f[0],h=f[1];s=Math.max(s,Math.max(d,h));var m=J(o,{belongsSrc:n,belongsTrg:u});m.reduce((function(e,t){return e&&null!=t}),!0)&&(a.addEdge.apply(a,i()(m).concat([[d,h]])),a.graph.getEdge(d,h).forEach((function(e){var t=e.data,n=c[L.edgeKey(d,h)];t.importFeatures(n)})))})),a.vertexGenerator=s+1,a}},{key:"getVertexMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.b.RADIUS,r=k.a.createSphere(e,n,o);return r.position=t,r}},{key:"getEdgeMesh",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.Color3.Gray(),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.b.RADIUS/4;return k.a.createTubeFromPoints(e,t,o,r,n)}},{key:"getEdgeMaterial",value:function(e,t){var n=t.color,o=void 0===n?C.Color3.Yellow():n,r=t.frequency,a=void 0===r?8:r,i=t.speed,c=void 0===i?0:i;return k.a.getShaderMaterial({vertex:te,frag:ne(a,c,[o.r,o.g,o.b])})(e)}}]),n}(P.a);x()(Q,"TYPE","GraphItem"),x()(Q,"NAME","LogicGraph"),x()(Q,"createGraphItemIfNone",(function(e,t){return t.getGraph().orElseRun((function(){var n=new Q(e,t);n.mesh.parent=t.getRootNode().item.mesh,t.addNodeItem2Tree(n)}))})),x()(Q,"isInvalidEdge",(function(e,t){var n,o,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=null===(n=e.parent)||void 0===n?void 0:n.nodeItem,i=null===(o=t.parent)||void 0===o?void 0:o.nodeItem,c=[];if(k.a.getNodeItemTypeFromMesh(e)===W.a.TYPE&&k.a.getNodeItemTypeFromMesh(t)===W.a.TYPE){var s=e.index/(a.keyPoints.length-1),u=t.index/(i.keyPoints.length-1);r&&0===s&&1===u&&c.push(1.1),1===s&&1===u&&c.push(2),0===s&&0===u&&c.push(3)}return r&&(k.a.getNodeItemTypeFromMesh(e)===W.a.TYPE&&k.a.getNodeItemTypeFromMesh(t)===q.a.TYPE&&e.index/(a.keyPoints.length-1)==0&&c.push(1.2),k.a.getNodeItemTypeFromMesh(e)===q.a.TYPE&&k.a.getNodeItemTypeFromMesh(t)===W.a.TYPE&&t.index/(i.keyPoints.length-1)==1&&c.push(1.3)),e.name===t.name&&c.push(4),c.length>0}));var Z={},X=function(e,t){var n=k.a.createSphere(e,C.Color3.Gray(),Number.MIN_VALUE,t,!1);return n.position=C.Vector3.Zero(),n.scaling=C.Vector3.One(),n.rotationQuaternion=O.Quaternion.Identity(),n.visibility=0,n},J=function(e,t){return[t.belongsSrc,t.belongsTrg].map((function(t){var n=t.name,o=t.index;return e.getNodeFromTree(n).map((function(e){var t=e.item;if(null==o)return t.mesh;var n=o<0?t.keyPoints.length-1:o;return t.keyPoints[n]})).orUndefined()}))},$=function(){function e(t,n,o){l()(this,e),this.id=t,this.mesh=n,this.position=o}return d()(e,null,[{key:"builder",value:function(){return function(t,n){return new e(t,n,k.a.getGlobalCoordinates(n,n.position).toBabylon())}}}]),e}(),ee=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l()(this,e),this.edge=[t,n],this.keyValueMap=o,this.weight=1}return d()(e,[{key:"importFeatures",value:function(e){var t=e.keyValueMap,n=e.weight;this.keyValueMap=t,this.weight=n}}]),e}(),te="\nprecision highp float;\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n\n    vUV = uv;\n    vPosition = position;\n    vNormal = normal;\n}",ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return"\n#define PI 3.1415926538\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n// Refs\nuniform float time;\n\nvoid main(void) {\n    vec3 color = vec3(".concat(n[0],", ").concat(n[1],", ").concat(n[2],");\n    float frequency = ").concat(Number(e).toFixed(1),";\n    float speed = ").concat(Number(t).toFixed(1),";\n    gl_FragColor = vec4(color, max(0.,sin(2. * PI * vUV.y * frequency - speed * time)));\n}")};t.a=Q},function(e,t){e.exports=require("@material-ui/core/MenuItem")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/objectWithoutProperties")},function(e,t){e.exports=require("@material-ui/core/Typography")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(3),s=n.n(c),u=n(15),l=n.n(u),f=n(13),d=n.n(f),h=n(6),m=n.n(h),p=n(1),v=n.n(p),g=n(25),y=n(8),b=n(10),A=n(2);function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=m()(e);if(t){var r=m()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return d()(this,n)}}var M=function(e){l()(n,e);var t=w(n);function n(){var e;r()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),v()(s()(e),"getType",(function(){return n.TYPE})),e}return i()(n,[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=b.Maybe.fromNull(t).map((function(e){return e.name})).orSome("KeyPoint".concat(Math.floor(1e3*Math.random()))),r=A.MeshBuilder.CreatePolyhedron(o,{custom:E,size:n.DEFAULT_SIZE},e),a=new A.StandardMaterial("KeyPointMaterial".concat(o),e);r.material=a,r.convertToFlatShadedMesh(),r.rotationQuaternion=A.Quaternion.Identity();var i=y.a.referentialBuilder(e).isPickable(!1).boxParams({isVisible:!1,size:.1*n.DEFAULT_SIZE}).name("".concat(o,"Axis")).build();return i.parent=r,g.a.mapDict2Mesh(t,r),new n(r,t.keyValueMap)}}]),n}(g.a);v()(M,"TYPE","KeyPoint"),v()(M,"DEFAULT_SIZE",.25);var E={name:"Triangular Antiprism (Octahedron)",category:["Antiprism"],vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]};t.a=M},function(e,t){e.exports=require("@material-ui/core/IconButton")},function(e,t){e.exports=require("@material-ui/core/FormControl")},function(e,t){e.exports=require("@material-ui/core/Divider")},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(11),s=0,u=function(){function e(){r()(this,e)}return i()(e,null,[{key:"copy",value:function(e){c.Clipboard.write("scene",e)}},{key:"paste",value:function(){return c.Clipboard.read("scene")}},{key:"getUID",value:function(){return s++}}]),e}()},function(e,t){e.exports=require("@material-ui/icons/Search")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),s=n.n(c),u=n(10);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){if(e.length===t.length){for(var o=!0,r=0;r<e.length;r++){var a=e[r],i=t[r];if(!n(a,i))return!1;o=o&&d(a.children,i.children,n)}return o}return!1}function h(e){return e.expanded=!0,e}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var o=f({},e);if(t(o)){var r=h(o);r.children=m(r.children,t),n.push(r)}else if(o.children){var a=m(o.children,t);0!==a.length&&(o.children=a,n.push(h(o)))}})),n}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var o=f({},e);t(o)&&n.push(o),n=n.concat(p(o.children,t))})),n}var v=function(){function e(t){r()(this,e),this.tree=t}return i()(e,[{key:"getNode",value:function(e){return function e(t,n){for(var o=0;o<t.length;o++){var r=t[o];if(n(r))return u.Maybe.some(r);var a=e(r.children,n);if(a.isSome())return a}return u.Maybe.none()}(this.tree,e)}},{key:"getParentNode",value:function(e){return function e(t,n,o){if(t.map((function(e){return n(e)})).reduce((function(e,t){return e||t}),!1))return u.Maybe.fromNull(o);for(var r=0;r<t.length;r++){var a=t[r],i=e(a.children,n,a);if(i.isSome())return i}return u.Maybe.none()}(this.tree,e,null)}},{key:"equals",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};return t.constructor===e?d(this.tree,t.tree,n):d(this.tree,t,n)}},{key:"map",value:function(t){return new e(function e(t,n,o){return t.forEach((function(t){var r=f({},t),a=o(r);a.children=e(r.children,[],o),n.push(a)})),n}(this.tree,[],t))}},{key:"filter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return new e(m(this.tree,t))}},{key:"flatten",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return p(this.tree,e)}},{key:"forEach",value:function(e){!function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.forEach((function(t){n(t),e(t.children,n)}))}(this.tree,e)}}]),e}();t.a=v},function(e,t){e.exports=require("@material-ui/core/Grid")},function(e,t){e.exports=require("@material-ui/icons/ChevronRight")},function(e,t,n){"use strict";var o=n(117),r=n.n(o),a=n(18),i=n.n(a),c=n(16),s=n.n(c),u=n(7),l=n.n(u),f=n(9),d=n.n(f),h=n(3),m=n.n(h),p=n(17),v=n.n(p),g=n(15),y=n.n(g),b=n(13),A=n.n(b),w=n(6),M=n.n(w),E=n(1),x=n.n(E),P=n(25),k=n(8),C=n(10),S=n(2),O=n(5),N=n(20),T=n(60),I=n(65),R=n(11);function B(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=M()(e);if(t){var r=M()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return A()(this,n)}}var D="Fail to generate navigation preview.",F=function(e){y()(n,e);var t=B(n);function n(e,o,r,a,i){var c;return l()(this,n),c=t.call(this,e,{}),x()(m()(c),"getType",(function(){return n.TYPE})),c.poses=o,c.robotConfig=r,c.scene=a,c.mainView=i,c.arrowMeshes=c.createArrowMeshes(),c.navPath=c.createNavPath(),c}return d()(n,[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"dispose",value:function(){this.navPath&&this.navPath.dispose(),this.arrowMeshes.forEach((function(e){return e.dispose()}))}},{key:"toDict",value:function(){var e=v()(M()(n.prototype),"toDict",this).call(this);return e.poses=this.poses,e.robotConfig=this.robotConfig,e}},{key:"toForm",value:function(){var e=v()(M()(n.prototype),"toForm",this).call(this);return delete e.jsonSchema.properties.position,delete e.jsonSchema.properties.rotation,delete e.jsonSchema.properties.color,delete e.jsonSchema.properties.annotations,delete e.uiSchema.position,delete e.uiSchema.rotation,delete e.uiSchema.color,delete e.data.position,delete e.data.rotation,delete e.data.color,delete e.data.annotations,e.jsonSchema.properties.config={type:"string",title:"Robot Configuration"},e.uiSchema.config={"ui:widget":"selectScopeModal","ui:options":{scopeList:"Configuration",name:"Robot Config",filter:function(e){return!0}}},e.data.config=this.robotConfig,e}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.robotConfig=e.config}},{key:"createArrowMeshes",value:function(){var e=this;return this.poses.map((function(t,n){var o=O.a.of(t.position).toBabylon(),r=2*Math.atan2(t.orientation[3],t.orientation[0]),a=new S.Vector3(Math.cos(r),Math.sin(r),0).add(o),i=k.a.getArrow(e.scene,"".concat(e.name,"Pose").concat(n),o,a,N.b.RADIUS/6);return i.parent=e.mesh,i.getChildren().forEach((function(t){t.material=k.a.getMaterialFromColor(n%2==0?S.Color3.Red():S.Color3.Green()),t.material.freeze(),t.observers=new S.Observable,t.observers.add(e.getArrowObserver(e.mainView)),t.onClick=function(){e.mainView.highlightNodesInTree([e.name]),e.mainView.setProperties(e.toForm()),setTimeout((function(){e.mainView.highlightMeshesInScene(e.arrowMeshes.flatMap((function(e){return e.getChildren()})))}))},t.onDel=function(){return e.mainView.deleteNodeFromTreeUsingName(e.name)}})),i}))}},{key:"createNavPath",value:function(){var e=new L(this);return e.play(),e}},{key:"getArrowObserver",value:function(e){var t=this;return function(n){var o=n.updatedPointMesh,r=n.is2updateServer,a=n.displacement,i=O.a.ofBabylon(a),c=k.a.getLocalCoordFromWorld(t.mesh,i,!1);o.position=o.position.add(c.scale(-1).toBabylon()),r&&e.setProperties(t.toForm())}}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=C.Maybe.fromNull(t).map((function(e){return e.name})).orSome("NavPreview".concat(Math.floor(1e3*Math.random()))),a=new S.Mesh(r,e);a.position=S.Vector3.Zero(),a.scaling=S.Vector3.One(),a.rotationQuaternion=S.Quaternion.Identity(),a.isPickable=!1;var i=new n(a,t.poses,t.robotConfig,e,o);return i}}]),n}(P.a);x()(F,"TYPE","NavigationPreviewItem");var L=function(){function e(t){var n=this;l()(this,e),this.navItem=t,this.scene=t.scene,this.mainView=t.mainView,this.pathPromise=this.getPathFromService(this.navItem.poses,this.navItem.robotConfig),this.pathPromise.then((function(e){var t=e.path;n.pathPoses=t.poses.map((function(e){return e.pose})),n.mesh=n.getNavigationPathMesh(n.pathPoses),n.animator=n.getAnimator()}))}return d()(e,[{key:"play",value:function(){var e=this;this.pathPromise.then((function(){e.animator.play()}))}},{key:"stop",value:function(){var e=this;this.pathPromise.then((function(){e.animator.stop()}))}},{key:"dispose",value:function(){this.mesh&&this.mesh.dispose(),this.stop()}},{key:"getAnimator",value:function(){var e=this,t=this.pathPoses.length;return T.a.builder().initialState({time:0,T:(new Date).getTime(),indices:s()(Array(t)).map((function(e,t){return t}))}).nextState((function(n){var o=n.time,r=n.T,a=n.indices,i=((new Date).getTime()-r)/1e3,c=s()(Array(t));return a.forEach((function(e,n){return a[n]=(e+3*i)%t})),c.forEach((function(n,o){var r=Math.floor(a[o]),i=Math.ceil(a[o]),s=(a[o]-r)/(i-r);a[o]>t-1&&(r=0,i=1),c[o]=O.a.of([e.pathPoses[r].position.x,e.pathPoses[r].position.y,e.pathPoses[r].position.z]).scale(1-s).add(O.a.of([e.pathPoses[i].position.x,e.pathPoses[i].position.y,e.pathPoses[i].position.z]).scale(s)).toArray()})),e.mesh.updateVerticesData(S.VertexBuffer.PositionKind,c.flatMap((function(e){return e}))),{time:o+i,T:(new Date).getTime(),indices:a}})).while((function(t){return!e.scene.isDisposed})).build()}},{key:"getNavigationPathMesh",value:function(e){var t=new S.Mesh("cloudPoint".concat(this.navItem.name),this.scene),n=new S.StandardMaterial("cloudPoint".concat(this.navItem.name,"Material"),this.scene);n.emissiveColor=new S.Color3(1,1,1),n.disableLighting=!0,n.pointsCloud=!0,n.pointSize=5,t.material=n,t.isPickable=!1;var o=new S.VertexData,r=e.map((function(e){var t=e.position;return[t.x,t.y,t.z]}));o.positions=r.flatMap((function(e){return e}));var a=new Array(4*r.length);return o.colors=a.fill(1),o.applyToMesh(t,!0),t.parent=this.navItem.mesh,t}},{key:"getPathFromService",value:function(e,t){var n=this,o=i()(e,2),r=o[0],a=o[1],c=new I.Ros({url:G}),s={scene:this.mainView.sceneName,robot_config:this.navItem.robotConfig,initial_pose:V(r),final_pose:V(a)};return new Promise((function(e){c.on("error",(function(t){console.log("Navigation Service ",t),n.getDefaultPath(s,e)})),c.on("connection",(function(){console.log("Navigation Service Connection made!")})),c.on("close",(function(){console.log("Navigation Service Connection closed.")}));var t=new I.Service({ros:c,name:U,serviceType:z}),o=new I.ServiceRequest(s);t.callService(o,(function(t){c.close(),e(t)}),(function(t){n.getDefaultPath(s,e)}))}))}},{key:"getDefaultPath",value:function(e,t){var n=this;R.MasterDB.cloudFunction(N.b.NAV_CLOUD_NAME,"generate_path",[e.scene,e.initial_pose,e.final_pose,e.robot_config],(function(e){console.log("Got default path",e.success),e.success?t({path:e.result}):(console.log("Caught exception in default path",e.error),n.getPathFromPoses(n.navItem.poses).then((function(e){return t({path:e})})).catch((function(e){console.log("Caught error in getPathFromPoses",e),n.mainView.showAlert(D,"error")})))})).catch((function(e){console.log("debug couldn't execute default generate path",e),n.getPathFromPoses(n.navItem.poses).then((function(e){return t({path:e})})).catch((function(e){console.log("Caught error in getPathFromPoses",e),n.mainView.showAlert(D,"error")}))}))}},{key:"getPathFromPoses",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=i()(e,2),o=n[0],r=n[1],a=O.a.of(o.position),c=O.a.of(r.position),u=c.sub(a),l=a.add(u.scale(.5)).add(O.a.of([o.orientation[0],o.orientation[3],0]).scale(2)),f=c.add(u.scale(-.5)).add(O.a.of([r.orientation[0],r.orientation[3],0]).scale(2)),d=[a,l,f,c],h=s()(Array(t)),m=0;m<t;m++)h[m]=j(d,m/(t-1)).toArray();return new Promise((function(e){return e({poses:h.map((function(e){return{pose:{position:{x:e[0],y:e[1],z:e[2]},orientation:{x:0,y:0,z:0,w:1}}}}))})}))}}]),e}();function j(e,t){if(1===e.length)return e[0];var n,o=r()(e).slice(1),a=(n=o,e.map((function(e,t){return[e,n[t]]})));return a.splice(-1,1),j(a.map((function(e){var n=i()(e,2);return function(e,t){return function(n){return e.scale(1-n).add(t.scale(n))}}(n[0],n[1])(t)})),t)}function V(e){var t=e.position,n=e.orientation;return{position:{x:t[0],y:t[1],z:t[2]},orientation:{w:n[0],x:n[1],y:n[2],z:n[3]}}}var U="/generate_path/path_points/in",z="movai_common/GeneratePath",G="ws://localhost:9090";t.a=F},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("@material-ui/core/Input")},function(e,t){e.exports=require("@material-ui/core/Menu")},function(e,t){e.exports=require("@babylonjs/gui/2D")},function(e,t){e.exports=require("@material-ui/core/Select")},function(e,t){e.exports=require("@material-ui/core/Avatar")},function(e,t){e.exports=require("@babylonjs/gui")},function(e,t){e.exports=require("@material-ui/icons/Clear")},function(e,t){e.exports=require("@material-ui/core/InputLabel")},function(e,t){e.exports=require("clsx")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=function(){function e(t,n,o,a,i){var c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r()(this,e),this.title=t,this.item=n,this.children=o,this.expanded=a,this.isVisible=i,this.isStatic=c}return i()(e,null,[{key:"dispose",value:function(t){t.item.dispose(),t.children.forEach((function(t){e.dispose(t)}))}},{key:"toDict",value:function(t){return{name:t.title,item:t.item.toDict(),children:t.children.map((function(t){return e.toDict(t)}))}}},{key:"builder",value:function(){return new s}}]),e}(),s=function(){function e(){r()(this,e),this._title=null,this._item={},this._children=[],this._expanded=!1,this._isVisible=!0,this._isStatic=!1}return i()(e,[{key:"title",value:function(e){return this._title=e,this}},{key:"item",value:function(e){return this._item=e,this}},{key:"children",value:function(e){return this._children=e,this}},{key:"expanded",value:function(e){return this._expanded=e,this}},{key:"isVisible",value:function(e){return this._isVisible=e,this}},{key:"isStatic",value:function(e){return this._isStatic=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a TreeNode, e.g ".concat(e))})),new c(this._title,this._item,this._children,this._expanded,this._isVisible,this._isStatic)}}]),e}();t.a=c},function(e,t){e.exports=require("@material-ui/core/Button")},function(e,t){e.exports=require("@material-ui/icons/Close")},function(e,t){e.exports=require("lodash/debounce")},function(e,t){e.exports=require("@material-ui/icons/ExpandMore")},function(e,t){e.exports=require("react-resize-detector")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(3),s=n.n(c),u=n(17),l=n.n(u),f=n(15),d=n.n(f),h=n(13),m=n.n(h),p=n(6),v=n.n(p),g=n(1),y=n.n(g),b=n(25),A=n(10),w=n(8),M=n(2);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m()(this,n)}}var x=function(e){d()(n,e);var t=E(n);function n(e){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_SIZE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r()(this,n),o=t.call(this,e,i),y()(s()(o),"getType",(function(){return n.TYPE})),o.size=a,o}return i()(n,[{key:"toDict",value:function(){var e=l()(v()(n.prototype),"toDict",this).call(this);return e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=A.Maybe.fromNull(t),r=o.flatMap((function(e){return A.Maybe.fromNull(e.size)})).orSome(n.DEFAULT_SIZE),a=o.flatMap((function(e){return A.Maybe.fromNull(e.name)})).orSome("Box".concat(Math.floor(1e3*Math.random()))),i=o.flatMap((function(e){return A.Maybe.fromNull(e.keyValueMap)})).orUndefined(),c=w.a.createBox(e,new M.Color3(Math.random(),Math.random(),Math.random()),r,a);return b.a.mapDict2Mesh(t,c),new n(c,r,i)}}]),n}(b.a);y()(x,"DEFAULT_SIZE",.5),y()(x,"TYPE","Box"),t.a=x},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=function(){function e(t,n,o){r()(this,e),this.state=t,this.next=n,this.while=o,this.requestAnimeId=null}return i()(e,[{key:"play",value:function(){var e=this;return this.requestAnimeId=requestAnimationFrame((function(){if(!e.while(e.state))return e.stop();e.state=e.next(e.state),e.play()})),this}},{key:"stop",value:function(){return cancelAnimationFrame(this.requestAnimeId),this}}],[{key:"builder",value:function(){return new s}}]),e}(),s=function(){function e(){r()(this,e),this._state=null,this._next=null,this._end=null}return i()(e,[{key:"initialState",value:function(e){return this._state=e,this}},{key:"nextState",value:function(e){return this._next=e,this}},{key:"while",value:function(e){return this._end=e,this}},{key:"build",value:function(){if([this._state,this._next,this._end].some((function(e){return null==e})))throw new Error("Animator properties are missing");return new c(this._state,this._next,this._end)}}]),e}()},function(e,t){e.exports=require("@material-ui/icons/Settings")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("@material-ui/core/CircularProgress")},function(e,t){e.exports=require("@material-ui/core/colors")},function(e,t){e.exports=require("roslib")},function(e,t,n){"use strict";(function(e){var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),s=n.n(c),u=n(39),l=n(53),f=n(24),d=n(11),h=n(20),m=n(29),p=n(42),v=n(56),g=n.n(v),y=h.b.CLOUD_FUNCTION_NAME,b=function(){function t(n,o){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.alert;r()(this,t),s()(this,"getNodeFromTree",(function(e,t){return new u.a(t).getNode((function(t){return e===t.title}))})),s()(this,"getParentFromChild",(function(e,t){return new u.a(t).getParentNode((function(t){return e===t.title}))})),s()(this,"deleteNodeFromTreeUsingName",(function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return a.getNodeFromTree(e,t).forEach((function(o){l.a.dispose(o),n&&a.deleteNodeInServer(e),a.getParentFromChild(e,t).forEach((function(t){t.children=t.children.filter((function(t){return t.title!==e}))})),t=t.filter((function(t){return t.title!==e}))})),t})),s()(this,"getNodeFromTreeWithPredicate",(function(e,t){return new u.a(t).getNode(e)})),s()(this,"addNodeItem2Tree",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.b.NAME,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];a.deleteNodeFromTreeUsingName(t.name,e,o);var i=a.staticNodeTypes.includes(t.getType()),c=l.a.builder().title(t.name).item(t).isVisible(r).isStatic(i).build();if(n){var s=a.getNodeFromTree(n,e);s.forEach((function(e){o&&a.addNodeItem2Server(c,e.title),e.children.push(c)}))}else e.push(c),o&&a.addNodeItem2Server(c,null);return e})),s()(this,"lostConnection",(function(){a.undoManager.undo({is2UpdateInServer:!1}),e((function(){a.alert("Sorry, work not saved. Please check internet connection","error")}))})),s()(this,"updateNodeInServer",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("updateNodeInServer!",e,a.sceneName),a.getNodeFromTree(e,n).forEach((function(r){var i=a.getParentFromChild(e,n).map((function(e){return e.title})).orNull();d.MasterDB.cloudFunction(y,"updateNode",[l.a.toDict(r),i,o,a.sceneName],(function(e){console.log("Update node with success?",e.success,e.error)})).catch((function(n){console.warn("Update node error",e,n),t.undoAction(a)}))}))})),s()(this,"addNodeItem2Server",(function(e,n){d.MasterDB.cloudFunction(y,"addNodeItem",[l.a.toDict(e),n,a.sceneName],(function(e){console.log("Add node with success?",e.success)})).catch((function(n){console.warn("Add node error",e.title,n),t.undoAction(a)}))})),s()(this,"deleteNodeInServer",(function(e){d.MasterDB.cloudFunction(y,"deleteNodeByName",[e,a.sceneName],(function(e){console.log("Deleted node with success?",e.success)})).catch((function(n){console.warn("Deleted node error",e,n),t.undoAction(a)}))})),this.sceneName=n,this.undoManager=o,this.alert=function(e,t){return i(e,t)},this.staticNodeTypes=[m.a.TYPE,p.a.TYPE]}return i()(t,null,[{key:"ofScene",value:function(e,n,o){return new t(e,n,o)}}]),t}();s()(b,"undoAction",g()((function(e){return e.lostConnection()}),500)),t.a=b}).call(this,n(139).setImmediate)},function(e,t){e.exports=require("@material-ui/core/InputAdornment")},function(e,t){e.exports=require("@material-ui/core/ListItemText")},function(e,t){e.exports=require("@material-ui/core/Checkbox")},function(e,t){e.exports=require("@material-ui/pickers")},function(e,t){e.exports=require("react-virtualized")},function(e,t){e.exports=require("lodash/set")},function(e,t){e.exports=require("lodash/cloneDeep")},function(e,t){e.exports=require("i18next")},function(e,t){e.exports=require("@material-ui/core/List")},function(e,t){e.exports=require("lodash/capitalize")},function(e,t){e.exports=require("@material-ui/core/TableCell")},function(e,t){e.exports=require("@material-ui/core/FormHelperText")},function(e,t){e.exports=require("@material-ui/lab/Alert")},function(e,t,n){"use strict";var o,r=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function c(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function s(e,t){for(var n={},o=[],r=0;r<e.length;r++){var a=e[r],s=t.base?a[0]+t.base:a[0],u=n[s]||0,l="".concat(s," ").concat(u);n[s]=u+1;var f=c(l),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==f?(i[f].references++,i[f].updater(d)):i.push({identifier:l,updater:v(d,t),references:1}),o.push(l)}return o}function u(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var r=n.nc;r&&(o.nonce=r)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,f=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function d(e,t,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=f(t,r);else{var a=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function h(e,t,n){var o=n.css,r=n.media,a=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var m=null,p=0;function v(e,t){var n,o,r;if(t.singleton){var a=p++;n=m||(m=u(t)),o=d.bind(null,n,a,!1),r=d.bind(null,n,a,!0)}else n=u(t),o=h.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var n=s(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var r=c(n[o]);i[r].references--}for(var a=s(e,t),u=0;u<n.length;u++){var l=c(n[u]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}n=a}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var r=(i=o,c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),"/*# ".concat(s," */")),a=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(a).concat([r]).join("\n")}var i,c,s;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(o)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(var c=0;c<e.length;c++){var s=[].concat(e[c]);o&&r[s[0]]||(n&&(s[2]?s[2]="".concat(n," and ").concat(s[2]):s[2]=n),t.push(s))}},t}},function(e,t){e.exports=require("react-i18next")},function(e){e.exports=JSON.parse('{"Save":"Save","Ports":"Ports","Invalid data type":"Invalid data type","Create New":"Create New","Workspace":"Workspace","Could not load workspaces":"Could not load workspaces","Name":"Name","Version":"Version","User":"User","Search":"Search","Annotations":"Annotations","Annotation":"Annotation","Callbacks":"Callbacks","Callback":"Callback","Configurations":"Configurations","Configuration":"Configuration","Flows":"Flows","Flow":"Flow","Nodes":"Nodes","Node":"Node","Layouts":"Layouts","Layout":"Layout","Scenes":"Scenes","Scene":"Scene","Key":"Key","key":"key","Value":"Value","Accept":"Accept","Cancel":"Cancel","not found":"not found","Ok":"Ok","Yes":"Yes","No":"No","Message":"Message","Edit Message":"Edit Message","Submit":"Submit","Load":"Load","Nothing selected":"Nothing selected","an":"an","a":"a","Select":"Select","Document":"Document","Are you sure?":"Are you sure?","Insert Text here":"Insert Text here","Confirm":"Confirm"}')},function(e){e.exports=JSON.parse('{"Save":"Gravar","Ports":"Portas","Invalid data type":"Tipo de dado inválido","Create New":"Criar Novo","Workspace":"Área de trabalho","Could not load workspaces":"Não foi possível carregar os espaços de trabalho","Name":"Nome","Version":"Versão","User":"Usuário","Search":"Procurar","Annotations":"Anotações","Annotation":"Anotação","Callbacks":"Revogações","Callback":"Revogação","Configurations":"Configurações","Configuration":"Configuração","Flows":"Fluxos","Flow":"Fluxo","Nodes":"Nós","Node":"Nó","Layouts":"Disposições","Layout":"Disposição","Scenes":"Cenários","Scene":"Cenário","Key":"Chave","key":"chave","Value":"Valor","Accept":"Aceitar","Cancel":"Cancelar","not found":"not found","Ok":"Ok","Yes":"Sim","No":"Não","Message":"Mensagem","Edit Message":"Editar Mensagem","Submit":"Enviar","Load":"Carregar","Nothing selected":"Nada selecionado","an":"um","a":"um","Select":"Selecione","Document":"Documento","Are you sure?":"Tens a certeza?","Insert Text here":"Inserir texto aqui","Confirm":"Confirmar"}')},function(e,t){e.exports=require("@material-ui/icons/Schedule")},function(e,t){e.exports=require("@material-ui/icons/Warning")},function(e,t){e.exports=require("@material-ui/icons/ViewModule")},function(e,t){e.exports=require("@material-ui/icons/Chat")},function(e,t){e.exports=require("@material-ui/core/Drawer")},function(e,t){e.exports=require("@material-ui/core/Collapse")},function(e,t){e.exports=require("material-table")},function(e,t){e.exports=require("@material-ui/icons/AddBox")},function(e,t){e.exports=require("@material-ui/icons/ArrowDownward")},function(e,t){e.exports=require("@material-ui/icons/Check")},function(e,t){e.exports=require("@material-ui/icons/ChevronLeft")},function(e,t){e.exports=require("@material-ui/icons/DeleteOutline")},function(e,t){e.exports=require("@material-ui/icons/Edit")},function(e,t){e.exports=require("@material-ui/icons/FilterList")},function(e,t){e.exports=require("@material-ui/icons/FirstPage")},function(e,t){e.exports=require("@material-ui/icons/LastPage")},function(e,t){e.exports=require("@material-ui/icons/Remove")},function(e,t){e.exports=require("@material-ui/icons/SaveAlt")},function(e,t){e.exports=require("@material-ui/icons/ViewColumn")},function(e,t){e.exports=require("@material-ui/core/Tabs")},function(e,t){e.exports=require("@material-ui/core/Tab")},function(e,t){e.exports=require("@material-ui/core/TextField")},function(e,t){e.exports=require("@material-ui/core/FormControlLabel")},function(e,t){e.exports=require("@material-ui/core/Switch")},function(e,t){e.exports=require("@material-ui/core/InputBase")},function(e,t){e.exports=require("@material-ui/core/Breadcrumbs")},function(e,t){e.exports=require("@material-ui/icons/NavigateNext")},function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' version='1.0' width='400.000000' height='400.000000' preserveAspectRatio='xMidYMid meet'%3E%3Crect id='backgroundrect' width='100%25' height='100%25' x='0' y='0' fill='none' stroke='none'/%3E %3Cg class='currentLayer' style=''%3E%3Ctitle%3ELayer 1%3C/title%3E%3Cg transform='translate(0,400) scale(0.10000000149011612,-0.10000000149011612) ' fill='%23d31b1b' stroke='none' id='svg_1' class='' fill-opacity='1'%3E %3Cpath d='M1770 3990 c-682 -83 -1271 -501 -1570 -1115 -103 -211 -167 -437 -191 -673 -14 -129 -6 -404 14 -522 85 -495 339 -929 729 -1242 232 -187 539 -332 836 -393 957 -199 1909 314 2272 1224 204 512 180 1116 -64 1606 -115 232 -229 387 -412 565 -296 286 -639 460 -1059 536 -106 19 -443 27 -555 14z m-998 -1105 c3 -3 -23 -48 -57 -99 -113 -172 -182 -338 -226 -546 -32 -149 -33 -448 -1 -593 31 -145 70 -258 134 -387 65 -132 64 -140 -28 -140 -66 0 -100 13 -143 53 -74 70 -71 38 -71 748 0 555 2 642 16 690 43 144 129 236 248 265 54 13 119 18 128 9z m2621 -21 c99 -34 192 -157 216 -288 14 -78 15 -1256 1 -1307 -13 -48 -82 -125 -124 -139 -55 -18 -166 -12 -166 9 0 4 25 57 55 118 195 391 215 839 55 1247 -41 105 -117 247 -176 327 -18 25 -30 49 -26 54 10 11 109 -2 165 -21z m-251 -61 c128 -170 217 -370 265 -594 13 -63 18 -129 18 -264 0 -199 -13 -285 -66 -448 -33 -101 -114 -277 -128 -277 -26 0 -31 80 -32 549 0 267 -4 495 -8 505 -6 16 -20 4 -87 -77 -43 -53 -81 -96 -84 -96 -3 -1 -16 41 -29 92 -27 106 -74 215 -132 304 -32 48 -38 66 -31 80 34 61 243 273 271 273 4 0 23 -21 43 -47z m-2206 15 c52 -39 95 -82 171 -170 l74 -88 -42 -61 c-23 -34 -54 -89 -69 -123 -35 -76 -80 -219 -80 -252 0 -13 -4 -24 -8 -24 -4 0 -43 43 -87 95 -43 52 -83 95 -87 95 -4 0 -8 -224 -9 -497 0 -492 -5 -565 -34 -565 -16 0 -94 166 -130 279 -52 159 -69 294 -62 493 8 230 47 384 147 585 56 112 154 255 174 255 7 0 26 -10 42 -22z m458 -511 l133 -157 -20 -58 c-13 -39 -19 -85 -19 -147 -1 -150 44 -260 151 -365 107 -105 214 -150 361 -150 241 0 443 162 500 399 16 69 8 222 -15 278 l-17 43 132 157 c73 87 136 159 140 161 24 9 119 -186 148 -303 11 -44 22 -104 25 -134 l4 -54 -329 -388 c-343 -405 -362 -424 -466 -455 -101 -31 -258 -12 -341 41 -48 29 -83 69 -607 691 -52 62 -94 121 -94 131 0 52 33 202 60 271 33 86 99 204 112 200 5 -2 68 -74 142 -161z m376 -444 c85 -102 167 -194 182 -204 62 -45 81 -30 292 224 76 92 142 165 146 162 13 -8 20 -110 10 -167 -27 -170 -153 -299 -324 -334 -130 -27 -257 9 -356 102 -61 57 -116 162 -125 239 -8 57 1 165 13 164 4 0 77 -84 162 -186z' id='svg_2' fill='%23d31b1b' fill-opacity='1'/%3E %3C/g%3E%3C/g%3E%3C/svg%3E"},function(e,t){e.exports=require("earcut")},function(e,t){e.exports=require("@babylonjs/core/Maths/math")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("lodash.isequal")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/toArray")},function(e,t){e.exports=require("@material-ui/core/utils")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/taggedTemplateLiteral")},function(e,t){e.exports=require("styled-components")},function(e,t){e.exports=require("@material-ui/core/styles/colorManipulator")},function(e,t){e.exports=require("@material-ui/icons/Label")},function(e,t){e.exports=require("@material-ui/core/Chip")},function(e,t){e.exports=require("@material-ui/icons/Add")},function(e,t){e.exports=require("@material-ui/icons/Today")},function(e,t){e.exports=require("@date-io/date-fns")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/typeof")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' version='1.0' width='400.000000' height='400.000000' preserveAspectRatio='xMidYMid meet'%3E%3Crect id='backgroundrect' width='100%25' height='100%25' x='0' y='0' fill='none' stroke='none'/%3E %3Cg class='currentLayer' style=''%3E%3Ctitle%3ELayer 1%3C/title%3E%3Cg transform='translate(0,400) scale(0.10000000149011612,-0.10000000149011612) ' fill='%23d31b1b' stroke='none' id='svg_1' class='' fill-opacity='1'%3E %3Cpath d='M1770 3990 c-682 -83 -1271 -501 -1570 -1115 -103 -211 -167 -437 -191 -673 -14 -129 -6 -404 14 -522 85 -495 339 -929 729 -1242 232 -187 539 -332 836 -393 957 -199 1909 314 2272 1224 204 512 180 1116 -64 1606 -115 232 -229 387 -412 565 -296 286 -639 460 -1059 536 -106 19 -443 27 -555 14z m-998 -1105 c3 -3 -23 -48 -57 -99 -113 -172 -182 -338 -226 -546 -32 -149 -33 -448 -1 -593 31 -145 70 -258 134 -387 65 -132 64 -140 -28 -140 -66 0 -100 13 -143 53 -74 70 -71 38 -71 748 0 555 2 642 16 690 43 144 129 236 248 265 54 13 119 18 128 9z m2621 -21 c99 -34 192 -157 216 -288 14 -78 15 -1256 1 -1307 -13 -48 -82 -125 -124 -139 -55 -18 -166 -12 -166 9 0 4 25 57 55 118 195 391 215 839 55 1247 -41 105 -117 247 -176 327 -18 25 -30 49 -26 54 10 11 109 -2 165 -21z m-251 -61 c128 -170 217 -370 265 -594 13 -63 18 -129 18 -264 0 -199 -13 -285 -66 -448 -33 -101 -114 -277 -128 -277 -26 0 -31 80 -32 549 0 267 -4 495 -8 505 -6 16 -20 4 -87 -77 -43 -53 -81 -96 -84 -96 -3 -1 -16 41 -29 92 -27 106 -74 215 -132 304 -32 48 -38 66 -31 80 34 61 243 273 271 273 4 0 23 -21 43 -47z m-2206 15 c52 -39 95 -82 171 -170 l74 -88 -42 -61 c-23 -34 -54 -89 -69 -123 -35 -76 -80 -219 -80 -252 0 -13 -4 -24 -8 -24 -4 0 -43 43 -87 95 -43 52 -83 95 -87 95 -4 0 -8 -224 -9 -497 0 -492 -5 -565 -34 -565 -16 0 -94 166 -130 279 -52 159 -69 294 -62 493 8 230 47 384 147 585 56 112 154 255 174 255 7 0 26 -10 42 -22z m458 -511 l133 -157 -20 -58 c-13 -39 -19 -85 -19 -147 -1 -150 44 -260 151 -365 107 -105 214 -150 361 -150 241 0 443 162 500 399 16 69 8 222 -15 278 l-17 43 132 157 c73 87 136 159 140 161 24 9 119 -186 148 -303 11 -44 22 -104 25 -134 l4 -54 -329 -388 c-343 -405 -362 -424 -466 -455 -101 -31 -258 -12 -341 41 -48 29 -83 69 -607 691 -52 62 -94 121 -94 131 0 52 33 202 60 271 33 86 99 204 112 200 5 -2 68 -74 142 -161z m376 -444 c85 -102 167 -194 182 -204 62 -45 81 -30 292 224 76 92 142 165 146 162 13 -8 20 -110 10 -167 -27 -170 -153 -299 -324 -334 -130 -27 -257 9 -356 102 -61 57 -116 162 -125 239 -8 57 1 165 13 164 4 0 77 -84 162 -186z' id='svg_2' fill='%23d31b1b' fill-opacity='1'/%3E %3C/g%3E%3C/g%3E%3C/svg%3E"},function(e,t){e.exports=require("@material-ui/core/Paper")},function(e,t){e.exports=require("react-virtualized-tree")},function(e,t){e.exports=require("@material-ui/core/Box")},function(e,t){e.exports=require("@material-ui/core/Backdrop")},function(e,t){e.exports=require("@material-ui/styles")},function(e,t){e.exports=require("jwt-decode")},function(e,t){e.exports=require("@babylonjs/core/Debug/debugLayer")},function(e,t){e.exports=require("@babylonjs/inspector")},function(e,t){e.exports=require("@babylonjs/loaders")},function(e,t,n){(function(e){var o=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(r.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new a(r.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(141),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(140))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=require("setimmediate")},function(e,t,n){var o=n(80),r=n(143);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};o(r,a);e.exports=r.locals||{}},function(e,t,n){(t=n(81)(!1)).push([e.i,"body.react-confirm-alert-body-element {\n  overflow: hidden;\n}\n\n.react-confirm-alert-blur {\n  filter: url(#gaussian-blur);\n  filter: blur(2px);\n  -webkit-filter: blur(2px);\n}\n\n.react-confirm-alert-overlay {\n  position: fixed;\n  top: calc(100vh - 300px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 99;\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  -ms-align-items: center;\n  align-items: flex-end;\n  opacity: 1;\n}\n\n.react-confirm-alert-body {\n  width: 400px;\n  padding: 30px;\n}\n\n.react-confirm-alert-svg {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.react-confirm-alert-body > h1 {\n  margin-top: 0;\n}\n\n.react-confirm-alert-body > h3 {\n  margin: 0;\n  font-size: 16px;\n}\n\n.react-confirm-alert-button-group {\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  margin-top: 20px;\n}\n\n.react-confirm-alert-button-group > button {\n  outline: none;\n  background: #333;\n  border: none;\n  display: inline-block;\n  padding: 6px 18px;\n  color: #eee;\n  margin-right: 10px;\n  border-radius: 5px;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.icon-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.icon-container:hover {\n  cursor: pointer;\n}\n",""]),e.exports=t},function(e,t){e.exports=require("fontsource-roboto")},function(e,t){e.exports=require("fontsource-open-sans")},function(e,t,n){var o=n(80),r=n(147);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};o(r,a);e.exports=r.locals||{}},function(e,t,n){(t=n(81)(!1)).push([e.i,".flow-action {\n  display: flex;\n  background: transparent;\n  width: 35px;\n  height: 35px;\n  margin: 6px;\n  border-radius: 50%;\n  justify-content: center;\n  align-items: center;\n  transition: background-color 0.5s;\n}\n\n.flow-action:hover {\n  background: rgba(11, 106, 138, 0.2);\n  cursor: pointer;\n}\n\n.robot-logs-container {\n  display: flex;\n  flex-direction: column;\n  height: 1px;\n  flex-grow: 1;\n}\n\n.tree-grow-overflow {\n  flex-grow: 0.5;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.logs-grow-overflow {\n  flex-grow: 1;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.saving {\n  /* font-size: 40px; */\n  margin: 0;\n}\n\n.saving span {\n  font-size: 15px;\n  animation-name: blink;\n  animation-duration: 1.4s;\n  animation-iteration-count: infinite;\n  animation-fill-mode: both;\n}\n\n.saving span:nth-child(2) {\n  animation-delay: 0.2s;\n}\n\n.saving span:nth-child(3) {\n  animation-delay: 0.4s;\n}\n\n@keyframes blink {\n  0% {\n    opacity: 0.2;\n  }\n  20% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0.2;\n  }\n}\n\n.MuiPickersToolbarButton-toolbarBtn {\n  padding: 0 !important;\n  min-width: 16px !important;\n  margin: 0 !important;\n  text-transform: none !important;\n}\n",""]),e.exports=t},function(e,t){e.exports=require("material-icons/css/material-icons.css")},function(e,t){e.exports=require("react-virtualized/styles.css")},function(e,t){e.exports=require("react-virtualized-tree/lib/main.css")},function(e,t,n){"use strict";n.r(t),n.d(t,"withOfflineValidation",(function(){return gs})),n.d(t,"withAuthentication",(function(){return As})),n.d(t,"Button",(function(){return l})),n.d(t,"AbstractModal",(function(){return T})),n.d(t,"ConfirmAlertModal",(function(){return R})),n.d(t,"SelectScopeModal",(function(){return ds})),n.d(t,"RobotLogModal",(function(){return fe})),n.d(t,"Drawer",(function(){return pe})),n.d(t,"Collapse",(function(){return Ce})),n.d(t,"VerticalBar",(function(){return Ne})),n.d(t,"ContextMenu",(function(){return Fe})),n.d(t,"Table",(function(){return gt})),n.d(t,"Tabs",(function(){return Ct})),n.d(t,"Text",(function(){return Tt})),n.d(t,"Themes",(function(){return mi})),n.d(t,"Toggle",(function(){return zt})),n.d(t,"SearchInput",(function(){return _t})),n.d(t,"Breadcrumb",(function(){return $t})),n.d(t,"SceneViewer",(function(){return Da})),n.d(t,"Select",(function(){return Wa})),n.d(t,"snackbar",(function(){return ii})),n.d(t,"Style",(function(){return yi})),n.d(t,"Logs",(function(){return Mc})),n.d(t,"FilterIcon",(function(){return Pi})),n.d(t,"LoginForm",(function(){return Rc})),n.d(t,"ProfileMenu",(function(){return jc}));var o=n(0),r=n.n(o),a=n(54),i=n.n(a),c=n(4),s=n.n(c),u=function(e){return r.a.createElement(i.a,{className:e.className,style:e.style,onClick:e.onClick,color:e.color,variant:e.variant,size:e.size,startIcon:e.startIcon,disabled:e.disabled},e.children)};u.propTypes={style:s.a.object,onClick:s.a.func,color:s.a.string,variant:s.a.string.isRequired,size:s.a.string,startIcon:s.a.element,children:s.a.node.isRequired,disabled:s.a.bool},u.defaultProps={style:{},onClick:function(){return console.log("Click MOV.AI button")},color:"default",variant:"contained",size:"medium",startIcon:void 0,children:r.a.createElement("div",null),disabled:!1};var l=u,f=n(1),d=n.n(f),h=n(55),m=n.n(h),p=n(19),v=n(56),g=n.n(v),y=n(12),b=n(74),A=n.n(b),w=n(82),M=n(83),E=n(84),x=void 0===window.SERVER_DATA||void 0===window.SERVER_DATA.Languages?{en:{translation:M},pt:{translation:E}}:window.SERVER_DATA.Languages,P=void 0===window.SERVER_DATA||void 0===window.SERVER_DATA.Language?"en":window.SERVER_DATA.Language;A.a.use(w.initReactI18next).init({resources:x,lng:P,fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1}});var k=A.a;function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var O=Object(p.makeStyles)((function(e){return{card:{margin:"auto",position:"absolute",overflow:"auto",display:"flex",flexDirection:"column",maxHeight:"98%"},closeButton:{cursor:"pointer",position:"absolute",color:e.textColor,top:15,right:15,"&:hover":{color:"gray"}}}})),N=function(e){var t=O(),n=g()((function(){e.onSubmit()}),50),o=function(){n()},a=function(){e.onCancel()};return r.a.createElement(y.Modal,{onKeyPress:function(e){"Enter"===e.key&&o()},open:e.open,onClose:a,style:{display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(y.Card,{className:t.card,style:S(S({},e.style),{},{minWidth:e.width,minHeight:e.height})},r.a.createElement(y.CardContent,{style:{flexGrow:1,maxHeight:"calc(100% - 70px)",overflowY:"auto"}},r.a.createElement(y.Typography,{variant:"h5"},e.title),r.a.createElement(y.Typography,{component:"div",className:t.closeButton,onClick:function(){return e.onCancel()}},r.a.createElement(m.a,null)),r.a.createElement(y.Divider,{style:{marginBottom:"12px"}}),r.a.createElement("div",{style:{maxHeight:"calc(100% - 35px)",overflowY:"auto",paddingTop:5}},e.children)),r.a.createElement(y.Divider,null),r.a.createElement(y.CardActions,null,e.hasSubmitButton&&r.a.createElement(y.Button,{color:e.submitColor,onClick:o},"".concat(k.t(e.submitText))),e.hasCancelButton&&r.a.createElement(y.Button,{onClick:a,color:e.cancelColor},"".concat(k.t(e.cancelText))))))};N.propTypes={onSubmit:s.a.func,onCancel:s.a.func,open:s.a.bool,title:s.a.string,submitText:s.a.string,submitColor:s.a.string,cancelText:s.a.string,cancelColor:s.a.string,width:s.a.string,height:s.a.string,style:s.a.object,hasSubmitButton:s.a.bool,hasCancelButton:s.a.bool},N.defaultProps={onSubmit:function(){},onCancel:function(){},open:!1,title:"New",submitText:"Confirm",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary",width:"25%",height:"25%",style:{},hasSubmitButton:!0,hasCancelButton:!0};var T=N,I=function(e){return r.a.createElement(T,{onSubmit:e.onSubmit,onCancel:e.onCancel,open:e.open,title:e.title,submitText:e.submitText,submitColor:e.submitColor,cancelText:e.cancelText,cancelColor:e.cancelColor},r.a.createElement("div",null,e.message),r.a.createElement("div",null,e.children))};I.propTypes={title:s.a.string,message:s.a.string,onSubmit:s.a.func,onCancel:s.a.func,open:s.a.bool,submitText:s.a.string,submitColor:s.a.string,cancelText:s.a.string,cancelColor:s.a.string},I.defaultProps={title:"Insert Text here",message:"Are you sure?",onSubmit:function(){},onCancel:function(){},open:!1,submitText:"Delete",submitColor:"secondary",cancelText:"Cancel",cancelColor:"primary"};var R=I,B=n(7),D=n.n(B),F=n(9),L=n.n(F),j=n(3),V=n.n(j),U=n(15),z=n.n(U),G=n(13),K=n.n(G),W=n(6),q=n.n(W),_=n(75),H=n.n(_),Y=n(48),Q=n.n(Y),Z=n(36),X=n.n(Z),J=n(32),$=n.n(J),ee=n(85),te=n.n(ee),ne=n(86),oe=n.n(ne),re=n(87),ae=n.n(re),ie=n(88),ce=n.n(ie),se=n(11);function ue(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var le=function(e){z()(n,e);var t=ue(n);function n(){var e;D()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(V()(e),"state",{data:{},open:!1,hasButton:!1}),d()(V()(e),"open",(function(t){var n=e.state.data,o=new Date(1e3*t.time),r=t.button?JSON.parse(t.button.replace(/'/g,'"')):null;n.time="".concat(o.toLocaleTimeString("pt")),n.action=t.action,n.message=t.message,n.robot=t.robot,n.service=t.service,n.module=t.module,r&&(n.buttonText=r.label,n.buttonAction=e.getRobotAlertAction(r)),e.setState({data:n,open:!0,hasButton:!!r})})),d()(V()(e),"getRobotAlertAction",(function(t){var n=t.callback,o=t.data;return n?function(){se.MasterDB.cloudFunction(n,"",o,(function(t){e.setState({open:!1})}))}:function(){return e.setState({open:!1})}})),d()(V()(e),"renderAlertInfo",(function(){var t=e.state.data,n=e.props,o=n.props,a=n.classes;return r.a.createElement($.a,{component:"div"},r.a.createElement(H.a,{style:{width:"100%"}},r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemAvatar,null,r.a.createElement(Q.a,null,r.a.createElement("i",{className:"fas fa-robot"}))),r.a.createElement(y.ListItemText,{primary:t.robot})),r.a.createElement(X.a,{variant:"inset",component:"li"}),r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemAvatar,null,r.a.createElement(Q.a,null,r.a.createElement(te.a,null))),r.a.createElement(y.ListItemText,{primary:t.time})),r.a.createElement(X.a,{variant:"inset",component:"li"}),o.includes("service")&&r.a.createElement("div",null,r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemAvatar,null,r.a.createElement(Q.a,null,r.a.createElement(oe.a,null))),r.a.createElement(y.ListItemText,{primary:t.service,className:a.breakWord})),r.a.createElement(X.a,{variant:"inset",component:"li"})),o.includes("module")&&r.a.createElement("div",null,r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemAvatar,null,r.a.createElement(Q.a,null,r.a.createElement(ae.a,null))),r.a.createElement(y.ListItemText,{primary:t.module,className:a.breakWord})),r.a.createElement(X.a,{variant:"inset",component:"li"})),r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemAvatar,null,r.a.createElement(Q.a,null,r.a.createElement(ce.a,null))),r.a.createElement(y.ListItemText,{primary:t.message,className:a.breakWord}))),t.action&&r.a.createElement("div",null,r.a.createElement(X.a,null),r.a.createElement(H.a,{style:{width:"100%"}},r.a.createElement(y.ListItem,null,r.a.createElement(y.ListItemText,{primary:t.action,className:a.breakWord})))))})),e}return L()(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.data,o=t.open,a=t.hasButton,i=this.props.title;return r.a.createElement(T,{open:o,title:i,style:{maxWidth:500},onCancel:function(){return e.setState({open:!1})},onSubmit:n.buttonAction,submitText:n.buttonText,submitColor:"primary",hasSubmitButton:a,hasCancelButton:!1},this.renderAlertInfo())}}]),n}(o.Component);le.propTypes={title:s.a.string,props:s.a.array},le.defaultProps={title:"Log Details",props:[]};var fe=Object(p.withStyles)((function(e){return{breakWord:{wordBreak:"break-all"}}}),{withTheme:!0})(le),de=n(89),he=n.n(de),me=function(e){return r.a.createElement(he.a,{style:e.style,anchor:e.anchor,open:e.open,onClose:e.onClose},e.children)};me.propTypes={style:s.a.object,anchor:s.a.string,open:s.a.bool,children:s.a.object},me.defaultProps={style:{},anchor:"left",open:!1,children:r.a.createElement("div",null)},me.ANCHOR={left:"left",right:"right",top:"top",bottom:"bottom"};var pe=me,ve=n(18),ge=n.n(ve),ye=n(41),be=n.n(ye),Ae=n(57),we=n.n(Ae),Me=n(90),Ee=n.n(Me);function xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke=function(e){var t=r.a.useState(e.open),n=ge()(t,2),o=n[0],a=n[1];r.a.useEffect((function(){e.open!==o&&a(e.open)}),[e.open]);var i;return r.a.createElement(y.List,null,r.a.createElement(y.ListItem,{button:!0,onClick:(i=e.onClick,function(){a(!o),i()})},o?r.a.createElement(we.a,{style:Pe({},e.iconStyle)}):r.a.createElement(be.a,{style:Pe({},e.iconStyle)}),r.a.createElement("div",{style:{width:"100%"}},e.item)),e.divided?r.a.createElement(y.Divider,null):[],r.a.createElement(Ee.a,{className:e.className,style:e.style,in:o},e.children))};ke.propTypes={item:s.a.object,onClick:s.a.func,open:s.a.bool,divided:s.a.bool,iconStyle:s.a.object},ke.defaultProps={item:r.a.createElement("div",null),onClick:function(){},open:!1,divided:!1,style:{},iconStyle:{}};var Ce=ke,Se=Object(p.makeStyles)((function(e){return{container:{width:65,height:"100%",display:"flex",flexDirection:"column",backgroundColor:function(e){return e.backgroundColor}},logoArea:{padding:"17px",textAlign:"center",alignItems:"center",justifyContent:"center"},navigationArea:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center"},accountArea:{padding:function(e){return e.unsetAccountAreaPadding?"unset":"17px"},textAlign:"center",alignItems:"center",justifyContent:"center"}}})),Oe=function(e){var t=Se(e);return r.a.createElement("div",{className:t.container},r.a.createElement("div",{className:t.logoArea},e.upperElement),r.a.createElement("div",{className:t.navigationArea},e.navigationList.map((function(e,t){return r.a.createElement("div",{key:t,style:{padding:"15px 0px"}},e)}))),r.a.createElement("div",{className:t.accountArea},e.lowerElement))};Oe.propTypes={upperElement:s.a.node,navigationList:s.a.array,lowerElement:s.a.node.isRequired,backgroundColor:s.a.string,unsetAccountAreaPadding:s.a.bool},Oe.defaultProps={upperElement:r.a.createElement("div",null),navigationList:[r.a.createElement("div",null)],lowerElement:r.a.createElement("div",null),backgroundColor:"#424242",unsetAccountAreaPadding:!1};var Ne=Oe,Te=n(45),Ie=n.n(Te),Re=n(30),Be=n.n(Re),De=function(e){var t=e.style,n=r.a.useState(null),o=ge()(n,2),a=o[0],i=o[1],c=function(){i(null)};return r.a.createElement("div",{style:t},r.a.cloneElement(e.element,{onClick:function(t){void 0!==e.element.props.onClick&&e.element.props.onClick(),i(t.currentTarget)}}),r.a.createElement(Ie.a,{id:"simple-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:c},e.menuList.reduce((function(e,t,n){return t&&"function"!=typeof t&&e.push(r.a.createElement(Be.a,{onClick:function(){t.onClick(),(t.onClose||void 0===t.onClose)&&c()},key:n},t.element)),e}),[])))};De.propTypes={element:s.a.node.isRequired,navigationList:s.a.array,lowerElement:s.a.node.isRequired,width:s.a.string,backgroundColor:s.a.string},De.defaultProps={element:r.a.createElement("div",null,"Ahaha"),menuList:[{onClick:function(){return console.log("clicked 1")},element:"Profile",onClose:!0}],lowerElement:r.a.createElement("div",null),width:"68px",backgroundColor:"#424242",style:{}};var Fe=De,Le=n(14),je=n.n(Le),Ve=n(91),Ue=n.n(Ve),ze=n(92),Ge=n.n(ze),Ke=n(93),We=n.n(Ke),qe=n(94),_e=n.n(qe),He=n(95),Ye=n.n(He),Qe=n(50),Ze=n.n(Qe),Xe=n(96),Je=n.n(Xe),$e=n(97),et=n.n($e),tt=n(98),nt=n.n(tt),ot=n(99),rt=n.n(ot),at=n(100),it=n.n(at),ct=n(101),st=n.n(ct),ut=n(102),lt=n.n(ut),ft=n(38),dt=n.n(ft),ht=n(103),mt=n.n(ht),pt={Add:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ge.a,je()({},e,{ref:t}))})),Check:Object(o.forwardRef)((function(e,t){return r.a.createElement(_e.a,je()({},e,{ref:t}))})),Clear:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ze.a,je()({},e,{ref:t}))})),Delete:Object(o.forwardRef)((function(e,t){return r.a.createElement(Je.a,je()({},e,{ref:t}))})),DetailPanel:Object(o.forwardRef)((function(e,t){return r.a.createElement(be.a,je()({},e,{ref:t}))})),Edit:Object(o.forwardRef)((function(e,t){return r.a.createElement(et.a,je()({},e,{ref:t}))})),Export:Object(o.forwardRef)((function(e,t){return r.a.createElement(lt.a,je()({},e,{ref:t}))})),Filter:Object(o.forwardRef)((function(e,t){return r.a.createElement(nt.a,je()({},e,{ref:t}))})),FirstPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(rt.a,je()({},e,{ref:t}))})),LastPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(it.a,je()({},e,{ref:t}))})),NextPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(be.a,je()({},e,{ref:t}))})),PreviousPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ye.a,je()({},e,{ref:t}))})),ResetSearch:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ze.a,je()({},e,{ref:t}))})),Search:Object(o.forwardRef)((function(e,t){return r.a.createElement(dt.a,je()({},e,{ref:t}))})),SortArrow:Object(o.forwardRef)((function(e,t){return r.a.createElement(We.a,je()({},e,{ref:t}))})),ThirdStateCheck:Object(o.forwardRef)((function(e,t){return r.a.createElement(st.a,je()({},e,{ref:t}))})),ViewColumn:Object(o.forwardRef)((function(e,t){return r.a.createElement(mt.a,je()({},e,{ref:t}))}))},vt=function(e){return r.a.createElement(Ue.a,{style:e.style,title:e.title,columns:e.columns,data:e.data,icons:pt,actions:e.actions,options:e.options,components:e.components,localization:e.localization})};vt.propTypes={style:s.a.object,title:s.a.string,columns:s.a.array,data:s.a.array,actions:s.a.array,options:s.a.object,components:s.a.object,localization:s.a.object},vt.defaultProps={style:{},title:"",columns:[],data:[],actions:[],options:{actionsColumnIndex:-1,draggable:!1,grouping:!1,search:!1,toolbar:!1,searchFieldAlignment:"left",paging:!1},components:{}};var gt=vt,yt=n(31),bt=n.n(yt),At=n(104),wt=n.n(At),Mt=n(105),Et=n.n(Mt),xt=["children","selectedTab","index"];function Pt(e){var t=e.children,n=e.selectedTab,o=e.index,a=bt()(e,xt);return r.a.createElement($.a,je()({component:"div",role:"tabpanel",hidden:n!==o,id:"tabpanel-".concat(o),"aria-labelledby":"tab-".concat(o)},a),n===o&&t)}Pt.propTypes={children:s.a.node,index:s.a.any.isRequired,selectedTab:s.a.any.isRequired};var kt=Object(p.makeStyles)((function(e){return{root:{flexGrow:1,height:"100%"},tabPanel:{flexGrow:1,minHeight:0,height:"calc(100% - 48px)",overflowY:"auto"}}}));function Ct(e){var t=kt(),n=r.a.useState(e.selectedTab),o=ge()(n,2),a=o[0],i=o[1];r.a.useEffect((function(){e.selectedTab!==a&&i(e.selectedTab)}),[e.selectedTab]);return r.a.createElement("div",{className:t.root},r.a.createElement(wt.a,{value:a,onChange:function(e,t){i(t)},indicatorColor:"primary",textColor:"primary"},e.tabList.map((function(e,t){return r.a.createElement(Et.a,je()({key:t,label:e.label},function(e){return{id:"tab-".concat(e),"aria-controls":"tabpanel-".concat(e)}}(t)))}))),e.tabList.map((function(n,o){return r.a.createElement(Pt,{key:o,selectedTab:a,index:o,className:e.scrollable?t.tabPanel:void 0},n.component)})))}Ct.propTypes={tabList:s.a.array,selectedTab:s.a.number,scrollable:s.a.bool},Ct.defaultProps={tabList:[{label:"Tab 1",component:r.a.createElement("div",null,"Component 1")},{label:"Tab 2",component:r.a.createElement("div",null,"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.")},{label:"Tab 3",component:r.a.createElement("div",null,"Component 3")}],selectedTab:0,scrollable:!0};var St=n(106),Ot=n.n(St),Nt=function(e){return r.a.createElement(Ot.a,e)};Nt.propTypes={},Nt.defaultProps={};var Tt=Nt,It=n(107),Rt=n.n(It),Bt=n(108),Dt=n.n(Bt),Ft=n(64);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vt=Object(p.makeStyles)((function(e){return{label:{fontFamily:"Roboto",fontStyle:"normal",fontWeight:"normal",fontSize:"14px",marginLeft:0,marginRight:0,marginBottom:0},colorSwitchBase:{color:Ft.grey[300],"&$colorChecked":{color:Ft.green[500],"& + $colorBar":{backgroundColor:Ft.green[500]}}},colorBar:{},colorChecked:{}}})),Ut=function(e){var t=Vt();return r.a.createElement(Rt.a,{control:r.a.createElement(Dt.a,{checked:e.toggle,onChange:e.onToggle,color:e.color,disabled:e.disabled,hidden:e.hidden,size:e.size,classes:{switchBase:t.colorSwitchBase,checked:t.colorChecked,track:t.colorBar}}),labelPlacement:e.labelPlacement,label:e.label,classes:{label:t.label},style:jt(jt({},e.style),{},{marginLeft:0,marginRight:0,marginBottom:0})})};Ut.propTypes={toggle:s.a.bool,onToggle:s.a.func,label:s.a.string,color:s.a.string,labelPlacement:s.a.string,style:s.a.object},Ut.defaultProps={color:"primary"};var zt=Ut,Gt=n(109),Kt=n.n(Gt);function Wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var qt=function(e){z()(n,e);var t=Wt(n);function n(){var e;D()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(V()(e),"searchInput",void 0),d()(V()(e),"timer",void 0),d()(V()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.props.enableTimeout?(e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,e.props.time)):e.handleSearch()})),d()(V()(e),"handleSearch",(function(){void 0!==e.searchInput&&e.props.onChange(e.searchInput)})),e}return L()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.style,o=e.placeholder;return r.a.createElement("div",{className:t.search,style:n},r.a.createElement("div",{className:t.searchIcon},r.a.createElement(dt.a,null)),r.a.createElement(Kt.a,{ref:this.setSearchInput,placeholder:o,classes:{root:t.inputRoot,input:t.inputInput},inputProps:{"aria-label":"search"},onChange:this.handleChange}))}}]),n}(o.Component);qt.propTypes={placeholder:s.a.string,onChange:s.a.func,time:s.a.number,enableTimeout:s.a.bool,style:s.a.object},qt.defaultProps={placeholder:"Search...",onChange:function(e){console.log(e)},time:250,enableTimeout:!0,style:{}};var _t=Object(p.withStyles)((function(e){return{search:d()({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(p.fade)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(p.fade)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:d()({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200})}}),{withTheme:!0})(qt),Ht=n(110),Yt=n.n(Ht),Qt=n(111),Zt=n.n(Qt),Xt=Object(p.makeStyles)((function(e){return{root:{"& > * + *":{marginTop:e.spacing(2)}},link:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans","&:hover":{cursor:"pointer",textDecoration:"underline"}},lastLabel:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans"}}})),Jt=function(e){var t=Xt();return r.a.createElement("div",{className:t.root},r.a.createElement(Yt.a,{separator:r.a.createElement(Zt.a,{fontSize:"small"}),"aria-label":"breadcrumb",style:e.style},e.pathList.map((function(n,o){if(e.pathList.length-1!==o)return r.a.createElement($.a,{key:o,color:"primary",variant:"inherit",className:t.link,onClick:n.function},n.label)})),r.a.createElement($.a,{color:"textPrimary",className:t.lastLabel},e.pathList[e.pathList.length-1].label)))};Jt.propTypes={pathList:s.a.array},Jt.defaultProps={pathList:[{label:"Mov.ai",function:function(){return console.log("pth1/")}},{label:"User",function:function(){return console.log("path1/path2")}},{label:"John Doe"}]};var $t=Jt,en=n(26),tn=n.n(en),nn=n(16),on=n.n(nn),rn=n(22),an=n.n(rn),cn=n(2),sn=n(58),un=n.n(sn),ln=n(20);function fn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Loading...",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"black";this.loadingUIText=e,this.loadingUIBackgroundColor=t}fn.prototype.displayLoadingUI=function(){document.getElementById("loading-scene").style.display="block"},fn.prototype.hideLoadingUI=function(){document.getElementById("loading-scene").style.display="none"};var dn=fn,hn=n(112),mn=n.n(hn),pn=["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady","is2render","sceneFactory"];function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var yn=Object(p.makeStyles)((function(e){return{root:gn(gn({},bn),{},{maxHeight:"100%",position:"relative"}),loaderContainer:{backgroundColor:"black",display:"none",height:"100%",position:"absolute",textAlign:"center",top:0,left:0,width:"100%",zIndex:1051},loaderImage:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)"}}})),bn={display:"flex",flexDirection:"column",flexGrow:1},An=function(e){var t=e.antialias,n=e.engineOptions,a=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,s=e.onSceneReady,u=e.is2render,l=e.sceneFactory,f=bt()(e,pn),d=Object(p.useTheme)(),h=yn(),m=Object(o.useRef)(null),v=Object(o.useState)(!1),g=ge()(v,2),b=g[0],A=g[1],w=Object(o.useState)(null),M=ge()(w,2),E=M[0],x=M[1],P=Object(o.useState)({width:100,height:100}),k=ge()(P,2),C=k[0],S=k[1];return Object(o.useEffect)((function(){if(!b){A(!0);var e=new cn.Engine(m.current,t,n,a),o=new dn;e.loadingScreen=o,function(e,t){u&&e.runRenderLoop((function(){"function"==typeof c&&c(t),t&&t.render()}))}(e,function(e){var t=l?l(e):new cn.Scene(e,i);return x(t),t.isReady()?s(t):t.onReadyObservable.addOnce((function(e){return s(e)})),t}(e))}return function(){console.log("Disposing engine and scene"),E&&E.dispose(),E&&E.getEngine()&&E.getEngine().dispose()}}),[m,b,E]),Object(o.useEffect)((function(){E&&(E.clearColor=ln.a[(null==d?void 0:d.label)||"default"])}),[h,d.label,E]),r.a.createElement("div",{className:h.root},r.a.createElement("div",{id:"loading-scene",className:h.loaderContainer},r.a.createElement("div",{className:h.loaderImage},r.a.createElement("img",{src:mn.a,alt:"loading",width:200}),r.a.createElement(y.LinearProgress,{color:"secondary",style:{marginTop:50}}))),r.a.createElement("canvas",je()({ref:m,width:C.width,height:C.height},f)),r.a.createElement(un.a,{handleWidth:!0,handleHeight:!0,onResize:function(e,t){S({width:e,height:t}),E&&E.getEngine().resize()}}))};An.propTypes={antialias:s.a.bool,engineOptions:s.a.object,adaptToDeviceRatio:s.a.bool,sceneOptions:s.a.object,onSceneReady:s.a.func,onRender:s.a.func,is2render:s.a.bool,sceneFactory:s.a.func},An.defaultProps={antialias:!0,onSceneReady:function(e){},is2render:!0,engineOptions:{preserveDrawingBuffer:!0,stencil:!0}};var wn=An,Mn=n(10),En=n(24),xn=n(17),Pn=n.n(xn),kn=n(8),Cn=n(5),Sn=function(){function e(){D()(this,e),this.memory={}}return L()(e,[{key:"action",value:function(e){e.getSceneMemory().forEach((function(e){e.gizmoManager.attachedMesh=null,e.camera.attachControl(e.canvas,!0)})),e.closeContextDial&&e.closeContextDial(),e.setContextActionIndex&&e.setContextActionIndex()}},{key:"onChange",value:function(e){}}]),e}(),On=n(25);function Nn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Tn=function(e){z()(n,e);var t=Nn(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return D()(this,n),r=t.call(this,e,a),d()(V()(r),"getCopyFunction",(function(){return function(e,t){}})),r.assetName=o,r}return L()(n,[{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.assetName=this.assetName,e}}]),n}(On.a);function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Bn=function(e){z()(n,e);var t=Rn(n);function n(e,o,r,a){var i;return D()(this,n),i=t.call(this,e,a),d()(V()(i),"getType",(function(){return n.TYPE})),i.size=o,i.textureSrc=r,i}return L()(n,[{key:"dispose",value:function(){Pn()(q()(n.prototype),"dispose",this).call(this)}},{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.size=this.size,e.textureSrc=this.textureSrc,e}},{key:"toForm",value:function(){var e=this.toDict();return{jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},assetName:{type:"string",title:"Asset Name"}}},uiSchema:{type:{"ui:disabled":!0},assetName:{"ui:disabled":!0},oldName:{"ui:widget":"hidden"}},data:{oldName:e.name,name:e.name,type:e.type,assetName:e.assetName}}}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.keyValueMap=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.annotations)}}]),n}(Tn);d()(Bn,"TYPE","Map");var Dn=Bn,Fn=n(46),Ln=(n(136),n(137),function e(){D()(this,e)});function jn(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?{name:"IE",version:(e=/\brv[ :]+(\d+)/g.exec(t)||[])[1]||""}:"Chrome"===n[1]&&null!=(e=t.match(/\bOPR|Edge\/(\d+)/))?{name:"Opera",version:e[1]}:(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),{name:n[0],version:n[1]})}d()(Ln,"createGizmo",(function(e){var t=new cn.RotationGizmo(new cn.UtilityLayerRenderer(e));return t.xGizmo.dragBehavior.detach(),t.xGizmo.scaleRatio=0,t.yGizmo.dragBehavior.detach(),t.yGizmo.scaleRatio=0,t})),d()(Ln,"createCamera",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){},o=1,r=kn.a.cameraBuilder(e).sphericalCoordinates(new cn.Vector3(0,0,14)).target(cn.Vector3.Zero()).name("camera").build();r.attachControl(t,!1),r.inertia=.7,r.collisionRadius=new cn.Vector3(o,o,o),r.panningInertia=.5,r.checkCollisions=!0,r.panningSensibility=0,r.lowerRadiusLimit=2;var a=jn();return"Firefox"===a.name&&a.version<=89&&(r.wheelPrecision=100),n(r),r})),d()(Ln,"createLight",(function(e){return kn.a.directionalLightBuilder(e).name("light").direction(new cn.Vector3(0,-1,0)).intensity(.35).build()})),d()(Ln,"createMeshGround",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=cn.Mesh.CreateGround("groundMesh",t,n,20,e);return o.translate(new cn.Vector3(0,-1,0),.01,cn.Space.WORLD),o.material=new cn.StandardMaterial("wireframe",e),o.material.wireframe=!0,o.isPickable=!1,o.checkCollisions=!0,o})),d()(Ln,"createScene",(function(e){var t=new cn.Scene(e);return t.collisionsEnabled=!0,t._uid=t.getUniqueId(),ln.b.DEBUG&&t.debugLayer.show({embedMode:!0,globalRoot:document.body,overlay:!0}),t})),d()(Ln,"createMouseLocationText",(function(e){var t=Fn.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),n=new Fn.TextBlock;return n.text="",n.color="white",n.fontSize=17,n.left=-560,n.top=-145,t.addControl(n),n}));var Vn=Ln;function Un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var zn=function(e){z()(n,e);var t=Un(n);function n(){return D()(this,n),t.apply(this,arguments)}return L()(n,[{key:"onPointerDown",value:function(e,t){}},{key:"onPointerMove",value:function(e,t){}},{key:"onPointerUp",value:function(e,t){}},{key:"onKeyUp",value:function(e,t){}},{key:"onWheel",value:function(e,t){}}]),n}(Sn),Gn=n(37);function Kn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(n){e.push({predicate:function(e){return!0},action:t});for(var o=0;o<e.length;o++){var r=e[o];if(r.predicate(n)){r.action();break}}}}var Wn=n(115),qn=n.n(Wn),_n=n(33),Hn=n(27),Yn=function(){function e(t){var n=this;return D()(this,e),t.getSceneMemory().map((function(e){var o=e.scene,r=o._uid;return r in Qn?Qn[r]:(n.scene=o,n.mainView=t,n.meshSelectionSet=new Set,Qn[r]=n,n)})).orSome(this)}return L()(e,[{key:"add",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.meshSelectionSet.has(e)?t&&this.meshSelectionSet.delete(e):this.meshSelectionSet.add(e),this}},{key:"addArray",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.forEach((function(e){return t.add(e,n)})),this}},{key:"clear",value:function(){return this.meshSelectionSet=new Set,this}},{key:"meshes",value:function(){return on()(this.meshSelectionSet)}},{key:"has",value:function(e){return this.meshSelectionSet.has(e)}},{key:"filter",value:function(e){var t=new Set;return this.meshSelectionSet.forEach((function(n){e(n)&&t.add(n)})),this.meshSelectionSet=t,this}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),Qn={},Zn=function(){function e(t){var n=this;return D()(this,e),t.getSceneMemory().map((function(e){var o=e.scene,r=o._uid;return r in eo?eo[r]:(n.scene=o,n.mesh=null,n.arrayOfMeshes=[],n.angleByMeshName={},n.mainView=t,n.theta=0,eo[r]=n,n)})).orSome(this)}return L()(e,[{key:"push",value:function(e){if(0===e.length)return this;e=Array.isArray(e)?e:[e],this.arrayOfMeshes=qn()(this.arrayOfMeshes.concat(e),(function(e){return e.name})),this.angleByMeshName=this.arrayOfMeshes.reduce((function(e,t){return e[t.name]=$n(t),e}),{});var t=kn.a.pointAverage(this.arrayOfMeshes.map((function(e){return kn.a.getGlobalCoordinates(e,e.position).toBabylon()})));return this.createPlaceHolderIn(t),this}},{key:"clear",value:function(){return this.arrayOfMeshes=[],this.mesh&&this.mesh.dispose(),this}},{key:"createPlaceHolderIn",value:function(t){var n=this;(null===this.mesh||this.mesh.isDisposed())&&(this.mesh=_n.a.ofDict(this.scene,{name:to,type:e,position:[0,0,0],quaternion:cn.Quaternion.Identity(),color:[.5,.5,.5],keyValueMap:{},isVisible:!0}).mesh,this.mesh.material=this.getSelPlaceHolderShader());var o=this;return this.mesh.getMouseContextActions=function(){return[{title:"Delete",onClick:function(){o.mainView.addGizmo2Mesh(),o.clear(),Yn.ofMainView(n.mainView).clear(),o.mainView.highlightMeshesInScene(),o.mainView.highlightNodesInTree()}}]},this.mesh.onClick=function(){},this.mesh.isSelectionPlaceHolder=!0,this.mesh.parent=this.mainView.getRootNode().item.mesh,this.mesh.position=t.add(new cn.Vector3(0,0,no)),this.mesh.observers=new cn.Observable,this.mesh.observers.add(this.getPlaceHolderObs()),this.mesh}},{key:"getSelPlaceHolderShader",value:function(){return kn.a.getShaderMaterial({name:"placeHolderShader",vertex:Xn,frag:Jn})(this.scene)}},{key:"getPlaceHolderObs",value:function(){var e=this;return function(t){var n=t.updatedPointMesh,o=t.is2updateServer,r=t.displacement,a=e.arrayOfMeshes.filter((function(e){return!e.isDisposed()})),i=$n(n),c=i-e.theta;e.theta=i,a.forEach((function(t){!function(e,t,n,o,r,a){Math.abs(r)<.001?function(e,t){var n=kn.a.getLocalCoordFromWorld(e,Cn.a.ofBabylon(t),!1),o=Cn.a.ofBabylon(e.position).add(n);e.position=o.toBabylon()}(t,n):function(e,t,n,o,r){var a=Cn.a.ofBabylon(e.position),i=Cn.a.ofBabylon(t.position).sub(a).toVec2(),c=Hn.a.of(Math.cos(n),Math.sin(n)).prod(i),s=Cn.a.of([c.x,c.y,0]).toBabylon();t.position=new cn.Vector3(e.position.x,e.position.y,t.position.z).add(s);var u=o.angleByMeshName[t.name]+r;t.rotationQuaternion=new cn.Quaternion(0,0,Math.sin(u/2),Math.cos(u/2))}(o,t,r,a,e)}(i,t,r,n,c,e),o&&e.mainView.updateNodeInServer(t.name),Mn.Maybe.fromNull(t.observers).forEach((function(e){return e.notifyObservers({updatedPointMesh:t,is2updateServer:o,displacement:r})})),Mn.Maybe.fromNull(t.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:t,is2updateServer:o,displacement:r})}))})),0===a.length&&e.clear()}}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),Xn="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n    vPosition = position;\n    vNormal = normal;\n}",Jn="\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n// Uniforms\nuniform mat4 world;\nuniform float time;\n\nvoid main(void) {\n    // World values\n    vec3 p = vec3(world * vec4(vPosition, 1.0));\n    vec3 n = normalize(vec3(world * vec4(vNormal, 0.0)));\n    vec3 nColor = n * 0.5 + 0.5;\n    float spatialFreq = 20.;\n    float timeFreq = 10.;\n    float power = sin(spatialFreq * p.y - timeFreq * time);\n    power *= power;\n    vec3 color = power *  nColor + (1. - power) * vec3(1,1,1);\n    gl_FragColor = vec4(color, 1.);\n}",$n=function(e){return Mn.Maybe.fromNull(e.rotationQuaternion).map((function(e){return 2*Math.atan2(e.z,e.w)})).orSome(0)},eo={},to="placeholder",no=1.5;var oo=Zn,ro=n(43),ao=n.n(ro),io=n(39),co=n(29),so=n(23);function uo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function lo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uo(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var ho=function(e){z()(n,e);var t=fo(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onPointerDown",(function(e,t){1!==e.buttons&&2!==e.buttons||e.ctrlKey||t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;o.maybeSelectedMesh=kn.a.pickMesh(r,a),o.maybeSelectedMesh.forEach((function(n){return o.dragDownMesh(n,t,e)})),o.maybeSelectedMesh.orLazy((function(){o.dragDownWithoutMesh(t,e)}))}))})),d()(V()(o),"onPointerMove",(function(e,t){1!==e.buttons||e.ctrlKey||t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;o.maybeSelectedMesh.forEach((function(e){kn.a.getGroundPosition(r,a).forEach((function(e){o.dragMoveMesh(t,e)}))})),o.maybeSelectedMesh.orLazy((function(){o.dragMoveWithoutMesh(e)}))}))})),d()(V()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.camera,r=e.scene,a=e.ground,i=e.canvas;o.maybeSelectedMesh.forEach((function(e){o.dragUpMesh(e,t,r,a)})),o.maybeSelectedMesh.orLazy((function(){o.dragUpWithoutMesh(t,r)})),n.attachControl(i,!0),o.maybeSelectedMesh=Mn.Maybe.none(),o.destroySelectionDiv(),o.corners=[]}))})),d()(V()(o),"onKeyUp",(function(e,t){Kn([{predicate:function(e){return["Backspace","Delete"].includes(e.code)},action:o.getDeleteAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyC"===e.code},action:o.getCopyAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyV"===e.code},action:o.getPasteAction(t)}])(e)})),d()(V()(o),"handleMeshRightClick",(function(e,t,n){2===e.buttons&&n&&n.getMouseContextActions&&t.setMouseContextActions(e,n.getMouseContextActions(t))})),d()(V()(o),"handleRightClickWithoutMesh",(function(e,t,n){2===e.buttons&&t.setMouseContextActions(e,[{title:"Paste",onClick:o.getPasteOnClick(n,t)}])})),d()(V()(o),"getPasteOnClick",(function(e,t){return function(){var n=Gn.a.paste();n&&"function"==typeof n&&n(e,t)}})),d()(V()(o),"notifyChildrenObserversRecursively",(function(e,t,n,r){e.forEach((function(e){(e.observers||e.graphVertex)&&r.getNodeFromTree(e.name).isSome()&&o.notifyObservers(e,t,n,r),e._children&&e._children.length&&o.notifyChildrenObserversRecursively(e._children,t,n,r)}))})),d()(V()(o),"setProperties",(function(e,t){return e.setPropertiesWithName(t)})),o.key="dragObject",o.name="Grab Objects [1]",o.icon=function(e){return r.a.createElement("i",je()({className:"far fa-hand-paper"},e))},o.maybeSelectedMesh=Mn.Maybe.none(),o.clickPointInWorld=Cn.a.ZERO,o.movePointInWorld=Cn.a.ZERO,o.startDivPos=Hn.a.ZERO,o.corners=[],o}return L()(n,[{key:"dragDownMesh",value:function(e,t,n){var o=this;e.isStatic||t.getSceneMemory().forEach((function(r){var a=r.camera,i=r.canvas,c=r.scene,s=r.ground;a.detachControl(i),o.addSelectedMesh(n,e,t),o.handleMeshRightClick(n,t,e),kn.a.getGroundPosition(c,s).forEach((function(n){o.updateMouseVars(n),e.onClick?e.onClick():t.closeContextDial(),e.isSelectionPlaceHolder?t.addGizmo2Mesh(e,(function(){o.notifyObservers(e,!1,Cn.a.ZERO,t)}),(function(){o.notifyObservers(e,!0,Cn.a.ZERO,t)})):o.selectMeshUpdateUI(t)}))}))}},{key:"selectMeshUpdateUI",value:function(e){var t=this,n=Yn.ofMainView(e),o=oo.ofMainView(e),r=n.meshes();e.highlightMeshesInScene(r),e.highlightNodesInTree(r.map((function(e){return e.name}))),r.length>1?(e.addGizmo2Name(),o.clear(),o.push(r),this.setProperties(e,r[0].name)):(o.clear(),e.addGizmo2Name(),r.forEach((function(n){e.addGizmo2Name(n.name),t.setProperties(e,n.name)})))}},{key:"dragDownWithoutMesh",value:function(e,t){var n=this;e.getMouseCoordsFromRoot().forEach((function(o){return n.handleRightClickWithoutMesh(t,e,o)})),e.getSceneMemory().forEach((function(e){var o=e.camera,r=e.canvas,a=e.scene;t.shiftKey&&(o.detachControl(r),n.createSelectionDiv(t),n.corners.push(Hn.a.of(a.pointerX,a.pointerY)))}))}},{key:"dragMoveMesh",value:function(e,t){var n=this,o=Yn.ofMainView(e).meshes(),r=oo.ofMainView(e),a=Cn.a.ofBabylon(t),i=a.sub(this.movePointInWorld);if(o.forEach((function(t){var o=kn.a.getLocalCoordFromWorld(t,i,!1);o=new cn.Vector3(o.x,o.y,0),t.position=t.position.add(o),n.notifyObservers(t,!1,i,e)})),o.length>1){var c=kn.a.getLocalCoordFromWorld(r.mesh,i,!1);c=new cn.Vector3(c.x,c.y,0),r.mesh.position=r.mesh.position.add(c)}this.movePointInWorld=a}},{key:"dragMoveWithoutMesh",value:function(e){this.updateSelectionDiv(e)}},{key:"dragUpMesh",value:function(e,t,n,o){var r=this,a=Yn.ofMainView(t),i=a.meshes(),c=oo.ofMainView(t);kn.a.getGroundPosition(n,o).forEach((function(s){var u=Cn.a.ofBabylon(s).sub(r.clickPointInWorld),l=u.length()>.001;i.forEach((function(e){var n=l||!!e.edgeIndexes;r.notifyObservers(e,n,Cn.a.ZERO,t),l&&t.updateNodeInServer(e.name)})),r.setProperties(t,e.name),l&&t.getUndoManager().addIt(r.getUndoAbleAction(i,u,t)),e.isSelectionPlaceHolder&&(a.clear(),a.addArray(c.arrayOfMeshes)),r.mergePathsIfAny(e,t,n,o)}))}},{key:"dragUpWithoutMesh",value:function(e,t){this.selectObjectsInside(t,e)}},{key:"updateMouseVars",value:function(e){var t=Cn.a.ofBabylon(e);this.movePointInWorld=t,this.clickPointInWorld=t}},{key:"addSelectedMesh",value:function(e,t,n){var o=Yn.ofMainView(n);if(t.edgeIndexes)return o.clear(),void o.add(t);if(o.filter((function(e){return!e.edgeIndexes})),e.shiftKey)o.add(t);else{if(o.has(t))return;o.clear(),o.add(t)}}},{key:"getDeleteAction",value:function(e){return function(){var t=Yn.ofMainView(e),n=t.meshes(),o=1===n.length;n.forEach((function(t){var n=e.getNodeFromTree(t.name);n.forEach((function(t){return e.onDeleteNode(t,o,o)})),n.orElseRun((function(){o&&t.onDel&&t.onDel()}))})),e.highlightNodesInTree(),e.highlightMeshesInScene(),e.addGizmo2Mesh(),t.clear(),oo.ofMainView(e).clear(),e.renderMenus()}}},{key:"getCopyAction",value:function(e){var t=this,n=Yn.ofMainView(e).meshes(),o=oo.ofMainView(e).mesh;return function(){n.length<=1?t.copyOne(n):t.copyMany(n,o)}}},{key:"copyOne",value:function(e){Gn.a.copy((function(t,n){var o=Gn.a.getUID(),r=e.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})).map((function(e){return e.getCopyFunction(!0,(function(e){return e+"_copy"+o}))}));if(0!==r.length){var a=function(){var e=r[0](t,n);return e.forEach((function(e){var t=e.mesh;n.addGizmo2Name(t.name),n.highlightMeshesInScene([t]),n.highlightNodesInTree([t.name]),Yn.ofMainView(n).clear().add(t),n.setProperties(e.toForm()),n.renderMenus()})),e},i=a();n.getUndoManager().addIt(se.UndoManager.actionBuilder().doAction(a).undoAction((function(){i.forEach((function(e){var t=e.mesh;n.deleteNodeFromTreeUsingName(t.name),n.highlightMeshesInScene(),n.highlightNodesInTree(),n.renderMenus()}))})).build())}}))}},{key:"copyMany",value:function(e,t){Gn.a.copy((function(n,o){var r=e.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})),a=r.map((function(){return Gn.a.getUID()})),i=r.map((function(e,t){return e.getCopyFunction(!1,(function(e){return e+"_copy"+a[t]}))})),c=function(){var e=i.map((function(e,a){return e(kn.a.toGlobalCoord(o)(r[a].mesh.absolutePosition).subtract(t.position).add(n),o)})).filter((function(e){return e.isSome()})).map((function(e){return e.some()})),a=e.map((function(e){return e.mesh})),c=e.map((function(e){return e.name}));return o.addGizmo2Name(),o.highlightMeshesInScene(a),o.highlightNodesInTree(c),Yn.ofMainView(o).clear().addArray(a),oo.ofMainView(o).clear().push(a),o.renderMenus(),o.forceUpdate(),e},s=c();o.getUndoManager().addIt(se.UndoManager.actionBuilder().doAction(c).undoAction((function(){s.forEach((function(e){var t=e.mesh;o.deleteNodeFromTreeUsingName(t.name,!0,!1)})),o.highlightMeshesInScene(),o.highlightNodesInTree(),Yn.ofMainView(o).clear(),oo.ofMainView(o).clear(),o.renderMenus(),o.forceUpdate()})).build())}))}},{key:"getPasteAction",value:function(e){var t=this;return function(){e.getMouseCoordsFromRoot().forEach((function(n){return t.getPasteOnClick(n,e)()}))}}},{key:"notifyObservers",value:function(e,t,n,o){Mn.Maybe.fromNull(e.observers).forEach((function(o){o.notifyObservers({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),Mn.Maybe.fromNull(e.graphVertex).forEach((function(o){(0,o.vertexObs)({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),o.getNodeFromTree(e.name).isSome()&&this.notifyChildrenObserversRecursively((null==e?void 0:e._children)||[],t,n,o)}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this,r=on()(e).map((function(e){return{mesh:e,parent:e.parent,keypointIndex:e.index||-1}})),a=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=kn.a.getLocalCoordFromWorld(e,t,!1),i=Cn.a.ofBabylon(e.position).add(a);e.position=i.toBabylon(),o.notifyObservers(e,r,t,n)},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(r){var i=r.mesh,c=r.parent,s=r.keypointIndex,u=t.scale(e),l=Mn.Maybe.None();s>=0?((l=n.getNodeFromTree(c.name)).forEach((function(e){var t=e.item,r=t.keyPoints[s];a(r,u,o),o&&n.updateNodeInServer(t.name)})),l.orElseRun((function(){}))):(l=n.getNodeFromTree(i.name)).forEach((function(e){var t=e.item.mesh;a(t,u,o),o&&n.updateNodeInServer(t.name)})),l.orElseRun((function(){a(i,u,o),o&&n.updateNodeInServer(i.name)}))}};return se.UndoManager.actionBuilder().doAction((function(){r.forEach(i())})).undoAction((function(e){var t=e.is2UpdateInServer,n=void 0===t||t;r.forEach(i(-1,n))})).build()}},{key:"createSelectionDiv",value:function(e){this.startDivPos=this.findMouseInDom(e);var t=this.startDivPos,n=t.x,o=t.y,a=document.createElement("div");a.id=po,document.body.appendChild(a),ao.a.render(r.a.createElement(mo,{left:n,top:o}),document.getElementById(po))}},{key:"updateSelectionDiv",value:function(e){var t=this.findMouseInDom(e),n=this.startDivPos,o=t.op(n,Math.min),a=o.x,i=o.y,c=t.op(n,Math.max),s=c.x,u=c.y,l=document.getElementById(po);l&&ao.a.render(r.a.createElement(mo,{left:a,top:i,width:s-a,height:u-i,style:{zIndex:999}}),l)}},{key:"destroySelectionDiv",value:function(){var e=document.getElementById(po);e&&e.parentNode.removeChild(e)}},{key:"findMouseInDom",value:function(e){var t=e.clientX,n=e.clientY;return new Hn.a(t,n)}},{key:"selectObjectsInside",value:function(e,t){var n=this;if(0!==this.corners.length){this.corners.push(Hn.a.of(e.pointerX,e.pointerY));var o=ge()(this.corners,2),r=o[0],a=o[1],i=a.op(r,Math.min),c=a.op(r,Math.max),s=[i,Hn.a.of(c.x,i.y),c,Hn.a.of(i.x,c.y)].map((function(e){return n.pickPoints(e,t)}));if(!s.some((function(e){return null==e}))){var u=new io.a(t.getObjectTree()).flatten(this.isItemInsideBox(s,t)).map((function(e){return e.item.mesh})),l=Yn.ofMainView(t);l.clear(),0!==u.length&&l.addArray(u,!1),this.selectMeshUpdateUI(t)}}}},{key:"pickPoints",value:function(e,t){return t.getSceneMemory().flatMap((function(n){var o=n.scene,r=n.ground,a=o.pick(e.x,e.y,(function(e){return e===r}));if(a.hit){var i=kn.a.toGlobalCoord(t)(a.pickedPoint);return Mn.Maybe.some(Hn.a.of(i.x,i.y))}return Mn.Maybe.none()})).orNull()}},{key:"isItemInsideBox",value:function(e,t){var n=this;return function(o){var r,a=o.item,i=a.getType();if(i===En.b.TYPE||i===Dn.TYPE||i===co.a.TYPE||null!=a&&null!==(r=a.mesh)&&void 0!==r&&r.isSelectionPlaceHolder)return!1;var c=a.mesh;return n.isMeshInsideBox(e,t)(c)}}},{key:"isMeshInsideBox",value:function(e,t){var n=this;return function(o){var r=kn.a.toGlobalCoord(t)(o.absolutePosition),a=new Hn.a(r.x,r.y);return n.isPointInsideBox(e)(a)}}},{key:"isPointInsideBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;return function(n){for(var o=0,r=e.length,a=0;a<r;a++){var i=e[a].sub(n),c=e[(a+1)%r].sub(n);o+=Math.acos(i.dot(c)/(i.length()*c.length()))}return Math.abs(o-2*Math.PI)<t}}},{key:"mergePathsIfAny",value:function(e,t,n,o){if(so.a.isKeyPointMesh(e,t)){var r=n.pick(n.pointerX,n.pointerY,(function(e){return e!==o&&e.isEnabled()}));if(r.hit){var a=r.ray,i=n.multiPickWithRay(a);if(i){var c=i.map((function(e){return e.pickedMesh})).filter((function(e){return so.a.isKeyPointMesh(e,t)}));if(c.length>=2){var s=ge()(c,2),u=s[0],l=s[1],f=u.index>l.index?u:l,d=u.index<=l.index?u:l;f.parent.name!==d.parent.name&&so.a.areKeyPointsCompatible(f,d,t)&&t.getNodeFromTree(f.parent.name).forEach((function(e){var n=e.item;t.getNodeFromTree(d.parent.name).forEach((function(e){var o=e.item,r=[n,o].map((function(e){return{parent:e.mesh.parent,dict:e.toDict(),children:on()(e.mesh._children)}})),a=n.name+"_"+o.name;t.getUndoManager().doIt(se.UndoManager.actionBuilder().doAction((function(){so.a.mergePaths(n.name,o.name,a,t)})).undoAction((function(e){var n=e.is2UpdateInServer,o=void 0===n||n;so.a.unMergePaths(r,a,t,o)})).build())}))}))}}}}}}]),n}(zn),mo=function(e){var t=e.left,n=e.top,o=e.width,a=e.height,i=e.style;return r.a.createElement("div",{style:lo({position:"absolute",top:n,left:t,width:o,height:a,borderRadius:10,border:"solid",borderColor:"#c7c7c7"},i)})};mo.defaultProps={left:0,top:0,width:0,height:0};var po="SELECTION_TOOL_ID",vo=ho;function go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var yo=function(e){z()(n,e);var t=go(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,r=e.camera;o.maybeMousePos=kn.a.getGroundPosition(t,n),o.maybeMousePos.forEach((function(t){r.detachControl(e.canvas)}))}))})),d()(V()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground;kn.a.getGroundPosition(n,r).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose(),o.tempMesh=o.createKeyPoint(e,bo,n,t,!1)}))}))}))})),d()(V()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.camera,a=e.ground,i=e.canvas;kn.a.getGroundPosition(n,a).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose();var a="KeyPoint".concat(Math.floor(1e3*Math.random())),i=o.createKeyPoint(e,a,n,t,!0,new cn.Color3(Math.random(),Math.random(),Math.random()));t.setPropertiesWithName(a),t.getUndoManager().addIt(o.getUndoAbleAction(i,n,t))}))})),o.maybeMousePos=Mn.Maybe.none(),r.attachControl(i,!0)}))})),o.key="addKeyPoint",o.name="Add Key Point [4]",o.maybeMousePos=Mn.Maybe.none(),o.tempMesh=null,o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-map-marker"},e))},o}return L()(n,[{key:"createKeyPoint",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:cn.Color3.Gray(),i=o.getRootNode().item.mesh,c=_n.a.ofDict(n,{name:t,color:[a.r,a.g,a.b]}),s=c.mesh;s.parent=i;var u=kn.a.getLocalCoordFromWorld({parent:i},Cn.a.ofBabylon(e)).toBabylon();return s.setPositionWithLocalVector(u.add(cn.Axis.Z.scale(_n.a.DEFAULT_SIZE))),r&&o.addNodeItem2Tree(c,i.name,r),s}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this;return se.UndoManager.actionBuilder().doAction((function(){o.createKeyPoint(cn.Vector3.Zero(),e.name,t,n,!0,e.material.diffuseColor).position=e.position,n.updateNodeInServer(e.name)})).undoAction((function(t){var o=t.is2UpdateInServer,r=void 0===o||o;n.deleteNodeFromTreeUsingName(e.name,r)})).build()}}]),n}(zn),bo="temp_key_point",Ao=yo,wo=n(116),Mo=n.n(wo);function Eo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var xo=function(e){z()(n,e);var t=Eo(n);function n(e,o,r){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return D()(this,n),a=t.call(this,e,i),d()(V()(a),"getType",(function(){return n.TYPE})),a.corners=o,a.keyPoints=r,a}return L()(n,[{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.corners=this.corners,e}},{key:"toForm",value:function(){var e=Pn()(q()(n.prototype),"toForm",this).call(this);e.jsonSchema.properties.dimensions={type:"object",title:"Dimensions",properties:{lower:{type:"object",title:"Lower Corner",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"}}},size:{type:"object",title:"Size",properties:{scaleX:{type:"number",title:"scale-X"},scaleY:{type:"number",title:"scale-Y"}}}}},e.uiSchema.dimensions={"ui:widget":"collapse"};var t=this.keyPoints.map((function(e){return kn.a.getGlobalCoordinates(e,e.position)})).map((function(e){return e.toArray()}));return e.data.dimensions={lower:{x:t[0][0],y:t[0][1]},size:{scaleX:this.corners[1][0]-this.corners[0][0],scaleY:this.corners[1][1]-this.corners[0][1]}},e}},{key:"ofForm",value:function(e){var t=this.toForm().data.dimensions;Mo()(t,e.dimensions)?Pn()(q()(n.prototype),"ofForm",this).call(this,e):this.ofFormDimensions(e)}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"ofFormDimensions",value:function(e){var t=this,n=cn.Vector3.FromArray([e.dimensions.lower.x,e.dimensions.lower.y,0].map(Number.parseFloat)),o=[e.dimensions.size.scaleX,e.dimensions.size.scaleY].map(Number.parseFloat),r=kn.a.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.keyPoints[e].observers.notifyObservers({updatedPointMesh:t.keyPoints[e],is2updateServer:n})};this.keyPoints[0].position=new cn.Vector3(r[0],r[1],this.keyPoints[0].position.z),a(0),r=kn.a.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),this.keyPoints[1].position=new cn.Vector3(r[0]+o[0],r[1]+o[1],this.keyPoints[1].position.z),a(1)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing Box region");var r=Mn.Maybe.fromNull(t.name).orSome("BoxRegion".concat(Math.floor(1e3*Math.random()))),a=Co(t,r,e),i=new cn.StandardMaterial("BoxRegionMaterial".concat(r),e),c=new cn.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,i.backFaceCulling=!1,a.material=i,a.visibility=t.color[3]||No,Mn.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new cn.Quaternion(e[1],e[2],e[3],e[0]);a.rotationQuaternion=t.normalize()}));var s=Oo(e,t.corners.map((function(e){return Cn.a.of(e).toBabylon()})),a,o);return new n(a,t.corners,s,t.keyValueMap)}}]),n}(On.a);d()(xo,"TYPE","BoxRegion");var Po=ln.b.RADIUS,ko=[[0,1,2],[2,3,0],[4,5,6],[6,7,4],[0,1,5],[5,4,0],[3,2,6],[6,7,3],[1,2,6],[6,5,1],[0,3,7],[7,4,0]];function Co(e,t,n){var o=e.corners.map((function(e){return Cn.a.of(e).toBabylon()})),r=o[1].subtract(o[0]),a=Cn.a.of(e.position).toBabylon(),i=[o[0],o[0].add(cn.Axis.X.scale(r.x)),o[0].add(new cn.Vector3(r.x,r.y,0)),o[0].add(cn.Axis.Y.scale(r.y))],c=new cn.Vector3(0,0,r.z),s={positions:[i[0],i[1],i[2],i[3],i[0].add(c),i[1].add(c),i[2].add(c),i[3].add(c)],faces:ko},u=kn.a.meshFromPositionAndFaces(t,n,s.positions,s.faces);return u.position=a,u.rotationQuaternion=cn.Quaternion.Identity(),u}var So=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;e.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh,s=c.name,u={position:Cn.a.ofBabylon(c.position).toArray(),corners:i.corners};u.corners[a]=[o.position.x,o.position.y,u.corners[a][2]],function(e,t,n,o){var r=kn.a.pointAverageVec3(e.corners.map((function(e){return Cn.a.of(e)})));e.position=r.toArray(),e.corners=e.corners.map((function(e){return Cn.a.of(e).sub(r).toArray()}));var a=kn.a.getRotationMatrix(n),i=Cn.a.ofBabylon(n.scaling),c=a.prodVec(r.mul(i)).toBabylon(),s=Co(e,n.name,t);s.parent=n.parent,s.rotationQuaternion=n.rotationQuaternion,s.position=c.add(n.position),s.material=n.material,s.visibility=n.visibility,s.getMouseContextActions=n.getMouseContextActions,s.nodeItem=n.nodeItem,s.observers=n.observers,n.graphVertex&&(s.graphVertex=n.graphVertex,s.graphVertex.vertex.mesh=s),o.mesh=s,o.corners=e.corners,on()(n._children).forEach((function(e){e.parent=s})),o.keyPoints.forEach((function(t,n){var o=t.position.z;t.position=Cn.a.of(e.corners[n]).toBabylon(),t.position.z=o})),n.dispose()}(u,t,c,i),e.addGizmo2Name(),r&&(e.updateNodeInServer(s),e.getNodeFromTree(s).forEach((function(t){e.setProperties(t.item.toForm())}))),Mn.Maybe.fromNull(i.mesh.observers).forEach((function(e){e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:r,displacement:cn.Vector3.Zero()})})),Mn.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:i.mesh,is2updateServer:r,displacement:cn.Vector3.Zero()})}))}))}},Oo=function(e,t,n,o){var r=[],a=t.reduce((function(e,t){return Math.max(e,t.z)}),Number.MIN_VALUE);return t.forEach((function(t,i){var c=t,s=kn.a.createSphere(e,new cn.Color3(.25,.25,.25),Po,"".concat(n.name,"keyPoint").concat(i),!0);s.parent=n,s.position=c,s.position.z=a,s.index=i,s.observers=new cn.Observable,s.observers.add(So(o,e)),r.push(s)})),r},No=.25,To=xo;function Io(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Ro=function(e){z()(n,e);var t=Io(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,r=e.camera,a=kn.a.getGroundPosition(t,n);o.maybeMousePos=a,a.forEach((function(t){r.detachControl(e.canvas)}))}))})),d()(V()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground;kn.a.getGroundPosition(n,r).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose(),o.tempMesh=o.createBoxRegion([r,e],Bo,n,t,!1)}))}))}))})),d()(V()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.camera,a=e.ground;kn.a.getGroundPosition(n,a).forEach((function(e){o.maybeMousePos.forEach((function(r){if(!(e.subtract(r).length()<.01)){o.tempMesh.dispose();var a="BoxRegion".concat(Math.floor(1e3*Math.random())),i=o.createBoxRegion([r,e],a,n,t,!0);t.setPropertiesWithName(a),t.getUndoManager().addIt(o.getUndoAbleAction([r,e],i,n,t))}}))})),o.maybeMousePos=Mn.Maybe.none(),r.attachControl(e.canvas,!0)}))})),d()(V()(o),"createBoxRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:cn.Color3.Red(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=o.getRootNode().item.mesh,s=e.map((function(e){return kn.a.getLocalCoordFromWorld({parent:c},Cn.a.ofBabylon(e))}));s[1]=s[1].add(Cn.a.of([0,0,i]));var u=s[0].add(s[1]).scale(.5),l=s.map((function(e){return e.sub(u)})),f=To.ofDict(n,{name:t,position:u.toArray(),color:[a.r,a.g,a.b],corners:l.map((function(e){return e.toArray()}))},o);return f.mesh.parent=c,r&&o.addNodeItem2Tree(f,c.name,r),f.mesh})),o.key="drawBoxRegion",o.name="Draw Box Region [3]",o.maybeMousePos=Mn.Maybe.none(),o.tempMesh=null,o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-square"},e))},o}return L()(n,[{key:"getUndoAbleAction",value:function(e,t,n,o){var r=this;return se.UndoManager.actionBuilder().doAction((function(){r.createBoxRegion(e,t.name,n,o,!0)})).undoAction((function(e){var n=e.is2UpdateInServer,r=void 0===n||n;o.deleteNodeFromTreeUsingName(t.name,r)})).build()}}]),n}(zn),Bo="temp_box_region",Do=Ro;function Fo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Lo=function(e){z()(n,e);var t=Fo(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onChange",(function(e){o.mouseCurve.length>1&&e.getSceneMemory().forEach((function(t){var n=t.scene;e.getUndoManager().doIt(o.getUndoAbleEnterAction(o.mouseCurve,n,e))}))})),d()(V()(o),"onPointerDown",(function(e,t){1===e.buttons&&(o.spherePlaceHolder.isDisposed()?t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,a=e.camera,i=e.canvas;kn.a.getGroundPosition(n,r).forEach((function(r){a.detachControl(i),o.mouseCurve.push(r),t.getUndoManager().doIt(o.getUndoAbleClickAction(o.mouseCurve,n,t,e))}))})):o.createPointInCurve(t))})),d()(V()(o),"getUndoAbleClickAction",(function(e,t,n,r){var a=r.camera,i=r.canvas,c=e.map((function(e){return Cn.a.ofBabylon(e)}));return se.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:on()(c);n.deleteNodeFromTreeUsingName(jo,!1,!1),o.createCurve(e,jo,t,n,!1),c.length<=2&&n.setContextActions(o.getDrawPathContextAction(a,i,t)),o.mouseCurve=on()(c)})).undoAction((function(e){var r=e.is2UpdateInServer,a=void 0===r||r;n.deleteNodeFromTreeUsingName(jo,a);var i=c.slice(0,c.length-1),s=1===i.length?[i[0],i[0]]:i;a?(i.length>0&&o.createCurve(s,jo,t,n,!1),o.mouseCurve=i):o.mouseCurve=[]})).build()})),d()(V()(o),"onPointerMove",(function(e,t){o.addKeyPointPlaceHolder(t)})),d()(V()(o),"onPointerUp",(function(e,t){})),d()(V()(o),"onKeyUp",(function(e,t){t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.camera,i=n.canvas,c=o.getDrawPathContextAction(a,i,r);Kn([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return c[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return c[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){c[0].action(t)}}])(e)}))})),d()(V()(o),"createCurve",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:cn.Color3.Gray(),i=o.getRootNode().item.mesh,c=kn.a.toGlobalCoord(o)(e),s=kn.a.pointAverage(c),u=c.map((function(e){return e.subtract(s)})),l=so.a.ofDict(n,{name:t,position:Cn.a.ofBabylon(s).toArray(),color:[a.r,a.g,a.b],localPath:u.map((function(e){return Cn.a.ofBabylon(e).toArray()}))},o);return l.mesh.parent=i,o.addNodeItem2Tree(l,i.name,r,!0,r),l})),d()(V()(o),"getDrawPathContextAction",(function(e,t,n){var a=[];return a.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(jo,!1),o.mouseCurve=[],n.closeContextDial()},name:"Clear Path [ESC | DEL | Backspace]"}),o.mouseCurve.length>1&&a.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-check"},e))},action:function(r){e.attachControl(t,!0),r.getUndoManager().doIt(o.getUndoAbleEnterAction(o.mouseCurve,n,r))},name:"Create Path [Enter]"}),a})),o.key="drawPath",o.name="Draw Path [2]",o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-bezier-curve"},e))},o.mouseCurve=[],o.spherePlaceHolder={dispose:function(){},isDisposed:function(){return!0}},o}return L()(n,[{key:"getUndoAbleEnterAction",value:function(e,t,n){var o=this,r=on()(e),a="Path".concat(Math.floor(1e3*Math.random()));return se.UndoManager.actionBuilder().doAction((function(){n.deleteNodeFromTreeUsingName(jo,!1);var e=o.createCurve(r,a,t,n,!0);if(o.mouseCurve=[],n.setPropertiesWithName(a),n.closeContextDial(),e&&e.keyPoints){var i=e.keyPoints;so.a.addEdgesInKeyPoints(i,t,n)}})).undoAction((function(e){var i=e.is2UpdateInServer,c=void 0===i||i;o.deleteEdgeInKeyPoints(a,n,c),n.deleteNodeFromTreeUsingName(a,c),c?(o.createCurve(r,jo,t,n,!1),o.mouseCurve=r):(o.mouseCurve=[],n.deleteNodeFromTreeUsingName(jo,!1))})).build()}},{key:"deleteEdgeInKeyPoints",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.getGraph().forEach((function(o){var r=o.item;t.getNodeFromTree(e).forEach((function(e){var o=e.item.keyPoints,a=[o[0],o[o.length-1]];r.delEdge.apply(r,a),n&&t.updateNodeInServer(r.name)}))}))}},{key:"addKeyPointPlaceHolder",value:function(e){var t=this;this.spherePlaceHolder.dispose(),e.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;kn.a.pickMesh(o,r).forEach((function(n){n.name!==jo&&e.getNodeFromTree(n.name).forEach((function(n){n.item.getType()===so.a.TYPE&&kn.a.getGroundPosition(o,r).forEach((function(n){var r=e.getRootNode().item.mesh;t.spherePlaceHolder=kn.a.createSphere(o,cn.Color3.Gray(),ln.b.RADIUS,"sphereInsertPlaceHolder",!1),t.spherePlaceHolder.parent=r,t.spherePlaceHolder.position=kn.a.toGlobalCoord(e)(n),t.spherePlaceHolder.visibility=.5}))}))}))}))}},{key:"createPointInCurve",value:function(e){var t=this;e.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;t.spherePlaceHolder.dispose(),kn.a.pickMesh(o,r).forEach((function(n){var a=n.name;e.getNodeFromTree(a).forEach((function(n){var a=n.item;kn.a.getGroundPosition(o,r).forEach((function(n){var r=on()(a.localPath).map((function(e){return Cn.a.of(e).toBabylon()})),i=a.mesh.position;e.getUndoManager().doIt(se.UndoManager.actionBuilder().doAction((function(){t.insertPointInCurve(o,e,a,n),e.updateNodeInServer(a.name)})).undoAction((function(t){var n=t.is2UpdateInServer,c=void 0===n||n;so.a.createNewMeshFromOldUsingNewPoints(r,o,a,e,so.a.onAddNewPointKeyPointUpdate),a.mesh.position=i,c&&e.updateNodeInServer(a.name)})).build())}))}))}))}))}},{key:"insertPointInCurve",value:function(e,t,n,o){var r=kn.a.getLocalCoordFromWorld({parent:n.mesh},Cn.a.ofBabylon(o)),a=n.localPath.map((function(e){return Cn.a.of(e)})),i=a.map((function(e,t){return{distance:r.sub(e).length(),index:t}})).sort((function(e,t){return e.distance-t.distance})),c=Math.min(i[0].index,i[1].index),s=a.map((function(e){return e.toBabylon()})),u=[].concat(on()(s.slice(0,c+1)),[r.toBabylon()],on()(s.slice(c+1)));so.a.createNewMeshFromOldUsingNewPoints(u,e,n,t,so.a.onAddNewPointKeyPointUpdate)}}]),n}(zn),jo="temp_curve",Vo=Lo;function Uo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function zo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Uo(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Uo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Ko=ln.b.RADIUS,Wo=se.Utils.mod,qo=function(e){z()(n,e);var t=Go(n);function n(e,o,r,a){var i,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return D()(this,n),i=t.call(this,e,c),d()(V()(i),"getType",(function(){return n.TYPE})),i.localPolygon=o,i.height=r,i.keyPoints=a,i.navigationAllowed=s,i}return L()(n,[{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.localPolygon=this.localPolygon,e.height=this.height,e.navigationAllowed=this.navigationAllowed,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"toForm",value:function(){var e=Pn()(q()(n.prototype),"toForm",this).call(this),t=zo({},e.jsonSchema.properties),o={type:"object",properties:{oldName:t.oldName,name:t.name,type:t.type,navigationAllowed:{type:"boolean",title:"Navigation allowed"},position:t.position,rotation:t.rotation,color:t.color,annotations:t.annotations}};return e.jsonSchema=o,e.data.navigationAllowed=this.navigationAllowed,e}},{key:"ofForm",value:function(e){Pn()(q()(n.prototype),"ofForm",this).call(this,e),this.navigationAllowed=Boolean(e.navigationAllowed)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing polygon or null mainView");var r=t.localPolygon.map((function(e){return Cn.a.of(e).toBabylon()})),a=Cn.a.of(t.position).toBabylon(),i=Ho(e,r,t.height,t.name);i.position=a,i.rotationQuaternion=cn.Quaternion.Identity();var c=new cn.StandardMaterial("PolygonMaterial".concat(t.name),e),s=new cn.Color3(t.color[0],t.color[1],t.color[2]);c.diffuseColor=s,c.emissiveColor=s,i.material=c,i.visibility=t.color[3]||Xo,Mn.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new cn.Quaternion(e[1],e[2],e[3],e[0]);i.rotationQuaternion=t.normalize()}));var u=Zo(e,r,i,o);return new n(i,r.map((function(e){return[e.x,e.y,e.z]})),t.height,u,t.keyValueMap,t.navigationAllowed)}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Yo,a=n.mesh,i=kn.a.pointAverage(e);e=e.map((function(e){return e.subtract(i)}));var c=kn.a.getRotationMatrix(a),s=Cn.a.ofBabylon(a.scaling),u=c.prodVec(Cn.a.ofBabylon(i).mul(s)).toBabylon(),l=Ho(t,e,n.height,a.name);l.parent=a.parent,l.rotationQuaternion=a.rotationQuaternion,l.position=u.add(a.position),l.material=a.material,l.visibility=a.visibility,l.onClick=a.onClick,l.getMouseContextActions=a.getMouseContextActions,l.nodeItem=a.nodeItem,l.observers=a.observers,a.graphVertex&&(l.graphVertex=a.graphVertex,l.graphVertex.vertex.mesh=l),n.localPolygon=e.map((function(e){return Cn.a.ofBabylon(e).toArray()})),n.mesh=l,n.keyPoints=r(t,o,a,n);var f=on()(a._children);return f.filter((function(e){return o.getNodeFromTree(e.name).isJust()})).forEach((function(e){e.parent=n.mesh})),a.dispose(),e}},{key:"deleteKeyPointWithUndo",value:function(e,t,o){var r=t.index,a=t.parent.name;o.getNodeFromTree(a).forEach((function(t){var i=t.item,c=zo({},i.mesh.position),s=i.localPolygon.map((function(e){return Cn.a.of(e).toBabylon()}));3!==s.length&&o.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,r,c,s,e,i,o))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,o,r,a,i,c){return se.UndoManager.actionBuilder().doAction((function(){var o=on()(r);o.splice(t,1),n.createNewMeshFromOldUsingNewPoints(o,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).undoAction((function(t){var s=t.is2UpdateInServer,u=void 0===s||s,l=on()(r);i.mesh.position=o,n.createNewMeshFromOldUsingNewPoints(l,a,i,c,n.onAddNewPointKeyPointUpdate),u&&c.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,o){return Zo(e,o.localPolygon.map((function(e){return Cn.a.of(e).toBabylon()})),o.mesh,t)}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,o,r,a,i,c,s){return se.UndoManager.actionBuilder().doAction((function(){for(var i=a.length,u=Wo(t+o,i),l=[],f=t+Math.max(0,o),d=0;d<f;d++)l.push(a[d]);l.push(a[u].add(a[t]).scale(.5));for(var h=f;h<i;h++)l.push(a[h]);n.createNewMeshFromOldUsingNewPoints(l,c,r,s,n.onAddNewPointKeyPointUpdate),s.updateNodeInServer(e)})).undoAction((function(t){var o=t.is2UpdateInServer,u=void 0===o||o,l=on()(a);r.mesh.position=i,n.createNewMeshFromOldUsingNewPoints(l,c,r,s,n.onAddNewPointKeyPointUpdate),u&&s.updateNodeInServer(e)})).build()}}]),n}(On.a);d()(qo,"TYPE","PolygonRegion"),d()(qo,"addKeyPointInBetween",(function(e,t,n,o){var r=t.index,a=t.parent.name;n.getNodeFromTree(a).forEach((function(t){var i=t.item,c=zo({},i.mesh.position),s=i.localPolygon.map((function(e){return Cn.a.of(e).toBabylon()}));n.getUndoManager().doIt(qo.getUndoAddKeyPointInBetween(a,r,o,i,s,c,e,n))}))}));var _o=function(e){var t=[];return t.push(e[1]),t.push(e[0]),t.push(e[2]),t},Ho=function(e,t,n,o){var r=new cn.Vector3(0,0,n),a={positions:[],faces:[]};a.positions=on()(t);for(var i=0;i<t.length;i++)a.positions.push(t[i].add(r));var c=t.length,s=kn.a.triangulatePolygon(t),u=kn.a.triangulatePolygon(a.positions.slice(c)).map((function(e){return e.map((function(e){return e+c}))})).map(_o),l=function(e){for(var t=e.length,n=kn.a.computeOrientation(e),o=[],r=0;r<t;r++){var a=(r+1)%t;o.push([r,t+a,a]),o.push([r,t+r,t+a])}return n>0?o:o.map(_o)}(t);return a.faces=s.concat(u).concat(l),kn.a.meshFromPositionAndFaces(o,e,a.positions,a.faces)};function Yo(e,t,n,o){return on()(n._children).forEach((function(e){e.parent=o.mesh,console.log("Moving parents of child",e.name)})),o.keyPoints.map((function(r,a){return r.observers=new cn.Observable,r.observers.add(Qo(e,t)),r.index=a,r.name="".concat(n.name,"keyPoint").concat(a),r.position=Cn.a.of(o.localPolygon[a]).toBabylon(),r}))}var Qo=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;o.parent&&t.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh.name,s=i.localPolygon.map((function(e){return Cn.a.of(e).toBabylon()}));s[a]=o.position,qo.createNewMeshFromOldUsingNewPoints(s,e,i,t),r&&t.updateNodeInServer(c),Mn.Maybe.fromNull(i.mesh.observers).forEach((function(e){i.mesh.getAbsolutePosition(),e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:r,displacement:cn.Vector3.Zero()})})),Mn.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){var t=e.vertexObs;i.mesh.getAbsolutePosition(),t({updatedPointMesh:i.mesh,is2updateServer:r,displacement:cn.Vector3.Zero()})}))}))}},Zo=function(e,t,n,o){var a=[];return t.forEach((function(t,r){var i=new cn.Color3(.25,.25,.25),c=kn.a.createSphere(e,i,Ko,"".concat(n.name,"keyPointPolygon").concat(r),!0);c.parent=n,c.position=t,c.index=r,c.observers=new cn.Observable,a.push(c),c.observers.add(Qo(e,o))})),a.forEach((function(t){t.onClick=function(){o.setContextActions(function(e,t,n){var o=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){n.item.localPolygon.length>3&&o.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-trash"},e))},action:function(n){qo.deleteKeyPointWithUndo(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),o.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-less-than"},e))},action:function(n){qo.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),o.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-greater-than"},e))},action:function(n){qo.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),o}(e,t,o))},t.onDel=function(){return qo.deleteKeyPointWithUndo(e,t,o)}})),a},Xo=.5,Jo=qo;function $o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var er=function(e){z()(n,e);var t=$o(n);function n(){var e,o,a;return D()(this,n),a=t.call(this),d()(V()(a),"action",(function(t){Pn()((e=V()(a),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(a))})),d()(V()(a),"onChange",(function(e){a.mouseCurve.length>2&&e.getSceneMemory().forEach((function(t){var n=t.scene;e.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,e))}))})),d()(V()(a),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground,r=e.camera;kn.a.getGroundPosition(n,o).forEach((function(o){r.detachControl(e.canvas),a.mouseCurve.push(o),t.getUndoManager().doIt(a.getUndoAbleClickAction(a.mouseCurve,n,t,e))}))}))})),d()(V()(a),"getDrawPolygonContextAction",(function(e,t,n){var o=[];return o.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(tr,!1),a.mouseCurve=[],n.closeContextDial()},name:"Clear Polygon [ESC | DEL | Backspace]"}),a.mouseCurve.length>2&&o.push({icon:function(e){return r.a.createElement("i",je()({className:"fas fa-check"},e))},action:function(o){e.attachControl(t,!0),o.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,o))},name:"Create Polygon [Enter]"}),o})),d()(V()(a),"onPointerMove",(function(e,t){})),d()(V()(a),"onPointerUp",(function(e,t){})),d()(V()(a),"onKeyUp",(function(e,t){var r=function(){return Pn()((o=V()(a),q()(n.prototype)),"onKeyUp",o).call(o,e,t)};t.getSceneMemory().forEach((function(n){var o=n.scene,i=n.camera,c=n.canvas,s=a.getDrawPolygonContextAction(i,c,o);Kn([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return s[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return s[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){s[0].action(t)}}],r)(e)}))})),d()(V()(a),"createPolygonRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:cn.Color3.Yellow(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=o.getRootNode().item.mesh,s=e.map((function(e){return kn.a.getLocalCoordFromWorld({parent:c},Cn.a.ofBabylon(e))})),u=kn.a.pointAverageVec3(s),l=s.map((function(e){return e.sub(u)})),f=Jo.ofDict(n,{name:t,position:u.toArray(),color:[a.r,a.g,a.b],localPolygon:l.map((function(e){return e.toArray()})),height:i},o);f.mesh.parent=c,o.addNodeItem2Tree(f,c.name,r,!0,r)})),a.key="drawPolygonRegion",a.name="Draw Polygon Region [5]",a.mouseCurve=[],a.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-draw-polygon"},e))},a}return L()(n,[{key:"getUndoAbleClickAction",value:function(e,t,n,o){var r=this,a=o.camera,i=o.canvas,c=on()(e);return se.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:c;n.deleteNodeFromTreeUsingName(tr,!1,!1),r.createPolygonRegion(e,tr,t,n,!1),n.setContextActions(r.getDrawPolygonContextAction(a,i,t)),r.mouseCurve=c})).undoAction((function(e){var o=e.is2UpdateInServer,a=void 0===o||o;n.deleteNodeFromTreeUsingName(tr,a);var i=c.slice(0,c.length-1),s=1===i.length?[i[0],i[0]]:i;a&&i.length>0&&r.createPolygonRegion(s,tr,t,n,!1),r.mouseCurve=i})).build()}},{key:"getUndoAbleEnterAction",value:function(e,t,n){var o=this,r=on()(e),a="PolygonRegion".concat(Math.floor(1e3*Math.random()));return se.UndoManager.actionBuilder().doAction((function(){n.deleteNodeFromTreeUsingName(tr,!1),o.createPolygonRegion(r,a,t,n,!0),o.mouseCurve=[],n.setPropertiesWithName(a),n.closeContextDial()})).undoAction((function(e){var i=e.is2UpdateInServer,c=void 0===i||i;n.deleteNodeFromTreeUsingName(a,c),c&&(o.createPolygonRegion(r,tr,t,n,!1),o.mouseCurve=r)})).build()}}]),n}(zn),tr="temp_polygon_region",nr=er;function or(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var rr=function(e){z()(n,e);var t=or(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onPointerDown",(function(e,t){})),d()(V()(o),"onPointerMove",(function(e,t){})),d()(V()(o),"onPointerUp",(function(e,t){})),o.key="orbit",o.name="Orbit [ESC]",o.maybeSelectedMesh=Mn.Maybe.none(),o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-globe"},e))},o}return n}(zn);function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var ir=function(e){z()(n,e);var t=ar(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o)),t.getGraph().forEach((function(e){e.isVisible||e.item.mesh.setEnabled(!0)}))})),d()(V()(o),"onPointerDown",(function(e,t){1===e.buttons&&o.mousePosConsumer(t)((function(e,n){var r=n.scene,a=n.ground,i=kn.a.pickMesh(r,a).filter(o.isConnectableMesh(t));i.forEach((function(r){t.highlightMeshesInScene([r],cn.Color3.Green()),o.onPointerDownLine(e,r,n,t)})),i.orElseRun((function(){t.highlightMeshesInScene(),o.resetPreview()}))}))})),d()(V()(o),"onPointerMove",(function(e,t){o.mousePosConsumer(t)((function(e,n){var r=n.scene,a=n.ground;kn.a.pickMesh(r,a).filter(o.isConnectableMesh(t)).cata((function(){return t.highlightMeshesInScene()}),(function(e){return t.highlightMeshesInScene([e],cn.Color3.Green())})),o.firstMousePos&&o.onPointerMoveLine(e,n,t)}))})),d()(V()(o),"onPointerUp",(function(e,t){})),d()(V()(o),"onKeyUp",(function(e,t){Kn([{predicate:function(e){return["Backspace","Delete","Escape"].includes(e.code)},action:function(){return o.resetPreview()}}])(e)})),d()(V()(o),"resetPreview",(function(){o.firstMousePos&&(o.deletePreviewMeshes(),o.firstMousePos=void 0,o.firstClickedMesh=void 0)})),d()(V()(o),"deletePreviewMeshes",(function(){o.previewMeshes.forEach((function(e){return e.dispose()})),o.previewMeshes=[]})),d()(V()(o),"mousePosConsumer",(function(e){return function(t){e.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground;kn.a.getGroundPosition(n,o).forEach((function(n){return t(n,e)}))}))}})),d()(V()(o),"isConnectableMesh",(function(e){return function(t){return e.getNodeFromTree(t.name).cata((function(){var n,o=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(o).filter((function(e){return e.item.getType()===so.a.TYPE})).filter((function(e){var n=e.item,o=t.index;return 0===o||o===n.keyPoints.length-1}))}),(function(e){var n=e.item;return Mn.Maybe.some(t).filter((function(e){return n.getType()!==so.a.TYPE&&n.getType()!==En.b.TYPE}))})).orSome(!1)}})),d()(V()(o),"belongsToPath",(function(e){return function(t){var n,o=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(o).filter((function(e){return e.item.getType()===so.a.TYPE})).map((function(e){return e.item.name}))}})),d()(V()(o),"belongs2SamePath",(function(e){return function(t,n){var r=o.belongsToPath(e);return r(t).flatMap((function(e){return r(n).map((function(t){return e===t}))})).orSome(!1)}})),d()(V()(o),"onPointerDownLine",(function(e,t,n,r){var a=n.scene;o.firstMousePos?o.belongs2SamePath(r)(t,o.firstClickedMesh)||co.a.isInvalidEdge(o.firstClickedMesh,t)?o.resetPreview():r.getUndoManager().doIt(o.getUndoAbleLineEdge([o.firstClickedMesh,t],a,r,t)):(o.firstMousePos=e,o.firstClickedMesh=t)})),d()(V()(o),"getUndoAbleLineEdge",(function(e,t,n){return se.UndoManager.actionBuilder().doAction((function(){o.createEdge(e,t,n),o.resetPreview()})).undoAction((function(t){var r=t.is2UpdateInServer,a=void 0===r||r;o.deleteEdge(e,n,a)})).build()})),d()(V()(o),"onPointerMoveLine",(function(e,t,n){var r=t.scene,a=n.getRootNode().item.mesh,i=cr(n)([o.firstMousePos,e]);o.deletePreviewMeshes(),o.previewMeshes=[co.a.getEdgeMesh(r,i,"previewEdge",cn.Color3.Blue(),ln.b.RADIUS/4)],o.previewMeshes.forEach((function(e){e.visibility=.25,e.parent=a,e.isPickable=!1}))})),d()(V()(o),"createEdge",(function(e,t,n){co.a.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var o=t.item;o.addEdge.apply(o,on()(e)),n.updateNodeInServer(o.name)}))})),d()(V()(o),"deleteEdge",(function(e,t,n){t.getGraph().forEach((function(o){var r=o.item;r.delEdge.apply(r,on()(e)),n&&t.updateNodeInServer(r.name)}))})),o.key="drawGraph",o.name="Draw Graph [6]",o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-project-diagram"},e))},o.previewMeshes=[],o.firstMousePos=void 0,o.firstClickedMesh=void 0,o}return L()(n,[{key:"onChange",value:function(){this.resetPreview()}}]),n}(zn),cr=kn.a.toGlobalCoord,sr=ir;function ur(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var lr=function(e){z()(n,e);var t=ur(n);function n(){var e,o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(t){Pn()((e=V()(o),q()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(V()(o))})),d()(V()(o),"onChange",(function(e){o.resetMeasure(e)})),d()(V()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground,i=n.camera,c=n.canvas;kn.a.getGroundPosition(r,a).forEach((function(n){var a=kn.a.toGlobalCoord(t)(n);o.ruler.push(a),o.ruler.length>2?o.resetMeasure(t):2===o.ruler.length?(o.rulerMesh&&o.rulerMesh.dispose(),o.rulerMesh=o.createRulerMesh(o.ruler,r,t),o.addTextGUI(r,o.calculateDistance(o.ruler[0],a),e),i.attachControl(c,!0)):i.detachControl(c)}))}))})),d()(V()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;kn.a.getGroundPosition(r,a).forEach((function(n){var a=kn.a.toGlobalCoord(t)(n);o.ruler.length>=2&&(4===e.buttons||.5===e.pressure)&&o.resetMeasure(t),1===o.ruler.length&&(o.rulerMesh&&o.rulerMesh.dispose(),o.rulerMesh=o.createRulerMesh([o.ruler[0],a],r,t),o.addTextGUI(r,o.calculateDistance(o.ruler[0],a),e))}))}))})),d()(V()(o),"onPointerUp",(function(e,t){})),d()(V()(o),"onWheel",(function(e,t){Math.abs(e.deltaY)>0&&o.resetMeasure(t)})),d()(V()(o),"calculateDistance",(function(e,t){var n=Hn.a.ofBabylon(e),o=Hn.a.ofBabylon(t);return n.sub(o).length().toFixed(3)})),d()(V()(o),"addTextGUI",(function(e,t,n){this.advancedTexture||(this.advancedTexture=Fn.AdvancedDynamicTexture.CreateFullscreenUI("UI Ruler",!0,e)),this.text&&this.advancedTexture.removeControl(this.text),this.text=new Fn.TextBlock,this.text.text="".concat(t,"m"),this.text.fontSize=17,this.text.left=e.pointerX-n.target.width/2+20,this.text.top=e.pointerY-n.target.height/2+20,this.text.color="white",this.advancedTexture.addControl(this.text)})),o.key="drawWall",o.name="Measure [7]",o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-ruler"},e))},o.ruler=[],o.rulerMesh=null,o.advancedTexture=null,o.text=null,o}return L()(n,[{key:"resetMeasure",value:function(e){this.rulerMesh&&this.rulerMesh.dispose(),this.text&&this.text.dispose(),this.ruler=[],e&&e.getSceneMemory().forEach((function(e){var t=e.camera,n=e.canvas;t.attachControl(n,!0)}))}},{key:"createRulerMesh",value:function(e,t,n){var o=cn.MeshBuilder.CreateLines("ruler",{points:e,updatable:!0},t),r=n.getRootNode().item.mesh;return o.parent=r,o}}]),n}(zn),fr=n(42);function dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var hr=function(e){z()(n,e);var t=dr(n);function n(e){var o;return D()(this,n),o=t.call(this),d()(V()(o),"action",(function(e){setTimeout((function(){o.uIInOut("Navigation preview params",(function(){return r.a.createElement("div",{style:{marginTop:"7px"}})}))})),e.setSelectedAction(V()(o))})),d()(V()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,a=e.camera,i=e.canvas;kn.a.getGroundPosition(n,r).forEach((function(e){a.detachControl(i),o.poses.length>=2&&o.resetData(),o.maybeFirstClickPos=Mn.Maybe.some(kn.a.toGlobalCoord(t)(e))}))}))})),d()(V()(o),"onPointerMove",(function(e,t){o.maybeFirstClickPos.forEach((function(e){t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;kn.a.getGroundPosition(r,a).forEach((function(n){var a=kn.a.toGlobalCoord(t)(n);o.previewPoseMesh&&o.previewPoseMesh.dispose(),o.previewPoseMesh=o.createPreviewPose(r,t,e,a)}))}))}))})),d()(V()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,a=e.camera,i=e.canvas;o.maybeFirstClickPos.forEach((function(e){kn.a.getGroundPosition(n,r).forEach((function(r){var a=kn.a.toGlobalCoord(t)(r),i=o.createPreviewPose(n,t,e,a,!0);i.material=o.poseMeshes.push(i);var c=Cn.a.ofBabylon(e),s=Cn.a.ofBabylon(a).sub(c),u=Math.atan2(s.y,s.x);o.poses.push({position:c.toArray(),orientation:[Math.cos(u/2),0,0,Math.sin(u/2)]}),2===o.poses.length&&(o.createNavPreviewNode(n,t),o.resetData())}))})),a.attachControl(i,!0),o.previewPoseMesh&&o.previewPoseMesh.dispose(),o.maybeFirstClickPos=Mn.Maybe.none()}))})),o.key="navigationPreviewAction",o.name="Add navigation preview [8]",o.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-road"},e))},o.uIInOut=e,o.maybeFirstClickPos=Mn.Maybe.none(),o.previewPoseMesh=void 0,o.poses=[],o.poseMeshes=[],o.schema={jsonSchema:{type:"object",properties:{type:{type:"string",title:"Type"},config:{type:"string",title:"Robot Configuration"}}},uiSchema:{type:{"ui:disabled":!0},config:{"ui:widget":"selectScopeModal","ui:options":{scopeList:"Configuration",name:"Robot Config",filter:function(e){return!0}}}},data:{type:fr.a.TYPE,config:""}},o}return L()(n,[{key:"onChange",value:function(e){e.renderMenus(),this.resetData()}},{key:"resetData",value:function(){this.maybeFirstClickPos=Mn.Maybe.none(),this.previewPoseMesh&&this.previewPoseMesh.dispose(),this.poses=[],this.poseMeshes.forEach((function(e){return e.dispose()})),this.poseMeshes=[]}},{key:"createPreviewPose",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=1.3,i=o.subtract(n),c=i.length(),s=r?a/c:Math.min(a/c,c),u=n.add(i.scale(s)),l=kn.a.getArrow(e,"previewPose",n,u,ln.b.RADIUS/6),f=t.getRootNode().item.mesh;return l.parent=f,l}},{key:"createNavPreviewNode",value:function(e,t){var n="Navigation".concat(Math.floor(100*Math.random())),o=on()(this.poses),r=this.schema.data.config;t.getUndoManager().doIt(se.UndoManager.actionBuilder().doAction((function(){var a=t.getRootNode().item.mesh,i=fr.a.ofDict(e,{name:n,poses:o,robotConfig:r},t);i.mesh.parent=a,t.addNodeItem2Tree(i,a.name)})).undoAction((function(){t.deleteNodeFromTreeUsingName(n)})).build())}}]),n}(zn),mr=function(e){return e?{measure:new lr,orbit:new rr}:{robotPreview:new hr((function(e,t){})),measure:new lr,drawGraph:new sr,drawRegion:new nr,addKeyPoint:new Ao,drawBoxRegion:new Do,drawPath:new Vo,dragObjects:new vo,orbit:new rr}},pr=function(){function e(t){D()(this,e),this.yamlSrc=t,this.cachedMap=null}var t,n;return L()(e,[{key:"load",value:(n=tn()(an.a.mark((function t(){var n,o,r;return an.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cachedMap){t.next=2;break}return t.abrupt("return",this.cachedMap);case 2:return t.next=4,fetch(e.getMapUrl(this.yamlSrc));case 4:return n=t.sent,t.t0=this,t.next=8,n.text();case 8:return t.t1=t.sent,t.next=11,t.t0.parseYaml.call(t.t0,t.t1);case 11:return o=t.sent,r={textureSrc:o.image,resolution:o.resolution,origin:o.origin,imageSize:o.size},this.cachedMap=r,t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"parseYaml",value:(t=tn()(an.a.mark((function t(n){var o,r;return an.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={},r={image:function(t,n){return o[t]=e.getMapUrl(n)},resolution:function(e,t){return o[e]=Number.parseFloat(t)},origin:function(e,t){return o[e]=JSON.parse(t)}},console.log("Yaml text",n),n.split("\n").map((function(e){return e.split(": ")})).filter((function(e){return e.length>=2})).filter((function(e){return e[0]in r})).forEach((function(e){return r[e[0]](e[0],e[1])})),t.next=6,this.getImageSize(o.image);case 6:return o.size=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getImageSize",value:function(e){return new Promise((function(t,n){var o=new Image;o.src=e,o.onload=function(){return t([o.naturalWidth,o.naturalHeight])}}))}}]),e}();d()(pr,"getMapUrl",(function(e){return"/static/maps/".concat(e)}));var vr=n(28),gr=n.n(vr),yr=function(){function e(){D()(this,e),this._count=0,this._mean=0,this._M2=0}return L()(e,[{key:"update",value:function(e){this._count+=1;var t=e-this._mean;this._mean+=t/this._count;var n=e-this._mean;return this._M2+=t*n,this}},{key:"count",get:function(){return this._count}},{key:"mean",get:function(){return this._count<2?Number.NaN:this._mean}},{key:"variance",get:function(){return this._count<2?Number.NaN:this._M2/this._count}},{key:"sampleVar",get:function(){return this._count<2?Number.NaN:this._M2/(this._count-1)}},{key:"isOutlier",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=(e-this.mean)/Math.sqrt(this.variance);return Number.isNaN(n)||Math.abs(n)>t}}]),e}();function br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var wr=function(e){z()(n,e);var t=Ar(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;D()(this,n),r=t.call(this,e.mesh,o,a),d()(V()(r),"updateRobot",(function(e,t,n){var o=(new Date).getTime();n(e,.001*(o-t)),r.requestAnimationFrameId=requestAnimationFrame((function(){return r.updateRobot(e,o,n)}))})),d()(V()(r),"animate",(function(e){r.requestAnimationFrameId=requestAnimationFrame((function(){return r.updateRobot(V()(r),(new Date).getTime(),e)}))})),d()(V()(r),"getType",(function(){return n.TYPE})),r.robot=c.getRobotManager().getRobot(e.id),r.scene=i,r.isOnline=!0,r.numberOfIte=0,r.is2UsePos=!0,r.meshTree=e,r.parentView=c,r.timeSinceLastUpdate=0,r.isSubscribedToLogs=!0,r.speedStats=new yr,r.alert=null,r.loggerSubscription=null,r.requestAnimationFrameId=null,r.speed=cn.Vector3.Zero(),r.qSpeed=cn.Quaternion.Zero(),r.newPos=cn.Vector3.Zero(),r.newOri=cn.Quaternion.Identity(),r.alertMesh=r.buildAlertMesh(e,i);var s=r.robot.getIP(r.onGetIP(V()(r)));return s&&r.startLogger(),kn.a.addClickActionToMesh(r.alertMesh,i,r.onMeshAlertClick(V()(r))),r}return L()(n,[{key:"buildAlertMesh",value:function(e,t){if(this.alertMesh)return this.alertMesh;var n=cn.MeshBuilder.CreateDisc("AlertDisc".concat(e.name),{radius:.2,sideOrientation:cn.Mesh.DOUBLESIDE}),o=new cn.StandardMaterial("AlertMat".concat(e.name),t);return o.emissiveColor=new cn.Color3.White,o.ambientTexture=new cn.Texture("data:image/png;base64,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",t),o.freeze(),n.material=o,n.isStatic=!0,n.position.y=-1.5,n.parent=e.mesh,n.setEnabled(!1),n.billboardMode=cn.Mesh.BILLBOARDMODE_ALL,n}},{key:"onMeshAlertClick",value:function(e){return function(){e.parentView.showRobotAlertModal(e.alert)}}},{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.isSubscribedToLogs=this.isSubscribedToLogs,e}},{key:"toForm",value:function(){var e=Pn()(q()(n.prototype),"toForm",this).call(this),t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.jsonSchema.properties),o={type:"object",properties:{oldName:t.oldName,name:t.name,type:t.type,position:t.position,rotation:t.rotation,color:t.color,annotations:t.annotations}};return e.jsonSchema=o,e.data.isSubscribedToLogs=this.isSubscribedToLogs,e}},{key:"ofForm",value:function(e){Pn()(q()(n.prototype),"ofForm",this).call(this,e),this.isSubscribedToLogs=Boolean(e.isSubscribedToLogs),e.isSubscribedToLogs&&this.robot.ip?this.startLogger():this.stopLogger(!0)}},{key:"dispose",value:function(){Pn()(q()(n.prototype),"dispose",this).call(this),this.robot.unsubscribe({property:"Parameter",propValue:"tf"}),window.cancelAnimationFrame(this.requestAnimationFrameId)}},{key:"toOffline",value:function(){this.mesh.isDisposed()||(this.mesh.visibility=.1,this.speed=cn.Vector3.Zero(),this.qSpeed=cn.Quaternion.Zero(),this.isOnline=!1,this.numberOfIte=0,this.speedStats=new yr,this.stopLogger())}},{key:"toOnline",value:function(){this.mesh.isDisposed()||(this.mesh.visibility=1,this.isOnline=!0,this.startLogger())}},{key:"startLogger",value:function(){this.loggerSubscription||(this.loggerSubscription=this.robot.subscribeToLogs(this.updateAlertState(this)))}},{key:"stopLogger",value:function(e){this.loggerSubscription&&(this.robot.unsubscribeToLogs(this.loggerSubscription),this.loggerSubscription=null),e&&this.alertMesh.setEnabled(!1)}},{key:"updateAlertState",value:function(e){return function(t){e.timeSinceLastUpdate=0,t.length>0&&("ERROR"===t[0].level||"CRITICAL"===t[0].level)?(e.alert=t[0],e.alertMesh.setEnabled(!0)):e.alertMesh.setEnabled(!1)}}},{key:"onGetIP",value:function(e){return function(t){t&&e.startLogger()}}}],[{key:"updateRobotMeshTree",value:function(e,t){var n=t.mesh.position,o=t.mesh.rotationQuaternion,r=new cn.Vector3(e.position.x,e.position.y,e.position.z),a=new cn.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w).normalize();t.numberOfIte++;var i=0===t.timeSinceLastUpdate?1:Math.min(1/t.timeSinceLastUpdate,1),c=r.subtract(n).scale(i),s=a.subtract(o).scale(i),u=c.length();t.numberOfIte<Er&&t.speedStats.update(u),t.speedStats.isOutlier(u)?t.is2UsePos=!0:(t.speedStats.update(u),t.speed=c,t.qSpeed=s,t.is2UsePos=!1),t.newPos=r,t.newOri=a,t.timeSinceLastUpdate=0}},{key:"setOnOffLine",value:function(e){e.timeSinceLastUpdate>n.TIME_2_BE_OFFLINE_IN_SEC?e.isOnline&&e.toOffline():(e.timeSinceLastUpdate>n.TIME_2_BE_OFFLINE_IN_SEC/4&&(e.is2UsePos=!0),e.isOnline||e.toOnline())}},{key:"createRobotMeshTreeRecursive",value:function(e,t,n,o){var r=this;t||(t=kn.a.createSphere(o,new cn.Color3(0,0,0),.5,e.name,!1));var a={mesh:t,children:[]},i=new cn.Vector3(e.position.x,e.position.y,e.position.z),c=new cn.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w);return t.position=i,t.rotationQuaternion=c,n&&(t.parent=n),a.children=e.child.map((function(e){return r.createRobotMeshTreeRecursive(e,kn.a.referentialBuilder(o).boxParams({isVisible:!1,size:.1}).build(),t,o)})),a}},{key:"createRobotMeshTree",value:function(e,t,o){return n.createRobotMeshTreeRecursive(e,t,null,o)}},{key:"builder",value:function(){return new Mr}}]),n}(Tn);d()(wr,"ROBOT_MESH_NAME","Tugbot.stl"),d()(wr,"TYPE","Robot"),d()(wr,"TIME_2_BE_OFFLINE_IN_SEC",10),d()(wr,"createBaseObject",(function(e){var t=e.robotName,n=e.robotMeshName,o=void 0===n?wr.ROBOT_MESH_NAME:n,r=e.id,a=void 0===r?wr.randomId():r,i=e.nodeDict,c=void 0===i?{position:[0,0,0],quaternion:[1,0,0,0]}:i;return{id:a,name:t,type:wr.TYPE,meshName:o,robotTree:{name:t,child:[],position:{x:c.position[0],y:c.position[1],z:c.position[2]},orientation:{w:c.quaternion[0],x:c.quaternion[1],y:c.quaternion[2],z:c.quaternion[3]}}}})),d()(wr,"getDefaultAnimator",(function(e){return function(e,t){var n=e.mesh,o=kn.a.getRotationMatrix(n).prodVec(new Cn.a([3,0,0])).toBabylon();n.position=n.position.add(o.scale(t)),n.rotate(cn.Axis.Z,-Math.PI/2*t,cn.Space.LOCAL)}})),d()(wr,"getSocketAnimator",(function(e,t){var n=function(t){var n=gr()(t,"Robot.".concat(e.meshTree.id,".Parameter.tf.Value"),void 0);n&&wr.updateRobotMeshTree(n,e)};return e.robot.subscribe({property:"Parameter",propValue:"tf",onLoad:function(e){return n(null==e?void 0:e.value)},onUpdate:function(e){return n(null==e?void 0:e.key)}}),function(t,n){t.timeSinceLastUpdate+=n,n=Math.min(n,1),Cn.a.ofBabylon(t.speed).someNaNOrInfinite()||Cn.a.ofBabylon(t.qSpeed).someNaNOrInfinite()||(t.is2UsePos?(t.mesh.position=t.newPos,t.mesh.rotationQuaternion=t.newOri):(t.mesh.position=t.mesh.position.add(t.speed.scale(n)),t.mesh.rotationQuaternion=t.mesh.rotationQuaternion.add(e.qSpeed.scale(n)).normalize()),wr.setOnOffLine(t))}}));var Mr=function(){function e(){D()(this,e),this._name=null,this._meshTree=null,this._parentMesh=null,this._parentView=null,this._scene=null,this._isPickable=!0,this._id=null,this._keyValueMap={},this._assetName=null}return L()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"meshTree",value:function(e){return this._meshTree=e,this}},{key:"parentMesh",value:function(e){return this._parentMesh=e,this}},{key:"parentView",value:function(e){return this._parentView=e,this}},{key:"scene",value:function(e){return this._scene=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"id",value:function(e){return this._id=e,this}},{key:"keyValueMap",value:function(e){return this._keyValueMap=e,this}},{key:"assetName",value:function(e){return this._assetName=e,this}},{key:"build",value:function(){var e=this;return Object.keys(this).filter((function(e){return"_parentMesh"!==e})).map((function(t){return e[t]})).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a robot, e.g ".concat(e))})),this._meshTree.id=this._id,this._meshTree.name=this._name,this._meshTree.mesh.name=this._name,this._meshTree.mesh.isPickable=this._isPickable,this._meshTree.mesh.parent=this._parentMesh,kn.a.referentialBuilder(this._scene).isPickable(!1).boxParams({isVisible:!1,size:.1}).name("".concat(this._name,"Axis")).build().parent=this._meshTree.mesh,new wr(this._meshTree,this._assetName,this._keyValueMap,this._scene,this._parentView)}}]),e}(),Er=30,xr=wr;function Pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var kr=function(){function e(){var t=this;if(D()(this,e),d()(this,"getAssets",(function(){return t.assets})),d()(this,"getAssetsActionMap",(function(){return t.assetsActionMap})),d()(this,"load",tn()(an.a.mark((function e(){return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.retrieveAssetsFromDb();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))),d()(this,"signalObservers",(function(){Object.keys(t.observersBySceneId).forEach((function(e){t.observersBySceneId[e].forEach((function(e){return e(t)}))}))})),d()(this,"subs",[function(e){return se.MasterDB.subscribe({Scope:"Robot",Name:"*",RobotName:"*"},t.getRobotUpdate(),(function(n){return t.getRobotNameSub(n.value,(function(){t.addRobots(),t.finishSub("RobotName",e)}))}))},function(e){return se.MasterDB.subscribe({Scope:"Robot",Name:"*",Parameter:"mesh"},t.getRobotUpdate(),(function(n){return t.getRobotMeshSub(n.value,(function(){t.addRobots(),t.finishSub("RobotMesh",e)}))}))},function(e){return se.MasterDB.subscribe({Scope:"Package",File:"*",Name:"maps",FileLabel:"*"},t.getMapUpdater((function(e){return e.key})),t.getMapSubscriber((function(e){return e.value}),(function(){return t.finishSub("Maps",e)})))},function(e){return se.MasterDB.subscribe({Scope:"Package",File:"*",Name:"meshes",FileLabel:"*"},t.getMeshUpdater(),t.getMeshSubscriber((function(e){return e.value}),(function(){return t.finishSub("Meshes",e)})))}]),d()(this,"finishSub",(function(e,n){console.log("FINISH SUB ",e,t.finishInitialSubscribers),++t.finishInitialSubscribers>t.subs.length-1&&(t.afterLoad.forEach((function(e){return e(t)})),t.afterLoad=[],t.isLoading=!1,n(!0))})),d()(this,"deleteRobot",(function(e){t.robots.hasOwnProperty(e)&&(t.delAsset(t.robots[e].name),e in t.robots&&delete t.robots[e])})),d()(this,"getMapSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(o){return t.getMapFileData(e,o).forEach((function(e){Object.keys(e).filter((function(e){return e.includes(".yaml")})).forEach(t.addMap),n()}))}})),d()(this,"getMapUpdater",(function(e){var n={del:function(n){t.getMapFileData(e,n).forEach((function(e){var n=Object.keys(e)[0];n=n.split(".")[0],t.delAsset(n)}))},set:t.getMapSubscriber(e),subscribe:t.getMapSubscriber(e)};return function(e){console.log("MAP UPDATE",e),n[e.event](e)}})),d()(this,"addMap",(function(e){var n={name:e.split(".")[0],loader:new pr(e),type:ia.Map};t.addAsset(n.name,n)})),d()(this,"getMapFileData",(function(e,t){return Sr(e(t)).flatMap(Or("Package")).flatMap(Or("maps")).flatMap(Or("File"))})),d()(this,"getMeshSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(o){t.getMeshFileData(e,o).forEach((function(e){return Object.keys(e).forEach((function(n){var o={id:n,name:e[n].FileLabel,type:ia.Mesh};t.addAsset(o.name,o)}))})),n()}})),d()(this,"getMeshUpdater",(function(){var e={del:function(e){t.getMeshFileData((function(e){return e.key}),e).forEach((function(e){var n=Object.keys(e)[0];t.delAsset(n)}))},set:t.getMeshSubscriber((function(e){return e.key})),subscribe:t.getMeshSubscriber((function(e){return e.key}))};return function(t){return e[t.event](t)}})),d()(this,"getMeshFileData",(function(e,t){return Sr(e(t)).flatMap(Or("Package")).flatMap(Or("meshes")).flatMap(Or("File"))})),Cr)return Cr;Cr=this,this.assets={},this.assetsActionMap={},this.robots={},this.observersBySceneId={},this.afterLoad=[],this.finishInitialSubscribers=0,this.isLoading=!0}return L()(e,[{key:"addAfterLoad",value:function(e){return this.afterLoad.push(e),this}},{key:"addObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"addAsset",value:function(e,t){try{this.assets[e]=t,this.assetsActionMap[e]=ca[t.type](t),this.isLoading||this.signalObservers()}catch(e){throw console.log("Caught exception while adding asset",e),Error("Caught exception while adding asset ".concat(e))}}},{key:"delAsset",value:function(e){e in this.assets&&delete this.assets[e],e in this.assetsActionMap&&delete this.assetsActionMap[e],this.signalObservers()}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&(console.log("Clear asset observer",t),delete this.observersBySceneId[t])}},{key:"retrieveAssetsFromDb",value:function(){var e=this;return new Promise((function(t,n){e.subs.forEach((function(e){return e(t)}))}))}},{key:"setRobot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in this.robots||(this.robots[e]={id:e,name:null,meshName:null}),Sr(n).forEach((function(n){return t.robots[e].name=n})),Sr(o).forEach((function(n){return t.robots[e].meshName=n}))}},{key:"addRobots",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.robots;Object.keys(t).forEach((function(t){if(Object.values(e.robots[t]).every((function(e){return null!==e}))){var n=e.robots[t];e.addAsset(n.name,xr.createBaseObject({robotName:n.name,robotMeshName:n.meshName,id:t}))}}))}},{key:"getRobotNameSub",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Sr(e).flatMap(Or("Robot")).forEach((function(e){return Object.keys(e).forEach((function(n){return t.setRobot(n,e[n].RobotName)}))})),n()}},{key:"getRobotMeshSub",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Sr(e).flatMap(Or("Robot")).forEach((function(e){return Object.keys(e).forEach((function(n){return t.setRobot(n,e[n].RobotName,e[n].Parameter.mesh.Value)}))})),Object.keys(this.robots).forEach((function(e){t.robots[e].meshName=t.robots[e].meshName?t.robots[e].meshName:xr.ROBOT_MESH_NAME})),n()}},{key:"getRobotUpdate",value:function(){var e=this,t={del:function(t){var n=t.patterns[0];n.hasOwnProperty("RobotName")?Sr(t.key).flatMap(Or("Robot")).forEach((function(t){return Object.keys(t).forEach(e.deleteRobot)})):n.hasOwnProperty("Parameter")&&Sr(t.key).flatMap(Or("Robot")).forEach((function(t){return Object.keys(t).forEach((function(t){e.robots[t].meshName=xr.ROBOT_MESH_NAME}))}))},set:function(t){var n=t.patterns[0],o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.key.Robot);n.hasOwnProperty("RobotName")?e.getRobotNameSub(t.key,(function(){return e.addRobots(o)})):n.hasOwnProperty("Parameter")&&e.getRobotMeshSub(t.key,(function(){return e.addRobots(o)}))}};return function(e){console.log("Robot NAME UPDATE",e),t[e.event](e)}}}],[{key:"getInstance",value:function(){return new e}}]),e}(),Cr=null,Sr=Mn.Maybe.fromNull,Or=function(e){return(t=Sr,function(e){return function(n){return t(e(n))}})(function(e){return function(t){return t[e]}}(e));var t},Nr=kr;function Tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Ir=function(e){z()(n,e);var t=Tr(n);function n(e,o){var a;return D()(this,n),a=t.call(this),d()(V()(a),"getType",(function(){return n.TYPE})),d()(V()(a),"deleteAsset",(function(){})),d()(V()(a),"download",tn()(an.a.mark((function e(){return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),a.name=e,a.key="addMap".concat(e),a.mapLoader=o,a.icon=function(e){return r.a.createElement("i",je()({},e,{className:"fas fa-map"}))},a.firstTimeLoad=!0,a}return L()(n,[{key:"addMap",value:function(e){var t=this;e.getSceneMemory().forEach(function(){var n=tn()(an.a.mark((function n(o){var r,a,i,c,s,u,l,f,d,h,m,p,v,g,y,b,A,w,M,E;return an.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=o.scene,a=o.camera,n.next=3,t.mapLoader.load();case 3:i=n.sent,c=i.textureSrc,s=i.resolution,u=i.origin,l=i.imageSize,f=s*l[0],d=s*l[1],h=kn.a.groundBuilder(r).name(Mn.Maybe.fromNull(t.memory.name).orSome(t.name)).width(f).height(d).textureSrc(c).build(),m=ge()(u,3),p=m[0],v=m[1],g=m[2],y=Cn.a.of([-f/2,-d/2,0]).sub(Cn.a.of([p,v,0])),b=e.getRootNode(),(A=b.item.mesh.parent).position=En.b.inverseCoordinates(y.toBabylon()),A.rotationQuaternion=new cn.Quaternion(En.a.quaternion[1],En.a.quaternion[2],En.a.quaternion[3],En.a.quaternion[0]),A.rotate(cn.Axis.Z,-g,cn.Space.LOCAL),a.setTarget(new cn.Vector3(A.position.x,A.position.y,A.position.z)),w=new Dn(h,[f,d],t.textureSrc,Mn.Maybe.fromNull(t.memory.assetName).orSome(t.name)),M=Mn.Maybe.fromNull(t.memory.isVisible).orSome(!0),E=Mn.Maybe.fromNull(t.memory.isImport).map((function(e){return!e})).orSome(!0),h.setEnabled(M),e.addNodeItem2Tree(w,null,E,M),o.ground.dispose(),o.ground=Vn.createMeshGround(r,f,d),t.memory.isImport=!1;case 27:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"action",value:function(e){var t=this;Pn()(q()(n.prototype),"action",this).call(this,e),e.getNodeFromTree(this.name).orElseRun((function(){t.memory.isImport?(t.addMap(e),t.firstTimeLoad=!1):e.getUndoManager().doIt(t.getUndoAction(e))})),e.setSelectedAction(mr().orbit)}},{key:"getUndoAction",value:function(e){var t=this;if(e.getObjectTree().length<2)return se.UndoManager.actionBuilder().doAction((function(){t.addMap(e)})).undoAction((function(t){var n=t.is2UpdateInServer,o=void 0===n||n,r=e.getObjectTree()[1].title;e.deleteNodeFromTreeUsingName(r,o)})).build();var n=e.getObjectTree()[1].title,o=this.name;return se.UndoManager.actionBuilder().doAction((function(){t.switchMaps(n,o,e)})).undoAction((function(t){var r=t.is2UpdateInServer,a=void 0===r||r;e.deleteNodeFromTreeUsingName(o,a),Mn.Maybe.fromNull(Nr.getInstance().getAssetsActionMap()[n]).forEach((function(t){return t.action(e)}))})).build()}},{key:"switchMaps",value:function(e,t,n){}}]),n}(Sn);d()(Ir,"TYPE","AddMapAction");var Rr=Ir;function Br(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Dr=se.Utils.ofNull,Fr=function(e){z()(n,e);var t=Br(n);function n(e,o){var r;return D()(this,n),r=t.call(this,e),d()(V()(r),"getType",(function(){return n.TYPE})),r.robot=o,r.pointCloudSubscribe(),r}return L()(n,[{key:"pointCloudSubscribe",value:function(){var e=this;se.MasterDB.subscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"},(function(t){Mn.Maybe.fromNull(t).flatMap((function(e){return Dr(e.key)})).flatMap((function(t){return Dr(t.Robot[e.robot.id])})).flatMap((function(e){return Dr(e.Parameter)})).flatMap((function(e){return Dr(e.front_lidar)})).flatMap((function(e){return Dr(e.Value)})).flatMap((function(e){return Dr(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}),(function(t){Mn.Maybe.fromNull(t.value).flatMap((function(e){return Dr(e.Robot)})).flatMap((function(t){return Dr(t[e.robot.id])})).flatMap((function(e){return Dr(e.Parameter)})).flatMap((function(e){return Dr(e.front_lidar)})).flatMap((function(e){return Dr(e.Value)})).flatMap((function(e){return Dr(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}))}},{key:"updatePointCloud",value:function(e){var t=new cn.VertexData;t.positions=e.flatMap((function(e){return e}));var n=new Array(4*e.length);t.colors=n.fill(1),t.applyToMesh(this.mesh,!0)}},{key:"dispose",value:function(){Pn()(q()(n.prototype),"dispose",this).call(this),se.MasterDB.unsubscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"})}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing point cloud or null mainView");var r=new cn.Mesh("cloudPoint".concat(t.name),e),a=new cn.StandardMaterial("cloudPoint".concat(t.name,"Material"),e);return a.emissiveColor=new cn.Color3(1,1,1),a.disableLighting=!0,a.pointsCloud=!0,a.pointSize=2,r.material=a,new n(r,t)}}]),n}(On.a);d()(Fr,"TYPE","PointCloud");var Lr=Fr,jr=function(){function e(){if(D()(this,e),Ur)return Ur;Ur=this,this.meshCacheBySceneId={},this.count=0}return L()(e,[{key:"hasKey",value:function(e,t){var n=t._uid;return Mn.Maybe.fromNull(this.meshCacheBySceneId[n]).flatMap((function(t){return Vr(t[e])})).cata((function(){return!1}),(function(){return!0}))}},{key:"put",value:function(e,t,n){var o=t._uid;return o in this.meshCacheBySceneId||(this.meshCacheBySceneId[o]={}),this.meshCacheBySceneId[o][e]=n,n.setEnabled(!1),this}},{key:"get",value:function(e,t){var n=this,o=t._uid;return Mn.Maybe.fromNull(this.meshCacheBySceneId[o]).flatMap((function(t){return Vr(t[e])})).map((function(t){console.log("#Mesh: Found Mesh in cache, retrieving copy number",n.count);var o=t.clone("".concat(e).concat(n.count++));return console.log("#Mesh:",o),o.setEnabled(!0),o})).orNull()}},{key:"del",value:function(e){var t=e._uid;t in this.meshCacheBySceneId&&delete this.meshCacheBySceneId[t]}}],[{key:"getInstance",value:function(){return new e}}]),e}(),Vr=function(e){return Mn.Maybe.fromNull(e)},Ur=null,zr=jr,Gr=(n(138),function(){function e(t){var n=this;D()(this,e),d()(this,"load",(function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformMesh;return new Promise((function(e,r){var a=zr.getInstance();if(a.hasKey(t,n.scene))console.log("Found Mesh ".concat(t," in cache for scene ").concat(n.scene)),e(a.get(t,n.scene));else{console.log("Loading mesh....");var i=new cn.AssetsManager(n.scene),c=i.addMeshTask("","",Kr,t);c.onSuccess=function(e){console.log("Load Success",t);var o=e.loadedMeshes[0];o.name=t,o.rotationQuaternion=cn.Quaternion.Identity(),o.position=cn.Vector3.Zero(),a.put(t,n.scene,o)},c.onError=function(e,n,o){console.log("Load error =>",n),r({message:n,exception:o,assetName:t,assetType:ia.Mesh})},i.onFinish=function(r){console.log("Load finish ");var i=a.get(t,n.scene);null!==i&&e(o(i))},i.load()}}))})),this.scene=t}return L()(e,null,[{key:"of",value:function(t){return new e(t)}},{key:"transformMesh",value:function(e){for(var t=Math.PI/2,n=e.getVerticesData(cn.VertexBuffer.PositionKind),o=e.getVerticesData(cn.VertexBuffer.NormalKind),r=new Float32Array(n.length),a=new Float32Array(n.length),i=Math.cos(t),c=Math.sin(t),s=n.length/3,u=0;u<s;u++)r[3*u]=n[3*u],r[3*u+1]=n[3*u+1]*i-n[3*u+2]*c,r[3*u+2]=n[3*u+1]*c-n[3*u+2]*i,a[3*u]=o[3*u],a[3*u+1]=o[3*u+1]*i-o[3*u+2]*c,a[3*u+2]=o[3*u+1]*c-o[3*u+2]*i;return e.setVerticesData(cn.VertexBuffer.PositionKind,r,!0),e.setVerticesData(cn.VertexBuffer.NormalKind,a,!0),e}}]),e}());d()(Gr,"getMeshUrl",(function(e){return"".concat(Kr).concat(e)}));var Kr="/static/meshes/",Wr=Gr;function qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Yr=function(e){z()(n,e);var t=Hr(n);function n(e){var o,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return xr.getDefaultAnimator(t)};return D()(this,n),a=t.call(this),d()(V()(a),"action",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};Pn()((o=V()(a),q()(n.prototype)),"action",o).call(o,e),e.getNodeFromTree(a.robot.name).orElseRun((function(){return a.addRobot(e,t)})),e.getNodeFromTree(a.robot.name).forEach((function(n){n.item.mesh.id.includes(a.robot.meshName)||(e.deleteNodeFromTreeUsingName(a.name,!0,!0),a.addRobot(e,t))})),e.setSelectedAction(mr().dragObjects)})),d()(V()(a),"getRobot",(function(e,t,n,o){var r=xr.createRobotMeshTree(a.robot.robotTree,t,e),i=Mn.Maybe.fromNull(a.memory.nodeItemDict);return xr.builder().id(a.robot.id).name(Mn.Maybe.fromNull(a.memory.name).orSome(a.robot.name)).assetName(Mn.Maybe.fromNull(a.memory.assetName).orSome(a.robot.name)).meshTree(r).parentMesh(n).parentView(o).scene(e).keyValueMap(i.map((function(e){return e.keyValueMap})).orSome({})).build()})),d()(V()(a),"getCloudPoint",(function(e,t,n){var o=Lr.ofDict(e,{name:a.robot.name,id:a.robot.id},t);return o.mesh.parent=n.mesh,o})),d()(V()(a),"getParentMesh",(function(e){return Mn.Maybe.fromNull(a.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(V()(a),"getType",(function(){return n.TYPE})),a.key="robotAction".concat(e.name),a.name=e.name,a.robot=e,a.robotAnimatorFactory=i,a.icon=function(e){return r.a.createElement("i",je()({className:"fas fa-robot"},e))},a}return L()(n,[{key:"addRobot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.getSceneMemory().forEach((function(o){var r=o.scene,a=_r({},t.memory);a.isImport?t.loadRobot(r,e,a,n):e.getUndoManager().doIt(t.getUndoAbleAction(e,r,a))})),this.memory.isImport=!1}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this;return se.UndoManager.actionBuilder().doAction((function(){o.loadRobot(t,e,n)})).undoAction((function(t){var n=t.is2UpdateInServer,r=void 0===n||n;e.deleteNodeFromTreeUsingName(o.name,r)})).build()}},{key:"loadRobot",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};Wr.of(e).load(this.robot.meshName).then((function(r){return o.createRobotFromMesh(r,e,t,n)})).catch((function(e){return r(e)}))}},{key:"createRobotFromMesh",value:function(e,t,n,o){var r=this.getParentMesh(n),a=Mn.Maybe.fromNull(o.isImport).orSome(!1),i=Mn.Maybe.fromNull(o.isVisible).orSome(!0);e.setEnabled(i);var c=this.getRobot(t,e,r,n);c.animate(this.robotAnimatorFactory(c,n)),n.addNodeItem2Tree(c,r.name,!a,i);var s=this.getCloudPoint(t,n,c);n.addNodeItem2Tree(s,c.name,!1,i)}}]),n}(Sn);d()(Yr,"TYPE","RobotAction");var Qr=Yr;function Zr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Xr=function(e){z()(n,e);var t=Zr(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return D()(this,n),r=t.call(this,e,o,a),d()(V()(r),"getType",(function(){return n.TYPE})),r}return L()(n,[{key:"toDict",value:function(){return Pn()(q()(n.prototype),"toDict",this).call(this)}},{key:"getMouseContextActions",value:function(e){return Pn()(q()(n.prototype),"getMouseContextActions",this).call(this,e).filter((function(e){return"Delete"===e.title}))}}]),n}(Tn);d()(Xr,"TYPE","Mesh");var Jr=Xr;function $r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ea(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var ta=function(e){z()(n,e);var t=ea(n);function n(e){var o;return D()(this,n),o=t.call(this),d()(V()(o),"addMesh",(function(e){e.getSceneMemory().forEach((function(t){var n=t.scene,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$r(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.memory),a=o.getIsImport(r),i=o.getFinalNameFromMemory(r,a);a?o.loadMesh(e,n,r,a,i):e.getUndoManager().doIt(o.getUndoAbleAction(e,n,r,a,i))})),o.memory.isImport=!1})),d()(V()(o),"transformMesh",(function(e,t,n,r){return function(a){var i=o.getParentMesh(e);a.parent=i,a.createNormals();var c=na(n.nodeItemDict);a.position=c.flatMap((function(e){return r?ra(e.position):oa()})).map(cn.Vector3.FromArray).orSome(cn.Vector3.Zero()),a.rotationQuaternion=c.flatMap((function(e){return r?ra(e.quaternion):oa()})).map((function(e){return new cn.Quaternion(e[1],e[2],e[3],e[0])})).orSome(cn.Quaternion.Identity());var s=new cn.StandardMaterial("Mesh".concat(a.name),t),u=c.flatMap((function(e){return r?ra(e.color):oa()})).map(cn.Color3.FromArray).orSome(cn.Color3.Gray());return s.diffuseColor=u,s.emissiveColor=u,a.material=s,a}})),d()(V()(o),"addMesh2Scene",(function(e,t,n,r){return function(a){var i=o.getParentMesh(e);a.name=r;var c=new Jr(a,o.name,na(t.nodeItemDict).flatMap((function(e){return n?ra(e.keyValueMap):oa()})).orSome({}));e.addNodeItem2Tree(c,i.name,!n),e.renderMenus()}})),d()(V()(o),"getParentMesh",(function(e){return na(o.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(V()(o),"getType",(function(){return n.TYPE})),d()(V()(o),"deleteAsset",(function(){})),d()(V()(o),"download",tn()(an.a.mark((function e(){return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),o.key=e.id,o.name=e.name,o.icon=function(e){return r.a.createElement("i",je()({},e,{className:"fas fa-draw-polygon"}))},o}return L()(n,[{key:"action",value:function(e){Pn()(q()(n.prototype),"action",this).call(this,e),console.log("Mesh ".concat(this.key," : ").concat(this.name),this.memory),this.addMesh(e),e.setSelectedAction(mr().dragObjects)}},{key:"getIsImport",value:function(e){return na(e.isImport).orSome(!1)}},{key:"getFinalNameFromMemory",value:function(e,t){return na(e.nodeItemDict).flatMap((function(e){return t?ra(e.name):oa()})).orSome("".concat(this.name).concat(Math.floor(100*Math.random())))}},{key:"getUndoAbleAction",value:function(e,t,n,o,r){var a=this;return se.UndoManager.actionBuilder().doAction((function(){a.loadMesh(e,t,n,o,r)})).undoAction((function(t){var n=t.is2UpdateInServer,o=void 0===n||n;e.deleteNodeFromTreeUsingName(r,o)})).build()}},{key:"loadMesh",value:function(e,t,n,o,r){Wr.of(t).load(this.key).then(this.transformMesh(e,t,n,o)).then(this.addMesh2Scene(e,n,o,r))}}]),n}(Sn);d()(ta,"TYPE","AddMeshAction");var na=Mn.Maybe.fromNull,oa=Mn.Maybe.none,ra=Mn.Maybe.some,aa=ta,ia={Map:"Map",Robot:"Robot",Mesh:"Mesh"},ca={Map:function(e){return new Rr(e.name,e.loader)},Robot:function(e){return new Qr(e,xr.getSocketAnimator)},Mesh:function(e){return new aa(e)}},sa=n(59);function ua(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var la=function(e){z()(n,e);var t=ua(n);function n(e,o,r){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return D()(this,n),a=t.call(this,e,c),d()(V()(a),"getType",(function(){return n.TYPE})),a.localWall=o,a.size=r,a.keyPoints=i,a}return L()(n,[{key:"toDict",value:function(){var e=Pn()(q()(n.prototype),"toDict",this).call(this);return e.localWall=this.localWall,e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing wall");var r=Mn.Maybe.fromNull(t.name).orSome("Wall".concat(Math.floor(1e3*Math.random()))),a=ha(t,r,e),i=new cn.StandardMaterial("WallMaterial".concat(r),e),c=new cn.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,a.material=i,a.position.z+=.001;var s=pa(e,t.localWall.map((function(e){return Cn.a.of(e).toBabylon()})),a,o);return new n(a,t.localWall,t.size,s,t.keyValueMap)}}]),n}(On.a);d()(la,"TYPE","Wall");var fa=ln.b.RADIUS,da=[[0,1,2],[2,3,0],[4,6,5],[6,4,7],[0,5,1],[5,0,4],[3,2,6],[6,7,3],[1,6,2],[6,1,5],[0,3,7],[7,4,0]];function ha(e,t,n){var o=e.localWall.map((function(e){return Cn.a.of(e).toBabylon()})),r=Cn.a.of(e.position).toBabylon(),a=o[1].subtract(o[0]).normalize(),i=new cn.Vector3(-a.y,a.x,0),c=[o[0].add(i.scale(e.size.width)),o[0].subtract(i.scale(e.size.width)),o[1].subtract(i.scale(e.size.width)),o[1].add(i.scale(e.size.width))],s=new cn.Vector3(0,0,e.size.height),u={positions:[c[0],c[1],c[2],c[3],c[0].add(s),c[1].add(s),c[2].add(s),c[3].add(s)],faces:da},l=kn.a.meshFromPositionAndFaces(t,n,u.positions,u.faces);return l.position=r,l}var ma=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;e.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh,s={position:Cn.a.ofBabylon(c.position).toArray(),localWall:i.localWall,size:i.size};s.localWall[a]=Cn.a.ofBabylon(o.position).toArray(),function(e,t,n,o){var r=kn.a.pointAverageVec3(e.localWall.map((function(e){return Cn.a.of(e)})));e.position=r.toArray(),e.localWall=e.localWall.map((function(e){return Cn.a.of(e).sub(r).toArray()}));var a=ha(e,n.name,t);a.position=n.position,a.rotationQuaternion=n.rotationQuaternion,a.locallyTranslate(r.toBabylon()),a.material=n.material,a.visibility=n.visibility,a.parent=n.parent,a.getMouseContextActions=n.getMouseContextActions,a.nodeItem=n.nodeItem,o.mesh=a,o.localWall=e.localWall,on()(n._children).forEach((function(e){n.removeChild(e),e.parent=a})),o.keyPoints.forEach((function(t,n){t.position=Cn.a.of(e.localWall[n]).toBabylon()})),n.dispose()}(s,t,c,i),r&&e.updateNodeInServer(c.name)}))}},pa=function(e,t,n,o){var r=[];return t.forEach((function(t,a){var i=kn.a.createSphere(e,new cn.Color3(.25,.25,.25),fa,"".concat(n.name,"keyPointWall").concat(a),!0);i.parent=n,i.position=t,i.index=a,i.observers=new cn.Observable,i.observers.add(ma(o,e)),r.push(i)})),r},va=la,ga={GlobalRef:En.b,Box:sa.a,KeyPoint:_n.a,Path:so.a,Wall:va,BoxRegion:To,PolygonRegion:Jo,GraphItem:co.a,NavigationPreviewItem:fr.a},ya=function(){function e(){D()(this,e)}return L()(e,null,[{key:"importScene",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};console.log("Importing scene...",t,n),e.updateErrorList=a;var i=[];return n.length>0?wa(t,n,o,i,r):Ma(t),console.log("End Importing scene"),i}},{key:"importNodeItem",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=ga[t.type];r&&e.getSceneMemory().forEach((function(a){var i=a.scene,c=r.ofDict(i,t,e),s=void 0===t.isVisible||t.isVisible;c.mesh.setEnabled(s),e.getNodeFromTree(n).forEach((function(e){c.mesh.parent=e.item.mesh})),e.addNodeItem2Tree(c,n,o,s,!1)}))}}]),e}();function ba(e){return e.type in ia}function Aa(e,t,n,o){var r=t.type,a=Mn.Maybe.fromNull(t.assetName).orSome(t.name),i=e.getAssetsActionMap(),c=Mn.Maybe.fromNull(i[a]).orLazy((function(){return i[a.split(".")[0]]}));if(!c&&r===ia.Robot){var s=xr.createBaseObject({robotName:a,nodeDict:t});c=ca.Robot(s)}c?(c.memory.parentObj={parent:n},c.memory.nodeItemDict=t,c.memory.assetName=a,c.memory.name=t.name,c.memory.isImport=!0,c.memory.isVisible=void 0===t.isVisible||t.isVisible,c.action(e,(function(e){var t;"RequestFileError"===(null==e||null===(t=e.exception)||void 0===t?void 0:t.name)&&(o.push({cause:"Asset of type ".concat(e.assetType," with name ").concat(e.assetName,", was not found"),solution:"please upload ".concat(e.assetType," ").concat(e.assetName)}),ya.updateErrorList(o))}))):o.push({cause:"Asset of type ".concat(r," with name ").concat(a,", was not found"),solution:"please upload ".concat(r," ").concat(a)})}function wa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){var a=t.sort((function(e,t){return e.item.type===ga.GlobalRef.TYPE?-1:t.item.type===ga.GlobalRef.TYPE||e.item.type===ga.GraphItem.TYPE?1:t.item.type===ga.GraphItem.TYPE||e.name<t.name?-1:e.name>t.name?1:0}));a.forEach((function(t){ba(t.item)?Aa(e,t.item,n,o):ya.importNodeItem(e,t.item,n,r),t.children.length>0&&wa(e,t.children,t.name,o,r)}))}}function Ma(e){e.getSceneMemory().forEach((function(t){var n=t.scene;e.addNodeItem2Tree(En.b.ofDict(n),null,!0)}))}d()(ya,"updateErrorList",(function(){}));var Ea=ya,xa=function e(){D()(this,e)};d()(xa,"retrieveScene",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ka,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Pa("retrieving scene");se.MasterDB.cloudFunction(ln.b.CLOUD_FUNCTION_NAME,"retrieveScene",e,(function(e){return Ca(e,t,n)}))}));var Pa=function(e){return function(e){}},ka=function(e){},Ca=function(e,t,n){e.success?t(e):n(e)},Sa=xa,Oa=n(66),Na=n(60),Ta=function e(){D()(this,e)};function Ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ra(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}d()(Ta,"onPointerDown",(function(e){return function(t){e.mousePosClick=e.getMouseCoordsFromRoot().orSome(cn.Vector3.Zero()),e.mousePosMove=e.mousePosClick,e.sceneMemory.forEach((function(e){var n=e.camera,o=e.canvas;(2===t.buttons||4===t.buttons||t.ctrlKey)&&n.detachControl(o)}))}})),d()(Ta,"onPointerUp",(function(e){return function(){e.sceneMemory.forEach((function(e){var t=e.camera,n=e.canvas;t.attachControl(n,!0)}))}})),d()(Ta,"onPointerMove",(function(e){return function(t){e.sceneMemory.forEach((function(n){var o=n.mouseLocationText,r=n.camera;e.getMouseCoordsFromRoot().forEach((function(n){!function(e,t){e.text="x: ".concat(t.x.toFixed(2),", y: ").concat(t.y.toFixed(2))}(o,n);var a=function(){var t=n.subtract(e.mousePosMove),o=function(e,t){var n=e.getRootNode().item.mesh.parent,o=kn.a.getRotationMatrix(n),r=Cn.a.ofBabylon(n.scaling);return o.prodVec(r.mul(Cn.a.ofBabylon(t))).toBabylon()}(e,t);!function(e,t){Na.a.builder().initialState({camera:e,time:0,T:(new Date).getTime()}).nextState((function(e){var n=e.camera,o=e.time,r=t.scale(.1);return n.position=n.position.add(r),n.setTarget(n.target.add(r)),{camera:n,time:o+.1,T:(new Date).getTime()}})).while((function(e){return e.time<=1})).build().play()}(r,o.scale(-1)),e.mousePosMove=n},i=[{predicate:t.ctrlKey&&1===t.buttons,action:a},{predicate:4===t.buttons,action:a}].filter((function(e){return e.predicate}));i.length>0&&i[0].action()}))}))}}));var Ba=function(e){z()(n,e);var t=Ra(n);function n(e){var o;return D()(this,n),o=t.call(this,e),d()(V()(o),"getRobotManager",(function(){return o.robotManager})),d()(V()(o),"getSceneMemory",(function(){return o.sceneMemory})),d()(V()(o),"getAssetsActionMap",(function(){return Nr.getInstance().getAssetsActionMap()})),d()(V()(o),"getRootNode",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:on()(o.objectTree);return e.filter((function(e){return e.title===En.b.NAME}))[0]})),d()(V()(o),"getObjectTree",(function(){return o.objectTree})),d()(V()(o),"setSelectedAction",(function(){})),d()(V()(o),"getUndoManager",(function(){return o.undoManager})),d()(V()(o),"getNodeFromTree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:on()(o.objectTree);return Oa.a.ofScene(o.sceneName,o.undoManager).getNodeFromTree(e,t)})),d()(V()(o),"deleteNodeFromTreeUsingName",(function(){throw new Error("Delete Node in viewer Exception")})),d()(V()(o),"updateNodeInServer",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Oa.a.ofScene(o.sceneName,o.undoManager).updateNodeInServer(e,on()(o.objectTree),t)})),d()(V()(o),"addNodeItem2Tree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:En.b.NAME,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=Oa.a.ofScene(o.sceneName,o.undoManager).addNodeItem2Tree(on()(o.objectTree),e,t,n,r);o.objectTree=a})),d()(V()(o),"setCameraToTarget",(function(){o.sceneMemory.forEach((function(e){var t=e.camera,n=o.isPanned?"":o.props.focusObject.Value;o.getNodeFromTree(n).forEach((function(e){console.log("Set Camera, Found Object",e.item.mesh);var n=.001*(new Date).getTime()-o.time;o.time=.001*(new Date).getTime();var r=e.item.mesh._absolutePosition.clone();o.cameraSpeed=o.targetPos?r.subtract(o.targetPos):cn.Vector3.Zero(),o.targetPos=r,t.setTarget(r),t.position=t.position.add(o.cameraSpeed.scale(n)),t.beta=o.isRotated?t.beta:0}))}))})),d()(V()(o),"onPointerDown",(function(e){o.isRotated=!0,Ta.onPointerDown(V()(o))(e)})),d()(V()(o),"onPointerUp",(function(e){Ta.onPointerUp(V()(o))(e)})),d()(V()(o),"onPointerMove",(function(e){4===e.buttons&&(o.isPanned=!0),Ta.onPointerMove(V()(o))(e)})),d()(V()(o),"onResize",(function(e,t){0===e&&0===t||o.getSceneMemory().forEach((function(n){var o=n.mouseLocationText;o.left=-e/2+e/17,o.top=-t/2+t/30}))})),d()(V()(o),"retrieveSceneFromServer",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};Sa.retrieveScene(o.sceneName,(function(t){var n=Ea.importScene(V()(o),t.result);o.resizeGround(),o.setState({errorList:n}),e()}))})),d()(V()(o),"loadAssets",tn()(an.a.mark((function e(){var t;return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Nr.getInstance(),0!==Object.values(t.getAssets()).length){e.next=4;break}return e.next=4,t.load();case 4:case"end":return e.stop()}}),e)})))),d()(V()(o),"loadScene",tn()(an.a.mark((function e(){return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadAssets();case 2:o.retrieveSceneFromServer(o.renderScene);case 3:case"end":return e.stop()}}),e)})))),d()(V()(o),"renderScene",(function(){o.getSceneMemory().forEach((function(e){var t=e.engine,n=e.scene;return t.runRenderLoop((function(){o.time=.001*(new Date).getTime(),n.render(),o.setCameraToTarget()}))}))})),d()(V()(o),"onSceneReady",(function(e){var t=e.getEngine(),n=t.getRenderingCanvas();o.addCanvasEventListeners(n);var r=Vn.createMouseLocationText(e);return o.sceneMemory=Mn.Maybe.some({engine:t,canvas:n,scene:e,camera:Vn.createCamera(e,n),light:Vn.createLight(e),ground:Vn.createMeshGround(e),gizmoManager:Vn.createGizmo(e),highlightLayer:{layer:new cn.HighlightLayer("hl1",e),lastHlMeshes:[]},mouseLocationText:r}),e})),d()(V()(o),"showRobotAlertModal",(function(e){o.robotAlertModal.current.open(e)})),d()(V()(o),"showAlert",(function(e,t){alert("type:".concat(t," ")+e)})),d()(V()(o),"renderMenus",(function(){})),d()(V()(o),"componentDidUpdate",(function(e){[{propVar:function(e){return e.sceneName.Value},action:function(){return o.sceneName=o.props.sceneName.Value}},{propVar:function(e){return e.focusObject.Value},action:function(){o.isPanned=!1,o.isRotated=!1,o.setCameraToTarget()}}].forEach((function(t){var n=t.propVar,r=t.action;n(o.props)!==n(e)&&r()}))})),d()(V()(o),"componentDidMount",(function(){console.log("SceneViewer Did Mount!! "),o.loadScene()})),o.state={errorList:[]},o.sceneName=e.sceneName.Value,o.sceneMemory=Mn.Maybe.none(),o.objectTree=[],o.undoManager=new se.UndoManager,o.isPanned=!1,o.isRotated=!1,o.targetPos=void 0,o.cameraSpeed=cn.Vector3.Zero(),o.time=.001*(new Date).getTime(),o.robotManager=new se.RobotManager,o.robotAlertModal=r.a.createRef(),o}return L()(n,[{key:"getGraph",value:function(){return new io.a(this.objectTree).getNode((function(e){return co.a.TYPE===e.item.getType()}))}},{key:"getRobots",value:function(){return this.getRootNode().children.filter((function(e){return e.item.getType()===xr.TYPE})).map((function(e){return e.item}))}},{key:"addCanvasEventListeners",value:function(e){var t=this;[{name:"pointerdown",function:function(e){return t.onPointerDown(e)}},{name:"pointerup",function:function(e){return t.onPointerUp(e)}},{name:"pointermove",function:function(e){return t.onPointerMove(e)}}].forEach((function(t){return e.addEventListener(t.name,t.function,!1)}))}},{key:"getMouseCoordsFromRoot",value:function(){var e=this;return this.sceneMemory.flatMap((function(t){var n=t.scene,o=t.ground;return kn.a.getGroundPosition(n,o).flatMap((function(t){return Mn.Maybe.fromNull(e.getRootNode()).map((function(e){return kn.a.getLocalCoordFromWorld(e.item.mesh,Cn.a.ofBabylon(t)).toBabylon()}))}))}))}},{key:"resizeGround",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this.getSceneMemory().forEach((function(t){t.ground.dispose();var n=t.scene,o=n.getWorldExtends(),r=o.max,a=o.min,i=r.subtract(a),c=!1;i.length()<e&&(i=new cn.Vector3(e,0,e),c=!0),t.ground=Vn.createMeshGround(n,i.x,i.z),t.ground.position=new cn.Vector3(a.x+(c?0:i.x/2),t.ground.position.y,a.z+(c?0:i.z/2))}))}},{key:"componentWillUnmount",value:function(){var e=this;this.sceneMemory.forEach((function(t){var n=t.scene;e.getRobots().forEach((function(e){e.dispose(),e.loggerSubscription&&e.robot.unsubscribeToLogs(e.loggerSubscription)})),Nr.getInstance().clearObserver(n),zr.getInstance().del(n),delete e.objectTree,delete e.sceneMemory,delete e.undoManager}))}},{key:"render",value:function(){var e=this,t=this.state.errorList,n=function(){return e.setState({errorList:[]})};return r.a.createElement("div",{style:{display:"flex",flexGrow:1,maxHeight:"100%"}},r.a.createElement(wn,{onSceneReady:this.onSceneReady,is2render:!1,sceneFactory:Vn.createScene}),r.a.createElement(R,{onSubmit:n,onCancel:n,open:(null==t?void 0:t.length)>0,title:"Scene Viewer",message:"An error occurred while loading the scene",submitText:"OK",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary"},function(e){return e?r.a.createElement("ul",null,e.map((function(e,t){var n=e.cause,o=e.solution;return r.a.createElement("li",{key:"error"+t},"".concat(n,", ").concat(o))}))):[]}(t)),r.a.createElement(fe,{ref:this.robotAlertModal,title:"Alert"}),r.a.createElement(un.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}))}}],[{key:"getComponentFactory",value:function(e){return function(t){var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ia(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ia(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({sceneName:e},t);return r.a.createElement(n,o)}}}]),n}(o.Component);d()(Ba,"EXTENSION",".3d"),Ba.propTypes={sceneName:s.a.shape({Value:s.a.string}),focusObject:s.a.shape({Value:s.a.string})},Ba.defaultProps={sceneName:{Value:"Pedro"},focusObject:{Value:""}};var Da=Ba,Fa=n(51),La=n.n(Fa),ja=n(35),Va=n.n(ja),Ua=n(47),za=n.n(Ua),Ga=Object(p.makeStyles)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),Ka=function(e){var t=Ga(),n=r.a.createElement("div",null);return e.noneOption&&(n=r.a.createElement(Be.a,{value:""},r.a.createElement("em",null,"None"))),r.a.createElement(Va.a,{variant:e.variant,className:t.formControl,style:e.style,hiddenLabel:void 0===e.label},r.a.createElement(La.a,{id:"movai-react-select"},e.label),r.a.createElement(za.a,{labelId:"movai-react-select",id:e.id,value:e.value,onChange:e.onChange,inputProps:e.inputProps},n,e.options.map((function(e,t){return r.a.createElement(Be.a,{key:t,value:e},e)}))))};Ka.propTypes={value:s.a.string,options:s.a.array,noneOption:s.a.bool,label:s.a.string,variant:s.a.string,style:s.a.object,onChange:s.a.func,id:s.a.string,inputProps:s.a.object},Ka.defaultProps={value:"option2",options:["option1","option2","option3"],variant:"filled",noneOption:!0,onChange:function(e){return console.log(e.target.value)},id:"movai-react-select"};var Wa=Ka,qa=n(52),_a=n.n(qa),Ha=n(34),Ya=n.n(Ha),Qa=n(118),Za=function(e){var t=e.path,n=void 0===t?"":t,o=e.style,a=void 0===o?{}:o,i=e.fill,c=void 0===i?"#fff":i,s=e.width,u=void 0===s?"100%":s,l=e.height,f=void 0===l?"100%":l,d=e.className,h=void 0===d?"":d,m=e.viewBox,p=void 0===m?"0 0 24 24":m;return r.a.createElement("svg",{width:u,style:a,height:f,viewBox:p,xmlns:"http://www.w3.org/2000/svg",className:"svg-icon ".concat(h||""),xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("path",{fill:c,d:n}))},Xa={Close:r.a.createElement(Za,{width:24,path:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),ErrorOutline:r.a.createElement(Za,{width:24,path:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),InfoOutlined:r.a.createElement(Za,{width:24,path:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),ReportProblemOutlined:r.a.createElement(Za,{width:24,path:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),SuccessOutlined:r.a.createElement(Za,{width:24,path:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"})},Ja=["action","children","classes","className","closeText","color","icon","iconMapping","onClose","role","severity","variant","theme"],$a={success:Xa.SuccessOutlined,warning:Xa.ReportProblemOutlined,error:Xa.ErrorOutline,info:Xa.InfoOutlined},ei=function(e){var t=e.action,n=e.children,r=e.classes,a=e.className,i=e.closeText,c=void 0===i?"Close":i,s=e.color,u=e.icon,l=e.iconMapping,f=void 0===l?$a:l,d=e.onClose,h=(e.role,e.severity),m=void 0===h?"success":h,p=e.variant,v=void 0===p?"standard":p,g=(e.theme,bt()(e,Ja));return o.createElement("div",je()({className:_a()(r.root,r["".concat(v).concat(Object(Qa.capitalize)(s||m))],a)},g),!1!==u?o.createElement("div",{className:r.icon},u||f[m]||$a[m]):null,o.createElement("div",{className:r.message},n),null!=t?o.createElement("div",{className:r.action},t):null,null==t&&d?o.createElement("div",{className:r.action},o.createElement(Ya.a,{size:"small","aria-label":c,title:c,color:"inherit",onClick:d},Xa.Close)):null)};ei.propTypes={action:s.a.node,children:s.a.node,classes:s.a.object,className:s.a.string,closeText:s.a.string,color:s.a.oneOf(["error","info","success","warning"]),icon:s.a.node,iconMapping:s.a.shape({error:s.a.node,info:s.a.node,success:s.a.node,warning:s.a.node}),onClose:s.a.func,role:s.a.string,severity:s.a.oneOf(["error","info","success","warning"]),variant:s.a.oneOf(["filled","outlined","standard"])};var ti=Object(p.withStyles)((function(){return{root:{backgroundColor:"transparent",display:"flex",padding:"6px 16px"},filledSuccess:{color:"#fff",backgroundColor:"#4caf50"},filledInfo:{color:"#fff",backgroundColor:"#2196f3"},filledWarning:{color:"#fff",backgroundColor:"#ff9800"},filledError:{color:"#fff",backgroundColor:"#f44336"},icon:{marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9},message:{padding:"8px 0",display:"flex",flexDirection:"column",justifyContent:"center"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiAlert"})(ei);n(142);function ni(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var oi=function(e){z()(n,e);var t=ni(n);function n(){var e;D()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(V()(e),"autoClose",null),d()(V()(e),"handleClickButton",(function(t){t.onClick&&t.onClick(),e.close()})),d()(V()(e),"handleClickOverlay",(function(t){var n=e.props,o=n.closeOnClickOutside,r=n.onClickOutside,a=t.target===e.overlay;o&&a&&(r(),e.close())})),d()(V()(e),"close",(function(){ai(),ri()})),d()(V()(e),"keyboardClose",(function(t){var n=e.props,o=n.closeOnEscape,r=n.onKeypressEscape,a=27===t.keyCode;o&&a&&(r(t),e.close())})),d()(V()(e),"componentDidMount",(function(){document.addEventListener("keydown",e.keyboardClose,!1),e.autoClose=setTimeout((function(){(document.getElementById("react-confirm-alert")||document.getElementById("react-confirm-alert-body-element"))&&e.close()}),e.props.autoHideDuration)})),d()(V()(e),"componentWillUnmount",(function(){document.removeEventListener("keydown",e.keyboardClose,!1),clearTimeout(e.autoClose),e.props.willUnmount()})),d()(V()(e),"renderCustomUI",(function(){var t=e.props,n=t.title,o=t.message;return(0,t.customUI)({title:n,message:o,onClose:e.close})})),e}return L()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.message,o=t.customUI,a=t.severity,i=t.closeText,c=t.closable,s=t.theme;return r.a.createElement("div",{className:"react-confirm-alert-overlay",ref:function(t){return e.overlay=t},onClick:this.handleClickOverlay},r.a.createElement("div",{className:"react-confirm-alert"},o?this.renderCustomUI():r.a.createElement("div",{className:"react-confirm-alert-body"},r.a.createElement(ti,{theme:s,elevation:6,variant:"filled",severity:a,closeText:i,action:c?r.a.createElement("div",{className:"icon-container",onClick:function(){return e.close()}},Xa.Close):void 0},n))))}}]),n}(o.Component);function ri(){var e=document.getElementById("react-confirm-alert");Object(ro.unmountComponentAtNode)(e),e.parentNode.removeChild(e)}function ai(){document.body.classList.remove("react-confirm-alert-body-element")}function ii(e,t){document.body.classList.add("react-confirm-alert-body-element"),function(e,t){var n=document.getElementById("react-confirm-alert");n||(document.body.children[0].classList.add("react-confirm-alert-blur"),(n=document.createElement("div")).id="react-confirm-alert",document.body.appendChild(n)),Object(ro.render)(r.a.createElement(oi,je()({},e,{theme:t})),n)}(e,t)}d()(oi,"propTypes",{message:s.a.string,customUI:s.a.func,closeOnClickOutside:s.a.bool,closeOnEscape:s.a.bool,willUnmount:s.a.func,onClickOutside:s.a.func,onKeypressEscape:s.a.func,severity:s.a.string,closeText:s.a.string,autoHideDuration:s.a.number,closable:s.a.bool}),d()(oi,"defaultProps",{closeOnClickOutside:!0,closeOnEscape:!0,willUnmount:function(){return null},onClickOutside:function(){return null},onKeypressEscape:function(){return null},severity:"info",closeText:"Close",autoHideDuration:6e3,closable:!0});n(144),n(145);function ci(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function si(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ci(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ci(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ui,li={borderBottom:"1px solid #212121",textColor:"white",background:{primary:"#424242",secondary:"#212121"}},fi={borderBottom:"1px solid #ccc",textColor:"rgba(0, 0, 0, 0.87)",background:{primary:"#e2e2e2",secondary:"#b2b2b2"}},di=function(e){return si(si({},e),{},{typography:{fontFamily:"Open Sans",h1:{fontFamily:"Open Sans"},h2:{fontFamily:"Open Sans"},h3:{fontFamily:"Open Sans"},h4:{fontFamily:"Open Sans"},h5:{fontFamily:"Open Sans"},h6:{fontFamily:"Open Sans"},body1:{fontFamily:"Roboto"}},cursorDefault:{cursor:"default"},cursorPointer:{cursor:"pointer"}})},hi={dark:Object(p.createMuiTheme)(di({label:"dark",textColor:li.textColor,backgroundColor:"linear-gradient(114.01deg, #212121 0%, #050505 100.43%)",bottomNavigation:{background:"#212121"},globalStats:{borderColor:"#474747",subTextColor:"#CDCDCD",upperTextColor:"#E6E6E6"},palette:{type:"dark",primary:{main:"#36b5e6"},secondary:{main:"#CF6679"},green:{main:"#03DAC5"},background:{primary:li.background.primary,secondary:li.background.secondary},accent:{background:"#f5f5f9",color:"rgba(0, 0, 0, 0.87)",border:"#dadde9"}},icon:{color:"#c6c6c6",hoverColor:"white"},table:{stripColor:"#505050"},verticalBar:{iconColor:"#9e9e9e"},overrides:{MuiTableCell:{body:{color:li.textColor}},MuiAppBar:{colorDefault:{color:li.textColor,borderColor:"black",backgroundColor:li.background.secondary},colorInherit:{color:li.textColor,backgroundColor:"#353535"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"inherit",margin:"8px"},containedSecondary:{color:"inherit",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#36b5e6"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(255,255,255,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}}}})),light:Object(p.createMuiTheme)(di({font:{Roboto:{fontFamily:"Roboto"},OpenSans:{fontFamily:"Open Sans"}},label:"light",textColor:fi.textColor,backgroundColor:"linear-gradient(122.19deg, #FFFFFF 2.58%, #FFFFFF 76.23%)",bottomNavigation:{background:"#c3c3c3"},icon:{color:"#757575",hoverColor:"black"},table:{stripColor:"whitesmoke"},globalStats:{borderColor:"#E6E6E6",subTextColor:"#717171",upperTextColor:"#474747"},palette:{primary:{main:"#007197"},secondary:{main:"#BE2424"},green:{main:"#03DAC5"},background:{primary:fi.background.primary,secondary:fi.background.secondary},accent:{background:"whitesmoke",color:fi.textColor,border:"darkgray"}},verticalBar:{iconColor:"#616161"},overrides:{MuiTableCell:{body:{color:fi.textColor}},MuiAppBar:{colorDefault:{color:fi.textColor,borderColor:fi.borderBottom,backgroundColor:fi.background.secondary},colorInherit:{color:fi.textColor,backgroundColor:"#d2d2d2"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"white",margin:"8px"},containedSecondary:{color:"white",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#007197"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(0,113,151, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(0,0,0,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}},MuiPaper:{root:{color:"#272727",backgroundColor:fi.background.primary}},MuiTableRow:{head:{"& th":{backgroundColor:fi.background.primary,borderBottom:fi.borderBottom}},root:{"& td":{borderBottom:fi.borderBottom}}}}})),getTheme:function(){var e=window.localStorage.getItem("movai.theme");return e||"dark"},setTheme:function(e){window.localStorage.setItem("movai.theme",e)}},mi=hi,pi=n(119),vi=n.n(pi),gi=n(120),yi=Object(gi.createGlobalStyle)(ui||(ui=vi()(["",""])),se.Style),bi=n(67),Ai=n.n(bi),wi=n(121);function Mi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Ei=Object(p.withStyles)((function(e){return{paper:{borderRadius:"8px",width:"242px",height:"411px",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.25)"}}}))((function(e){return r.a.createElement(Ie.a,je()({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},autoFocus:!1},e))})),xi=function(e){z()(n,e);var t=Mi(n);function n(){var e;D()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(V()(e),"state",{anchorEl:null,otherFilters:[]}),d()(V()(e),"handleClick",(function(t){e.setState({anchorEl:t.currentTarget})})),d()(V()(e),"handleClose",(function(){e.setState({anchorEl:null,otherFilters:[]})})),e}return L()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=(e.t,e.disabled),o=e.tooltip,a=e.title;return r.a.createElement(r.a.Fragment,null,r.a.createElement(y.Tooltip,{title:o||a},r.a.createElement(Ya.a,{size:"small",onClick:this.handleClick,disabled:n,className:this.props.isActive?t.iconActive:t.icon},this.props.icon)),r.a.createElement(Ei,{id:"customized-menu",anchorEl:this.state.anchorEl,open:Boolean(this.state.anchorEl),onClose:this.handleClose,className:t.height},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"-webkit-fill-available"}},r.a.createElement(y.Typography,{component:"div",style:{padding:"10px 10px 0px 20px",display:"flex",flexDirection:"row"}},r.a.createElement(y.Typography,{component:"div",style:{fontSize:"24px",fontFamily:"Open Sans",fontWeight:500}},this.props.title),r.a.createElement(y.Typography,{component:"div",style:{flexGrow:1}}),r.a.createElement(y.Typography,{component:"div",onClick:this.handleClose,className:t.icon},r.a.createElement("i",{className:"fas fa-times"}))),r.a.createElement("div",{style:{flexGrow:1,display:"flex",flexDirection:"column",margin:"10px 0px 0px 10px"}},this.props.children))))}}]),n}(o.Component);xi.propTypes={isActive:s.a.bool,disabled:s.a.bool,tooltip:s.a.string,title:s.a.string},xi.defaultProps={isActive:!1,disabled:!1,tooltip:"",title:"Filters"};var Pi=Object(p.withStyles)((function(e){return{button:{margin:e.spacing(1),color:e.palette.primary.main,borderColor:e.palette.primary.main},iconActive:{color:e.palette.primary.main,borderColor:e.palette.primary.main,backgroundColor:Object(wi.fade)(e.palette.primary.main,.1)},buttonApplyFilters:{background:e.palette.primary.main,fontFamily:"Roboto",fontStyle:"normal",fontWeight:"bold",fontSize:"14px",color:"#FAFAFA",margin:"0px 20px 10px 20px","&:hover":{background:e.palette.primary.dark}},icon:{"&:hover":{cursor:"pointer"}},height:{height:"100%"},checkbox:{marginLeft:"10px"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)}}}),{withTheme:!0})(xi),ki=n(122),Ci=n.n(ki),Si=n(123),Oi=n.n(Si),Ni=n(124),Ti=n.n(Ni),Ii=n(125),Ri=n.n(Ii),Bi=n(44),Di=n.n(Bi),Fi=n(68),Li=n.n(Fi),ji=n(61),Vi=n.n(ji),Ui=n(69),zi=n.n(Ui),Gi=n(70),Ki=n(126),Wi=n.n(Ki),qi=n(62),_i=n.n(qi),Hi=Object(p.makeStyles)((function(e){return{input:{flex:1,paddingLeft:"10px",fontSize:"medium"},searchText:{minWidth:150,paddingLeft:e.spacing(3)},addTagText:{width:"100%"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)},toggleContainer:{margin:e.spacing(2)},tagsContainer:{display:"flex",flexDirection:"column",padding:e.spacing(.5),margin:e.spacing(0,3,0,3)},tagsList:{marginTop:e.spacing(3)},chip:{margin:e.spacing(.5)},formControl:{margin:e.spacing(1),minWidth:120,maxWidth:300},filtersButton:{display:"flex",flexDirection:"row"},columnsFilter:{display:"flex",flexDirection:"column",marginTop:6},iconButton:{color:"#0B6A8A","&:hover":{color:"#22c7ff"}}}})),Yi=function(e){var t,n=Hi(),o=r.a.useState(""),a=ge()(o,2),i=a[0],c=a[1],s=function(t){var n,o=null==t||null===(n=t.target)||void 0===n?void 0:n.value,r=o[o.length-1];e.updateRobotSelection(r)};return r.a.createElement(y.AppBar,{position:"static",color:"inherit"},r.a.createElement(y.Toolbar,{variant:"dense"},r.a.createElement("div",{className:n.toggleContainer},r.a.createElement("svg",{width:"20",height:"18",viewBox:"0 0 30 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{paddingTop:"5px",paddingRight:"5px"}},r.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7753 1.35706L15.9587 2.61119L16.3648 2.87846L18.4001 4.18898L17.1052 6.20016H25.437C26.5487 6.20016 27.45 7.10137 27.45 8.21307V12.8244H28.0955C28.6514 12.8244 29.102 13.275 29.102 13.8308V16.0643C29.102 16.6201 28.6514 17.0707 28.0955 17.0707H27.45V21.2901C27.45 22.4018 26.5487 23.303 25.437 23.303H4.12161C3.00991 23.303 2.1087 22.4017 2.1087 21.29V17.0707H1.42467C0.868819 17.0707 0.418213 16.6201 0.418213 16.0643V13.8308C0.418213 13.275 0.868819 12.8244 1.42467 12.8244H2.1087V8.21307C2.1087 7.10137 3.00991 6.20016 4.12161 6.20016H13.5141L14.8252 4.16395L13.2875 3.15192L13.2966 3.13812L13.2875 3.1322L15.1377 0.290771L16.7753 1.35706ZM24.4306 9.21953H5.12807V20.2836H24.4306V9.21953ZM7.18098 12.1324C6.68518 12.1324 6.28325 12.5343 6.28325 13.0301C6.28325 13.5259 6.68518 13.9278 7.18098 13.9278H9.04635C9.54216 13.9278 9.94409 13.5259 9.94409 13.0301C9.94409 12.5343 9.54216 12.1324 9.04635 12.1324H7.18098ZM20.6901 12.1324C20.1943 12.1324 19.7924 12.5343 19.7924 13.0301C19.7924 13.5259 20.1943 13.9278 20.6901 13.9278H22.5555C23.0513 13.9278 23.4532 13.5259 23.4532 13.0301C23.4532 12.5343 23.0513 12.1324 22.5555 12.1324H20.6901ZM9.17669 17.6512H11.3239V19.253H9.17669V17.6512ZM14.3432 17.6513H12.196V19.253H14.3432V17.6513ZM15.2154 17.6513H17.3626V19.253H15.2154V17.6513ZM20.382 17.6513H18.2348V19.253H20.382V17.6513ZM10.9568 23.69H18.6019V25.7029C18.6019 26.2587 18.1513 26.7093 17.5954 26.7093H11.9632C11.4074 26.7093 10.9568 26.2587 10.9568 25.7029V23.69Z",fill:"#9E9E9E"})),r.a.createElement(Va.a,{className:n.formControl},r.a.createElement(za.a,{labelId:"select-label",id:"select",multiple:!0,value:e.selectedRobots,onChange:s,renderValue:function(e){var t=e.filter((function(e){return e.isSelected})).map((function(e){return e.name}));return t.length>2?[t[0],t[1]].join(" , ")+"...":t.join(" , ")},input:r.a.createElement(Di.a,null),MenuProps:Qi},e.selectedRobots.map((function(e,t){return r.a.createElement(Be.a,{key:"robotList-".concat(t),value:e.id},r.a.createElement(zi.a,{checked:e.isSelected}),r.a.createElement(Li.a,{primary:e.name}))}))))),r.a.createElement(y.TextField,{className:n.searchText,label:"",placeholder:"Search (regex)",value:e.messageRegex,onChange:function(t){return e.handleMessageRegex(t.target.value)},InputProps:{startAdornment:r.a.createElement(Ai.a,{style:{paddingRight:8}},r.a.createElement(dt.a,{fontSize:"small"})),endAdornment:r.a.createElement(Ai.a,{position:"end"},r.a.createElement(Ya.a,{disabled:!e.messageRegex,onClick:function(){return e.handleMessageRegex("")}},r.a.createElement(m.a,{color:"inherit",fontSize:"small"})))},size:"small"}),r.a.createElement("div",{className:n.toggleContainer},r.a.createElement(Va.a,{className:n.formControl},r.a.createElement(za.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",style:{minWidth:"290px"},multiple:!0,value:e.levels,onChange:e.handleLevels,input:r.a.createElement(Di.a,null),renderValue:function(t){return e.levelsList.filter((function(e){return t.includes(e.value)})).map((function(e){return e.label})).join(", ")},MenuProps:Qi},e.levelsList.map((function(t){return r.a.createElement(Be.a,{key:t.value,value:t.value},r.a.createElement(zi.a,{checked:e.levels.indexOf(t.value)>-1}),r.a.createElement(Li.a,{primary:t.label}))}))))),(t=e.advancedMode,r.a.createElement(Pi,{icon:r.a.createElement(Ci.a,null),title:"Tags",disabled:!t,isActive:e.tags.length>0},r.a.createElement("div",{className:n.tagsContainer},r.a.createElement(y.TextField,{className:n.addTagText,value:i,onChange:function(e){return c(e.target.value)},onKeyUp:function(t){13===t.keyCode&&(e.handleAddTag(i),c(""))},label:"Add Tag",InputProps:{endAdornment:r.a.createElement(Ai.a,null,r.a.createElement(Ya.a,{onClick:function(){e.handleAddTag(i),c("")}},r.a.createElement(Ti.a,null)))},size:"small"}),r.a.createElement("div",{className:n.tagsList},e.tags.map((function(t){return r.a.createElement("li",{key:t.key},r.a.createElement(Oi.a,{label:t.label,onDelete:function(){return e.handleDeleteTag(t)},className:n.chip,size:"small"}))})))))),r.a.createElement(Pi,{icon:r.a.createElement(Ri.a,null),title:e.t("Date Range"),isActive:null!==e.selectedFromDate||null!==e.selectedToDate},r.a.createElement(Gi.MuiPickersUtilsProvider,{utils:Wi.a},r.a.createElement(Gi.KeyboardDateTimePicker,{key:"time-picker",size:"small",variant:"inline",ampm:!1,label:e.t("From date"),value:e.selectedFromDate,onChange:function(t){return e.handleDateChange(t,"selectedFromDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}),r.a.createElement(Gi.KeyboardDateTimePicker,{key:"time-picker2",size:"small",variant:"inline",ampm:!1,label:e.t("To date"),value:e.selectedToDate,onChange:function(t){return e.handleDateChange(t,"selectedToDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}))),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(Pi,{icon:r.a.createElement(Vi.a,null),title:e.t("Configuration")},r.a.createElement(y.FormControlLabel,{control:r.a.createElement(y.Switch,{checked:e.advancedMode,onChange:e.handleAdvancedMode}),label:e.advancedMode?"Advanced":"Simple"}),r.a.createElement("div",{className:n.filtersButton},r.a.createElement(y.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Limit p/Robot"),":")),r.a.createElement(y.TextField,{value:e.limit,onChange:e.handleLimit,className:n.limitText,id:"outlined-number",placeholder:e.t("limit"),type:"number",InputLabelProps:{shrink:!0},size:"small"})),r.a.createElement("div",{className:n.columnsFilter},r.a.createElement(y.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Columns"),":")),r.a.createElement(Va.a,{className:n.formControl},r.a.createElement(za.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",multiple:!0,value:e.columns,onChange:e.handleColumns,input:r.a.createElement(Di.a,null),renderValue:function(t){return t.map((function(t){return gr()(e,"columnList[".concat(t,"].label"),"")})).join(", ")},MenuProps:Qi},Object.keys(e.columnList).map((function(t,n){return r.a.createElement(Be.a,{key:n,value:t},r.a.createElement(zi.a,{checked:e.columns.indexOf(t)>-1}),r.a.createElement(Li.a,{primary:e.columnList[t].label}))}))))))))},Qi={PaperProps:{style:{maxHeight:224,width:250}},getContentAnchorEl:null};function Zi(e,t){return _i()(e,t)}Yi.propTypes={levels:s.a.array,levelsList:s.a.array,handleLevels:s.a.func,limit:s.a.number,handleLimit:s.a.func,columns:s.a.array,columnList:s.a.object,handleColumns:s.a.func,handleDeleteTag:s.a.func,messageRegex:s.a.string,handleMessageRegex:s.a.func,selectedFromDate:s.a.string,selectToDate:s.a.string,handleDateChange:s.a.func,selectedRobots:s.a.array,updateRobotSelection:s.a.func,advancedMode:s.a.bool,handleAdvancedMode:s.a.func,t:s.a.func},Yi.defaultProps={levels:[],levelsList:[],handleLevels:function(){},limit:1,handleLimit:function(){},columns:[],columnList:{},handleColumns:function(){},handleDeleteTag:function(){},messageRegex:"",handleMessageRegex:function(){},selectedFromDate:"",selectToDate:"",handleDateChange:function(){},selectedRobots:[],updateRobotSelection:function(){},advancedMode:!1,handleAdvancedMode:function(){},t:function(e){return e}};var Xi=Object(o.memo)(Yi,Zi),Ji=(n(146),n(127),n(128)),$i=n.n(Ji);var ec={INFO:{backgroundColor:"rgba(33, 150, 243, 0.1)"},WARNING:{backgroundColor:"rgba(255, 152, 0, 0.1)"},DEBUG:{backgroundColor:"rgba(76, 175, 80, 0.1)"},ERROR:{backgroundColor:"rgba(244, 67, 54, 0.1)"},CRITICAL:{backgroundColor:"rgba(255, 19, 1, 0.1)"}};function tc(e,t){var n=e.length;if(0===n||void 0===e)return 0;for(var o=0;o<n;o++)for(var r=0;r<n&&o!==e[r][t];r++)if(r===n-1)return o;return n}function nc(e,t){var n="";if(Array.isArray(e)&&e.length===t.length)return n;try{return e.forEach((function(e){n=""===n?"".concat(e.toLowerCase()):"".concat(n,",").concat(e.toLowerCase())})),"level=".concat(n)}catch(e){return""}}function oc(e){var t="";return $i()(e)?t:(e.forEach((function(e){t=""===t?"".concat(e.label):"".concat(t,",").concat(e.label)})),"&tags=".concat(t))}function rc(e){if(!e||""===e)return"";var t=e.replace(/ /g,"+");return"&message=".concat(t)}function ac(e,t){for(var n,o=0,r=e.length-1,a=null;o<=r;){var i=t(e[n=(o+r)/2|0]);"right"===i[0]?o=n+1:r=n-1,i[1]&&(a=n)}return a}var ic=function(e,t,n){if(!e)return[];var o=0,r=e.length;if(!t&&!n)return e;var a=e.map((function(e){return e.time}));return n&&(o=ac(a,(function(e){return e>=n.getTime()/1e3?["right",!1]:["left",!0]}))),t&&(r=ac(a,(function(e){return e<=t.getTime()/1e3?["left",!1]:["right",!0]}))),e.slice(o,r+1)},cc=n(77),sc=n.n(cc),uc=n(71),lc=["columns","rowHeight","headerHeight","onRowClick"],fc=["dataKey","render"];function dc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function hc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var mc=Object(p.makeStyles)((function(e){return hc({flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:"rgba(0, 5, 58, 0.3)"}},tableCell:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block"},flexColumn:{flex:1,alignItems:"center"},noClick:{cursor:"initial"}},ec)})),pc=function(e){var t=e.columns,n=e.rowHeight,o=e.headerHeight,a=e.onRowClick,i=bt()(e,lc),c=mc(),s=function(t){var n=t.index,o=e.data[n];return _a()(c.tableRow,c.flexContainer,-1!==n&&c[o.level],d()({},c.tableRowHover,-1!==n&&null!=a))},u=function(e){return function(o){var a=o.cellData,i=o.columnIndex;return r.a.createElement(sc.a,{component:"div",className:"".concat(c.tableCell," ").concat(c.flexContainer),variant:"body",style:{height:n},align:null!=i&&t[i].numeric?"right":"left"},e?e(a):a)}};return r.a.createElement(uc.AutoSizer,null,(function(e){var l=e.height,f=e.width;return r.a.createElement(uc.Table,je()({height:l,width:f,onRowClick:a,rowHeight:n,gridStyle:{direction:"inherit"},headerHeight:o,className:c.table},i,{rowClassName:s}),t.map((function(e,n){var a=e.dataKey,i=e.render,s=bt()(e,fc);return r.a.createElement(uc.Column,je()({key:a,headerRenderer:function(e){return a=hc(hc({},e),{},{columnIndex:n}),i=a.label,s=a.columnIndex,r.a.createElement(sc.a,{component:"div",className:_a()(c.tableCell,c.flexContainer,c.noClick),variant:"head",style:{height:o},align:t[s].numeric?"right":"left"},r.a.createElement("span",null,i));var a,i,s},flexGrow:"message"===a?1:void 0,className:c.flexContainer,cellRenderer:u(i),dataKey:a},s))})))}))};function vc(e){return r.a.createElement(pc,{rowHeight:48,headerHeight:48,rowCount:e.logsData.length,rowGetter:function(t){var n=t.index;return e.logsData[n]},data:e.logsData,columns:e.columns.map((function(t){return e.columnList[t]})),onRowClick:e.onRowClick})}function gc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}vc.propTypes={columns:s.a.array,columnList:s.a.object,logsData:s.a.array,height:s.a.number,onRowClick:s.a.func},vc.defaultProps={columns:[],columnList:{},logsData:[],height:10};var Ac={key:0,label:"ui"},wc=function(e){z()(n,e);var t=bc(n);function n(){var e;D()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(V()(e),"state",{selectedRobots:[],levels:["INFO","ERROR"],limit:50,logsData:[],messageRegex:"",selectedFromDate:null,selectedToDate:null,columns:["Time","Robot","Message"],tags:e.props.advancedMode?[]:[Ac],height:0,levelsList:e.props.advancedMode?[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]:[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}],advancedMode:e.props.advancedMode}),d()(V()(e),"logsTimeout",void 0),d()(V()(e),"logModal",Object(o.createRef)()),d()(V()(e),"simpleLevelsList",[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}]),d()(V()(e),"advancedLevelsList",[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]),d()(V()(e),"updateSelectedRobots",(function(){e.props.robotsData.length&&e.props.robotsData.filter((function(e){return e.ip})).length&&e.setSelectedRobots(e.props.robotsData.map((function(e){return yc(yc({},e),{},{isSelected:!0})})))})),d()(V()(e),"updateRobotSelection",(function(t){var n=on()(e.state.selectedRobots),o=n[n.findIndex((function(e){return e.id===t}))];o.isSelected=!o.isSelected,e.setState({selectedRobots:n})})),d()(V()(e),"setSelectedRobots",(function(t){clearTimeout(e.logsTimeout),e.setState({selectedRobots:t}),e.getLogs(t)})),d()(V()(e),"getLogs",function(){var t=tn()(an.a.mark((function t(n){return an.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.filter((function(t){return t.robotState!==e.props.robotStates.off})).filter((function(e){return e.isSelected})).map((function(t){return e.getRobotLogData(t)}))).then((function(t){e.setState((function(n){var o=t.reduce((function(e,t){return t&&t.forEach((function(t){return e.push(t)})),e}),[]);return e.logsTimeout=setTimeout(e.getLogs,3e3,n.selectedRobots),{logsData:o.sort((function(e,t){return t.time-e.time}))}}))}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d()(V()(e),"getRobotLogData",(function(t){return new Promise((function(n,o){var r=setTimeout((function(){console.error("MOV.AI: One of the promises reached timeout"),n([])}),2e3);if(t.ip){var a="http://".concat(t.ip,"/api/v1/logs/?").concat(nc(e.state.levels,e.state.levelsList),"&limit=").concat(e.state.limit).concat(oc(e.state.tags)).concat(rc(e.state.messageRegex));se.MasterDB.get(a,(function(e,t){n((null==e?void 0:e.data)||[]),clearTimeout(r)}))}else n([])})).catch((function(){return console.log("Failed getRobotLogData")}))})),d()(V()(e),"onRowClick",(function(t){e.logModal.current.open(t.rowData)})),e}return L()(n,[{key:"resizeHandler",value:function(){var e=this.divElement.clientHeight;this.setState({height:e})}},{key:"componentDidMount",value:function(){this.updateSelectedRobots()}},{key:"componentDidUpdate",value:function(e,t){_i()(e.robotsData,this.props.robotsData)||this.updateSelectedRobots()}},{key:"componentWillUnmount",value:function(){this.logsTimeout&&clearTimeout(this.logsTimeout)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},r.a.createElement("div",{style:{flexGrow:"1",height:"100%",display:"flex",flexDirection:"column"}},r.a.createElement(Xi,{selectedRobots:this.state.selectedRobots,updateRobotSelection:this.updateRobotSelection,levels:this.state.levels,levelsList:this.state.levelsList,handleLevels:function(t){e.setState({levels:t.target.value})},limit:this.state.limit,handleLimit:function(t){""===t.target.value?e.setState({limit:0}):e.setState({limit:t.target.value})},columns:this.state.columns,columnList:this.props.columnList,handleColumns:function(t){var n=Object.keys(e.props.columnList).filter((function(e){return t.target.value.includes(e)}));e.setState({columns:n})},tags:this.state.tags,handleAddTag:function(t){var n=e.state.tags;""!==t&&n.findIndex((function(e){return e.label===t}))<0&&(n.push({key:tc(n,"key"),label:t}),e.setState({tags:n}))},handleDeleteTag:function(t){var n=e.state.tags.filter((function(e){return e.key!==t.key}));e.setState({tags:n})},messageRegex:this.state.messageRegex,handleMessageRegex:function(t){return e.setState({messageRegex:t})},selectedFromDate:this.state.selectedFromDate,selectedToDate:this.state.selectedToDate,handleDateChange:function(t,n){e.setState(d()({},n,t))},advancedMode:this.state.advancedMode,handleAdvancedMode:function(t){var n=!e.state.advancedMode;e.setState({advancedMode:n,levelsList:e.state.advancedMode?e.simpleLevelsList:e.advancedLevelsList,tags:n?[]:[Ac]})}}),r.a.createElement("div",{ref:function(t){e.divElement=t},className:this.props.classes.tableContainer},r.a.createElement(vc,{columns:this.state.columns,columnList:this.props.columnList,logsData:ic(this.state.logsData,this.state.selectedFromDate,this.state.selectedToDate),height:this.state.height,levelsList:this.state.levelsList,onRowClick:this.onRowClick}))),r.a.createElement(fe,{ref:this.logModal,props:["module","service"]}))}}]),n}(o.Component);wc.propTypes={robotsData:s.a.array,robotStates:s.a.object,columnList:s.a.object,advancedMode:s.a.bool},wc.defaultProps={robotsData:[{name:"robot",id:"032cf6207ff34ad0a68cc45034f61b41",timestamp:1604334778.6494586,robotState:"okay",battery:78,ip:"127.0.0.1"},{name:"robot_test",id:"4df900e30cb44adba33ae74bb2596d88",timestamp:1603969723.997914,robotState:"off",battery:22,ip:"127.0.0.1"}],robotStates:{error:"error",temp:"temp",okay:"okay",off:"off"},columnList:{Date:{label:"Date",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleDateString("pt"))}(e)}},Time:{label:"Time",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleTimeString("pt"))}(e)}},Level:{label:"Level",dataKey:"level",width:100},Module:{label:"Module",dataKey:"module",width:100},Robot:{label:"Robot",dataKey:"robot",width:100},Message:{label:"Message",dataKey:"message",width:100}},advancedMode:!1};var Mc=Object(p.withStyles)((function(e){return{tableContainer:{flexGrow:1,minHeight:0,overflow:"hidden"}}}),{withTheme:!0})(wc),Ec=n(40),xc=n.n(Ec),Pc=n(129),kc=n.n(Pc),Cc=n(130),Sc=n.n(Cc),Oc=n(78),Nc=n.n(Oc);function Tc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Ic=function(e){z()(n,e);var t=Tc(n);function n(){var e;D()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(V()(e),"state",{username:"",password:"",remember:!1,error:!1,errorMessage:"",capsLockOn:!1}),d()(V()(e),"sendCreds",tn()(an.a.mark((function t(){var n;return an.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,se.Authentication.login(e.state.username,e.state.password,e.state.remember);case 3:(n=t.sent).error?e.setState({error:!0,errorMessage:n.error}):e.props.setLoggedIn(!0),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.setState({error:!0,errorMessage:t.t0});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),d()(V()(e),"checkCapsLock",(function(t){if("CapsLock"===t.key&&e.state.capsLockOn)e.setState({capsLockOn:!1});else{var n=t.getModifierState("CapsLock");e.setState({capsLockOn:n})}})),e}return L()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,o=t.logo;return r.a.createElement(xc.a,{style:{paddingTop:"5%"},container:!0,direction:"column",alignItems:"center",justify:"space-evenly"},r.a.createElement(Sc.a,{elevation:10,className:n.root},r.a.createElement(xc.a,{item:!0},r.a.createElement("img",{src:o||kc.a,className:"center",alt:"logo",style:{display:"block",marginLeft:"auto",marginRight:"auto",width:"50%"}})),r.a.createElement(xc.a,null,r.a.createElement($.a,{align:"center",variant:"subtitle1",gutterBottom:!0},r.a.createElement(Va.a,{className:n.formControl,error:this.state.error},r.a.createElement(La.a,{htmlFor:"component-username-error"},"Username"),r.a.createElement(Di.a,{id:"component-username-error",value:this.state.username,"aria-describedby":"component-username-error-text",onChange:function(t){return e.setState({username:t.target.value})}})))),r.a.createElement(xc.a,null,r.a.createElement($.a,{align:"center",variant:"subtitle1",gutterBottom:!0},r.a.createElement(Va.a,{className:n.formControl,error:this.state.error},r.a.createElement(La.a,{htmlFor:"component-password-error"},"Password"),r.a.createElement(Di.a,{id:"component-password-error",type:"password",value:this.state.password,"aria-describedby":"component-password-error-text",onChange:function(t){return e.setState({password:t.target.value})},onKeyUp:function(t){e.checkCapsLock(t),"Enter"===t.key&&e.sendCreds()}}),this.state.error&&r.a.createElement(Nc.a,{id:"component-error-text"},this.state.errorMessage),this.state.capsLockOn&&r.a.createElement(Nc.a,{id:"component-warning-text"},"Warning: Caps lock is ON!")))),r.a.createElement(xc.a,null,r.a.createElement($.a,{align:"center",gutterBottom:!0},r.a.createElement(i.a,{onClick:function(){return e.sendCreds()}},"Login")))))}}]),n}(o.Component);Ic.propTypes={logs:s.a.any,setLoggedIn:s.a.func},Ic.defaultProps={setLoggedIn:function(e){return console.log(e)}};var Rc=Object(p.withStyles)((function(e){return{root:{padding:e.spacing(4,4),borderRadius:10}}}),{withTheme:!0})(Ic);function Bc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Dc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fc=Object(p.makeStyles)((function(e){return{menuItemSpacing:Dc({fontSize:"18px",minHeight:"18px",padding:e.spacing(1.25,2)},e.cursorDefault),profileMenuFooter:{fontSize:"14px",textAlign:"end"}}})),Lc=function(e){var t,n=Fc(),o=r.a.useState(null),a=ge()(o,2),i=a[0],c=a[1];return r.a.createElement("div",null,r.a.createElement(Ya.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)}},r.a.createElement(Vi.a,null)),r.a.createElement(Ie.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(){c(null)}},r.a.createElement(y.Typography,{component:"div",variant:"body1"},r.a.createElement("div",{className:n.menuItemSpacing},e.welcomeLabel,", ",e.userName),r.a.createElement(X.a,{variant:"middle"}),null===(t=e.extraItems)||void 0===t?void 0:t.map((function(e){return r.a.createElement(Be.a,{className:n.menuItemSpacing,onClick:function(){return e.func}},e.label)})),r.a.createElement("div",{className:n.menuItemSpacing},e.darkThemeLabel,r.a.createElement(zt,{onToggle:function(){return e.handleToggleTheme()},toggle:e.isDarkTheme})),r.a.createElement(Be.a,{className:(n.menuItemSpacing,n.cursorPointer),onClick:e.handleLogout},e.logoutLabel),r.a.createElement(X.a,{variant:"middle"}),r.a.createElement("div",{className:n.menuItemSpacing+" "+n.profileMenuFooter},e.version))))};Lc.propTypes={welcomeLabel:s.a.string,userName:s.a.string,darkThemeLabel:s.a.string,logoutLabel:s.a.string,version:s.a.string,extraItems:s.a.array,isDarkTheme:s.a.bool,handleLogout:s.a.func,handleToggleTheme:s.a.func},Lc.defaultProps={welcomeLabel:"Hello",userName:"User",darkThemeLabel:"Dark Theme",logoutLabel:"Logout",version:"",extraItems:[],isDarkTheme:!0,handleLogout:function(){return console.log("logout")},handleToggleTheme:function(){return console.log("toggle")}};var jc=Lc,Vc=n(72),Uc=n.n(Vc),zc=n(73),Gc=n.n(zc),Kc=n(131),Wc=n.n(Kc),qc=(n(148),n(149),n(150),n(132)),_c=n.n(qc);function Hc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Yc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}var Zc=function(e){z()(n,e);var t=Qc(n);function n(){var e;D()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(V()(e),"searchInput",null),d()(V()(e),"timer",null),d()(V()(e),"inputRef",r.a.createRef()),d()(V()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,250)})),d()(V()(e),"handleSearch",(function(){null!==e.searchInput&&e.props.search(e.searchInput)})),e}return L()(n,[{key:"resetValue",value:function(){var e=this.inputRef.current.children[0];e.value="",e.focus(),this.searchInput="",this.handleSearch(),this.forceUpdate()}},{key:"isEmpty",value:function(){return null===this.searchInput||""===this.searchInput.trim()}},{key:"render",value:function(){var e=this;return r.a.createElement(y.Typography,{component:"div",style:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%"}},r.a.createElement(y.InputBase,{ref:this.inputRef,style:{marginLeft:10,flex:1},placeholder:k.t("Search"),onChange:this.handleChange}),r.a.createElement(y.IconButton,{style:{padding:10},onClick:function(){e.isEmpty()||e.resetValue()}},this.isEmpty()?r.a.createElement(dt.a,null):r.a.createElement(Ze.a,null)))}}]),n}(o.Component),Xc=function(e){return r.a.createElement(y.List,{style:Yc({paddingLeft:"0px",paddingRight:"0px"},e.style),dense:!0,component:"div",onKeyUp:e.onKeyUp},e.children)},Jc=function(e){return r.a.createElement(Xc,{style:{flexGrow:1,paddingBottom:"0px",paddingTop:"0px"},onKeyUp:e.onKeyUp},r.a.createElement(y.ListItem,null,r.a.createElement(Zc,{search:function(t){return e.onSearch(t)}})),r.a.createElement(y.Divider,null),r.a.createElement(y.Typography,{style:e.style,component:"div"},r.a.Children.map(e.children,(function(e){return e}))))};Jc.propTypes={onSearch:s.a.func},Jc.defaultProps={onSearch:function(e){return console.log(e)}};var $c=["style","node"];function es(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ts(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?es(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):es(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ns(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=q()(e);if(t){var r=q()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return K()(this,n)}}for(var os=[],rs=0;rs<100;rs++)os.push({id:rs,name:"1.0.".concat(rs)});var as=function(e){z()(n,e);var t=ns(n);function n(){var e;D()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(V()(e),"state",{selectedGroup:"EXPANDED",groupsEnabled:!0,searchValue:""}),d()(V()(e),"searchFilter",(function(e,t){var n=t.toLowerCase(),o=e.filter((function(e){return!e.name.includes("@SM")&&e.name.toLowerCase().includes(n)||e.children.findIndex((function(e){return e.name.toLowerCase().includes(n)}))>=0})).map((function(e){return ts(ts({},e),{},{children:((null==e?void 0:e.children)||[]).filter((function(t){return t.name&&!t.name.includes("@SM")&&(e.name.toLowerCase().includes(n)||t.name.toLowerCase().includes(n))}))})}));return o.forEach((function(e){e.children.forEach((function(e,t){e.id=e.id?e.id:t,e.children&&e.children.forEach((function(e,t){e.id=e.id?e.id:t}))}))})),o})),d()(V()(e),"handleSelectedGroupChange",(function(t){e.setState({selectedGroup:t})})),d()(V()(e),"handleExpansion",(function(e,t,n,o){})),e}return L()(n,[{key:"render",value:function(){var e=this,t=this.props.classes,n=r.a.createElement("i",{className:"fas fa-home"}),o=this.props.data;return r.a.createElement("div",null,r.a.createElement(Jc,{style:{overflow:"auto"},icon:n,onSearch:function(t){e.setState({searchValue:t})}},r.a.createElement("div",{style:{height:this.props.height}},r.a.createElement(Wc.a,{nodes:this.searchFilter(o,this.state.searchValue),onChange:this.props.handleChange},(function(n){var a,i,c=n.style,s=n.node;bt()(n,$c);return c.paddingLeft=c.marginLeft/1.5,c.marginLeft=0,r.a.createElement("div",{style:c,onClick:function(){return e.props.onClickNode(s)},onDoubleClick:function(){return e.props.onDoubleClickNode(s)},p:2,className:gr()(s,"children",!1)?"":t.preContainer},r.a.createElement(_c.a,{p:1,className:t.inlineFlex},r.a.createElement(xc.a,{alignContent:"space-between",container:!0},gr()(s,"children",!1)&&(null===(a=s.state)||void 0===a?void 0:a.expanded)&&r.a.createElement(we.a,{onClick:function(t){return e.handleExpansion(t,o,s,!1)}}),gr()(s,"children",!1)&&!(null!==(i=s.state)&&void 0!==i&&i.expanded)&&r.a.createElement(be.a,{onClick:function(t){return e.handleExpansion(t,o,s,!0)}}),r.a.createElement("div",{className:gr()(s,"children",!1)?"":t.spaceBetween},r.a.createElement("div",{className:t.ellipsis},s.name)))))})))))}}]),n}(o.Component);as.propTypes={data:s.a.array,onClickNode:s.a.func,onDoubleClickNode:s.a.func,handleChange:s.a.func,height:s.a.oneOfType([s.a.string,s.a.number])},as.defaultProps={data:[],onClickNode:function(){},onDoubleClickNode:function(){},handleChange:function(){},height:700};var is=Object(p.withStyles)((function(e){return{horizFlex:{display:"flex",flexDirection:"row",alignItems:"center"},spaceBetween:{display:"flex",width:"100%",justifyContent:"space-between"},preContainer:{justifyContent:"space-between","& button":{display:"none"},"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)","& button":{display:"inline-flex"}}},ellipsis:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:2},iconSpace:{flex:1,textAlign:"right",minWidth:"45px","& button":{position:"relative",bottom:"7px",padding:"7px"}}}}),{withTheme:!0})(as),cs=n(133),ss=n.n(cs),us=n(63),ls=n.n(us),fs=function(e){var t=[{id:0,name:k.t("Annotations"),scope:"Annotation",children:[]},{id:1,name:k.t("Callback"),scope:"Callback",children:[]},{id:2,name:k.t("Configuration"),scope:"Configuration",children:[]},{id:3,name:k.t("Flow"),scope:"Flow",children:[]},{id:4,name:k.t("Nodes"),scope:"Node",children:[]},{id:5,name:k.t("Layouts"),scope:"Layout",children:[]},{id:6,name:k.t("Scenes"),scope:"GraphicScene",children:[]}],n=r.a.useState(t),o=ge()(n,2),a=o[0],i=o[1],c=r.a.useState("global"),s=ge()(c,2),u=s[0],l=s[1],f=r.a.useState(e.selected),d=ge()(f,2),h=d[0],m=d[1],p=r.a.useState({}),v=ge()(p,2),g=v[0],b=v[1],A=r.a.useState(!0),w=ge()(A,2),M=w[0],E=w[1],x=t.filter((function(t){return e.scopeList.includes(t.scope)}));r.a.useEffect((function(){return se.Workspace.getAll().then((function(e){return b(e)})).catch((function(e){return console.log(e)})),S(u),function(){}}),[e.scopeList]),r.a.useEffect((function(){if(!M&&"global"===u&&e.filter){var t=Gc()(a);a.forEach((function(n,o){t[o].children=n.children.filter(e.filter)})),i(t)}}),[e.filter,M]);var P,C,S=function(e){var t=Gc()(x);t.forEach((function(n,o){se.Workspace.getDocs({workspace:e,scope:n.scope}).then((function(e){var n=e.scopes.sort((function(e,t){return e.ref.localeCompare(t.ref)})).map((function(e,t){return{id:t,url:e.url,name:e.ref,children:[{name:""}]}}));t[o].children=n,i(t),E(!1)})).catch((function(e){return console.error(e)}))}))};return r.a.createElement(T,{onSubmit:function(){return e.onSubmit(h)},onCancel:e.onCancel,open:e.open,title:(P=e.scopeList[0],C=["a","e","i","o","u"].includes(P[0].toLowerCase())?k.t("an"):k.t("a"),"".concat(k.t("Select")," ").concat(C," ").concat(k.t(P))),width:"50%"},r.a.createElement(y.Grid,{container:!0},r.a.createElement(y.Grid,{item:!0,xs:12,style:{textAlign:"center",paddingBottom:"6px",paddingTop:"10px"}},r.a.createElement(y.FormControl,{style:{width:"50%"}},r.a.createElement(y.InputLabel,null,k.t("Workspace")),r.a.createElement(y.Select,{value:u,onChange:function(e){l(e.target.value),S(e.target.value),E(!0)},disabled:!e.allowArchive},Object.keys(g).map((function(e,t){return r.a.createElement(y.MenuItem,{key:t,value:e},g[e].label)}))))),r.a.createElement(y.Typography,{component:"div",style:{overflowY:"auto",overflowX:"hidden",justifyContent:"center",width:"100%"}},M?r.a.createElement(ss.a,{style:{position:"relative",height:"50vh",width:"inherit",color:"#fff",zIndex:99999},open:M},r.a.createElement(ls.a,{color:"inherit"})):r.a.createElement(is,{onClickNode:function(e){return function(e){var t=Gc()(a),n={0:function(){var n=t.findIndex((function(t){return t.id===e.id})),o=gr()(t,[n,"state","expanded"],!1);Uc()(t,[n,"state"],{expanded:!o}),i(t)},1:function(){var n=t.findIndex((function(t){return t.id===e.parents[0]}));se.Workspace.getDocs({workspace:u,scope:t[n].scope,id:e.name}).then((function(o){var r=o.versions.map((function(e,t){return{url:e.url,name:e.tag,id:t}})),a=t[n].children.findIndex((function(t){return t.id===e.id})),c=gr()(t,[n,"children",a,"state","expanded"],!1);Uc()(t,[n,"children",a,"state"],{expanded:!c}),Uc()(t,[n,"children",a,"children"],r),i(t)})).catch((function(e){return console.error(e)}))},2:function(){m("".concat(e.url))}};gr()(n,e.deepness,(function(){}))()}(e)},onDoubleClickNode:function(t){return n=t,void("global"!==u&&n.deepness<=1||(m(n.url),e.onSubmit(n.url)));var n},data:a,handleChange:function(e){return i(e)},showIcons:!1,height:"400px"})),r.a.createElement(y.Grid,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(y.Typography,{label:k.t("Message"),value:"selected",margin:"normal"},""===h?k.t("Nothing selected"):h))))};fs.propTypes={allowArchive:s.a.bool,onSubmit:s.a.func,onCancel:s.a.func,open:s.a.bool,scopeList:s.a.array,message:s.a.string,selected:s.a.string,filter:s.a.func},fs.defaultProps={title:k.t("Insert Text here"),message:k.t("Are you sure?"),allowArchive:!0,onSubmit:function(){},onCancel:function(){},open:!1,scopeList:["Callback"],selected:""};var ds=fs,hs=n(79),ms=n.n(hs),ps=n(134),vs=Object(ps.makeStyles)((function(e){return{alert:{position:"absolute",bottom:0,width:"100%"}}}));function gs(e){return function(t){var n=r.a.useState(!0),a=ge()(n,2),i=a[0],c=a[1],s=r.a.useState(!1),u=ge()(s,2),l=u[0],f=u[1],d=r.a.useState(null),h=ge()(d,2),m=h[0],p=h[1],v=r.a.useState(!1),g=ge()(v,2),b=g[0],A=g[1],w=vs();Object(o.useEffect)((function(){var e=se.MasterDB.offlineValidation({onOnline:M,onOffline:E});p(e)}),[]);var M=function(){c(!0),f(!0),setTimeout((function(){return f(!1)}),2e3)},E=function(){c(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(e,t),!i&&r.a.createElement(ms.a,{className:w.alert,variant:"filled",severity:"error",action:r.a.createElement(y.Button,{color:"inherit",size:"small",onClick:function(){A(!0),m.retryConnection().then((function(){return A(!1)}))}},b?r.a.createElement(ls.a,{size:20,color:"inherit"}):"RETRY")},"Connection failed... You're now in offline mode, please wait to reconnect."),i&&l&&r.a.createElement(ms.a,{className:w.alert,variant:"filled",severity:"success"},"You're now online!")))}}var ys=n(135),bs=n.n(ys);function As(e){return function(t){var n=Object(o.useRef)(!0),a=Object(o.useState)(!1),i=ge()(a,2),c=i[0],s=i[1],u=Object(o.useState)(0),l=ge()(u,2),f=l[0],d=l[1];Object(o.useEffect)((function(){function e(){return(e=tn()(an.a.mark((function e(){return an.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.Authentication.checkLogin();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}s(function(){return e.apply(this,arguments)}())}),[]),Object(o.useEffect)((function(){var e=Math.floor(.001*Date.now()),t=window.localStorage.getItem("movai.refreshToken");try{var n=(bs()(t).exp||e)-e;if(n<=0)throw new Error("Token expired");setTimeout((function(){return d(e)}),1e3*n+2e3),s(!0)}catch(e){s(!1)}}),[f,c]);return r.a.createElement(r.a.Fragment,null,!c&&n.current?(n.current=!1,r.a.createElement(Rc,{setLoggedIn:function(e){return s(e)}})):r.a.createElement(r.a.Fragment,null,r.a.createElement(e,je()({handleLogOut:function(){se.Authentication.logout()},loggedIn:c},t)),r.a.createElement(y.Modal,{open:!c},r.a.createElement(Rc,{setLoggedIn:function(e){return s(e)}}))))}}}])}));
//# sourceMappingURL=index.js.map