!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Movai=t():e.Movai=t()}(global,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=71)}([function(e,t){e.exports=require("babylonjs")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/defineProperty")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/for-each")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/assertThisInitialized")},function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/map")},function(e,t){e.exports=require("monet")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/classCallCheck")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/createClass")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/getPrototypeOf")},function(e,t){e.exports=require("prop-types")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/extends")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/inherits")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/flat-map")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/get")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/concat")},function(e,t){e.exports=require("mov.ai-core")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/keys")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/filter")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptors")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-descriptor")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/get-own-property-symbols")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/toConsumableArray")},function(e,t){e.exports=require("@material-ui/core")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/define-property")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/define-properties")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/object/values")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/reduce")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/some")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/splice")},function(e,t){e.exports=require("@material-ui/icons/ChevronRight")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/slicedToArray")},function(e,t){e.exports=require("@material-ui/icons/Clear")},function(e,t){e.exports=require("@babylonjs/gui/2D")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/promise")},function(e,t){e.exports=require("@babel/runtime-corejs3/regenerator")},function(e,t){e.exports=require("@material-ui/core/Button")},function(e,t){e.exports=require("@material-ui/core/Drawer")},function(e,t){e.exports=require("@material-ui/icons/ExpandMore")},function(e,t){e.exports=require("@material-ui/core/Collapse")},function(e,t){e.exports=require("@material-ui/core/styles")},function(e,t){e.exports=require("@material-ui/core/Menu")},function(e,t){e.exports=require("@material-ui/core/MenuItem")},function(e,t){e.exports=require("material-table")},function(e,t){e.exports=require("@material-ui/icons/AddBox")},function(e,t){e.exports=require("@material-ui/icons/ArrowDownward")},function(e,t){e.exports=require("@material-ui/icons/Check")},function(e,t){e.exports=require("@material-ui/icons/ChevronLeft")},function(e,t){e.exports=require("@material-ui/icons/DeleteOutline")},function(e,t){e.exports=require("@material-ui/icons/Edit")},function(e,t){e.exports=require("@material-ui/icons/FilterList")},function(e,t){e.exports=require("@material-ui/icons/FirstPage")},function(e,t){e.exports=require("@material-ui/icons/LastPage")},function(e,t){e.exports=require("@material-ui/icons/Remove")},function(e,t){e.exports=require("@material-ui/icons/SaveAlt")},function(e,t){e.exports=require("@material-ui/icons/Search")},function(e,t){e.exports=require("@material-ui/icons/ViewColumn")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/set-timeout")},function(e,t){e.exports=require("react-resize-detector")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/math/sign")},function(e,t){e.exports=require("earcut")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/sort")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/find-index")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/slice")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/every")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/includes")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/number/parse-float")},function(e,t){e.exports=require("@babel/runtime-corejs3/helpers/esm/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime-corejs3/core-js-stable/instance/fill")},function(e,t){e.exports=require("babylonjs-loaders")},function(e,t,n){"use strict";n.r(t);var o=n(4),r=n.n(o),i=n(37),a=n.n(i),l=n(10),c=n.n(l),u=function(e){return r.a.createElement(a.a,{className:e.className,style:e.style,onClick:e.onClick,color:e.color,variant:e.variant,size:e.size,startIcon:e.startIcon},e.children)};u.propTypes={style:c.a.object,onClick:c.a.func,color:c.a.string,variant:c.a.string,size:c.a.string,startIcon:c.a.element,children:c.a.node.isRequired},u.defaultProps={style:{},onClick:function(){return console.log("Click MOV.AI button")},color:"default",variant:"contained",size:"medium",startIcon:void 0,children:r.a.createElement("div",null)};var s=u,f=n(25),h=n.n(f),m=n(26),d=n.n(m),v=n(20),p=n.n(v),y=n(2),b=n.n(y),g=n(21),M=n.n(g),w=n(19),k=n.n(w),x=n(22),P=n.n(x),N=n(18),C=n.n(N),S=n(1),T=n.n(S),_=n(24);function A(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=A(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=A(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}var j={margin:"auto",position:"absolute",overflow:"auto",display:"flex",flexDirection:"column"},R=function(e){var t=function(){e.onSubmit()},n=function(){e.onCancel()};return r.a.createElement(_.Modal,{onKeyPress:function(e){"Enter"===e.key&&t()},open:e.open,onClose:n,style:{display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(_.Card,{style:E({},j,{width:e.width,height:e.height,minWidth:"260px",minHeight:"280px"})},r.a.createElement(_.CardContent,{style:{flexGrow:1,display:"flex",flexDirection:"column",minHeight:0}},r.a.createElement(_.Typography,{variant:"h5",style:{padding:"12px 0px 12px 6px",fontFamily:"Open Sans",fontStyle:"normal",fontWeight:600,fontSize:"24px"}},e.title),r.a.createElement("div",{style:{paddingLeft:"6px",flexGrow:1,overflow:"auto",minHeight:0}},e.children)),r.a.createElement(_.Divider,null),r.a.createElement(_.CardActions,{style:{alignSelf:"flex-end"}},r.a.createElement(s,{onClick:n,variant:"outlined"},e.cancelText),r.a.createElement(s,{color:"primary",onClick:t},e.submitText))))};R.propTypes={onSubmit:c.a.func,onCancel:c.a.func,open:c.a.bool,title:c.a.string,submitText:c.a.string,cancelText:c.a.string,width:c.a.string,height:c.a.string},R.defaultProps={onSubmit:function(){},onCancel:function(){},open:!1,title:"New",submitText:"Confirm",cancelText:"Cancel",width:"25%",height:"25%"};var B=R,D=n(38),V=n.n(D),z=function(e){return r.a.createElement(V.a,{style:e.style,anchor:e.anchor,open:e.open,onClose:e.onClose},e.children)};z.propTypes={style:c.a.object,anchor:c.a.string,open:c.a.bool,children:c.a.object},z.defaultProps={style:{},anchor:"left",open:!1,children:r.a.createElement("div",null)},z.ANCHOR={left:"left",right:"right",top:"top",bottom:"bottom"};var I=z,O=n(32),F=n.n(O),q=n(31),L=n.n(q),U=n(39),G=n.n(U),Y=n(40),W=n.n(Y);function Q(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=Q(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=Q(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}var H=function(e){var t=r.a.useState(e.open),n=F()(t,2),o=n[0],i=n[1];r.a.useEffect((function(){e.open!==o&&i(e.open)}),[e.open]);var a;return r.a.createElement(_.List,null,r.a.createElement(_.ListItem,{button:!0,onClick:(a=e.onClick,function(){i(!o),a()})},o?r.a.createElement(G.a,{style:Z({},e.iconStyle)}):r.a.createElement(L.a,{style:Z({},e.iconStyle)}),r.a.createElement("div",{style:{width:"100%"}},e.item)),e.divided?r.a.createElement(_.Divider,null):[],r.a.createElement(W.a,{className:e.className,style:e.style,in:o},e.children))};H.propTypes={item:c.a.object,onClick:c.a.func,open:c.a.bool,divided:c.a.bool,iconStyle:c.a.object},H.defaultProps={item:r.a.createElement("div",null),onClick:function(){},open:!1,divided:!1,style:{},iconStyle:{}};var K=H,X=n(5),J=n.n(X),$=n(41),ee=Object($.makeStyles)((function(e){return{container:{height:"100%",backgroundColor:function(e){return e.backgroundColor},width:function(e){return e.width},display:"flex",flexDirection:"column"},logoArea:{padding:"17px",textAlign:"center",alignItems:"center",justifyContent:"center"},navigationArea:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center"},accountArea:{padding:"17px",textAlign:"center",alignItems:"center",justifyContent:"center"}}})),te=function(e){var t,n=ee(e);return r.a.createElement("div",{className:n.container},r.a.createElement("div",{className:n.logoArea},e.upperElement),r.a.createElement("div",{className:n.navigationArea},J()(t=e.navigationList).call(t,(function(e,t){return r.a.createElement("div",{key:t,style:{padding:"15px 0px"}},e)}))),r.a.createElement("div",{className:n.accountArea},e.lowerElement))};te.propTypes={upperElement:c.a.node.isRequired,navigationList:c.a.array,lowerElement:c.a.node.isRequired,width:c.a.string,backgroundColor:c.a.string},te.defaultProps={upperElement:r.a.createElement("div",null),navigationList:[r.a.createElement("div",null)],lowerElement:r.a.createElement("div",null),width:"68px",backgroundColor:"#424242"};var ne=te,oe=n(42),re=n.n(oe),ie=n(43),ae=n.n(ie),le=function(e){var t,n=r.a.useState(null),o=F()(n,2),i=o[0],a=o[1],l=function(){a(null)};return r.a.createElement("div",null,r.a.cloneElement(e.element,{onClick:function(t){void 0!==e.element.props.onClick&&e.element.props.onClick(),a(t.currentTarget)}}),r.a.createElement(re.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:l},J()(t=e.menuList).call(t,(function(e,t){return r.a.createElement(ae.a,{onClick:function(){e.onClick(),(e.onClose||void 0===e.onClose)&&l()},key:t},e.element)}))))};le.propTypes={element:c.a.node.isRequired,navigationList:c.a.array,lowerElement:c.a.node.isRequired,width:c.a.string,backgroundColor:c.a.string},le.defaultProps={element:r.a.createElement("div",null,"Ahaha"),menuList:[{onClick:function(){return console.log("clicked 1")},element:"Profile",onClose:!0}],lowerElement:r.a.createElement("div",null),width:"68px",backgroundColor:"#424242"};var ce=le,ue=n(12),se=n.n(ue),fe=n(44),he=n.n(fe),me=n(45),de=n.n(me),ve=n(46),pe=n.n(ve),ye=n(47),be=n.n(ye),ge=n(48),Me=n.n(ge),we=n(33),ke=n.n(we),xe=n(49),Pe=n.n(xe),Ne=n(50),Ce=n.n(Ne),Se=n(51),Te=n.n(Se),_e=n(52),Ae=n.n(_e),Ee=n(53),je=n.n(Ee),Re=n(54),Be=n.n(Re),De=n(55),Ve=n.n(De),ze=n(56),Ie=n.n(ze),Oe=n(57),Fe=n.n(Oe),qe={Add:Object(o.forwardRef)((function(e,t){return r.a.createElement(de.a,se()({},e,{ref:t}))})),Check:Object(o.forwardRef)((function(e,t){return r.a.createElement(be.a,se()({},e,{ref:t}))})),Clear:Object(o.forwardRef)((function(e,t){return r.a.createElement(ke.a,se()({},e,{ref:t}))})),Delete:Object(o.forwardRef)((function(e,t){return r.a.createElement(Pe.a,se()({},e,{ref:t}))})),DetailPanel:Object(o.forwardRef)((function(e,t){return r.a.createElement(L.a,se()({},e,{ref:t}))})),Edit:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ce.a,se()({},e,{ref:t}))})),Export:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ve.a,se()({},e,{ref:t}))})),Filter:Object(o.forwardRef)((function(e,t){return r.a.createElement(Te.a,se()({},e,{ref:t}))})),FirstPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ae.a,se()({},e,{ref:t}))})),LastPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(je.a,se()({},e,{ref:t}))})),NextPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(L.a,se()({},e,{ref:t}))})),PreviousPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(Me.a,se()({},e,{ref:t}))})),ResetSearch:Object(o.forwardRef)((function(e,t){return r.a.createElement(ke.a,se()({},e,{ref:t}))})),Search:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ie.a,se()({},e,{ref:t}))})),SortArrow:Object(o.forwardRef)((function(e,t){return r.a.createElement(pe.a,se()({},e,{ref:t}))})),ThirdStateCheck:Object(o.forwardRef)((function(e,t){return r.a.createElement(Be.a,se()({},e,{ref:t}))})),ViewColumn:Object(o.forwardRef)((function(e,t){return r.a.createElement(Fe.a,se()({},e,{ref:t}))}))},Le=function(e){return r.a.createElement(he.a,{style:e.style,title:e.title,columns:e.columns,data:e.data,icons:qe,actions:e.actions,options:e.options,components:e.components})};Le.propTypes={style:c.a.object,title:c.a.string,columns:c.a.array,data:c.a.array,actions:c.a.array,options:c.a.object,components:c.a.object},Le.defaultProps={style:{},title:"",columns:[],data:[],actions:[],options:{actionsColumnIndex:-1,draggable:!1,grouping:!1,search:!1,toolbar:!1,searchFieldAlignment:"left",paging:!1},components:{}};var Ue=Le,Ge=n(29),Ye=n.n(Ge),We=n(27),Qe=n.n(We),Ze=n(58),He=n.n(Ze),Ke=n(23),Xe=n.n(Ke),Je=n(7),$e=n.n(Je),et=n(8),tt=n.n(et),nt=n(11),ot=n.n(nt),rt=n(9),it=n.n(rt),at=n(3),lt=n.n(at),ct=n(13),ut=n.n(ct),st=n(16),ft=n.n(st),ht=n(59),mt=n.n(ht),dt=n(0),vt=function(e){function t(){var e,n,o;$e()(this,t);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return o=ot()(this,(e=it()(t)).call.apply(e,ft()(n=[this]).call(n,i))),T()(lt()(o),"state",{size:{width:"100px",height:"100px"}}),T()(lt()(o),"addEventListeners",(function(){return o.props.addEventListeners2Canvas(o.canvas)})),T()(lt()(o),"getCanvas",(function(){return o.canvas})),T()(lt()(o),"onResize",(function(e,t){console.log("Canvas on resize",e,t),o.setState({size:{width:e,height:t}})})),T()(lt()(o),"getSize",(function(){return o.state.size})),o}return ut()(t,e),tt()(t,[{key:"componentDidMount",value:function(){this.addEventListeners(),this.engine=new dt.Engine(this.canvas,!0,{stencil:!0});var e=this.props.createScene(this.engine,this.canvas);this.props.is2render&&this.engine.runRenderLoop((function(){e.render()}))}},{key:"render",value:function(){var e=this;return r.a.createElement(_.Typography,{component:"div",style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",flexGrow:1}},r.a.createElement("canvas",{ref:function(t){return e.canvas=t},style:{flexGrow:1},width:this.state.size.width,height:this.state.size.height}),r.a.createElement(mt.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}))}}]),t}(o.Component);vt.propTypes={createScene:c.a.func,is2render:c.a.bool,addEventListeners2Canvas:c.a.func},vt.defaultProps={createScene:function(e,t){},is2render:!0,addEventListeners2Canvas:function(e){}};var pt=vt,yt=n(6),bt=n(15),gt=n.n(bt),Mt=n(28),wt=n.n(Mt),kt=function(){function e(t,n,o){$e()(this,e);for(var r=[t,n,o],i=0;i<r.length;i++)if(r[i].constructor!==Array||r[i].length<3)throw"One of the inputs is not a array";this.mat3=J()(r).call(r,(function(e){return new Pt(e)}))}return tt()(e,[{key:"prodVec",value:function(e){for(var t=new Pt([0,0,0]),n=0;n<this.mat3.length;n++)t=t.add(this.mat3[n].scale(e.vec3[n]));return t}},{key:"dotVec",value:function(e){for(var t=[0,0,0],n=0;n<this.mat3.length;n++)t[n]=this.mat3[n].dot(e);return new Pt(t)}},{key:"prod",value:function(t){var n=this.prodVec(t.mat3[0]),o=this.prodVec(t.mat3[1]),r=this.prodVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"dot",value:function(t){var n=this.dotVec(t.mat3[0]),o=this.dotVec(t.mat3[1]),r=this.dotVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"map",value:function(t){var n,o,r,i=J()(n=this.mat3[0]).call(n,t),a=J()(o=this.mat3[1]).call(o,t),l=J()(r=this.mat3[2]).call(r,t);return new e(i.vec3,a.vec3,l.vec3)}},{key:"equals",value:function(e){var t,n;return e.constructor===this.constructor&&wt()(t=J()(n=this.mat3).call(n,(function(t,n){return t.equals(e.mat3[n])}))).call(t,(function(e,t){return e&&t}),!0)}}],[{key:"ofBabylonMatrix",value:function(t){var n=dt.Matrix.GetAsMatrix3x3(t);return new e([n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]])}},{key:"of",value:function(t,n,o){return new e(t,n,o)}},{key:"eye",value:function(){return new e([1,0,0],[0,1,0],[0,0,1])}}]),e}(),xt=function(){function e(t){var n=this;if($e()(this,e),T()(this,"normalize",(function(){var e=n.length();if(0===e)throw"You can't normalize a zero norm vector";return n.scale(1/e)})),t.constructor!==Array||t.length<3)throw"".concat(t," is not a valid 3-vector");this.vec3=Xe()(t)}return tt()(e,[{key:"getX",value:function(){return this.vec3[0]}},{key:"getY",value:function(){return this.vec3[1]}},{key:"getZ",value:function(){return this.vec3[2]}},{key:"add",value:function(e){return this.binaryOp(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.binaryOp(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.binaryOp(e,(function(e,t){return e*t}))}},{key:"binaryOp",value:function(t,n){var o=[];return o[0]=n(this.vec3[0],t.vec3[0]),o[1]=n(this.vec3[1],t.vec3[1]),o[2]=n(this.vec3[2],t.vec3[2]),new e(o)}},{key:"scale",value:function(e){var t;return J()(t=this).call(t,(function(t){return t*e}))}},{key:"dot",value:function(e){return this.vec3[0]*e.vec3[0]+this.vec3[1]*e.vec3[1]+this.vec3[2]*e.vec3[2]}},{key:"map",value:function(t){var n;return new e(J()(n=this.vec3).call(n,t))}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"toBabylon",value:function(){return new dt.Vector3(this.vec3[0],this.vec3[1],this.vec3[2])}},{key:"toArray",value:function(){return this.vec3}},{key:"equals",value:function(e){var t,n;return e.constructor===this.constructor&&wt()(t=J()(n=e.vec3).call(n,(function(t,n){return e.vec3[n]===t}))).call(t,(function(e,t){return e&&t}),!0)}},{key:"reduce",value:function(e,t){var n;return wt()(n=this.vec3).call(n,e,t)}},{key:"getMax",value:function(){var e;return wt()(e=this).call(e,(function(e,t){return Math.max(e,t)}),-Number.MAX_VALUE)}},{key:"getMin",value:function(){var e;return wt()(e=this).call(e,(function(e,t){return Math.min(e,t)}),Number.MAX_VALUE)}}],[{key:"ofBabylon",value:function(t){return new e([t.x,t.y,t.z])}},{key:"of",value:function(t){return new e(t||[0,0,0])}},{key:"orthogonalBasisFromVector",value:function(e){for(var t=kt.eye(),n=0,o=0;o<3;o++)if(0!=e.vec3[o]){n=o;break}var r=t.mat3[(n+1)%3].add(t.mat3[n].scale(-e.vec3[(n+1)%3]/e.vec3[n]));r=r.normalize();var i=t.mat3[(n+2)%3].add(t.mat3[n].scale(-e.vec3[(n+2)%3]/e.vec3[n]));return i=(i=i.normalize()).sub(r.scale(r.dot(i))),{u:e.normalize(),v:r,w:i.normalize()}}}]),e}();T()(xt,"ONES",xt.of([1,1,1])),T()(xt,"ZERO",xt.of([0,0,0]));var Pt=xt,Nt=n(60),Ct=n.n(Nt),St=n(14),Tt=n.n(St),_t=function(){function e(t){$e()(this,e),this._scene=t,this._isPosition=!1,this._isRotation=!1,this._isBoundingBox=!1,this._isScale=!1,this._usePointerToAttachGizmos=!1}return tt()(e,[{key:"isPosition",value:function(e){return this._isPosition=e,this}},{key:"isRotation",value:function(e){return this._isRotation=e,this}},{key:"isBoundingBox",value:function(e){return this._isBoundingBox=e,this}},{key:"isScale",value:function(e){return this._isScale=e,this}},{key:"usePointerToAttachGizmos",value:function(e){return this._usePointerToAttachGizmos=e,this}},{key:"build",value:function(){var e=new dt.GizmoManager(this._scene);return e.positionGizmoEnabled=this._isPosition,e.rotationGizmoEnabled=this._isRotation,e.boundingBoxGizmoEnabled=this._isBoundingBox,e.scaleGizmoEnabled=this._isScale,e.usePointerToAttachGizmos=this._usePointerToAttachGizmos,e}}]),e}(),At=function(){function e(t){$e()(this,e),this._scene=t,this._sphericalCoordinates=null,this._target=null,this._name="camera".concat(Math.floor(1e3*Math.random()))}return tt()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"sphericalCoordinates",value:function(e){return this._sphericalCoordinates=e,this}},{key:"target",value:function(e){return this._target=e,this}},{key:"build",value:function(){var e=Qe()(this);return b()(e).call(e,(function(e){if(null===e)throw"There are missing variables to build a camera, e.g ".concat(e)})),new dt.ArcRotateCamera(this._name,this._sphericalCoordinates.x,this._sphericalCoordinates.y,this._sphericalCoordinates.z,this._target,this._scene)}}]),e}(),Et=function(){function e(t){$e()(this,e),this._scene=t,this._position=null,this._name="light".concat(Math.floor(1e3*Math.random())),this._intensity=1}return tt()(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){var e=Qe()(this);b()(e).call(e,(function(e){if(null===e)throw"There are missing variables to build a light, e.g ".concat(e)}));var t=new dt.PointLight(this._name,this._position,this._scene);return t.intensity=this._intensity,t}}]),e}(),jt=function(){function e(t){$e()(this,e),this._scene=t,this._name="referential".concat(Math.floor(1e3*Math.random())),this._isPickable=!0,this._boxParams={isVisible:!0,size:.25},this._size=1}return tt()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"boxParams",value:function(e){return this._boxParams=e,this}},{key:"size",value:function(e){return this._size=e,this}},{key:"build",value:function(){var e=this._size,t=dt.Mesh.CreateLines("axisX".concat(this._name),[new dt.Vector3.Zero,new dt.Vector3(e,0,0),new dt.Vector3(.95*e,.05*e,0),new dt.Vector3(e,0,0),new dt.Vector3(.95*e,-.05*e,0)],this._scene);t.color=new dt.Color3(1,0,0),t.isPickable=!1;var n=dt.Mesh.CreateLines("axisY".concat(this._name),[new dt.Vector3.Zero,new dt.Vector3(0,e,0),new dt.Vector3(-.05*e,.95*e,0),new dt.Vector3(0,e,0),new dt.Vector3(.05*e,.95*e,0)],this._scene);n.color=new dt.Color3(0,1,0),n.isPickable=!1;var o=dt.Mesh.CreateLines("axisZ".concat(this._name),[new dt.Vector3.Zero,new dt.Vector3(0,0,e),new dt.Vector3(0,-.05*e,.95*e),new dt.Vector3(0,0,e),new dt.Vector3(0,.05*e,.95*e)],this._scene);o.color=new dt.Color3(0,0,1),o.isPickable=!1;var r=dt.MeshBuilder.CreateBox(this._name,{size:this._boxParams.size},this._scene);return r.isVisible=this._boxParams.isVisible,r.isPickable=this._isPickable,t.parent=r,n.parent=r,o.parent=r,r}}]),e}(),Rt=function(){function e(t){$e()(this,e),this._scene=t,this._name="camera".concat(Math.floor(1e3*Math.random())),this._width=1,this._height=1,this._textureSrc=null,this._isPickable=!1}return tt()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"textureSrc",value:function(e){return this._textureSrc=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"build",value:function(){var e=dt.Mesh.CreateGround(this._name,this._width,this._height,1,this._scene);return e.translate(new dt.Vector3(0,-1,0),.1,dt.Space.WORLD),this._textureSrc&&(e.material=new dt.StandardMaterial("Texture".concat(this._name),this._scene),e.material.ambientTexture=new dt.Texture(this._textureSrc,this._scene),e.material.ambientTexture.uScale=1,e.material.ambientTexture.vScale=1),e.isPickable=this._isPickable,e}}]),e}(),Bt=function(){function e(t){$e()(this,e),this._scene=t,this._direction=null,this._name="Dlight".concat(Math.floor(1e3*Math.random())),this._intensity=1}return tt()(e,[{key:"direction",value:function(e){return this._direction=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){var e=Qe()(this);b()(e).call(e,(function(e){if(null===e)throw"There are missing variables to build a light, e.g ".concat(e)}));var t=new dt.DirectionalLight(this._name,this._direction.normalize(),this._scene);return t.intensity=this._intensity,t}}]),e}(),Dt=n(17),Vt=function(){function e(){var t=this;if($e()(this,e),T()(this,"getAnnotations",(function(){return t.annotations})),zt)return zt;zt=this,this.annotations={},this.retrieveAnnotationsFromDb()}return tt()(e,[{key:"retrieveAnnotationsFromDb",value:function(){var e=this;Dt.MasterDB.subscribe({Scope:"Annotation",Name:"*"},(function(t){var n;console.log("Annotation update",t);var o=t.key.Annotation;b()(n=C()(o)).call(n,(function(t){var n=o[t];if(n.Type){var r=n.Type.toLowerCase(),i=n.Label;r in e.annotations||(e.annotations[r]={names:[],labels:[]}),e.annotations[r].names.push(t),e.annotations[r].labels.push(i||t)}}))}),(function(t){var n,o=t.value.Annotation;b()(n=C()(o)).call(n,(function(t){var n=o[t];if(n.Type){var r=n.Type.toLowerCase(),i=n.Label;r in e.annotations||(e.annotations[r]={names:[],labels:[]}),e.annotations[r].names.push(t),e.annotations[r].labels.push(i)}}))}))}}],[{key:"getInstance",value:function(){return new e}},{key:"getAnnotations",value:function(){return e.getInstance().getAnnotations()}}]),e}(),zt=null,It=Vt;function Ot(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ft(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=Ot(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=Ot(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}var qt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$e()(this,e),T()(this,"getType",(function(){return e.TYPE})),this.name=t.name,this.mesh=t,this.keyValueMap=n,It.getInstance()}return tt()(e,[{key:"dispose",value:function(){this.mesh.dispose()}},{key:"toDict",value:function(){var e,t,n=this;return{name:this.name,type:this.getType(),position:Pt.ofBabylon(this.mesh.position).toArray(),quaternion:J()(e=yt.Maybe.fromNull(this.mesh.rotationQuaternion)).call(e,(function(e){return[e.w,e.x,e.y,e.z]})).orLazy((function(){var e=dt.Quaternion.RotationYawPitchRoll(n.mesh.rotation.y,n.mesh.rotation.x,n.mesh.rotation.z);return[e.w,e.x,e.y,e.z]})),color:Tt()(t=yt.Maybe.fromNull(this.mesh.material)).call(t,(function(e){var t;return J()(t=yt.Maybe.fromNull(e.diffuseColor)).call(t,(function(e){return[e.r,e.g,e.b]}))})).orSome([0,0,0]),keyValueMap:this.keyValueMap}}},{key:"toForm",value:function(){var e,t=this.toDict(),n=new dt.Color3(t.color[0],t.color[1],t.color[2]),o={jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},position:{type:"object",title:"Position",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},quaternion:{type:"object",title:"Orientation",properties:{w:{type:"number",title:"w"},x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},color:{type:"string",title:"Color"},annotations:{title:"Annotations",type:"object",properties:{}}}},uiSchema:{type:{"ui:disabled":!0},color:{"ui:widget":"color"},oldName:{"ui:widget":"hidden"}},data:{oldName:t.name,name:t.name,type:t.type,position:{x:t.position[0],y:t.position[1],z:t.position[2]},quaternion:{w:t.quaternion[0],x:t.quaternion[1],y:t.quaternion[2],z:t.quaternion[3]},color:n.toHexString(),annotations:Ft({},t.keyValueMap)}},r=It.getAnnotations();return b()(e=C()(r)).call(e,(function(e){r[e].labels.length>0&&(o.jsonSchema.properties.annotations.properties[e]={title:Dt.Utils.capitalize(e),type:"string",enumNames:r[e].labels,enum:r[e].names})})),o}},{key:"ofForm",value:function(t){var n=new e(this.mesh);return n.name=t.name,n.mesh.name=t.name,n.mesh.position=new dt.Vector3(t.position.x,t.position.y,t.position.z),n.mesh.rotationQuaternion=new dt.Quaternion(t.quaternion.x,t.quaternion.y,t.quaternion.z,t.quaternion.w).normalize(),n.mesh.material&&(n.mesh.material.diffuseColor=dt.Color3.FromHexString(t.color),n.mesh.material.emissiveColor=dt.Color3.FromHexString(t.color)),n.keyValueMap=Ft({},t.annotations),n.getType=this.getType,n}}],[{key:"mapDict2Mesh",value:function(e,t){var n;if(!t)throw"can't map a null mesh";return b()(n=yt.Maybe.fromNull(e)).call(n,(function(n){var o,r,i,a;b()(o=yt.Maybe.fromNull(e.name)).call(o,(function(e){return t.name=e})),b()(r=yt.Maybe.fromNull(n.position)).call(r,(function(e){return t.position=Pt.of(e).toBabylon()})),b()(i=yt.Maybe.fromNull(n.quaternion)).call(i,(function(e){var n=new dt.Quaternion(e[1],e[2],e[3],e[0]);t.rotationQuaternion=n.normalize()})),b()(a=yt.Maybe.fromNull(n.color)).call(a,(function(e){var n,o=new dt.Color3(e[0],e[1],e[2]);b()(n=yt.Maybe.fromNull(t.material)).call(n,(function(e){var n,r;b()(n=yt.Maybe.fromNull(e.diffuseColor)).call(n,(function(e){return t.material.diffuseColor=o})),b()(r=yt.Maybe.fromNull(e.emissiveColor)).call(r,(function(e){return t.material.emissiveColor=o}))}))}))})),t}}]),e}();T()(qt,"TYPE","NodeItem");var Lt=qt,Ut=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.DEFAULT_SIZE,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return $e()(this,t),n=ot()(this,it()(t).call(this,e,r)),T()(lt()(n),"getType",(function(){return t.TYPE})),n.size=o,n}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.size=this.size,e}}],[{key:"ofDict",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],yt.Maybe.fromNull(n)),r=Tt()(o).call(o,(function(e){return yt.Maybe.fromNull(e.size)})).orSome(t.DEFAULT_SIZE),i=Tt()(o).call(o,(function(e){return yt.Maybe.fromNull(e.name)})).orSome("Box".concat(Math.floor(1e3*Math.random()))),a=Tt()(o).call(o,(function(e){return yt.Maybe.fromNull(e.keyValueMap)})).orUndefined(),l=Zt.createBox(e,new dt.Color3(Math.random(),Math.random(),Math.random()),r,i);return Lt.mapDict2Mesh(n,l),new t(l,r,a)}}]),t}(Lt);T()(Ut,"DEFAULT_SIZE",.5),T()(Ut,"TYPE","Box");var Gt=Ut,Yt=n(61),Wt=function(){return Math.floor(1e3*Math.random())},Qt=function(){function e(){$e()(this,e)}return tt()(e,null,[{key:"computeLocalCoordinateFromMesh",value:function(t,n){if(!t.parent)return n;var o=t.parent,r=Pt.ofBabylon(o.position),i=e.getRotationMatrix(o),a=Pt.ofBabylon(o.scaling);return J()(a).call(a,(function(e){return 1/e})).mul(i.dotVec(e.computeLocalCoordinateFromMesh(o,n).sub(r)))}},{key:"getRotationMatrix",value:function(e){var t=new dt.Matrix,n=yt.Maybe.fromNull(e.rotationQuaternion);return b()(n).call(n,(function(e){return e.toRotationMatrix(t)})),n.orElseRun((function(){dt.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z).toRotationMatrix(t)})),kt.ofBabylonMatrix(t)}},{key:"showNormals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dt.Color3.Red(),r=t.getVerticesData(dt.VertexBuffer.NormalKind),i=t.getVerticesData(dt.VertexBuffer.PositionKind),a=[],l=0;l<r.length;l+=3){var c=dt.Vector3.FromArray(i,l),u=c.add(dt.Vector3.FromArray(r,l).scaleInPlace(n));a.push([c.add(t.position),u.add(t.position)])}var s=dt.MeshBuilder.CreateLineSystem("normalLines",{lines:a},e);return s.color=o,s.parent=t,s}},{key:"orthogonalBasisFromVector",value:function(e){for(var t=[new dt.Vector3(1,0,0),new dt.Vector3(0,1,0),new dt.Vector3(0,0,1)],n=[e.x,e.y,e.z],o=0,r=0;r<3;r++)if(0!=n[r]){o=r;break}var i=t[(o+1)%3].add(t[o].scale(-n[(o+1)%3]/n[o]));i=i.normalize();var a=t[(o+2)%3].add(t[o].scale(-n[(o+2)%3]/n[o]));return a=(a=a.normalize()).subtract(i.scale(dt.Vector3.Dot(i,a))),{u:dt.Vector3.FromArray(n).normalize(),v:i,w:a.normalize()}}},{key:"cameraBuilder",value:function(e){return new At(e)}},{key:"guizoManagerBuilder",value:function(e){return new _t(e)}},{key:"meshFromPositionAndFaces",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=new dt.VertexData;i.positions=Tt()(n).call(n,(function(e){return[e.x,e.y,e.z]})),i.indices=Tt()(o).call(o,(function(e){return e}));var a=new dt.Mesh(e,t);return i.applyToMesh(a,r),a}},{key:"triangulatePolygon",value:function(e){for(var t,n=Yt(Tt()(t=J()(e).call(e,(function(e){return[e.x,e.y,e.z]}))).call(t,(function(e){return e})),null,3),o=n.length/3,r=[],i=0;i<o;i++){var a=3*i;r.push([n[a],n[a+1],n[a+2]])}return r}},{key:"computeOrientation",value:function(e){var t=e.length,n=J()(e).call(e,(function(e){return Pt.ofBabylon(e)})),o=0;return b()(n).call(n,(function(e,r){var i=n[(r+1)%t].sub(n[r]);o+=Pt.of([-e.getY(),e.getX(),e.getZ()]).dot(i)})),o/2}},{key:"pointAverage",value:function(e){return e&&0!=e.length?wt()(e).call(e,(function(e,t){return e.add(t)}),dt.Vector3.Zero()).scale(1/e.length):dt.Vector3.Zero()}},{key:"pointAverageVec3",value:function(e){return e&&0!=e.length?wt()(e).call(e,(function(e,t){return e.add(t)}),Pt.ZERO).scale(1/e.length):Pt.ZERO}},{key:"randomVector3",value:function(e,t){var n;return new dt.Vector3.FromArray(J()(n=[0,0,0]).call(n,(function(n){return e+(t-e)*Math.random()})))}}]),e}();T()(Qt,"createOrientedCone",(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new dt.Vector3(1,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object(dt.Color3)(.5,.5,.5),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OrientedCone".concat(Wt()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,a={positions:[],faces:[]},l=t.length()/3,c=Qt.orthogonalBasisFromVector(t),u=c.v,s=c.w,f=Ct()(dt.Vector3.Dot(dt.Vector3.Cross(u,s),t)),h=0;h<i;h++){var m=f*(2*Math.PI/i)*h;a.positions.push(u.scale(l*Math.cos(m)).add(s.scale(l*Math.sin(m))))}a.positions.push(dt.Vector3.Zero()),a.positions.push(t);for(var d=a.positions.length-1,v=a.positions.length-2,p=0;p<i;p++)a.faces.push([d,(p+1)%i,p]),a.faces.push([v,p,(p+1)%i]);var y=Qt.meshFromPositionAndFaces(o,e,a.positions,a.faces);y.convertToFlatShadedMesh();var b=new dt.StandardMaterial("OrientedConeMaterial".concat(o),e);return b.diffuseColor=n,b.emissiveColor=n,y.material=b,y.isPickable=r,y})),T()(Qt,"createSphere",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(dt.Color3)(.5,.5,.5),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sphere".concat(Wt()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=dt.Mesh.CreateSphere(o,16,n,e),a=new dt.StandardMaterial("SphereMaterial".concat(o),e);return a.diffuseColor=t,a.emissiveColor=t,i.material=a,i.isPickable=r,i})),T()(Qt,"createBox",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object(dt.Color3)(.5,.5,.5),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Gt.DEFAULT_SIZE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Box".concat(Wt()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=dt.Mesh.CreateBox(o,n,e),a=new dt.StandardMaterial("BoxMaterial".concat(o),e);return a.diffuseColor=t,a.emissiveColor=t,i.material=a,i.isPickable=r,i})),T()(Qt,"positionalLightBuilder",(function(e){return new Et(e)})),T()(Qt,"directionalLightBuilder",(function(e){return new Bt(e)})),T()(Qt,"referentialBuilder",(function(e){return new jt(e)})),T()(Qt,"getGroundPosition",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e===t}));return n.hit?Ye()(yt.Maybe).call(yt.Maybe,n.pickedPoint):yt.Maybe.none()})),T()(Qt,"pickMesh",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e!==t&&e.isEnabled()}));return n.hit&&n.pickedMesh.isPickable?Ye()(yt.Maybe).call(yt.Maybe,n.pickedMesh):yt.Maybe.none()})),T()(Qt,"groundBuilder",(function(e){return new Rt(e)}));var Zt=Qt,Ht=function(e){function t(e,n){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return $e()(this,t),(o=ot()(this,it()(t).call(this,e,r))).assetName=n,o}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.assetName=this.assetName,e}}]),t}(Lt),Kt=function(e){function t(e,n){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return $e()(this,t),o=ot()(this,it()(t).call(this,e.mesh,n,r)),T()(lt()(o),"updateRobot",(function(e,t,n){var r=(new Date).getTime();n(e,.001*(r-t)),o.requestAnimationFrameId=requestAnimationFrame((function(){return o.updateRobot(e,r,n)}))})),T()(lt()(o),"animate",(function(e){o.requestAnimationFrameId=requestAnimationFrame((function(){return o.updateRobot(lt()(o),(new Date).getTime(),e)}))})),T()(lt()(o),"getType",(function(){return t.TYPE})),o.requestAnimationFrameId=null,o.meshTree=e,o}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){return gt()(it()(t.prototype),"toDict",this).call(this)}},{key:"toForm",value:function(){var e=gt()(it()(t.prototype),"toForm",this).call(this);return e.jsonSchema.properties={oldName:e.jsonSchema.properties.oldName,name:e.jsonSchema.properties.name,type:e.jsonSchema.properties.type,assetName:{type:"string",title:"Asset Name"},position:e.jsonSchema.properties.position,quaternion:e.jsonSchema.properties.quaternion,color:e.jsonSchema.properties.color,annotations:e.jsonSchema.properties.annotations},e.uiSchema.assetName={"ui:disabled":!0},e.data.assetName=this.assetName,e}},{key:"dispose",value:function(){gt()(it()(t.prototype),"dispose",this).call(this),Dt.MasterDB.unsubscribe({Scope:"Robot",Name:this.meshTree.id,Parameter:"tf"}),window.cancelAnimationFrame(this.requestAnimationFrameId)}}],[{key:"updateRobotMeshTree",value:function(e,t){t.mesh.position=new dt.Vector3(e.position.x,e.position.y,e.position.z);var n=new dt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w);t.mesh.rotationQuaternion=n.normalize()}},{key:"transformMesh",value:function(e,t){var n=Math.PI,o=e.getBoundingInfo().boundingSphere,r=Zt.createSphere(t,new dt.Color3(0,0,0),.25*o.radius,"pivotSphere".concat(e.name),!1);e.position.set(-o.center.x,-o.center.y,-o.center.z);var i=Zt.createSphere(t,new dt.Color3(0,0,0),.5*o.radius,"tfsphere".concat(e.name),!1);i.visibility=.25,i.scaling=Pt.ONES.scale(1/o.radius).toBabylon(),i.addRotation(0,0,n),i.position.set(0,0,.25);var a=Zt.createSphere(t,new dt.Color3(0,0,0),1.9,e.name,!0);return a.visibility=.1,e.parent=r,r.parent=i,i.parent=a,a}},{key:"createRobotMeshTreeRecursive",value:function(e,t,n,o){var r,i=this;t||(t=Zt.createSphere(o,new dt.Color3(0,0,0),.5,e.name,!1));var a={mesh:t,children:[]},l=new dt.Vector3(e.position.x,e.position.y,e.position.z),c=new dt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w);return t.position=l,t.rotationQuaternion=c,n&&(t.parent=n),a.children=J()(r=e.child).call(r,(function(e){i.createRobotMeshTreeRecursive(e,Zt.referentialBuilder(o).boxParams({isVisible:!1,size:.1}).build(),t,o)})),a}},{key:"createRobotMeshTree",value:function(e,n,o){return t.createRobotMeshTreeRecursive(e,n,null,o)}},{key:"builder",value:function(){return new Xt}}]),t}(Ht);T()(Kt,"ROBOT_MESH_NAME","Tugbot.stl"),T()(Kt,"TYPE","Robot"),T()(Kt,"getDefaultAnimator",(function(e){return function(t,n){var o=t.mesh,r=Zt.getRotationMatrix(o).prodVec(new Pt([3,0,0])).toBabylon();o.position=o.position.add(r.scale(n)),o.rotate(dt.Axis.Z,-Math.PI/2*n,dt.Space.LOCAL),Math.random()<.01&&e.updateNodeInServer(o.name)}})),T()(Kt,"getSocketAnimator",(function(e,t){return Dt.MasterDB.subscribe({Scope:"Robot",Name:e.meshTree.id,Parameter:"tf"},(function(n){var o=n.key.Robot[e.meshTree.id].Parameter.tf.Value;o&&(console.log("ROBOT TF UPDATE...",o),Kt.updateRobotMeshTree(o,e),console.log("Updating robot ",e),Math.random()<.01&&t.updateNodeInServer(e.name))}),(function(n){console.log("ROBOT INIT SUB...",n.value);var o=n.value.Robot[e.meshTree.id].Parameter.tf.Value;Kt.updateRobotMeshTree(o,e),console.log("Updating robot ",e),t.updateNodeInServer(e.name)})),function(e,t){}}));var Xt=function(){function e(){$e()(this,e),this._name=null,this._meshTree=null,this._parentMesh=null,this._scene=null,this._isPickable=!0,this._id=null,this._keyValueMap={},this._assetName=null}return tt()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"meshTree",value:function(e){return this._meshTree=e,this}},{key:"parentMesh",value:function(e){return this._parentMesh=e,this}},{key:"scene",value:function(e){return this._scene=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"id",value:function(e){return this._id=e,this}},{key:"keyValueMap",value:function(e){return this._keyValueMap=e,this}},{key:"assetName",value:function(e){return this._assetName=e,this}},{key:"build",value:function(){var e,t,n=this,o=J()(e=k()(t=C()(this)).call(t,(function(e){return"_parentMesh"!==e}))).call(e,(function(e){return n[e]}));return b()(o).call(o,(function(e){if(null===e)throw"There are missing variables to build a robot, e.g ".concat(e)})),this._meshTree.id=this._id,this._meshTree.name=this._name,this._meshTree.mesh.name=this._name,this._meshTree.mesh.isPickable=this._isPickable,this._meshTree.mesh.parent=this._parentMesh,Zt.referentialBuilder(this._scene).isPickable(!1).boxParams({isVisible:!1,size:.1}).name("".concat(this._name,"Axis")).build().parent=this._meshTree.mesh,new Kt(this._meshTree,this._assetName,this._keyValueMap)}}]),e}(),Jt=Kt,$t=null,en=function(){function e(){if($e()(this,e),$t)return $t;$t=this,this.meshCacheBySceneId={},this.count=0}return tt()(e,[{key:"hasKey",value:function(e,t){var n,o=t._uid;return Tt()(n=yt.Maybe.fromNull(this.meshCacheBySceneId[o])).call(n,(function(t){return tn(t[e])})).orSome(!1)}},{key:"put",value:function(e,t,n){var o=t._uid;return o in this.meshCacheBySceneId||(this.meshCacheBySceneId[o]={}),this.meshCacheBySceneId[o][e]=n,n.setEnabled(!1),this}},{key:"get",value:function(e,t){var n,o,r=this,i=t._uid;return J()(n=Tt()(o=yt.Maybe.fromNull(this.meshCacheBySceneId[i])).call(o,(function(t){return tn(t[e])}))).call(n,(function(t){var n;console.log("#Mesh: Found Mesh in cache, retrieving copy number",r.count);var o=t.clone(ft()(n="".concat(e)).call(n,r.count++));return console.log("#Mesh:",o),o})).orNull()}}],[{key:"getInstance",value:function(){return new e}}]),e}(),tn=function(e){return yt.Maybe.fromNull(e)},nn=en,on=n(62),rn=n.n(on),an=-Math.PI/2,ln={position:[0,0,0],scaling:[1,-1,1],quaternion:[Math.cos(an/2),Math.sin(an/2),0,0]},cn=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $e()(this,t),n=ot()(this,it()(t).call(this,e,o)),T()(lt()(n),"getType",(function(){return t.TYPE})),n}return ut()(t,e),tt()(t,[{key:"toForm",value:function(){var e=gt()(it()(t.prototype),"toForm",this).call(this);return e.uiSchema.name={"ui:disabled":!0},e}}],[{key:"ofDict",value:function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],t.getRosOrigin(e)),i=Zt.referentialBuilder(e).name(t.NAME).isPickable(!0).boxParams({isVisible:!0,size:.25}).build();return i.parent=r,Lt.mapDict2Mesh(o,i),new t(i,Tt()(n=yt.Maybe.fromNull(o)).call(n,(function(e){return yt.Maybe.fromNull(e.keyValueMap)})).orUndefined())}},{key:"getRosOrigin",value:function(e){var t=dt.MeshBuilder.CreateBox("ROS_ORIGIN",{size:.001},e);t.isVisible=!1,t.isPickable=!1,t.position=Pt.of(ln.position).toBabylon(),t.scaling=Pt.of(ln.scaling).toBabylon();var n=new dt.Quaternion(ln.quaternion[1],ln.quaternion[2],ln.quaternion[3],ln.quaternion[0]);return t.rotationQuaternion=n.normalize(),t}},{key:"inverseCoord",value:function(e){var t,n=ln.quaternion,o=Zt.getRotationMatrix({rotationQuaternion:new dt.Quaternion(n[1],n[2],n[3],n[0])}),r=J()(t=Pt.of(ln.scaling)).call(t,(function(e){return 1/e})),i=Pt.of(ln.position),a=r.mul(o.dotVec(Pt.ofBabylon(e).sub(i)));return J()(a).call(a,(function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}}]),t}(Lt);T()(cn,"TYPE","GlobalRef"),T()(cn,"NAME","Global ref");var un=cn,sn={name:"Triangular Antiprism (Octahedron)",category:["Antiprism"],vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},fn=function(e){function t(e,n){var o;return $e()(this,t),o=ot()(this,it()(t).call(this,e,n)),T()(lt()(o),"getType",(function(){return t.TYPE})),o}return ut()(t,e),tt()(t,null,[{key:"ofDict",value:function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],J()(n=yt.Maybe.fromNull(o)).call(n,(function(e){return e.name})).orSome("KeyPoint".concat(Math.floor(1e3*Math.random())))),i=dt.MeshBuilder.CreatePolyhedron(r,{custom:sn,size:t.DEFAULT_SIZE},e),a=new dt.StandardMaterial("KeyPointMaterial".concat(r),e);i.material=a,i.convertToFlatShadedMesh();var l=Zt.referentialBuilder(e).isPickable(!1).boxParams({isVisible:!1,size:.1*t.DEFAULT_SIZE}).name("".concat(r,"Axis")).build();return l.parent=i,Lt.mapDict2Mesh(o,i),new t(i,o.keyValueMap)}}]),t}(Lt);T()(fn,"TYPE","KeyPoint"),T()(fn,"DEFAULT_SIZE",.25);var hn=fn,mn=n(63),dn=n.n(mn),vn=n(30),pn=n.n(vn),yn={RADIUS:.25,CLOUD_FUNCTION_NAME:"backend.viewer"};function bn(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=bn(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=bn(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}var Mn=yn.RADIUS,wn=function(e){var t=function(e){for(var t=0,n=0;n<e.length-1;n++){t+=e[n+1].subtract(e[n]).length()}return t}(e),n=Math.ceil(2*t);return{points:dt.Curve3.CreateCatmullRomSpline(e,n,!1).getPoints()}},kn=function(e){var t,n=function(e){for(var t=[],n=0;n<e.length-1;n++){var o=e[n+1].subtract(e[n]);t.push(Math.atan2(o.y,o.x))}return t.push(t[t.length-1]),t}(e.points);return J()(t=e.points).call(t,(function(e,t){return[e.x,e.y,n[t]]}))};function xn(e,t,n,o){var r,i,a=Xe()(n._children),l=J()(r=o.splinePath).call(r,(function(e){return new dt.Vector3(e[0],e[1],0)}));return b()(a).call(a,(function(e){e.parent=o.mesh})),J()(i=o.keyPoints).call(i,(function(r,i){var a,c;(r.observers=new dt.Observable,r.observers.add(Nn(e,t)),r.index=i,r.name=ft()(a="".concat(n.name,"keyPointSpline")).call(a,i),r.position=Pt.of(o.localPath[i]).toBabylon(),r.rotationQuaternion=dt.Quaternion.Identity(),i>0&&i<o.keyPoints.length-1)&&(b()(c=r._children).call(c,(function(e){return e.dispose()})),jn(e,r.material.diffuseColor,o.mesh,i,l,r.position)().parent=r);return r}))}function Pn(e,t,n,o,r){var i,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:xn,l=Zt.pointAverage(e);console.log(ft()(i="Old average ".concat(n.position,", average ")).call(i,l)),e=J()(e).call(e,(function(e){return e.subtract(l)}));var c=wn(e),u=dt.MeshBuilder.CreateLines(n.name,{points:c.points,updatable:!0},t);return u.position=n.position,u.rotationQuaternion=n.rotationQuaternion,u.locallyTranslate(l),u.material=n.material,u.visibility=n.visibility,u.parent=n.parent,o.localPath=J()(e).call(e,(function(e){return Pt.ofBabylon(e).toArray()})),o.splinePath=kn(c),o.mesh=u,o.keyPoints=a(t,r,n,o),n.dispose(),e}var Nn=function(e,t){return function(n){var o,r=n.updatedPointMesh,i=n.is2updateServer;b()(o=t.getNodeFromTree(r.parent.name)).call(o,(function(n){var o,a=r.index,l=n.item,c=l.mesh,u=J()(o=l.localPath).call(o,(function(e){return Pt.of(e).toBabylon()}));u[a]=r.position,Pn(u,e,c,l,t),i&&t.updateNodeInServer(c.name)}))}};function Cn(e,t,n,o){return _n(e,o,t)}var Sn=function(e,t,n,o){var r,i=t.index,a=t.parent.name;b()(r=n.getNodeFromTree(a)).call(r,(function(t){var r,l,c=i+o,u=t.item,s=u.localPath.length,f=u.mesh,h=[],m=J()(r=u.localPath).call(r,(function(e){return Pt.of(e).toBabylon()}));if(c<0)h=ft()(l=[m[0].scale(3).subtract(m[1]).scale(.5)]).call(l,m);else if(c>s-1)h=ft()(m).call(m,[m[s-1].scale(3).subtract(m[s-2]).scale(.5)]);else{for(var d=i+Math.max(0,o),v=0;v<d;v++)h.push(m[v]);h.push(m[c].add(m[i]).scale(.5));for(var p=d;p<s;p++)h.push(m[p])}Pn(h,e,f,u,n,Cn),n.updateNodeInServer(a)}))},Tn=function(e,t,n){var o,i=[];return b()(o=n.getNodeFromTree(t.parent.name)).call(o,(function(n){2!==n.item.localPath.length&&i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-times"},e))},action:function(n){!function(e,t,n){var o,r=t.index,i=t.parent.name;b()(o=n.getNodeFromTree(i)).call(o,(function(t){var o,a,l=t.item,c=l.mesh,u=J()(o=l.localPath).call(o,(function(e){return Pt.of(e).toBabylon()}));pn()(u).call(u,r,1),pn()(a=l.keyPoints).call(a,r,1)[0].dispose(),Pn(u,e,c,l,n,Cn),n.updateNodeInServer(i)}))}(e,t,n),n.closeContextDial()},name:"Delete node"}),i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-greater-than"},e))},action:function(n){Sn(e,t,n,1),n.closeContextDial()},name:"Add next"}),i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-less-than"},e))},action:function(n){Sn(e,t,n,-1),n.closeContextDial()},name:"Add previous"})})),i},_n=function(e,t,n){var o,r,i=new dt.Color3(.25,.25,.25),a=[],l=J()(o=t.localPath).call(o,(function(e){return Pt.of(e).toBabylon()})),c=J()(r=t.splinePath).call(r,(function(e){return new dt.Vector3(e[0],e[1],0)})),u=t.mesh;return b()(l).call(l,(function(t,o){var r,s,f=Rn(e,i,u,o),h=0==o||o==l.length-1?f():(r=jn(e,i,u,o,c,t)(),(s=Rn(e,i,u,o)()).visibility=.1,r.parent=s,s);h.parent=u,h.position=t,h.index=o,h.observers=new dt.Observable,a.push(h),h.observers.add(Nn(e,n))})),b()(a).call(a,(function(t){t.onClick=function(){n.setContextActions(Tn(e,t,n))}})),a},An=function(e){function t(e,n,o,r){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return $e()(this,t),i=ot()(this,it()(t).call(this,e,a)),T()(lt()(i),"getType",(function(){return t.TYPE})),i.localPath=n,i.keyPoints=o,i.splinePath=r,i}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.localPath=this.localPath,e.splinePath=this.splinePath,e}}],[{key:"ofDict",value:function(e){var n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r||!i)throw"null dictionary describing path or null mainView";var a=r.name,l=J()(n=r.localPath).call(n,(function(e){return Pt.of(e).toBabylon()})),c=Pt.of(r.position).toBabylon(),u=wn(l),s=dt.MeshBuilder.CreateLines(a,{points:u.points,updatable:!0},e);s.position=c;var f=new dt.StandardMaterial("PathMaterial".concat(a),e),h=new dt.Color3(r.color[0],r.color[1],r.color[2]);f.diffuseColor=h,f.emissiveColor=h,s.material=f,b()(o=yt.Maybe.fromNull(r.quaternion)).call(o,(function(e){var t=new dt.Quaternion(e[1],e[2],e[3],e[0]);s.rotationQuaternion=t.normalize()}));var m=kn(u),d=_n(e,gn({},r,{mesh:s,splinePath:m}),i);return new t(s,J()(l).call(l,(function(e){return[e.x,e.y,e.z]})),d,m,r.keyValueMap)}}]),t}(Lt);T()(An,"TYPE","Path");var En=An;function jn(e,t,n,o,r,i){return function(){var a,l,c=dn()(a=J()(r).call(r,(function(e){return i.subtract(e).length()}))).call(a,(function(e){return e<1e-5})),u=r[c+1].subtract(r[c]).normalize().scale(Mn);return Zt.createOrientedCone(e,u,t,ft()(l="".concat(n.name,"keyPointCone")).call(l,o),!1)}}function Rn(e,t,n,o){return function(){var r;return Zt.createSphere(e,t,Mn,ft()(r="".concat(n.name,"keyPointSpline")).call(r,o),!0)}}var Bn=yn.RADIUS,Dn=[[0,1,2],[2,3,0],[4,6,5],[6,4,7],[0,5,1],[5,0,4],[3,2,6],[6,7,3],[1,6,2],[6,1,5],[0,3,7],[7,4,0]];function Vn(e,t,n){var o,r=J()(o=e.localWall).call(o,(function(e){return Pt.of(e).toBabylon()})),i=Pt.of(e.position).toBabylon(),a=r[1].subtract(r[0]).normalize(),l=new dt.Vector3(-a.y,a.x,0),c=[r[0].add(l.scale(e.size.width)),r[0].subtract(l.scale(e.size.width)),r[1].subtract(l.scale(e.size.width)),r[1].add(l.scale(e.size.width))],u=new dt.Vector3(0,0,e.size.height),s={positions:[c[0],c[1],c[2],c[3],c[0].add(u),c[1].add(u),c[2].add(u),c[3].add(u)],faces:Dn},f=Zt.meshFromPositionAndFaces(t,n,s.positions,s.faces);return f.position=i,f}var zn=function(e,t){return function(n){var o,r=n.updatedPointMesh,i=n.is2updateServer;b()(o=e.getNodeFromTree(r.parent.name)).call(o,(function(n){var o=r.index,a=n.item,l=a.mesh,c={position:Pt.ofBabylon(l.position).toArray(),localWall:a.localWall,size:a.size};c.localWall[o]=Pt.ofBabylon(r.position).toArray(),function(e,t,n,o){var r,i,a,l=Zt.pointAverageVec3(J()(r=e.localWall).call(r,(function(e){return Pt.of(e)})));e.position=l.toArray(),e.localWall=J()(i=e.localWall).call(i,(function(e){return Pt.of(e).sub(l).toArray()}));var c=Vn(e,n.name,t);c.position=n.position,c.rotationQuaternion=n.rotationQuaternion,c.locallyTranslate(l.toBabylon()),c.material=n.material,c.visibility=n.visibility,c.parent=n.parent,o.mesh=c,o.localWall=e.localWall;var u=Xe()(n._children);b()(u).call(u,(function(e){n.removeChild(e),e.parent=c})),b()(a=o.keyPoints).call(a,(function(t,n){t.position=Pt.of(e.localWall[n]).toBabylon()})),n.dispose()}(c,t,l,a),i&&e.updateNodeInServer(l.name)}))}},In=function(e,t,n,o){var r=[];return b()(t).call(t,(function(t,i){var a,l=Zt.createSphere(e,new dt.Color3(.25,.25,.25),Bn,ft()(a="".concat(n.name,"keyPointWall")).call(a,i),!0);l.parent=n,l.position=t,l.index=i,l.observers=new dt.Observable,l.observers.add(zn(o,e)),r.push(l)})),r},On=function(e){function t(e,n,o){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return $e()(this,t),r=ot()(this,it()(t).call(this,e,a)),T()(lt()(r),"getType",(function(){return t.TYPE})),r.localWall=n,r.size=o,r.keyPoints=i,r}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.localWall=this.localWall,e.size=this.size,e}}],[{key:"ofDict",value:function(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!o)throw"null dictionary describing wall";var i=yt.Maybe.fromNull(o.name).orSome("Wall".concat(Math.floor(1e3*Math.random()))),a=Vn(o,i,e),l=new dt.StandardMaterial("WallMaterial".concat(i),e),c=new dt.Color3(o.color[0],o.color[1],o.color[2]);l.diffuseColor=c,l.emissiveColor=c,a.material=l,a.position.z+=.001;var u=In(e,J()(n=o.localWall).call(n,(function(e){return Pt.of(e).toBabylon()})),a,r);return new t(a,o.localWall,o.size,u,o.keyValueMap)}}]),t}(Lt);T()(On,"TYPE","Wall");var Fn=On,qn=yn.RADIUS,Ln=[[0,1,2],[2,3,0],[4,5,6],[6,7,4],[0,1,5],[5,4,0],[3,2,6],[6,7,3],[1,2,6],[6,5,1],[0,3,7],[7,4,0]];function Un(e,t,n){var o,r=J()(o=e.corners).call(o,(function(e){return Pt.of(e).toBabylon()})),i=r[1].subtract(r[0]),a=Pt.of(e.position).toBabylon(),l=[r[0],r[0].add(dt.Axis.X.scale(i.x)),r[0].add(new dt.Vector3(i.x,i.y,0)),r[0].add(dt.Axis.Y.scale(i.y))],c=new dt.Vector3(0,0,i.z),u={positions:[l[0],l[1],l[2],l[3],l[0].add(c),l[1].add(c),l[2].add(c),l[3].add(c)],faces:Ln},s=Zt.meshFromPositionAndFaces(t,n,u.positions,u.faces);return s.position=a,s}var Gn=function(e,t){return function(n){var o,r=n.updatedPointMesh,i=n.is2updateServer;b()(o=e.getNodeFromTree(r.parent.name)).call(o,(function(n){var o=r.index,a=n.item,l=a.mesh,c=l.name,u={position:Pt.ofBabylon(l.position).toArray(),corners:a.corners};u.corners[o]=Pt.ofBabylon(r.position).toArray(),function(e,t,n,o){var r,i,a,l=Zt.pointAverageVec3(J()(r=e.corners).call(r,(function(e){return Pt.of(e)})));e.position=l.toArray(),e.corners=J()(i=e.corners).call(i,(function(e){return Pt.of(e).sub(l).toArray()}));var c=Un(e,n.name,t);c.position=n.position,c.rotationQuaternion=n.rotationQuaternion,c.locallyTranslate(l.toBabylon()),c.material=n.material,c.visibility=n.visibility,c.parent=n.parent,o.mesh=c,o.corners=e.corners;var u=Xe()(n._children);b()(u).call(u,(function(e){n.removeChild(e),e.parent=c})),b()(a=o.keyPoints).call(a,(function(t,n){t.position=Pt.of(e.corners[n]).toBabylon()})),n.dispose()}(u,t,l,a),i&&e.updateNodeInServer(c)}))}},Yn=function(e,t,n,o){var r=[];return b()(t).call(t,(function(t,i){var a,l=t,c=Zt.createSphere(e,new dt.Color3(.25,.25,.25),qn,ft()(a="".concat(n.name,"keyPoint")).call(a,i),!0);c.parent=n,c.position=l,c.index=i,c.observers=new dt.Observable,c.observers.add(Gn(o,e)),r.push(c)})),r},Wn=function(e){function t(e,n,o){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return $e()(this,t),r=ot()(this,it()(t).call(this,e,i)),T()(lt()(r),"getType",(function(){return t.TYPE})),r.corners=n,r.keyPoints=o,r}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.corners=this.corners,e}}],[{key:"ofDict",value:function(e){var n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r)throw"null dictionary describing Box region";var a=yt.Maybe.fromNull(r.name).orSome("BoxRegion".concat(Math.floor(1e3*Math.random()))),l=Un(r,a,e),c=new dt.StandardMaterial("BoxRegionMaterial".concat(a),e),u=new dt.Color3(r.color[0],r.color[1],r.color[2]);c.diffuseColor=u,c.emissiveColor=u,c.backFaceCulling=!1,l.material=c,l.visibility=.25,b()(n=yt.Maybe.fromNull(r.quaternion)).call(n,(function(e){var t=new dt.Quaternion(e[1],e[2],e[3],e[0]);l.rotationQuaternion=t.normalize()}));var s=Yn(e,J()(o=r.corners).call(o,(function(e){return Pt.of(e).toBabylon()})),l,i);return new t(l,r.corners,s,r.keyValueMap)}}]),t}(Lt);T()(Wn,"TYPE","BoxRegion");var Qn=Wn,Zn=n(64),Hn=n.n(Zn),Kn=yn.RADIUS,Xn=function(e){var t=[];return t.push(e[1]),t.push(e[0]),t.push(e[2]),t},Jn=function(e,t,n,o){var r,i,a,l,c=new dt.Vector3(0,0,n),u={positions:[],faces:[]};u.positions=Xe()(t);for(var s=0;s<t.length;s++)u.positions.push(t[s].add(c));var f=t.length,h=Zt.triangulatePolygon(t),m=J()(r=J()(i=Zt.triangulatePolygon(Hn()(a=u.positions).call(a,f))).call(i,(function(e){return J()(e).call(e,(function(e){return e+f}))}))).call(r,Xn),d=function(e){for(var t=e.length,n=Zt.computeOrientation(e),o=[],r=0;r<t;r++){var i=(r+1)%t;o.push([r,t+i,i]),o.push([r,t+r,t+i])}return n>0?o:J()(o).call(o,Xn)}(t);return u.faces=ft()(l=ft()(h).call(h,m)).call(l,d),Zt.meshFromPositionAndFaces(o,e,u.positions,u.faces)};function $n(e,t,n,o){var r,i=Xe()(n._children);return b()(i).call(i,(function(e){n.removeChild(e),e.parent=o.mesh})),J()(r=o.keyPoints).call(r,(function(r,i){var a;return r.observers=new dt.Observable,r.observers.add(to(e,t)),r.index=i,r.name=ft()(a="".concat(n.name,"keyPoint")).call(a,i),r.position=Pt.of(o.localPolygon[i]).toBabylon(),r}))}function eo(e,t,n,o,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:$n,a=Zt.pointAverage(e);e=J()(e).call(e,(function(e){return e.subtract(a)}));var l=Jn(t,e,o.height,n.name);return l.position=n.position,l.rotationQuaternion=n.rotationQuaternion,l.locallyTranslate(a),l.material=n.material,l.visibility=n.visibility,l.parent=n.parent,o.localPolygon=J()(e).call(e,(function(e){return Pt.ofBabylon(e).toArray()})),o.mesh=l,o.keyPoints=i(t,r,n,o),n.dispose(),e}var to=function(e,t){return function(n){var o,r=n.updatedPointMesh,i=n.is2updateServer;b()(o=t.getNodeFromTree(r.parent.name)).call(o,(function(n){var o,a=r.index,l=n.item,c=l.mesh,u=c.name,s=J()(o=l.localPolygon).call(o,(function(e){return Pt.of(e).toBabylon()}));s[a]=r.position,eo(s,e,c,l,t),i&&t.updateNodeInServer(u)}))}};function no(e,t,n,o){var r;return io(e,J()(r=o.localPolygon).call(r,(function(e){return Pt.of(e).toBabylon()})),o.mesh,t)}var oo=function(e,t,n,o){var r,i=t.index,a=t.parent.name;b()(r=n.getNodeFromTree(a)).call(r,(function(t){for(var r,a=t.item,l=a.localPolygon.length,c=Dt.Utils.mod(i+o,l),u=a.mesh,s=J()(r=a.localPolygon).call(r,(function(e){return Pt.of(e).toBabylon()})),f=[],h=i+Math.max(0,o),m=0;m<h;m++)f.push(s[m]);f.push(s[c].add(s[i]).scale(.5));for(var d=h;d<l;d++)f.push(s[d]);eo(f,e,u,a,n,no)}))},ro=function(e,t,n){var o,i=[];return b()(o=n.getNodeFromTree(t.parent.name)).call(o,(function(n){n.item.localPolygon.length>3&&i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-times"},e))},action:function(n){!function(e,t,n){var o,r=t.index,i=t.parent.name;b()(o=n.getNodeFromTree(i)).call(o,(function(t){var o,a,l=t.item,c=l.mesh,u=J()(o=l.localPolygon).call(o,(function(e){return Pt.of(e).toBabylon()}));pn()(u).call(u,r,1),pn()(a=l.keyPoints).call(a,r,1)[0].dispose(),eo(u,e,c,l,n),n.updateNodeInServer(i)}))}(e,t,n),n.closeContextDial()},name:"Delete node"}),i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-greater-than"},e))},action:function(n){oo(e,t,n,1),n.closeContextDial()},name:"Add next"}),i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-less-than"},e))},action:function(n){oo(e,t,n,-1),n.closeContextDial()},name:"Add previous"})})),i},io=function(e,t,n,o){var r=[];return b()(t).call(t,(function(t,i){var a,l=new dt.Color3(.25,.25,.25),c=Zt.createSphere(e,l,Kn,ft()(a="".concat(n.name,"keyPointPolygon")).call(a,i),!0);c.parent=n,c.position=t,c.index=i,c.observers=new dt.Observable,r.push(c),c.observers.add(to(e,o))})),b()(r).call(r,(function(t){t.onClick=function(){o.setContextActions(ro(e,t,o))}})),r},ao=function(e){function t(e,n,o,r){var i,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return $e()(this,t),i=ot()(this,it()(t).call(this,e,a)),T()(lt()(i),"getType",(function(){return t.TYPE})),i.localPolygon=n,i.height=o,i.keyPoints=r,i}return ut()(t,e),tt()(t,[{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.localPolygon=this.localPolygon,e.height=this.height,e}}],[{key:"ofDict",value:function(e){var n,o,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!r||!i)throw"null dictionary describing polygon or null mainView";var a=J()(n=r.localPolygon).call(n,(function(e){return Pt.of(e).toBabylon()})),l=Pt.of(r.position).toBabylon(),c=Jn(e,a,r.height,r.name);c.position=l;var u=new dt.StandardMaterial("PolygonMaterial".concat(r.name),e),s=new dt.Color3(r.color[0],r.color[1],r.color[2]);u.diffuseColor=s,u.emissiveColor=s,c.material=u,c.visibility=.5,b()(o=yt.Maybe.fromNull(r.quaternion)).call(o,(function(e){var t=new dt.Quaternion(e[1],e[2],e[3],e[0]);c.rotationQuaternion=t.normalize()}));var f=io(e,a,c,i);return new t(c,J()(a).call(a,(function(e){return[e.x,e.y,e.z]})),r.height,f,r.keyValueMap)}}]),t}(Lt);T()(ao,"TYPE","PolygonRegion");var lo=ao,co=function(e){function t(e,n,o,r){var i;return $e()(this,t),i=ot()(this,it()(t).call(this,e,r)),T()(lt()(i),"getType",(function(){return t.TYPE})),i.size=n,i.textureSrc=o,i}return ut()(t,e),tt()(t,[{key:"dispose",value:function(){gt()(it()(t.prototype),"dispose",this).call(this)}},{key:"toDict",value:function(){var e=gt()(it()(t.prototype),"toDict",this).call(this);return e.size=this.size,e.textureSrc=this.textureSrc,e}},{key:"toForm",value:function(){var e=this.toDict();return{jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},assetName:{type:"string",title:"Asset Name"}}},uiSchema:{type:{"ui:disabled":!0},assetName:{"ui:disabled":!0},oldName:{"ui:widget":"hidden"}},data:{oldName:e.name,name:e.name,type:e.type,assetName:e.assetName}}}}]),t}(Ht);T()(co,"TYPE","Map");var uo=co,so={GlobalRef:un,Box:Gt,KeyPoint:hn,Path:En,Wall:Fn,BoxRegion:Qn,PolygonRegion:lo},fo={Robot:Jt,Map:uo};function ho(e){return e.type in fo}function mo(e,t,n){var o=yt.Maybe.fromNull(t.assetName).orSome(t.name),r=e.getAssetsActionMap()[o];r.memory.parentObj={parent:n},r.memory.nodeItemDict=t,r.memory.assetName=o,r.memory.name=t.name,r.action(e)}function vo(e,t,n){var o,r=so[t.type];r&&b()(o=e.getSceneMemory()).call(o,(function(o){var i,a=o.scene,l=r.ofDict(a,t,e);b()(i=e.getNodeFromTree(n)).call(i,(function(e){l.mesh.parent=e.item.mesh})),e.addNodeItem2Tree(l,n,!1)}))}function po(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t){var o=rn()(t).call(t,(function(e,t){return"GlobalRef"===e.item.type?-1:e.name<t.name?-1:e.name>t.name?1:0}));b()(o).call(o,(function(t){ho(t.item)?mo(e,t.item,n):vo(e,t.item,n),t.children.length>0&&po(e,t.children,t.name)}))}}function yo(e,t){var n;b()(n=e.getSceneMemory()).call(n,(function(n){var o=n.scene,r=!t;e.addNodeItem2Tree(un.ofDict(o),null,r)}))}var bo=function(){function e(){$e()(this,e)}return tt()(e,null,[{key:"importScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log("Importing scene...",e,t),t.length>0?po(e,t):yo(e,n),console.log("End Importing scene")}}]),e}(),go=n(34),Mo=function e(){$e()(this,e)};T()(Mo,"createGizmo",(function(e){var t=new dt.RotationGizmo(new dt.UtilityLayerRenderer(e));return t.xGizmo.dragBehavior.detach(),t.xGizmo.scaleRatio=0,t.yGizmo.dragBehavior.detach(),t.yGizmo.scaleRatio=0,t})),T()(Mo,"createCamera",(function(e,t,n){var o=Zt.cameraBuilder(e).sphericalCoordinates(new dt.Vector3(0,0,14)).target(dt.Vector3.Zero()).name("camera").build();return o.attachControl(t,!1),o.inertia=.85,o.collisionRadius=new dt.Vector3(1,1,1),o.checkCollisions=!0,n(o),o})),T()(Mo,"createLight",(function(e){return Zt.directionalLightBuilder(e).name("light").direction(new dt.Vector3(0,-1,0)).intensity(.35).build()})),T()(Mo,"createMeshGround",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=dt.Mesh.CreateGround("groundMesh",t,n,20,e);return o.translate(new dt.Vector3(0,-1,0),.01,dt.Space.WORLD),o.material=new dt.StandardMaterial("wireframe",e),o.material.wireframe=!0,o.isPickable=!1,o.checkCollisions=!0,o})),T()(Mo,"createScene",(function(e){var t=new dt.Scene(e);return t.clearColor=dt.Color3.Black,t.collisionsEnabled=!0,t._uid=t.getUniqueId(),t})),T()(Mo,"createMouseLocationText",(function(e){var t=go.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),n=new go.TextBlock;return n.text="",n.color="white",n.fontSize=11,n.left=-560,n.top=-145,t.addControl(n),n}));var wo=Mo,ko=function e(){$e()(this,e)};T()(ko,"retrieveScene",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:No,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Po("retrieving scene");Dt.MasterDB.cloudFunction(yn.CLOUD_FUNCTION_NAME,"retrieveScene",e,(function(e){return Co(e,t,n)}))}));var xo,Po=function(e){return function(t){var n;throw""+ft()(n="Exception caught in ".concat(e,": ")).call(n,t.error)}},No=function(e){},Co=function(e,t,n){e.success?t(e):n(e)},So=ko,To=function(){function e(t){$e()(this,e),this.scene=t}return tt()(e,[{key:"loadMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(e,t,n){},r=new dt.AssetsManager(this.scene),i=r.addMeshTask("","",_o+"/static/meshes/",e);i.onSuccess=t,i.onError=o,r.onFinish=n,r.load()}}],[{key:"of",value:function(t){return new e(t)}}]),e}(),_o=""===window.location.port?"http://".concat(window.location.hostname):ft()(xo="http://".concat(window.location.hostname,":")).call(xo,window.location.port),Ao=To;function Eo(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}function jo(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=Eo(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=Eo(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}function Ro(e,t,n){if(e.length==t.length){for(var o=!0,r=0;r<e.length;r++){var i=e[r],a=t[r];if(!n(i,a))return!1;o=o&&Ro(i.children,a.children,n)}return o}return!1}function Bo(e){return e.expanded=!0,e}function Do(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return b()(e).call(e,(function(e){var o=jo({},e);if(t(o))n.push(Bo(o));else if(o.children){var r=Do(o.children,t);0!==r.length&&(o.children=r,n.push(Bo(o)))}})),n}var Vo=function(){function e(t){$e()(this,e),this.tree=t}return tt()(e,[{key:"getNode",value:function(e){return function e(t,n){for(var o=0;o<t.length;o++){var r=t[o];if(n(r))return Ye()(yt.Maybe).call(yt.Maybe,r);var i=e(r.children,n);if(i.isSome())return i}return yt.Maybe.none()}(this.tree,e)}},{key:"getParentNode",value:function(e){return function e(t,n,o){var r;if(wt()(r=J()(t).call(t,(function(e){return n(e)}))).call(r,(function(e,t){return e||t}),!1))return yt.Maybe.fromNull(o);for(var i=0;i<t.length;i++){var a=t[i],l=e(a.children,n,a);if(l.isSome())return l}return yt.Maybe.none()}(this.tree,e,null)}},{key:"equals",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};return t.constructor===e?Ro(this.tree,t.tree,n):Ro(this.tree,t,n)}},{key:"map",value:function(t){return new e(function e(t,n,o){for(var r=0;r<t.length;r++){var i=t[r],a=o(i);a.children=[],e(i.children,a.children,o),n.push(a)}return n}(this.tree,[],t))}},{key:"filter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return Do(this.tree,e)}}]),e}(),zo=function(){function e(t,n,o,r,i){$e()(this,e),this.title=t,this.item=n,this.children=o,this.expanded=r,this.isVisible=i}return tt()(e,null,[{key:"dispose",value:function(t){var n;t.item.dispose(),b()(n=t.children).call(n,(function(t){e.dispose(t)}))}},{key:"toDict",value:function(t){var n;return{name:t.title,item:t.item.toDict(),children:J()(n=t.children).call(n,(function(t){return e.toDict(t)}))}}},{key:"builder",value:function(){return new Io}}]),e}(),Io=function(){function e(){$e()(this,e),this._title=null,this._item={},this._children=[],this._expanded=!0,this._isVisible=!0}return tt()(e,[{key:"title",value:function(e){return this._title=e,this}},{key:"item",value:function(e){return this._item=e,this}},{key:"children",value:function(e){return this._children=e,this}},{key:"expanded",value:function(e){return this._expanded=e,this}},{key:"isVisible",value:function(e){return this._isVisible=e,this}},{key:"build",value:function(){var e;return b()(e=Qe()(this)).call(e,(function(e){if(null===e)throw"There are missing variables to build a TreeNode, e.g ".concat(e)})),new zo(this._title,this._item,this._children,this._expanded,this._isVisible)}}]),e}(),Oo=zo,Fo=yn.CLOUD_FUNCTION_NAME,qo=function(){function e(t){var n=this;$e()(this,e),T()(this,"getNodeFromTree",(function(e,t){return new Vo(t).getNode((function(t){return e===t.title}))})),T()(this,"getParentFromChild",(function(e,t){return new Vo(t).getParentNode((function(t){return e===t.title}))})),T()(this,"deleteNodeFromTreeUsingName",(function(e,t){var o,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return b()(o=n.getNodeFromTree(e,t)).call(o,(function(o){Oo.dispose(o),r&&n.deleteNodeInServer(e);var i=n.getParentFromChild(e,t);b()(i).call(i,(function(t){var n;t.children=k()(n=t.children).call(n,(function(t){return t.title!==e}))})),t=k()(t).call(t,(function(t){return t.title!==e}))})),t})),T()(this,"getNodeFromTreeWithPredicate",(function(e,t){return new Vo(t).getNode(e)})),T()(this,"addNodeItem2Tree",(function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:un.NAME,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];n.deleteNodeFromTreeUsingName(t.name,e,r);var a=Oo.builder().title(t.name).item(t).isVisible(i).build();if(o){var l=n.getNodeFromTree(o,e);b()(l).call(l,(function(e){r&&n.addNodeItem2Server(a,e.title),e.children.push(a)}))}else e.push(a),r&&n.addNodeItem2Server(a,null);return e})),T()(this,"updateNodeInServer",(function(e,t){var o,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("updateNodeInServer!",n.sceneName),b()(o=n.getNodeFromTree(e,t)).call(o,(function(o){var i,a=J()(i=n.getParentFromChild(e,t)).call(i,(function(e){return e.title})).orNull();Dt.MasterDB.cloudFunction(Fo,"updateNode",[Oo.toDict(o),a,r,n.sceneName],(function(e){console.log("Update node with success?",e.success)}))}))})),T()(this,"addNodeItem2Server",(function(e,t){Dt.MasterDB.cloudFunction(Fo,"addNodeItem",[Oo.toDict(e),t,n.sceneName],(function(e){console.log("Add node with success?",e.success)}))})),T()(this,"deleteNodeInServer",(function(e){Dt.MasterDB.cloudFunction(Fo,"deleteNodeByName",[e,n.sceneName],(function(e){console.log("Deleted node with success?",e.success)}))})),this.sceneName=t}return tt()(e,null,[{key:"ofScene",value:function(t){return new e(t)}}]),e}(),Lo=n(65),Uo=n.n(Lo),Go=n(35),Yo=n.n(Go),Wo=n(66),Qo=n.n(Wo),Zo=n(36),Ho=n.n(Zo),Ko=n(67),Xo=n.n(Ko),Jo=n(68),$o=n.n(Jo),er=function(){function e(){$e()(this,e),this.memory={}}return tt()(e,[{key:"action",value:function(e){var t;b()(t=e.getSceneMemory()).call(t,(function(e){e.gizmoManager.attachedMesh=null})),e.highlightNodeInTree&&e.highlightNodeInTree(),e.highlightNodeInScene&&e.highlightNodeInScene()}}]),e}(),tr=function(e){function t(){return $e()(this,t),ot()(this,it()(t).call(this))}return ut()(t,e),tt()(t,[{key:"onPointerDown",value:function(e,t){}},{key:"onPointerMove",value:function(e,t){}},{key:"onPointerUp",value:function(e){}}]),t}(er),nr=function(e){function t(){var e;return $e()(this,t),or?ot()(e,or):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"setProperties",(function(e,t){var n;b()(n=e.getNodeFromTree(t)).call(n,(function(t){e.setProperties(t.item.toForm())}))})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"onPointerDown",(function(t,n){var o;1===t.buttons&&b()(o=n.getSceneMemory()).call(o,(function(t){var o,r=t.scene,i=t.ground,a=t.camera;e.maybeSelectedMesh=Zt.pickMesh(r,i),b()(o=e.maybeSelectedMesh).call(o,(function(o){o.onClick?o.onClick():n.closeContextDial(),n.addGizmo(o.name),n.highlightNodeInTree(o.name),n.highlightNodeInScene(o.name),e.setProperties(n,o.name),a.detachControl(t.canvas)}))}))})),T()(lt()(e),"onPointerMove",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var n=t.scene,o=t.ground,r=Zt.getGroundPosition(n,o);b()(r).call(r,(function(t){var n;b()(n=e.maybeSelectedMesh).call(n,(function(n){var o=Zt.computeLocalCoordinateFromMesh(n,new Pt([t.x,t.y,t.z]));n.position=new dt.Vector3(o.getX(),o.getY(),n.position.z),e.notifyObservers(n,!1)}))}))}))})),T()(lt()(e),"onPointerUp",(function(t){var n;b()(n=t.getSceneMemory()).call(n,(function(n){var o,r=n.camera;b()(o=e.maybeSelectedMesh).call(o,(function(n){e.notifyObservers(n),e.setProperties(t,n.name),t.updateNodeInServer(n.name)})),e.maybeSelectedMesh=yt.Maybe.none(),r.attachControl(n.canvas,!0)}))})),e.key="dragObject",e.name="Drag Objects",e.maybeSelectedMesh=yt.Maybe.none(),e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-mouse-pointer"},e))},or=lt()(e),e)}return ut()(t,e),tt()(t,[{key:"notifyObservers",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b()(t=yt.Maybe.fromNull(e.observers)).call(t,(function(t){return t.notifyObservers({updatedPointMesh:e,is2updateServer:n})}))}}],[{key:"getInstace",value:function(){return new t}}]),t}(tr),or=null,rr=nr,ir=null,ar=function(e){function t(){var e;return $e()(this,t),ir?ot()(e,ir):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"createKeyPoint",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:dt.Color3.Gray(),a=o.getRootNode().item.mesh,l=hn.ofDict(n,{name:t,color:[i.r,i.g,i.b]}),c=l.mesh;c.parent=a;var u=Zt.computeLocalCoordinateFromMesh({parent:a},Pt.ofBabylon(e)).toBabylon();return c.setPositionWithLocalVector(u.add(dt.Axis.Z.scale(hn.DEFAULT_SIZE))),r&&o.addNodeItem2Tree(l,a.name,r),c})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"onPointerDown",(function(t,n){var o;0===t.button&&b()(o=n.getSceneMemory()).call(o,(function(t){var n,o=t.scene,r=t.ground,i=t.camera;e.maybeMousePos=Zt.getGroundPosition(o,r),b()(n=e.maybeMousePos).call(n,(function(e){i.detachControl(t.canvas)}))}))})),T()(lt()(e),"onPointerMove",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var o=t.scene,r=t.ground,i=Zt.getGroundPosition(o,r);b()(i).call(i,(function(t){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh&&e.tempMesh.dispose(),e.tempMesh=e.createKeyPoint(t,"temp_key_point",o,n,!1)}))}))}))})),T()(lt()(e),"onPointerUp",(function(t){var n;b()(n=t.getSceneMemory()).call(n,(function(n){var o=n.scene,r=n.camera,i=n.ground,a=Zt.getGroundPosition(o,i);b()(a).call(a,(function(n){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh&&e.tempMesh.dispose(),e.createKeyPoint(n,"KeyPoint".concat(Math.floor(1e3*Math.random())),o,t,!0,new dt.Color3(Math.random(),Math.random(),Math.random()))}))})),e.maybeMousePos=yt.Maybe.none(),r.attachControl(n.canvas,!0)}))})),e.key="addKeyPoint",e.name="Add Key Point",e.maybeMousePos=yt.Maybe.none(),e.tempMesh=null,e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-map-marker"},e))},ir=lt()(e),e)}return ut()(t,e),tt()(t,null,[{key:"getInstace",value:function(){return new t}}]),t}(tr),lr=null,cr=function(e){function t(){var e;return $e()(this,t),lr?ot()(e,lr):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"createBoxRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:dt.Color3.Red(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=o.getRootNode().item.mesh,c=J()(e).call(e,(function(e){return Zt.computeLocalCoordinateFromMesh({parent:l},Pt.ofBabylon(e))}));c[1]=c[1].add(Pt.of([0,0,a]));var u=c[0].add(c[1]).scale(.5),s=J()(c).call(c,(function(e){return e.sub(u)})),f=Qn.ofDict(n,{name:t,position:u.toArray(),color:[i.r,i.g,i.b],corners:J()(s).call(s,(function(e){return e.toArray()}))},o);return f.mesh.parent=l,r&&o.addNodeItem2Tree(f,l.name,r),f.mesh})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"onPointerDown",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var n=t.scene,o=t.ground,r=t.camera,i=Zt.getGroundPosition(n,o);e.maybeMousePos=i,b()(i).call(i,(function(e){r.detachControl(t.canvas)}))}))})),T()(lt()(e),"onPointerMove",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var o=t.scene,r=t.ground,i=Zt.getGroundPosition(o,r);b()(i).call(i,(function(t){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh&&e.tempMesh.dispose(),e.tempMesh=e.createBoxRegion([r,t],"temp_box_region",o,n,!1)}))}))}))})),T()(lt()(e),"onPointerUp",(function(t){var n;b()(n=t.getSceneMemory()).call(n,(function(n){var o=n.scene,r=n.camera,i=n.ground,a=Zt.getGroundPosition(o,i);b()(a).call(a,(function(n){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh.dispose(),e.createBoxRegion([r,n],"BoxRegion".concat(Math.floor(1e3*Math.random())),o,t,!0)}))})),e.maybeMousePos=yt.Maybe.none(),r.attachControl(n.canvas,!0)}))})),e.key="drawBoxRegion",e.name="Draw Box Region",e.maybeMousePos=yt.Maybe.none(),e.tempMesh=null,e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-square"},e))},lr=lt()(e),e)}return ut()(t,e),tt()(t,null,[{key:"getInstace",value:function(){return new t}}]),t}(tr),ur=null,sr=function(e){function t(){var e;return $e()(this,t),ur?ot()(e,ur):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"createCurve",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:dt.Color3.White(),a=o.getRootNode().item.mesh,l=J()(e).call(e,(function(e){return Zt.computeLocalCoordinateFromMesh({parent:a},Pt.ofBabylon(e)).toBabylon()})),c=Zt.pointAverage(l),u=J()(l).call(l,(function(e){return e.subtract(c)})),s=En.ofDict(n,{name:t,position:Pt.ofBabylon(c).toArray(),color:[i.r,i.g,i.b],localPath:J()(u).call(u,(function(e){return Pt.ofBabylon(e).toArray()}))},o);s.mesh.parent=a,o.addNodeItem2Tree(s,a.name,r)})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"getDrawPathContextAction",(function(t,n,o){var i=[];return i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-times"},e))},action:function(o){t.attachControl(n,!0),o.deleteNodeFromTreeUsingName("temp_curve",!1),e.mouseCurve=[],o.closeContextDial()},name:"Clear Path"}),e.mouseCurve.length>1&&i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-check"},e))},action:function(r){t.attachControl(n,!0),r.deleteNodeFromTreeUsingName("temp_curve",!1),e.createCurve(e.mouseCurve,"Path".concat(Math.floor(1e3*Math.random())),o,r,!0),e.mouseCurve=[],r.closeContextDial()},name:"Create Path"}),i})),T()(lt()(e),"onPointerDown",(function(t,n){var o;1===t.buttons&&b()(o=n.getSceneMemory()).call(o,(function(t){var o=t.scene,r=t.ground,i=t.camera,a=Zt.getGroundPosition(o,r);b()(a).call(a,(function(r){i.detachControl(t.canvas),e.mouseCurve.push(r),1===e.mouseCurve.length?e.createCurve([e.mouseCurve[0],e.mouseCurve[0]],"temp_curve",o,n,!1):e.createCurve(e.mouseCurve,"temp_curve",o,n,!1),n.setContextActions(e.getDrawPathContextAction(i,t.canvas,o))}))}))})),T()(lt()(e),"onPointerMove",(function(e,t){})),T()(lt()(e),"onPointerUp",(function(e){})),e.key="drawPath",e.name="Draw Path",e.mouseCurve=[],e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-bezier-curve"},e))},ur=lt()(e),e)}return ut()(t,e),tt()(t,null,[{key:"getInstace",value:function(){return new t}}]),t}(tr),fr=null,hr=function(e){function t(){var e;return $e()(this,t),fr?ot()(e,fr):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"createPolygonRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:dt.Color3.Yellow(),a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,l=o.getRootNode().item.mesh,c=J()(e).call(e,(function(e){return Zt.computeLocalCoordinateFromMesh({parent:l},Pt.ofBabylon(e))})),u=Zt.pointAverageVec3(c),s=J()(c).call(c,(function(e){return e.sub(u)})),f=lo.ofDict(n,{name:t,position:u.toArray(),color:[i.r,i.g,i.b],localPolygon:J()(s).call(s,(function(e){return e.toArray()})),height:a},o);f.mesh.parent=l,o.addNodeItem2Tree(f,l.name,r)})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"getDrawPolygonContextAction",(function(t,n,o){var i=[];return i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-times"},e))},action:function(o){t.attachControl(n,!0),o.deleteNodeFromTreeUsingName("temp_polygon_region",!1),e.mouseCurve=[],o.closeContextDial()},name:"Clear Polygon"}),e.mouseCurve.length>2&&i.push({icon:function(e){return r.a.createElement("i",se()({className:"fas fa-check"},e))},action:function(r){t.attachControl(n,!0),r.deleteNodeFromTreeUsingName("temp_polygon_region",!1),e.createPolygonRegion(e.mouseCurve,"PolygonRegion".concat(Math.floor(1e3*Math.random())),o,r,!0),e.mouseCurve=[],r.closeContextDial()},name:"Create Polygon"}),i})),T()(lt()(e),"onPointerDown",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var o=t.scene,r=t.ground,i=t.camera,a=Zt.getGroundPosition(o,r);b()(a).call(a,(function(r){i.detachControl(t.canvas),e.mouseCurve.push(r),1===e.mouseCurve.length?e.createPolygonRegion([e.mouseCurve[0],e.mouseCurve[0]],"temp_polygon_region",o,n,!1):e.createPolygonRegion(e.mouseCurve,"temp_polygon_region",o,n,!1),n.setContextActions(e.getDrawPolygonContextAction(i,t.canvas,o))}))}))})),T()(lt()(e),"onPointerMove",(function(e,t){})),T()(lt()(e),"onPointerUp",(function(e){})),e.key="drawPolygonRegion",e.name="Draw Polygon Region",e.mouseCurve=[],e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-draw-polygon"},e))},fr=lt()(e),e)}return ut()(t,e),tt()(t,null,[{key:"getInstace",value:function(){return new t}}]),t}(tr),mr=null,dr=function(e){function t(){var e;return $e()(this,t),mr?ot()(e,mr):(e=ot()(this,it()(t).call(this)),T()(lt()(e),"createWall",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{width:.1,height:1},a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:new dt.Color3(.25,.25,.25),l=o.getRootNode().item.mesh,c=J()(e).call(e,(function(e){return Zt.computeLocalCoordinateFromMesh({parent:l},Pt.ofBabylon(e)).toBabylon()})),u=c[1].add(c[0]).scale(.5),s=J()(c).call(c,(function(e){return e.subtract(u)})),f=Fn.ofDict(n,{name:t,position:Pt.ofBabylon(u).toArray(),size:i,color:[a.r,a.g,a.b],localWall:J()(s).call(s,(function(e){return Pt.ofBabylon(e).toArray()}))},o);return f.mesh.parent=l,r&&o.addNodeItem2Tree(f,l.name,r),f.mesh})),T()(lt()(e),"action",(function(n){gt()(it()(t.prototype),"action",lt()(e)).call(lt()(e),n),n.setSelectedAction(lt()(e))})),T()(lt()(e),"onPointerDown",(function(t,n){var o;0===t.button&&b()(o=n.getSceneMemory()).call(o,(function(t){var n=t.scene,o=t.ground,r=t.camera,i=Zt.getGroundPosition(n,o);e.maybeMousePos=i,b()(i).call(i,(function(e){r.detachControl(t.canvas)}))}))})),T()(lt()(e),"onPointerMove",(function(t,n){var o;b()(o=n.getSceneMemory()).call(o,(function(t){var o=t.scene,r=t.ground,i=Zt.getGroundPosition(o,r);b()(i).call(i,(function(t){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh&&e.tempMesh.dispose(),e.tempMesh=e.createWall([r,t],"temp_wall",o,n,!1)}))}))}))})),T()(lt()(e),"onPointerUp",(function(t){var n;b()(n=t.getSceneMemory()).call(n,(function(n){var o=n.scene,r=n.camera,i=n.ground,a=Zt.getGroundPosition(o,i);b()(a).call(a,(function(n){var r;b()(r=e.maybeMousePos).call(r,(function(r){e.tempMesh.dispose(),r.subtract(n).length()>.1&&e.createWall([r,n],"Wall".concat(Math.floor(1e3*Math.random())),o,t,!0)}))})),e.maybeMousePos=yt.Maybe.none(),r.attachControl(n.canvas,!0)}))})),e.key="drawWall",e.name="Draw wall",e.maybeMousePos=yt.Maybe.none(),e.tempMesh=null,e.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-arrows-alt-h"},e))},mr=lt()(e),e)}return ut()(t,e),tt()(t,null,[{key:"getInstace",value:function(){return new t}}]),t}(tr),vr=(n(70),n(69)),pr=n.n(vr),yr=Dt.Utils.ofNull,br=function(e){function t(e,n){var o;return $e()(this,t),o=ot()(this,it()(t).call(this,e)),T()(lt()(o),"getType",(function(){return t.TYPE})),o.robot=n,o.pointCloudSubscribe(),o}return ut()(t,e),tt()(t,[{key:"pointCloudSubscribe",value:function(){var e=this;Dt.MasterDB.subscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"},(function(t){var n,o,r,i,a,l,c;b()(n=Tt()(o=Tt()(r=Tt()(i=Tt()(a=Tt()(l=Tt()(c=yt.Maybe.fromNull(t)).call(c,(function(e){return yr(e.key)}))).call(l,(function(t){return yr(t.Robot[e.robot.id])}))).call(a,(function(e){return yr(e.Parameter)}))).call(i,(function(e){return yr(e.front_lidar)}))).call(r,(function(e){return yr(e.Value)}))).call(o,(function(e){return yr(e.points)}))).call(n,(function(t){return e.updatePointCloud(t)}))}),(function(t){var n,o,r,i,a,l,c;b()(n=Tt()(o=Tt()(r=Tt()(i=Tt()(a=Tt()(l=Tt()(c=yt.Maybe.fromNull(t.value)).call(c,(function(e){return yr(e.Robot)}))).call(l,(function(t){return yr(t[e.robot.id])}))).call(a,(function(e){return yr(e.Parameter)}))).call(i,(function(e){return yr(e.front_lidar)}))).call(r,(function(e){return yr(e.Value)}))).call(o,(function(e){return yr(e.points)}))).call(n,(function(t){return e.updatePointCloud(t)}))}))}},{key:"updatePointCloud",value:function(e){var t=new dt.VertexData;t.positions=Tt()(e).call(e,(function(e){return e}));var n=new Array(4*e.length);t.colors=pr()(n).call(n,1),t.applyToMesh(this.mesh,!0)}},{key:"dispose",value:function(){gt()(it()(t.prototype),"dispose",this).call(this),Dt.MasterDB.unsubscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"})}}],[{key:"ofDict",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!n||!o)throw"null dictionary describing point cloud or null mainView";var r=new dt.Mesh("cloudPoint".concat(n.name),e),i=new dt.StandardMaterial("cloudPoint".concat(n.name,"Material"),e);return i.emissiveColor=new dt.Color3(1,1,1),i.disableLighting=!0,i.pointsCloud=!0,i.pointSize=2,r.material=i,new t(r,n)}}]),t}(Lt);T()(br,"TYPE","PointCloud");var gr=br,Mr=function(e){function t(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return Jt.getDefaultAnimator(t)};return $e()(this,t),n=ot()(this,it()(t).call(this)),T()(lt()(n),"action",(function(e){gt()(it()(t.prototype),"action",lt()(n)).call(lt()(n),e),e.getNodeFromTree(n.robot.name).orElseRun((function(){return n.addRobot(e)})),e.setSelectedAction(kr.dragObjects)})),T()(lt()(n),"getType",(function(){return t.TYPE})),n.robot=e,n.key="robotAction".concat(e.name),n.name=e.name,n.robotAnimatorFactory=o,n.icon=function(e){return r.a.createElement("i",se()({className:"fas fa-robot"},e))},n}return ut()(t,e),tt()(t,[{key:"createRobotFromMesh",value:function(e,t,n){var o,r,i,a=Jt.createRobotMeshTree(this.robot.robotTree,e,t),l=J()(o=Tt()(r=J()(i=yt.Maybe.fromNull(this.memory.parentObj)).call(i,(function(e){return e.parent}))).call(r,(function(e){return n.getNodeFromTree(e)}))).call(o,(function(e){return e.item.mesh})).orSome(n.getRootNode().item.mesh),c=yt.Maybe.fromNull(this.memory.nodeItemDict),u=Jt.builder().id(this.robot.id).name(yt.Maybe.fromNull(this.memory.name).orSome(this.robot.name)).assetName(yt.Maybe.fromNull(this.memory.assetName).orSome(this.robot.name)).meshTree(a).parentMesh(l).scene(t).keyValueMap(J()(c).call(c,(function(e){return e.keyValueMap})).orSome({})).build();u.animate(this.robotAnimatorFactory(u,n));var s=null==this.memory.parentObj;this.memory.parentObj=null,n.addNodeItem2Tree(u,l.name,s);var f=gr.ofDict(t,{name:this.robot.name,id:this.robot.id},n);f.mesh.parent=u.mesh,n.addNodeItem2Tree(f,u.name,!1)}},{key:"addRobot",value:function(e){var t,n=this;b()(t=e.getSceneMemory()).call(t,(function(t){var o=t.scene,r=nn.getInstance().get(Jt.ROBOT_MESH_NAME,o);n.createRobotFromMesh(r,o,e)}))}}]),t}(er);T()(Mr,"TYPE","RobotAction");var wr=Mr,kr={dragObjects:rr.getInstace(),addKeyPoint:ar.getInstace(),drawBoxRegion:cr.getInstace(),drawPath:sr.getInstace(),drawRegion:hr.getInstace(),drawWalls:dr.getInstace(),addRobot:new wr({id:"Test",name:"Test",robotTree:{name:"Test",position:{x:0,y:0,z:0},orientation:{w:1,x:0,y:0,z:0},child:[{name:"TestTF",position:{x:1,y:0,z:1},orientation:{w:Math.cos(-Math.PI/4),x:0,y:Math.sin(-Math.PI/4),z:0},child:[]}]}})},xr=function(e){function t(e,n,o,i,a){var l;return $e()(this,t),l=ot()(this,it()(t).call(this)),T()(lt()(l),"getType",(function(){return t.TYPE})),T()(lt()(l),"deleteAsset",(function(){Dt.MasterDB.cloudFunction(yn.CLOUD_FUNCTION_NAME,"deleteMap",l.name,(function(e){console.log("Delete Maps",e)}))})),l.name=e,l.key="addMap".concat(e),l.textureSrc=n,l.resolution=o,l.origin=i,l.imageSize=a,l.icon=function(e){return r.a.createElement("i",se()({},e,{className:"fas fa-map"}))},l}return ut()(t,e),tt()(t,[{key:"getSensibilityFromArea",value:function(e){return Nr(e)}},{key:"addMap",value:function(e){var t,n=this,o=yt.Maybe.fromNull(e.getRootNode());b()(t=e.getSceneMemory()).call(t,(function(t){var r,i,a,l=t.scene,c=t.camera,u=n.resolution*n.imageSize[0],s=n.resolution*n.imageSize[1],f=Zt.groundBuilder(l).name(yt.Maybe.fromNull(n.memory.name).orSome(n.name)).width(u).height(s).textureSrc(n.textureSrc).build(),h=Pt.of([-u/2,-s/2,0]).sub(Pt.of(n.origin)),m=null==n.memory.parentObj;n.memory.parentObj=null,b()(o).call(o,(function(e){var t=e.item.mesh.parent;t.position=un.inverseCoord(h.toBabylon()),c.setTarget(new dt.Vector3(t.position.x,t.position.y,t.position.z))})),c.panningSensibility=n.getSensibilityFromArea(u*s),console.log(ft()(r=ft()(i=ft()(a="Panning Sensibility: width(".concat(u,") height(")).call(a,s,") Area(")).call(i,u*s,") Sensibility(")).call(r,c.panningSensibility,")"));var d=new uo(f,[u,s],n.textureSrc,yt.Maybe.fromNull(n.memory.assetName).orSome(n.name));e.addNodeItem2Tree(d,null,m),t.ground.dispose(),t.ground=wo.createMeshGround(l,u,s)}))}},{key:"action",value:function(e){var n=this;gt()(it()(t.prototype),"action",this).call(this,e);var o=e.getNodeFromTree(this.name);b()(o).call(o,(function(e){})),o.orElseRun((function(){if(e.getObjectTree().length<2)return n.addMap(e);var t=e.getObjectTree()[1].title;e.deleteNodeFromTreeUsingName(t),n.addMap(e)})),e.setSelectedAction(kr.dragObjects)}}]),t}(er);T()(xr,"TYPE","AddMapAction");var Pr,Nr=function(e){return 1018.74*Math.exp(-464231e-10*e)},Cr=xr,Sr="Map",Tr="Robot",_r={Map:function(e){return new Cr(e.name,e.image,e.resolution,e.origin,e.size)},Robot:function(e){return new wr(e,Jt.getSocketAnimator)}},Ar=""===window.location.port?"http://".concat(window.location.hostname):ft()(Pr="http://".concat(window.location.hostname,":")).call(Pr,window.location.port),Er=function(){function e(){var t=this;if($e()(this,e),T()(this,"getAssets",(function(){return t.assets})),T()(this,"getAssetsActionMap",(function(){return t.assetsActionMap})),T()(this,"addAfterLoad",(function(e){return t.afterLoad.push(e),t})),T()(this,"getMapUrl",(function(e){var t;return ft()(t="".concat(Ar,"/static/maps/")).call(t,e)})),T()(this,"parseYaml",function(){var e=$o()(Ho.a.mark((function e(n){var o,r,i,a,l,c;return Ho.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l={},c={image:function(e,t){return l[e]=t},resolution:function(e,t){return l[e]=Xo()(t)},origin:function(e,t){return l[e]=JSON.parse(t)}},b()(o=k()(r=k()(i=J()(a=n.split("\n")).call(a,(function(e){return e.split(": ")}))).call(i,(function(e){return e.length>=2}))).call(r,(function(e){return e[0]in c}))).call(o,(function(e){return c[e[0]](e[0],e[1])})),l.name=l.image.split("/").pop(),l.image=t.getMapUrl(l.image),console.log("Yaml text",n),e.next=8,t.getImageSize(l.image);case 8:return l.size=e.sent,e.abrupt("return",l);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),T()(this,"finishSub",(function(e){var n;(console.log("FINISH SUB ",e,t.finishInitialSubscribers),++t.finishInitialSubscribers>2)&&b()(n=t.afterLoad).call(n,(function(e){return e()}))})),T()(this,"getMapSubscribe",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(o){var r,i,a,l;return b()(r=Tt()(i=Tt()(a=Tt()(l=yt.Maybe.fromNull(e(o))).call(l,(function(e){return yt.Maybe.fromNull(e.Package)}))).call(a,(function(e){return yt.Maybe.fromNull(e.maps)}))).call(i,(function(e){return yt.Maybe.fromNull(e.File)}))).call(r,(function(e){var o,r,i=J()(o=k()(r=C()(e)).call(r,(function(e){return Qo()(e).call(e,".yaml")}))).call(o,(function(e){return t.addMap(e)}));Yo.a.all(i).then((function(){return n()})).catch((function(e){return console.log("Caught exception",e)}))}))}})),T()(this,"getUpdateMapSub",(function(e,n){var o={del:function(o){var r,i,a,l;b()(r=Tt()(i=Tt()(a=Tt()(l=yt.Maybe.fromNull(e(o))).call(l,(function(e){return yt.Maybe.fromNull(e.Package)}))).call(a,(function(e){return yt.Maybe.fromNull(e.maps)}))).call(i,(function(e){return yt.Maybe.fromNull(e.File)}))).call(r,(function(e){delete t.assets[C()(e)[0]],delete t.assetsActionMap[C()(e)[0]],n()}))},set:t.getMapSubscribe(e,n),subscribe:t.getMapSubscribe(e,n)};return function(e){o[e.event](e)}})),jr)return jr;jr=this,this.assets={},this.assetsActionMap={},this.robots={},this.observers=[],this.afterLoad=[],this.finishInitialSubscribers=0,this.retrieveAssetsFromDb()}return tt()(e,[{key:"addObserver",value:function(e){return this.observers.push(e),this}},{key:"addAsset",value:function(e,t){this.assets[e]=t,this.assetsActionMap[e]=_r[t.type](t)}},{key:"addRobot",value:function(e){var t,n,o,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e in this.robots||(this.robots[e]={id:e,name:null,tf:null}),b()(t=yt.Maybe.fromNull(i)).call(t,(function(t){return r.robots[e].name=t})),b()(n=yt.Maybe.fromNull(a)).call(n,(function(t){return r.robots[e].tf=t})),Uo()(o=Qe()(this.robots[e])).call(o,(function(e){return null!==e}))){var l=this.robots[e];l.tf.name=l.name,this.addAsset(l.name,{name:l.name,id:e,type:Tr,robotTree:l.tf})}}},{key:"addMap",value:function(e){var t=this;return fetch(this.getMapUrl(e)).then((function(e){return e.text()})).then((function(e){return t.parseYaml(e)})).then((function(e){return e.type=Sr,e})).then((function(e){return t.addAsset(e.name,e)}))}},{key:"getImageSize",value:function(e){return new Yo.a((function(t,n){var o=new Image;o.src=e,o.onload=function(){return t([o.naturalWidth,o.naturalHeight])}}))}},{key:"retrieveAssetsFromDb",value:function(){var e=this;Dt.MasterDB.subscribe({Scope:"Robot",Name:"*",RobotName:"*"},(function(e){}),(function(t){var n,o;b()(n=Tt()(o=yt.Maybe.fromNull(t.value)).call(o,(function(e){return yt.Maybe.fromNull(e.Robot)}))).call(n,(function(t){var n;b()(n=C()(t)).call(n,(function(n){return e.addRobot(n,t[n].RobotName)}))})),e.finishSub("RobotName")})),Dt.MasterDB.subscribe({Scope:"Robot",Name:"*",Parameter:"tf"},(function(e){}),(function(t){var n,o;b()(n=Tt()(o=yt.Maybe.fromNull(t.value)).call(o,(function(e){return yt.Maybe.fromNull(e.Robot)}))).call(n,(function(t){var n;b()(n=C()(t)).call(n,(function(n){return e.addRobot(n,null,t[n].Parameter.tf.Value)}))})),e.finishSub("Robot tf")})),Dt.MasterDB.subscribe({Scope:"Package",File:"*",Name:"maps"},this.getUpdateMapSub((function(e){return e.key}),(function(){var t;return b()(t=e.observers).call(t,(function(e){return e()}))})),this.getMapSubscribe((function(e){return e.value}),(function(){return e.finishSub("Maps")})))}}],[{key:"getInstance",value:function(){return new e}}]),e}(),jr=null,Rr=Er;function Br(e,t){var n=C()(e);if(P.a){var o=P()(e);t&&(o=k()(o).call(o,(function(t){return M()(e,t).enumerable}))),n.push.apply(n,o)}return n}var Dr=function(e){function t(e){var n;return $e()(this,t),n=ot()(this,it()(t).call(this,e)),T()(lt()(n),"getSceneMemory",(function(){return n.sceneMemory})),T()(lt()(n),"getAssetsActionMap",(function(){return Rr.getInstance().getAssetsActionMap()})),T()(lt()(n),"getRootNode",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xe()(n.objectTree);return k()(e).call(e,(function(e){return e.title===un.NAME}))[0]})),T()(lt()(n),"getObjectTree",(function(){return n.objectTree})),T()(lt()(n),"setSelectedAction",(function(e){})),T()(lt()(n),"getNodeFromTree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe()(n.objectTree);return qo.ofScene(n.sceneName).getNodeFromTree(e,t)})),T()(lt()(n),"deleteNodeFromTreeUsingName",(function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];throw"Delete Node in viewer Exception"})),T()(lt()(n),"updateNodeInServer",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n.props.focusObject.Value===e&&n.setCameraToTarget(),qo.ofScene(n.sceneName).updateNodeInServer(e,Xe()(n.objectTree),t)})),T()(lt()(n),"addNodeItem2Tree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:un.NAME,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=qo.ofScene(n.sceneName).addNodeItem2Tree(Xe()(n.objectTree),e,t,o,r);n.objectTree=i})),T()(lt()(n),"setCameraToTarget",(function(){var e;b()(e=n.sceneMemory).call(e,(function(e){var t=e.camera,o=n.props.focusObject.Value;n.getNodeFromTree(o).cata((function(){console.log("Set Camera",n.getRootNode().item.mesh._absolutePosition),t.setTarget(n.getRootNode().item.mesh._absolutePosition.clone())}),(function(e){console.log("Set Camera, Found Object",e.item.mesh),t.setTarget(e.item.mesh._absolutePosition.clone())}))}))})),T()(lt()(n),"retrieveSceneFromServer",(function(e){So.retrieveScene(n.sceneName,(function(t){bo.importScene(lt()(n),t.result),He()(e)}))})),T()(lt()(n),"getAssets",(function(e){var t=Rr.getInstance();t.addAfterLoad(e),Qe()(t.getAssets()).length>0&&e()})),T()(lt()(n),"loadMeshes",(function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};b()(e=n.getSceneMemory()).call(e,(function(e){var n=e.engine,o=e.scene;Ao.of(o).loadMesh(Jt.ROBOT_MESH_NAME,(function(e){var t=Jt.transformMesh(e.loadedMeshes[0],o);nn.getInstance().put(Jt.ROBOT_MESH_NAME,o,t)}),(function(e){n.runRenderLoop((function(){return o.render()})),t()}))}))})),T()(lt()(n),"loadScene",(function(){n.loadMeshes((function(){return n.getAssets((function(){return n.retrieveSceneFromServer((function(){return n.setCameraToTarget()}))}))}))})),T()(lt()(n),"cameraViewObservable",(function(e){var t=Math.abs(e.beta)<=.01;e.panningAxis=t?new dt.Vector3(1,1,0):new dt.Vector3(1,0,1)})),T()(lt()(n),"createScene",(function(e,t){var o=wo.createScene(e);return n.sceneMemory=Ye()(yt.Maybe).call(yt.Maybe,{engine:e,canvas:t,scene:o,camera:wo.createCamera(o,t,(function(e){return e.onViewMatrixChangedObservable.add((function(){return n.cameraViewObservable(e)}))})),light:wo.createLight(o),ground:wo.createMeshGround(o),gizmoManager:wo.createGizmo(o),highlightLayer:{hl:new dt.HighlightLayer("hl1",o),lastHlMesh:null}}),o})),T()(lt()(n),"componentDidUpdate",(function(e){var t=[{propVar:function(e){return e.sceneName.Value},action:function(){return n.sceneName=n.props.sceneName.Value}},{propVar:function(e){return e.focusObject.Value},action:n.setCameraToTarget}];J()(t).call(t,(function(t){var o=t.propVar,r=t.action;o(n.props)!==o(e)&&r()}))})),T()(lt()(n),"componentDidMount",(function(){console.log("SceneViewer Did Mount!!"),n.loadScene()})),n.sceneName=e.sceneName.Value,n.sceneMemory=yt.Maybe.none(),n.objectTree=[],n}return ut()(t,e),tt()(t,[{key:"render",value:function(){return r.a.createElement(pt,{createScene:this.createScene,is2render:!1})}}],[{key:"getComponentFactory",value:function(e){return function(n){var o=function(e){for(var t=1;t<arguments.length;t++){var n,o=null!=arguments[t]?arguments[t]:{};if(t%2)b()(n=Br(Object(o),!0)).call(n,(function(t){T()(e,t,o[t])}));else if(p.a)d()(e,p()(o));else{var r;b()(r=Br(Object(o))).call(r,(function(t){h()(e,t,M()(o,t))}))}}return e}({sceneName:e},n);return r.a.createElement(t,o)}}}]),t}(o.Component);T()(Dr,"EXTENSION",".3d"),Dr.propTypes={sceneName:c.a.shape({Value:c.a.string}),focusObject:c.a.shape({Value:c.a.string})},Dr.defaultProps={sceneName:{Value:"Pedro"},focusObject:{Value:""}};var Vr=Dr;n.d(t,"Button",(function(){return s})),n.d(t,"AbstractModal",(function(){return B})),n.d(t,"Drawer",(function(){return I})),n.d(t,"Collapse",(function(){return K})),n.d(t,"VerticalBar",(function(){return ne})),n.d(t,"ContextMenu",(function(){return ce})),n.d(t,"Table",(function(){return Ue})),n.d(t,"SceneViewer",(function(){return Vr}))}])}));