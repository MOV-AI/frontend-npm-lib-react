!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MovaiReact=t():e.MovaiReact=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=145)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/defineProperty")},function(e,t){e.exports=require("@babylonjs/core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/assertThisInitialized")},function(e,t){e.exports=require("prop-types")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/getPrototypeOf")},function(e,t,n){"use strict";var o=n(17),r=n.n(o),a=n(7),i=n.n(a),c=n(9),u=n.n(c),s=n(1),l=n.n(s),f=n(2),d=n(27),h=function(){function e(t){var n=this;if(i()(this,e),l()(this,"normalize",(function(){var e=n.length();if(0===e)throw new Error("You can't normalize a zero norm vector");return n.scale(1/e)})),t.constructor!==Array||t.length<3)throw new Error("".concat(t," is not a valid 3-vector"));this.vec3=r()(t)}return u()(e,[{key:"x",get:function(){return this.vec3[0]}},{key:"y",get:function(){return this.vec3[1]}},{key:"z",get:function(){return this.vec3[2]}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"op",value:function(t,n){var o=[];return o[0]=n(this.vec3[0],t.vec3[0]),o[1]=n(this.vec3[1],t.vec3[1]),o[2]=n(this.vec3[2],t.vec3[2]),new e(o)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"dot",value:function(e){return this.vec3[0]*e.vec3[0]+this.vec3[1]*e.vec3[1]+this.vec3[2]*e.vec3[2]}},{key:"map",value:function(t){return new e(this.vec3.map(t))}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"toBabylon",value:function(){return new f.Vector3(this.vec3[0],this.vec3[1],this.vec3[2])}},{key:"toArray",value:function(){return this.vec3}},{key:"toVec2",value:function(){return new d.a(this.x,this.y)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&e.vec3.map((function(t,n){return e.vec3[n]===t})).reduce((function(e,t){return e&&t}),!0)}},{key:"reduce",value:function(e,t){return this.vec3.reduce(e,t)}},{key:"getMax",value:function(){return this.reduce((function(e,t){return Math.max(e,t)}),-Number.MAX_VALUE)}},{key:"getMin",value:function(){return this.reduce((function(e,t){return Math.min(e,t)}),Number.MAX_VALUE)}},{key:"someNaNOrInfinite",value:function(){return this.vec3.some((function(e){return isNaN(e)||!isFinite(e)}))}}],[{key:"ofBabylon",value:function(t){return new e([t.x,t.y,t.z])}},{key:"of",value:function(t){return new e(t||[0,0,0])}},{key:"fromArray",value:function(t){return e.of(t)}},{key:"random",value:function(){return new e([1,2,3].map(Math.random()))}},{key:"orthogonalBasisFromVector",value:function(t){for(var n=[e.e1,e.e2,e.e3],o=0,r=0;r<3;r++)if(0!==t.vec3[r]){o=r;break}var a=n[(o+1)%3].add(n[o].scale(-t.vec3[(o+1)%3]/t.vec3[o]));a=a.normalize();var i=n[(o+2)%3].add(n[o].scale(-t.vec3[(o+2)%3]/t.vec3[o]));return i=(i=i.normalize()).sub(a.scale(a.dot(i))),{u:t.normalize(),v:a,w:i.normalize()}}}]),e}();l()(h,"ONES",h.of([1,1,1])),l()(h,"ZERO",h.of([0,0,0])),l()(h,"e1",new h([1,0,0])),l()(h,"e2",new h([0,1,0])),l()(h,"e3",new h([0,0,1])),t.a=h},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classCallCheck")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),u=n.n(c),s=n(6),l=n(2),f=function(){function e(t,n,o){r()(this,e);for(var a=[t,n,o],i=0;i<a.length;i++)if(a[i].constructor!==Array||a[i].length<3)throw Error("One of the inputs is not a array");this.mat3=a.map((function(e){return new s.a(e)}))}return i()(e,[{key:"prodVec",value:function(e){for(var t=new s.a([0,0,0]),n=0;n<this.mat3.length;n++)t=t.add(this.mat3[n].scale(e.vec3[n]));return t}},{key:"dotVec",value:function(e){for(var t=[0,0,0],n=0;n<this.mat3.length;n++)t[n]=this.mat3[n].dot(e);return new s.a(t)}},{key:"prod",value:function(t){var n=this.prodVec(t.mat3[0]),o=this.prodVec(t.mat3[1]),r=this.prodVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"dot",value:function(t){var n=this.dotVec(t.mat3[0]),o=this.dotVec(t.mat3[1]),r=this.dotVec(t.mat3[2]);return new e(n.vec3,o.vec3,r.vec3)}},{key:"map",value:function(t){var n=this.mat3[0].map(t),o=this.mat3[1].map(t),r=this.mat3[2].map(t);return new e(n.vec3,o.vec3,r.vec3)}},{key:"equals",value:function(e){return e.constructor===this.constructor&&this.mat3.map((function(t,n){return t.equals(e.mat3[n])})).reduce((function(e,t){return e&&t}),!0)}}],[{key:"ofBabylonMatrix",value:function(t){var n=l.Matrix.GetAsMatrix3x3(t);return new e([n[0],n[1],n[2]],[n[3],n[4],n[5]],[n[6],n[7],n[8]])}},{key:"of",value:function(t,n,o){return new e(t,n,o)}},{key:"eye",value:function(){return new e([1,0,0],[0,1,0],[0,0,1])}}]),e}(),d=n(10),h=function(){function e(t){r()(this,e),this._scene=t,this._isPosition=!1,this._isRotation=!1,this._isBoundingBox=!1,this._isScale=!1,this._usePointerToAttachGizmos=!1}return i()(e,[{key:"isPosition",value:function(e){return this._isPosition=e,this}},{key:"isRotation",value:function(e){return this._isRotation=e,this}},{key:"isBoundingBox",value:function(e){return this._isBoundingBox=e,this}},{key:"isScale",value:function(e){return this._isScale=e,this}},{key:"usePointerToAttachGizmos",value:function(e){return this._usePointerToAttachGizmos=e,this}},{key:"build",value:function(){var e=new l.GizmoManager(this._scene);return e.positionGizmoEnabled=this._isPosition,e.rotationGizmoEnabled=this._isRotation,e.boundingBoxGizmoEnabled=this._isBoundingBox,e.scaleGizmoEnabled=this._isScale,e.usePointerToAttachGizmos=this._usePointerToAttachGizmos,e}}]),e}(),m=function(){function e(t){r()(this,e),this._scene=t,this._sphericalCoordinates=null,this._target=null,this._name="camera".concat(Math.floor(1e3*Math.random()))}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"sphericalCoordinates",value:function(e){return this._sphericalCoordinates=e,this}},{key:"target",value:function(e){return this._target=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a camera, e.g ".concat(e))})),new l.ArcRotateCamera(this._name,this._sphericalCoordinates.x,this._sphericalCoordinates.y,this._sphericalCoordinates.z,this._target,this._scene)}}]),e}(),p=function(){function e(t){r()(this,e),this._scene=t,this._position=null,this._name="light".concat(Math.floor(1e3*Math.random())),this._intensity=1}return i()(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new l.PointLight(this._name,this._position,this._scene);return e.intensity=this._intensity,e}}]),e}(),v=function(){function e(t){r()(this,e),this._scene=t,this._name="referential".concat(Math.floor(1e3*Math.random())),this._isPickable=!0,this._boxParams={isVisible:!0,size:.25},this._size=1}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"boxParams",value:function(e){return this._boxParams=e,this}},{key:"size",value:function(e){return this._size=e,this}},{key:"build",value:function(){var e=this._size,t=l.Mesh.CreateLines("axisX".concat(this._name),[new l.Vector3.Zero,new l.Vector3(e,0,0),new l.Vector3(.95*e,.05*e,0),new l.Vector3(e,0,0),new l.Vector3(.95*e,-.05*e,0)],this._scene);t.color=new l.Color3(1,0,0),t.isPickable=!1;var n=l.Mesh.CreateLines("axisY".concat(this._name),[new l.Vector3.Zero,new l.Vector3(0,e,0),new l.Vector3(-.05*e,.95*e,0),new l.Vector3(0,e,0),new l.Vector3(.05*e,.95*e,0)],this._scene);n.color=new l.Color3(0,1,0),n.isPickable=!1;var o=l.Mesh.CreateLines("axisZ".concat(this._name),[new l.Vector3.Zero,new l.Vector3(0,0,e),new l.Vector3(0,-.05*e,.95*e),new l.Vector3(0,0,e),new l.Vector3(0,.05*e,.95*e)],this._scene);o.color=new l.Color3(0,0,1),o.isPickable=!1;var r=l.MeshBuilder.CreateBox(this._name,{size:this._boxParams.size},this._scene);return r.isVisible=this._boxParams.isVisible,r.isPickable=this._isPickable,t.parent=r,n.parent=r,o.parent=r,r}}]),e}(),g=function(){function e(t){r()(this,e),this._scene=t,this._name="camera".concat(Math.floor(1e3*Math.random())),this._width=1,this._height=1,this._textureSrc=null,this._isPickable=!1}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"textureSrc",value:function(e){return this._textureSrc=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"build",value:function(){var e=l.Mesh.CreateGround(this._name,this._width,this._height,1,this._scene);return e.translate(new l.Vector3(0,-1,0),.1,l.Space.WORLD),this._textureSrc&&(e.material=new l.StandardMaterial("Texture".concat(this._name),this._scene),e.material.ambientTexture=new l.Texture(this._textureSrc,this._scene),e.material.ambientTexture.uScale=1,e.material.ambientTexture.vScale=1),e.isPickable=this._isPickable,e}}]),e}(),y=n(48),b=function(){function e(t,n){r()(this,e),this._mesh=t,this._scene=n,this._name="tooltip".concat(Math.floor(1e3*Math.random())),this._width=null,this._height=null,this._thickness=2,this._linkOffsetX="100px",this._linkOffsetY="-50px",this._background="grey",this._alpha=.7,this._scaleX=0,this._scaleY=0,this._cornerRadius=30,this._text="",this._color="White",this._fontSize=14,this._padding="20px"}return i()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"mesh",value:function(e){return this._mesh=e,this}},{key:"width",value:function(e){return this._width=e,this}},{key:"height",value:function(e){return this._height=e,this}},{key:"linkOffsetX",value:function(e){return this._linkOffsetX=e,this}},{key:"linkOffsetY",value:function(e){return this._linkOffsetY=e,this}},{key:"background",value:function(e){return this._background=e,this}},{key:"alpha",value:function(e){return this._alpha=e,this}},{key:"scaleX",value:function(e){return this._scaleX=e,this}},{key:"scaleY",value:function(e){return this._scaleY=e,this}},{key:"cornerRadius",value:function(e){return this._cornerRadius=e,this}},{key:"text",value:function(e){return this._text=e,this}},{key:"color",value:function(e){return this._color=e,this}},{key:"fontSize",value:function(e){return this._fontSize=e,this}},{key:"padding",value:function(e){return this._padding=e,this}},{key:"build",value:function(){var e=this,t=y.AdvancedDynamicTexture.CreateFullscreenUI("UI");t.useInvalidateRectOptimization=!1;var n=new y.Rectangle(this._name);t.addControl(n),n.thickness=2,this._width&&(n.width=this._width),this._height&&(n.height=this._height),n.linkOffsetX=this._linkOffsetX,n.linkOffsetY=this._linkOffsetY,n.transformCenterX=0,n.transformCenterY=1,n.background=this._background,n.alpha=this._alpha,n.scaleX=this._scaleX,n.scaleY=this._scaleY,n.cornerRadius=this._cornerRadius,n.adaptWidthToChildren=!0,n.adaptHeightToChildren=!0,n.linkWithMesh(this._mesh);var o=new y.TextBlock;o.text=this._text,o.color=this._color,o.fontSize=this._fontSize,o.textVerticalAlignment=y.Control.VERTICAL_ALIGNMENT_TOP,o.textHorizontalAlignment=y.Control.HORIZONTAL_ALIGNMENT_CENTER,n.addControl(o),o.alpha=1/o.parent.alpha,o.paddingTop=this._padding,o.paddingBottom=this._padding,o.paddingLeft=this._padding,o.paddingRight=this._padding,o.resizeToFit=!0;var r=new l.ActionManager(this._scene);this._mesh.actionManager=r;var a=new l.Animation("tooltipAnimation","scaleX",30,l.Animation.ANIMATIONTYPE_FLOAT,l.Animation.ANIMATIONLOOPMODE_CONSTANT),i=new l.Animation("tooltipAnimation","scaleY",30,l.Animation.ANIMATIONTYPE_FLOAT,l.Animation.ANIMATIONLOOPMODE_CONSTANT),c=[{frame:0,value:0},{frame:10,value:1}];return a.setKeys(c),i.setKeys(c),n.animations=[],n.animations.push(a),n.animations.push(i),r.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOverTrigger,(function(t){e._scene.beginAnimation(n,0,10,!1)}))),r.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOutTrigger,(function(t){e._scene.beginAnimation(n,10,0,!1)}))),o}}]),e}(),A=function(){function e(t){r()(this,e),this._scene=t,this._direction=null,this._name="Dlight".concat(Math.floor(1e3*Math.random())),this._intensity=1}return i()(e,[{key:"direction",value:function(e){return this._direction=e,this}},{key:"name",value:function(e){return this._name=e,this}},{key:"intensity",value:function(e){return this._intensity=e,this}},{key:"build",value:function(){Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a light, e.g ".concat(e))}));var e=new l.DirectionalLight(this._name,this._direction.normalize(),this._scene);return e.intensity=this._intensity,e}}]),e}(),w=n(106),M=n.n(w),E=n(25),P=n(58),x=function(){function e(){if(r()(this,e),C)return C;C=this,this.materialCacheBySceneId={},this.count=0}return i()(e,[{key:"hasKey",value:function(e,t){var n=t._uid;return d.Maybe.fromNull(this.materialCacheBySceneId[n]).flatMap((function(t){return k(t[e])})).cata((function(){return!1}),(function(){return!0}))}},{key:"put",value:function(e,t,n){var o=t._uid;return o in this.materialCacheBySceneId||(this.materialCacheBySceneId[o]={}),this.materialCacheBySceneId[o][e]=n,this}},{key:"get",value:function(e,t){var n=this,o=t._uid;return d.Maybe.fromNull(this.materialCacheBySceneId[o]).flatMap((function(t){return k(t[e])})).map((function(e){return n.count++,e}))}},{key:"del",value:function(e){var t=e._uid;t in this.materialCacheBySceneId&&delete this.materialCacheBySceneId[t]}}],[{key:"getInstance",value:function(){return new e}}]),e}(),k=function(e){return d.Maybe.fromNull(e)},C=null,S=x,O=function(){function e(){r()(this,e)}return i()(e,null,[{key:"getGlobalCoordinates",value:function(t,n){if(t.parent&&t.parent.name===E.a.NAME||t.name===E.a.NAME)return s.a.ofBabylon(n);var o=t.parent,r=s.a.ofBabylon(o.position),a=e.getRotationMatrix(o),i=s.a.ofBabylon(o.scaling);return a.prodVec(i.mul(e.getGlobalCoordinates(t.parent,n))).add(r)}},{key:"getParentCoord",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t.parent,a=o?s.a.ofBabylon(r.position):s.a.ZERO,i=e.getRotationMatrix(r),c=s.a.ofBabylon(r.scaling);return i.prodVec(c.mul(n)).add(a)}},{key:"getGlobalCoord",value:function(t,n){if(t.parent&&t.parent.name===E.a.NAME||t.name===E.a.NAME)return n;var o=t.parent,r=s.a.ofBabylon(o.position),a=e.getRotationMatrix(o),i=s.a.ofBabylon(o.scaling),c=a.prodVec(i.mul(s.a.ofBabylon(n))).add(r);return e.getGlobalCoord(o,c.toBabylon())}},{key:"getBabylonCoordinates",value:function(e){return E.a.forwardCoordinates(e)}},{key:"getLocalCoordFromGlobal",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t.parent&&t.parent.name===E.a.NAME||t.name===E.a.NAME)return s.a.ofBabylon(n);var r=t.parent,a=o?s.a.ofBabylon(r.position):s.a.ZERO,i=e.getRotationMatrix(r),c=s.a.ofBabylon(r.scaling);return c.map((function(e){return 1/e})).mul(i.dotVec(e.getLocalCoordFromGlobal(r,n,o).sub(a)))}},{key:"getLocalCoordFromWorld",value:function(t,n){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t.parent)return n;var r=t.parent,a=o?s.a.ofBabylon(r.position):s.a.ZERO,i=e.getRotationMatrix(r),c=s.a.ofBabylon(r.scaling),u=c.map((function(e){return 1/e}));return u.mul(i.dotVec(e.getLocalCoordFromWorld(r,n,o).sub(a)))}},{key:"getRotationMatrix",value:function(e){var t=new l.Matrix,n=d.Maybe.fromNull(null==e?void 0:e.rotationQuaternion);return n.forEach((function(e){return e.toRotationMatrix(t)})),n.orElseRun((function(){l.Quaternion.RotationYawPitchRoll(e.rotation.y,e.rotation.x,e.rotation.z).toRotationMatrix(t)})),f.ofBabylonMatrix(t)}},{key:"showNormals",value:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l.Color3.Red(),r=t.getVerticesData(l.VertexBuffer.NormalKind),a=t.getVerticesData(l.VertexBuffer.PositionKind),i=[],c=0;c<r.length;c+=3){var u=l.Vector3.FromArray(a,c),s=u.add(l.Vector3.FromArray(r,c).scaleInPlace(n));i.push([u.add(t.position),s.add(t.position)])}var f=l.MeshBuilder.CreateLineSystem("normalLines",{lines:i},e);return f.color=o,f.parent=t,f}},{key:"orthogonalBasisFromVector",value:function(e){for(var t=[new l.Vector3(1,0,0),new l.Vector3(0,1,0),new l.Vector3(0,0,1)],n=[e.x,e.y,e.z],o=0,r=0;r<3;r++)if(0!==n[r]){o=r;break}var a=t[(o+1)%3].add(t[o].scale(-n[(o+1)%3]/n[o]));a=a.normalize();var i=t[(o+2)%3].add(t[o].scale(-n[(o+2)%3]/n[o]));return i=(i=i.normalize()).subtract(a.scale(l.Vector3.Dot(a,i))),{u:l.Vector3.FromArray(n).normalize(),v:a,w:i.normalize()}}},{key:"cameraBuilder",value:function(e){return new m(e)}},{key:"gizmoManagerBuilder",value:function(e){return new h(e)}},{key:"meshFromPositionAndFaces",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=new l.VertexData;a.positions=n.flatMap((function(e){return[e.x,e.y,e.z]})),a.indices=o.flatMap((function(e){return e}));var i=new l.Mesh(e,t);return a.applyToMesh(i,r),i}},{key:"triangulatePolygon",value:function(e){for(var t=M()(e.map((function(e){return[e.x,e.y,e.z]})).flatMap((function(e){return e})),null,3),n=t.length/3,o=[],r=0;r<n;r++){var a=3*r;o.push([t[a],t[a+1],t[a+2]])}return o}},{key:"computeOrientation",value:function(e){var t=e.length,n=e.map((function(e){return s.a.ofBabylon(e)})),o=0;return n.forEach((function(e,r){var a=n[(r+1)%t].sub(n[r]);o+=s.a.of([-e.y,e.x,e.z]).dot(a)})),o/2}},{key:"pointAverage",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),l.Vector3.Zero()).scale(1/e.length):l.Vector3.Zero()}},{key:"pointAverageVec3",value:function(e){return e&&0!==e.length?e.reduce((function(e,t){return e.add(t)}),s.a.ZERO).scale(1/e.length):s.a.ZERO}},{key:"randomVector3",value:function(e,t){return new l.Vector3.FromArray([0,0,0].map((function(n){return e+(t-e)*Math.random()})))}},{key:"getMaterialFromColor",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MaterialFromColor".concat(I()),o=new l.StandardMaterial(n,t);return o.diffuseColor=e,o.emissiveColor=e,o}},{key:"setOrthoView",value:function(e,t){e.mode=l.Camera.ORTHOGRAPHIC_CAMERA;var n=t.getEngine().getAspectRatio(e),o=e.position.length();e.orthoLeft=-o/2,e.orthoRight=o/2,e.orthoBottom=e.orthoLeft*n,e.orthoTop=e.orthoRight*n}},{key:"setPerspectiveView",value:function(e,t){e.mode=l.Camera.PERSPECTIVE_CAMERA}},{key:"getArrow",value:function(t,n,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=e.createTubeFromPoints(t,[o,r],l.Color3.Gray(),a,n+"tube"),c=e.createOrientedCone(t,r.subtract(o).normalize().scale(7*a),l.Color3.Gray(),n+"cone");c.position=r;var u=new l.Mesh(n,t);return i.parent=u,c.parent=u,u}},{key:"addTooltipToMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new b(e,t).text(n).build()}},{key:"addClickActionToMesh",value:function(e,t,n){var o=new l.ActionManager(t);e.actionManager=o,o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPickDownTrigger,(function(e){n()}))),o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOverTrigger,(function(t){e.material.unfreeze(),e.material.emissiveColor=l.Color3.Gray()}))),o.registerAction(new l.ExecuteCodeAction(l.ActionManager.OnPointerOutTrigger,(function(t){e.material.emissiveColor=l.Color3.White(),setTimeout((function(){return e.material.freeze()}),10)})))}}]),e}();u()(O,"toGlobalCoord",(function(e){var t=e.getRootNode().item.mesh;return function(e){var n=function(e){return O.getLocalCoordFromWorld({parent:t},s.a.ofBabylon(e)).toBabylon()};return Array.isArray(e)?e.map(n):n(e)}})),u()(O,"createOrientedCone",(function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.Vector3(1,0,0),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"OrientedCone".concat(I()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:16,i={positions:[],faces:[]},c=t.length()/3,u=O.orthogonalBasisFromVector(t),s=u.v,f=u.w,d=Math.sign(l.Vector3.Dot(l.Vector3.Cross(s,f),t)),h=0;h<a;h++){var m=d*(2*Math.PI/a)*h;i.positions.push(s.scale(c*Math.cos(m)).add(f.scale(c*Math.sin(m))))}i.positions.push(l.Vector3.Zero()),i.positions.push(t);for(var p=i.positions.length-1,v=i.positions.length-2,g=0;g<a;g++)i.faces.push([p,(g+1)%a,g]),i.faces.push([v,g,(g+1)%a]);var y=O.meshFromPositionAndFaces(o,e,i.positions,i.faces);y.convertToFlatShadedMesh();var b="OrientedConeMaterial".concat(o);return y.material=L.get(b,e).orLazy((function(){var t=O.getMaterialFromColor(n,e,b);return L.put(b,e,t),t})),y.isPickable=r,y})),u()(O,"createSphere",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Sphere".concat(I()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=l.Mesh.CreateSphere(o,16,n,e),i=O.getMaterialFromColor(t,e,"SphereMaterial".concat(o));return a.material=i,a.isPickable=r,a})),u()(O,"createBox",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.Color3.Gray(),n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:P.a.DEFAULT_SIZE,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Box".concat(I()),r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=l.Mesh.CreateBox(o,n,e),i=new l.StandardMaterial("BoxMaterial".concat(o),e);return i.diffuseColor=t,i.emissiveColor=t,a.material=i,a.isPickable=r,a})),u()(O,"createTubeFromPoints",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Tube".concat(I()),a=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=l.MeshBuilder.CreateTube(r,{path:t,radius:o,sideOrientation:l.Mesh.DOUBLESIDE,updatable:!0,cap:l.Mesh.CAP_ALL},e),c="Material".concat(r);return i.material=L.get(c,e).orLazy((function(){var t=O.getMaterialFromColor(n,e,c);return L.put(c,e,t),t})),i.isPickable=a,i})),u()(O,"positionalLightBuilder",(function(e){return new p(e)})),u()(O,"directionalLightBuilder",(function(e){return new A(e)})),u()(O,"referentialBuilder",(function(e){return new v(e)})),u()(O,"getGroundPosition",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e===t}));return n.hit?d.Maybe.some(n.pickedPoint):d.Maybe.none()})),u()(O,"pickMesh",(function(e,t){var n=e.pick(e.pointerX,e.pointerY,(function(e){return e!==t&&e.isEnabled()}));return n.hit&&n.pickedMesh.isPickable?d.Maybe.some(n.pickedMesh):d.Maybe.none()})),u()(O,"groundBuilder",(function(e){return new g(e)})),u()(O,"piecewiseCurveDistance",(function(e){for(var t=0,n=0;n<e.length-1;n++){t+=e[n+1].subtract(e[n]).length()}return t})),u()(O,"getCurveOrientations",(function(e){for(var t=[],n=0;n<e.length-1;n++){var o=e[n+1].subtract(e[n]);t.push(Math.atan2(o.y,o.x))}return t.push(t[t.length-1]),t})),u()(O,"getSplineFromCurve",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7,n=!1;return{points:l.Curve3.CreateCatmullRomSpline(e,t,n).getPoints()}})),u()(O,"splineObj2redis",(function(e){var t=O.getCurveOrientations(e.points);return e.points.map((function(e,n){return[e.x,e.y,t[n]]}))})),u()(O,"getShaderMaterial",(function(e){var t=e.name,n=void 0===t?"CustomShader".concat(I()):t,o=e.vertex,r=void 0===o?B:o,a=e.frag,i=void 0===a?R:a,c=e.onBindObservable,u=void 0===c?D:c,s=e.preProcessShader,f=void 0===s?F:s;return function(e){var t=new l.ShaderMaterial(n,e,{vertexSource:r,fragmentSource:i},{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","projection"]});return f(e,t),t.onBindObservable.add((function(){u(e,t)})),t}}));var N,T,I=function(){return Math.floor(1e3*Math.random())},B="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n\n    vUV = uv;\n    vPosition = position;\n    vNormal = normal;\n}",R="\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n// Uniforms\nuniform mat4 world;\n\n// Refs\nuniform vec3 cameraPosition;\nuniform vec3 lightPosition;\nuniform float time;\n\nvoid main(void) {\n    vec3 vLightPosition = lightPosition;\n\n    // World values\n    vec3 vPositionW = vec3(world * vec4(vPosition, 1.0));\n    vec3 vNormalW = normalize(vec3(world * vec4(vNormal, 0.0)));\n    vec3 viewDirectionW = normalize(cameraPosition - vPositionW);\n\n    // Light\n    vec3 lightVectorW = normalize(vLightPosition - vPositionW);\n    vec3 color = vec3(0.5,0.,1.);\n\n    // diffuse\n    float ndl = max(0., dot(vNormalW, lightVectorW));\n\n    // Specular\n    vec3 angleW = normalize(viewDirectionW + lightVectorW);\n    float specComp = max(0., dot(vNormalW, angleW));\n    specComp = pow(specComp, max(1., 64.)) * 2.;\n\n    gl_FragColor = vec4(color * ndl + vec3(specComp), 1.);\n}\n",D=(N=0,T=(new Date).getTime(),function(e,t){var n=((new Date).getTime()-T)/1e3;t.setFloat("time",N),t.setVector3("cameraPosition",e.activeCamera.position),e.lights.length>0&&t.setVector3("lightPosition",e.lights[0].position),N+=n,T=(new Date).getTime()}),F=function(e,t){t.backFaceCulling=!1,t.setFloat("time",0),t.setVector3("cameraPosition",e.activeCamera.position),t.setVector3("lightPosition",new l.Vector3(0,20,10))},L=S.getInstance();t.a=O},function(e,t){e.exports=require("@babel/runtime/helpers/esm/createClass")},function(e,t){e.exports=require("monet")},function(e,t){e.exports=require("mov-fe-lib-core")},function(e,t){e.exports=require("@material-ui/core")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/extends")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/inherits")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/get")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/toConsumableArray")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/slicedToArray")},function(e,t){e.exports=require("@material-ui/core/styles")},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n(2),r={RADIUS:.25,POINTS_DENSITY:2,CLOUD_FUNCTION_NAME:"backend.viewer",NAV_CLOUD_NAME:"backend.generate_path",RAD2DEG:180/Math.PI,DEG2RAD:Math.PI/180,DEBUG:!1},a={dark:o.Color3.Black(),light:o.Color3.Gray(),default:o.Color3.Black()};t.b=r},function(e,t){e.exports=require("@babel/runtime/helpers/esm/classPrivateFieldGet")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t,n){"use strict";var o=n(17),r=n.n(o),a=n(7),i=n.n(a),c=n(9),u=n.n(c),s=n(1),l=n.n(s),f=n(36),d=n(6),h=n(10),m=n(74),p=n.n(m),v=n(2),g=n(11),y=function(){function e(){var t=this;if(i()(this,e),l()(this,"getAnnotations",(function(){return t.annotations})),b)return b;b=this,this.annotations={},this.observersBySceneId={}}return u()(e,[{key:"load",value:function(){return this.retrieveAnnotationsFromDb(),this}},{key:"pushObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&delete this.observersBySceneId[t]}},{key:"retrieveAnnotationsFromDb",value:function(){var e=this;g.MasterDB.subscribe({Scope:"Annotation",Name:"*"},(function(t){console.log("Annotation update",t);var n={del:function(t){return e.delAnnotation(t)},set:function(t){return e.addAnnotation(t)}},o=t.key.Annotation;t.event in n&&(n[t.event](o),Object.keys(e.observersBySceneId).forEach((function(t){return e.observersBySceneId[t].forEach((function(t){return t(e)}))})))}),(function(t){console.log("Annotation start",t);var n=t.value.Annotation;e.addAnnotation(n)}))}},{key:"delAnnotation",value:function(e){var t=this;if(e){var n=Object.keys(e).reduce((function(e,t){return e.push(t),e}),[]);Object.keys(this.annotations).forEach((function(e){var o=t.annotations[e];o.names=o.names.filter((function(e){return!n.includes(e)})),o.labels=o.labels.filter((function(e){return!n.includes(e)}))}))}}},{key:"addAnnotation",value:function(e){var t=this;e&&Object.keys(e).forEach((function(n){var o=e[n];if(o.Type){var r=o.Type.toLowerCase(),a=o.Label;r in t.annotations||(t.annotations[r]={names:[],labels:[]}),t.annotations[r].names.push(n),t.annotations[r].labels.push(a||n)}}))}}],[{key:"getInstance",value:function(){return new e}},{key:"getAnnotations",value:function(){return e.getInstance().getAnnotations()}}]),e}(),b=null,A=y,w=n(25),M=n(20);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(){function e(t){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,e),l()(this,"getType",(function(){return e.TYPE})),l()(this,"getMouseContextActions",(function(e){return[{title:"Copy",onClick:function(){return f.a.copy(n.getCopyFunction())}},{title:"Delete",onClick:function(){return e.getNodeFromTree(n.name).forEach((function(t){return e.onDeleteNode(t,!1)}))}}]})),this.name=t.name,this.mesh=t,this.mesh.getMouseContextActions=this.getMouseContextActions,this.mesh.nodeItem=this,this.keyValueMap=o}return u()(e,[{key:"dispose",value:function(){this.delVertex(),this.mesh.dispose()}},{key:"toDict",value:function(){var e,t,n,o=this;return{name:this.name,type:this.getType(),position:d.a.ofBabylon(null===(e=this.mesh)||void 0===e?void 0:e.position).toArray(),quaternion:h.Maybe.fromNull(null===(t=this.mesh)||void 0===t?void 0:t.rotationQuaternion).map((function(e){return[e.w,e.x,e.y,e.z]})).orLazy((function(){var e=v.Quaternion.RotationYawPitchRoll(o.mesh.rotation.y,o.mesh.rotation.x,o.mesh.rotation.z);return[e.w,e.x,e.y,e.z]})),color:h.Maybe.fromNull(null===(n=this.mesh)||void 0===n?void 0:n.material).flatMap((function(e){return h.Maybe.fromNull(e.diffuseColor).map((function(e){return[e.r,e.g,e.b,o.mesh.visibility]}))})).orSome([0,0,0,1]),keyValueMap:this.keyValueMap,isVisible:this.mesh.isEnabled()}}},{key:"toForm",value:function(){var t=this.toDict(),n=new v.Color3(t.color[0],t.color[1],t.color[2]),o=new v.Quaternion(t.quaternion[1],t.quaternion[2],t.quaternion[3],t.quaternion[0]).toEulerAngles(),r={jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},position:{type:"object",title:"Position",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},rotation:{type:"object",title:"Rotation",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},color:{type:"object",title:"Color",properties:{r:{type:"number"},g:{type:"number"},b:{type:"number"},a:{type:"number"}}}}},uiSchema:{type:{"ui:disabled":!0},color:{"ui:widget":"color"},oldName:{"ui:widget":"hidden"},position:{"ui:widget":"collapse"},rotation:{"ui:widget":"collapse"}},data:{oldName:t.name,name:t.name,type:t.type,position:{x:t.position[0],y:t.position[1],z:t.position[2]},rotation:{x:o.x*M.b.RAD2DEG,y:o.y*M.b.RAD2DEG,z:o.z*M.b.RAD2DEG},color:{r:n.r,g:n.g,b:n.b,a:this.mesh.visibility}}};return e.setAnnotations2Form(r,this.keyValueMap),r}},{key:"ofForm",value:function(e){var t=this;if(this.name=e.name,this.mesh.name=e.name,h.Maybe.fromNull(null==e?void 0:e.position).forEach((function(e){var n=[e.x,e.y,e.z].map(Number.parseFloat);t.mesh.position=v.Vector3.FromArray(n)})),h.Maybe.fromNull(null==e?void 0:e.rotation).forEach((function(e){var n=[e.x,e.y,e.z].map(Number.parseFloat).map((function(e){return e*M.b.DEG2RAD}));t.mesh.rotationQuaternion=v.Quaternion.FromEulerAngles.apply(v.Quaternion,r()(n))})),this.mesh.material){var n=new v.Color3(e.color.r,e.color.g,e.color.b);this.mesh.material.diffuseColor=n,this.mesh.material.emissiveColor=n,this.mesh.visibility=e.color.a}this.keyValueMap=P({},e.annotations)}},{key:"getCopyFunction",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e+"_copy"+f.a.getUID()};return function(o,r){return r.getSceneMemory().map((function(a){var i=a.scene,c=r.getRootNode().item,u=e.toDict();u.name=n(u.name);var s=d.a.ofBabylon(o).toArray();s[2]=u.position[2],u.position=s;var l=e.ofDict(i,u,r);return l.mesh.parent=c.mesh,r.addNodeItem2Tree(l,w.a.NAME,!0,!0,t),l}))}}},{key:"delVertex",value:function(){var e,t=null===(e=this.mesh.graphVertex)||void 0===e?void 0:e.delVertex;if(!t){var n,o=((null===(n=this.mesh)||void 0===n?void 0:n._children)||[]).filter((function(e){return!!e.graphVertex})).map((function(e){return e.graphVertex.delVertex}));t=function(){return o.forEach((function(e){return e()}))}}t()}}],[{key:"mapDict2Mesh",value:function(e,t){if(!t)throw new Error("can't map a null mesh");return h.Maybe.fromNull(e).forEach((function(n){h.Maybe.fromNull(e.name).forEach((function(e){return t.name=e})),h.Maybe.fromNull(n.position).forEach((function(e){return t.position=d.a.of(e).toBabylon()})),h.Maybe.fromNull(n.quaternion).forEach((function(e){var n=new v.Quaternion(e[1],e[2],e[3],e[0]);t.rotationQuaternion=n.normalize()})),h.Maybe.fromNull(n.color).forEach((function(e){var n=new v.Color3(e[0],e[1],e[2]);h.Maybe.fromNull(t.material).forEach((function(e){h.Maybe.fromNull(e.diffuseColor).forEach((function(e){return t.material.diffuseColor=n})),h.Maybe.fromNull(e.emissiveColor).forEach((function(e){return t.material.emissiveColor=n}))}))}))})),t}},{key:"setAnnotations2Form",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.jsonSchema.properties.annotations={title:"Annotations",type:"object",properties:{}},e.uiSchema.annotations={"ui:widget":"collapse"},e.data.annotations=P({},t);var n=A.getAnnotations();["safety","behaviour","localization","navigation"].forEach((function(t){e.jsonSchema.properties.annotations.properties[t]={title:p()(t),type:"string"},e.uiSchema.annotations[t]={"ui:widget":"selectScopeModal","ui:options":{scopeList:"Annotation",name:p()(t),filter:function(e){return n[t]&&n[t].names.includes(e.name)}}}}))}},{key:"randomId",value:function(){return"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}}]),e}();l()(x,"TYPE","NodeItem");t.a=x},function(e,t,n){"use strict";var o=n(14),r=n.n(o),a=n(17),i=n.n(a),c=n(7),u=n.n(c),s=n(9),l=n.n(s),f=n(3),d=n.n(f),h=n(16),m=n.n(h),p=n(15),v=n.n(p),g=n(13),y=n.n(g),b=n(5),A=n.n(b),w=n(1),M=n.n(w),E=n(23),P=n(6),x=n(8),k=n(0),C=n.n(k),S=n(10),O=n(20),N=n(2),T=n(11),I=n(29);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){M()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=A()(e);if(t){var r=A()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y()(this,n)}}var F=O.b.RADIUS,L=function(e){v()(n,e);var t=D(n);function n(e,o,r,a,i){var c,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};return u()(this,n),c=t.call(this,e,l),M()(d()(c),"getType",(function(){return n.TYPE})),c.localPath=o,c.keyPoints=r,c.splinePath=a,c.selectedKeyPointIndex=-1,c.mainView=i,c.weight=s,c}return l()(n,[{key:"toDict",value:function(){var e=m()(A()(n.prototype),"toDict",this).call(this);return e.localPath=this.localPath,e.splinePath=this.splinePath,e.weight=this.weight,e}},{key:"toForm",value:function(){var e=m()(A()(n.prototype),"toForm",this).call(this);if(this.selectedKeyPointIndex>=0){e.jsonSchema.properties.selectedKeyPoint={type:"object",title:"KeyPoint ".concat(this.selectedKeyPointIndex),properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"},z:{type:"number",title:"z"}}},e.uiSchema.selectedKeyPoint={"ui:widget":"collapse"},e.uiSchema.position={"ui:widget":"hidden"},e.uiSchema.rotation={"ui:widget":"hidden"},e.uiSchema.color={"ui:widget":"hidden"},e.uiSchema.annotations={"ui:widget":"hidden"};var t=this.keyPoints[this.selectedKeyPointIndex],o=x.a.getGlobalCoordinates(t,t.position).toArray();return e.data.selectedKeyPoint={x:o[0],y:o[1],z:o[2]},e}var r=R({},e.jsonSchema.properties),a={type:"object",properties:{oldName:r.oldName,name:r.name,type:r.type,weight:{type:"number",title:"Weight"},position:r.position,rotation:r.rotation,color:r.color,annotations:r.annotations}};return e.jsonSchema=a,e.data.weight=this.weight,e}},{key:"ofForm",value:function(e){if(m()(A()(n.prototype),"ofForm",this).call(this,e),this.selectedKeyPointIndex>=0){var t=this.keyPoints[this.selectedKeyPointIndex],o=e.selectedKeyPoint,r=N.Vector3.FromArray([o.x,o.y,o.z].map(Number.parseFloat)),a=x.a.getLocalCoordFromGlobal(t,r).toArray();return t.position=new N.Vector3(a[0],a[1],a[2]),void t.observers.notifyObservers({updatedPointMesh:t,is2updateServer:!1})}this.weight=Number(e.weight),this.updatePathEdgeWithForm(this.weight,this.keyValueMap)}},{key:"updatePathEdgeWithForm",value:function(e,t){var n=this;this.mainView.getGraph().forEach((function(o){var r=o.item,a=r.graph,c=[n.keyPoints[0],n.keyPoints[n.keyPoints.length-1]].filter((function(e){var t;return!(null==e||null===(t=e.graphVertex)||void 0===t||!t.vertex)})).map((function(e){return e.graphVertex.vertex}));if(!(c.length<2)){var u=c.map((function(e){return e.id}));a.getEdge.apply(a,i()(u)).forEach((function(n){var o=n.data;o.weight=e,o.keyValueMap=t})),n.mainView.updateNodeInServer(r.name)}}))}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"getCopyFunction",value:function(e,t){var o=this;return function(r,a){return m()(A()(n.prototype),"getCopyFunction",o).call(o,e,t)(r,a).map((function(e){var t,r,i,c=null==e?void 0:e.keyPoints;return void 0!==c&&[null===(r=(t=o).keyPoints[0])||void 0===r?void 0:r.graphVertex,null===(i=t.keyPoints[t.keyPoints.length-1])||void 0===i?void 0:i.graphVertex].every((function(e){return!!e}))&&n.updateGraph(a,c,e,!0),e}))}}},{key:"importFeatures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new n({},{},{},{},{});this.keyValueMap=e.keyValueMap,this.weight=e.weight}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing path or null mainView");var r=t.name,a=t.localPath.map((function(e){return P.a.of(e).toBabylon()})),i=x.a.getSplineFromCurve(a),c=i.points,u=null;(u=1===c.length?N.MeshBuilder.CreateLines(r,{points:c,updatable:!0},e):x.a.createTubeFromPoints(e,c,N.Color3.Gray(),F/8,r)).position=P.a.of(t.position).toBabylon(),u.material=x.a.getMaterialFromColor(N.Color3.FromArray(t.color),e,"PathMaterial".concat(r)),u.rotationQuaternion=S.Maybe.fromNull(t.quaternion).map((function(e){return new N.Quaternion(e[1],e[2],e[3],e[0]).normalize()})).orSome(N.Quaternion.Identity());var s=x.a.splineObj2redis(i),l=z(e,R(R({},t),{},{mesh:u,splinePath:s}),o),f=new n(u,a.map((function(e){return[e.x,e.y,e.z]})),l,s,o,t.weight,t.keyValueMap);return u.onClick=j(o,f),u.observers=new N.Observable,u.observers.add(V(l)),f}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,o,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:U,c=o.mesh,u=x.a.pointAverage(e);e=e.map((function(e){return e.subtract(u)}));var s=x.a.getSplineFromCurve(e),l=x.a.createTubeFromPoints(t,s.points,N.Color3.Gray(),F/8,c.name),f=x.a.getRotationMatrix(c),d=P.a.ofBabylon(c.scaling),h=f.prodVec(P.a.ofBabylon(u).mul(d)).toBabylon();l.parent=c.parent,l.rotationQuaternion=c.rotationQuaternion,l.position=h.add(c.position),l.material=c.material,l.visibility=c.visibility,l.onClick=c.onClick,l.getMouseContextActions=c.getMouseContextActions,l.nodeItem=c.nodeItem,l.observers=c.observers,o.localPath=e.map((function(e){return P.a.ofBabylon(e).toArray()})),o.splinePath=x.a.splineObj2redis(s),o.mesh=l;var m=i()(o.keyPoints);o.keyPoints=a(t,r,c,o);var p=i()(c._children);return p.filter((function(e){return r.getNodeFromTree(e.name).isJust()})).forEach((function(e){e.parent=o.mesh})),o.mesh.observers.clear(),o.mesh.observers.add(V(o.keyPoints)),n.updateGraph(r,m,o,m.length!==o.keyPoints.length),c.dispose(),o}},{key:"deleteKeyPoint",value:function(e,t,o){var r=t.index,a=t.parent.name;o.getNodeFromTree(a).forEach((function(t){var i=t.item,c=R({},i.mesh.position),u=i.localPath.map((function(e){return P.a.of(e).toBabylon()}));o.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,r,c,u,e,i,o))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,o,r,a,c,u){return T.UndoManager.actionBuilder().doAction((function(){var o=i()(r);o.splice(t,1),n.createNewMeshFromOldUsingNewPoints(o,a,c,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).undoAction((function(t){var s=t.is2UpdateInServer,l=void 0===s||s,f=i()(r);c.mesh.position=o,n.createNewMeshFromOldUsingNewPoints(f,a,c,u,n.onAddNewPointKeyPointUpdate),l&&u.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,o){return z(e,o,t)}},{key:"addKeyPointInBetween",value:function(e,t,o,r){var a=t.index,i=t.parent.name;o.getNodeFromTree(i).forEach((function(t){var c=t.item,u=c.localPath.map((function(e){return P.a.of(e).toBabylon()})),s=R({},c.mesh.position);o.getUndoManager().doIt(n.getUndoAddKeyPointInBetween(i,a,r,c,u,s,e,o))}))}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,o,r,a,c,u,s){return T.UndoManager.actionBuilder().doAction((function(){var c=t+o,l=r.localPath.length,f=[],d=i()(a);if(c<0)f=[d[0].scale(3).subtract(d[1]).scale(.5)].concat(d);else if(c>l-1)f=d.concat([d[l-1].scale(3).subtract(d[l-2]).scale(.5)]);else{for(var h=t+Math.max(0,o),m=0;m<h;m++)f.push(d[m]);f.push(d[c].add(d[t]).scale(.5));for(var p=h;p<l;p++)f.push(d[p])}n.createNewMeshFromOldUsingNewPoints(f,u,r,s,n.onAddNewPointKeyPointUpdate),s.updateNodeInServer(e)})).undoAction((function(t){var o=t.is2UpdateInServer,l=void 0===o||o,f=i()(a);r.mesh.position=c,n.createNewMeshFromOldUsingNewPoints(f,u,r,s,n.onAddNewPointKeyPointUpdate),l&&s.updateNodeInServer(e)})).build()}},{key:"updateGraph",value:function(e,t,n,o){o&&e.getGraph().forEach((function(o){var r=o.item,a=n.keyPoints,i=[a[0],a[a.length-1]],c=[],u=[t[0],t[t.length-1]];r.getEdge.apply(r,u).forEach((function(t){u.forEach((function(e){var t=[];r.getNeighbors(e).filter((function(t){return!r.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){t.push({edge:r.getEdge(e,n.mesh),vertex:n})})),c.push(t)})),u.forEach((function(e){return r.delVertexFromMesh(e)})),r.addEdge.apply(r,i),r.getEdge.apply(r,i).forEach((function(e){e.importFeatures(t)})),c.forEach((function(e,t){e.forEach((function(e){r.addEdge(i[t],e.vertex.mesh),r.getEdge(i[t],e.vertex.mesh).forEach((function(t){return e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),e.updateNodeInServer(r.name)}))}))}},{key:"isKeyPointMesh",value:function(e,t){return Number.isInteger(e.index)&&t.getNodeFromTree(e.parent.name).filter((function(e){return e.item.getType()===n.TYPE})).orSome(!1)}},{key:"areKeyPointsCompatible",value:function(e,t,n){return n.getNodeFromTree(e.parent.name).flatMap((function(o){var r=o.item;return n.getNodeFromTree(t.parent.name).map((function(n){var o=n.item,a=e.index,i=t.index,c=r.localPath.length,u=o.localPath.length;return!(0!==a&&a!==c-1||0!==i&&i!==u-1)&&!((a=0===a?1:-1)*(i=0===i?1:-1)>0)}))})).orSome(!1)}},{key:"mergePaths",value:function(e,t,o,r){r.getNodeFromTree(e).forEach((function(e){var a=e.item;r.getNodeFromTree(t).forEach((function(e){var t=e.item,i=a.mesh.parent,c=a.mesh._children.filter((function(e){return void 0===e.index})),u=t.mesh._children.filter((function(e){return void 0===e.index})),s=a.toDict(),l=t.keyPoints.splice(1).map((function(e){return x.a.getLocalCoordFromWorld({parent:a.mesh},P.a.ofBabylon(e.absolutePosition))}));s.name=o,s.localPath=s.localPath.concat(l.map((function(e){return e.toArray()})));var f=x.a.pointAverageVec3(s.localPath.map((function(e){return P.a.of(e)})));s.localPath=s.localPath.map((function(e){return P.a.of(e).sub(f).toArray()})),r.getSceneMemory().forEach((function(e){var o=e.scene,l=n.ofDict(o,s,r);l.mesh.parent=i,l.mesh.translate(f.toBabylon(),1,N.Space.LOCAL),l.importFeatures(),r.addNodeItem2Tree(l,i.name),n.addEdgesInKeyPoints(l.keyPoints,o,r),c.forEach((function(e){r.getNodeFromTree(e.name).forEach((function(t){var n=t.item;r.updateNodeItemInTree(n,l.name);var o=x.a.getLocalCoordFromWorld({parent:l.mesh},P.a.ofBabylon(e.absolutePosition));e.position=o.toBabylon(),e.parent=l.mesh}))})),u.forEach((function(e){r.getNodeFromTree(e.name).forEach((function(t){var n=t.item;r.updateNodeItemInTree(n,l.name);var o=x.a.getLocalCoordFromWorld({parent:l.mesh},P.a.ofBabylon(e.absolutePosition));e.position=o.toBabylon(),e.parent=l.mesh}))})),r.deleteNodeFromTreeUsingName(a.name),r.deleteNodeFromTreeUsingName(t.name)}))}))}))}},{key:"unMergePaths",value:function(e,t,o){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.forEach((function(e){o.getSceneMemory().forEach((function(t){var a=t.scene,i=n.ofDict(a,e.dict,o);i.mesh.parent=e.parent,o.addNodeItem2Tree(i,e.parent.name,r),n.addEdgesInKeyPoints(i.keyPoints,a,o,r),e.children.forEach((function(e){o.getNodeFromTree(e.name).forEach((function(t){var n=t.item;o.updateNodeItemInTree(n,i.name,r);var a=x.a.getLocalCoordFromWorld({parent:i.mesh},P.a.ofBabylon(e.absolutePosition));e.position=a.toBabylon(),e.parent=i.mesh}))}))}))})),o.deleteNodeFromTreeUsingName(t,r)}},{key:"addEdgesInKeyPoints",value:function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];I.a.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var r=t.item,a=[e[0],e[e.length-1]];r.addEdge.apply(r,a),o&&n.updateNodeInServer(r.name)}))}}]),n}(E.a);M()(L,"TYPE","Path"),t.a=L;var j=function(e,t){return function(){e.closeContextDial(),e.getNodeFromTree(t.name).forEach((function(e){return e.item.selectedKeyPointIndex=-1}))}},V=function(e){return function(t){t.updatedPointMesh;var n=t.is2updateServer,o=t.displacement;e.forEach((function(e){e.graphVertex&&e.graphVertex.vertexObs({updatedPointMesh:e,is2updateServer:n,displacement:o})}))}};function U(e,t,n,o){var r=i()(n._children),a=o.splinePath.map((function(e){return new N.Vector3(e[0],e[1],0)}));return r.forEach((function(e){e.parent=o.mesh})),o.keyPoints.map((function(t,r){(t.index=r,t.name="".concat(n.name,"keyPointSpline").concat(r),t.position=P.a.of(o.localPath[r]).toBabylon(),t.rotationQuaternion=N.Quaternion.Identity(),n.graphVertex&&(t.graphVertex=n.graphVertex),r>0&&r<o.keyPoints.length-1)&&(t._children.forEach((function(e){return e.dispose()})),K(e,t.material.diffuseColor,o.mesh,r,a,t.position)().parent=t);return t}))}var z=function(e,t,n){var o=new N.Color3(.25,.25,.25),a=[],i=t.localPath.map((function(e){return P.a.of(e).toBabylon()})),c=t.splinePath.map((function(e){return new N.Vector3(e[0],e[1],0)})),u=t.mesh;return i.forEach((function(t,r){var s,l,f=G(e,o,u,r),d=0===r||r===i.length-1?f():(s=K(e,o,u,r,c,t)(),(l=G(e,o,u,r)()).visibility=.1,s.parent=l,l);d.parent=u,d.position=t,d.index=r,d.observers=new N.Observable,a.push(d),d.observers.add(function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;n.displacement;o.parent&&t.getNodeFromTree(o.parent.name).forEach((function(n){var a=n.item,i=o.index,c=a.mesh,u=a.localPath.map((function(e){return P.a.of(e).toBabylon()}));u[i]=o.position,L.createNewMeshFromOldUsingNewPoints(u,e,a,t),i>0&&i<u.length-1&&t.highlightMeshesInScene([a.keyPoints[i]._children[0]]),r&&(t.updateNodeInServer(c.name),t.setProperties(a.toForm()))}))}}(e,n))})),a.forEach((function(o){o.onClick=function(){n.setContextActions(function(e,t,n){var o=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){2!==n.item.localPath.length&&o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-trash"},e))},action:function(n){L.deleteKeyPoint(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-less-than"},e))},action:function(n){L.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),o.push({icon:function(e){return C.a.createElement("i",r()({className:"fas fa-greater-than"},e))},action:function(n){L.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),o}(e,o,n)),n.getNodeFromTree(o.parent.name).forEach((function(e){e.item.selectedKeyPointIndex=o.index,n.setProperties(e.item.toForm())}))},o.getMouseContextActions=function(e,t,n){return function(o){var r=[];return o.getNodeFromTree(n).forEach((function(n){var a=n.item,i=a.localPath.length;i<=2||t.index>0&&t.index<i-1&&r.push({title:"Split curve",onClick:function(){o.getUndoManager().doIt(T.UndoManager.actionBuilder().doAction((function(){!function(e,t,n,o){e.getGraph().forEach((function(r){var a=r.item;e.getNodeFromTree(o).forEach((function(r){var i=r.item,c=[[],[]],u=i.localPath,s=P.a.ofBabylon(i.mesh.position),l=null==i?void 0:i.mesh.parent,f=n.index,d=[[],[]];u.forEach((function(e,t){t<=f?d[0].push(e):(t===f+1&&d[1].push(u[f]),d[1].push(e))}));var h=i.keyPoints,m=[h[0],h[h.length-1]];m.forEach((function(e,t){a.getNeighbors(e).filter((function(t){return!a.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){c[t].push({edge:a.getEdge(e,n.mesh),vertex:n})}))})),m.forEach((function(e){a.delVertexFromMesh(e)})),e.deleteNodeFromTreeUsingName(o),d.forEach((function(n,r){var u=x.a.pointAverage(n.map((function(e){return P.a.of(e).toBabylon()}))),f=n.map((function(e){return P.a.of(e).sub(P.a.ofBabylon(u)).toBabylon()})),d=[];i.mesh.material.diffuseColor.toArray(d);var h=i.mesh.rotationQuaternion.clone()||N.Quaternion.Identity(),m=[h.w,h.x,h.y,h.z],p=L.ofDict(t,{name:0===r?o:"".concat(o,"_split").concat(q++),position:s.toArray(),quaternion:m,color:d,localPath:f.map((function(e){return P.a.ofBabylon(e).toArray()}))},e);p.mesh.translate(u,1,N.Space.LOCAL),p.mesh.parent=l,p.importFeatures(i),e.addNodeItem2Tree(p,l.name);var v=p.keyPoints,g=[v[0],v[v.length-1]];a.addEdge.apply(a,g),a.getEdge.apply(a,g).forEach((function(e){e.importFeatures(p)})),c[r].forEach((function(e){a.addEdge(g[r],e.vertex.mesh),a.getEdge(g[r],e.vertex.mesh).forEach((function(t){e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),e.updateNodeInServer(a.name)}))}))}(o,e,t,a.name)})).undoAction((function(t){var n=t.is2UpdateInServer;!function(e,t,n){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e.getGraph().forEach((function(r){var a=r.item,i=n.name,c="".concat(i,"_split").concat(--q);e.getNodeFromTree(i).forEach((function(r){var u=r.item;e.getNodeFromTree(c).forEach((function(r){var s=r.item,l=u.mesh.parent,f=[[],[]],d=[u.keyPoints[0],s.keyPoints[s.keyPoints.length-1]];d.forEach((function(e,t){a.getNeighbors(e).filter((function(t){return!a.doMeshesBelong2SamePath(e,t.mesh)})).forEach((function(n){f[t].push({edge:a.getEdge(e,n.mesh),vertex:n})}))})),d.forEach((function(e){a.delVertexFromMesh(e)})),e.deleteNodeFromTreeUsingName(i,o),e.deleteNodeFromTreeUsingName(c,o);var h=[];n.mesh.material.diffuseColor.toArray(h);var m=L.ofDict(t,{name:i,position:P.a.ofBabylon(n.mesh.position).toArray(),color:h,localPath:n.localPath},e);m.mesh.parent=l,m.importFeatures(n),e.addNodeItem2Tree(m,l.name,o);var p=m.keyPoints,v=[p[0],p[p.length-1]];a.addEdge.apply(a,v),a.getEdge.apply(a,v).forEach((function(e){e.importFeatures(m)})),f.forEach((function(e,t){e.forEach((function(e){a.addEdge(v[t],e.vertex.mesh),a.getEdge(v[t],e.vertex.mesh).forEach((function(t){e.edge.forEach((function(e){t.importFeatures(e)}))}))}))})),o&&e.updateNodeInServer(a.name)}))}))}))}(o,e,a,void 0===n||n)})).build())}})})),r.push({title:"Delete point",onClick:function(){L.deleteKeyPoint(e,t,o)}}),r}}(e,o,t.name)})),a};function K(e,t,n,o,r,a){return function(){var i=r.map((function(e){return a.subtract(e).length()})).reduce((function(e,t,n){return e.value<t?e:{value:t,index:n}}),{value:Number.MAX_VALUE,index:-1}).index,c=r[i+1]?r[i+1]:r[i],u=r[i],s=c.subtract(u).normalize().scale(F);return x.a.createOrientedCone(e,s,t,"".concat(n.name,"keyPointCone").concat(o),!1)}}function G(e,t,n,o){return function(){return x.a.createSphere(e,t,F,"".concat(n.name,"keyPointSpline").concat(o),!0)}}var q=0},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(3),u=n.n(c),s=n(16),l=n.n(s),f=n(15),d=n.n(f),h=n(13),m=n.n(h),p=n(5),v=n.n(p),g=n(1),y=n.n(g),b=n(23),A=n(6),w=n(8),M=n(10),E=n(2);function P(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m()(this,n)}}var x=-Math.PI/2,k={position:[0,0,0],scaling:[1,-1,1],quaternion:[Math.cos(x/2),Math.sin(x/2),0,0]},C=function(e){d()(n,e);var t=P(n);function n(e){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r()(this,n),o=t.call(this,e,a),y()(u()(o),"getType",(function(){return n.TYPE})),o}return i()(n,[{key:"toForm",value:function(){var e=l()(v()(n.prototype),"toForm",this).call(this);return e.uiSchema.name={"ui:disabled":!0},e}},{key:"getMouseContextActions",value:function(){return[]}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=n.getRosOrigin(e),r=w.a.referentialBuilder(e).name(n.NAME).isPickable(!0).boxParams({isVisible:!0,size:.25}).build();return r.parent=o,b.a.mapDict2Mesh(t,r),new n(r,M.Maybe.fromNull(t).flatMap((function(e){return M.Maybe.fromNull(e.keyValueMap)})).orUndefined())}},{key:"getRosOrigin",value:function(e){var t=E.MeshBuilder.CreateBox("ROS_ORIGIN",{size:.001},e);t.isVisible=!1,t.isPickable=!1,t.position=A.a.of(k.position).toBabylon(),t.scaling=A.a.of(k.scaling).toBabylon();var n=new E.Quaternion(k.quaternion[1],k.quaternion[2],k.quaternion[3],k.quaternion[0]);return t.rotationQuaternion=n.normalize(),t}},{key:"inverseCoordinates",value:function(e){var t=k.quaternion,n=w.a.getRotationMatrix({rotationQuaternion:new E.Quaternion(t[1],t[2],t[3],t[0])}),o=A.a.of(k.scaling).map((function(e){return 1/e})),r=A.a.of(k.position);return o.mul(n.dotVec(A.a.ofBabylon(e).sub(r))).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}},{key:"forwardCoordinates",value:function(e){var t=k.quaternion,n=w.a.getRotationMatrix({rotationQuaternion:new E.Quaternion(t[1],t[2],t[3],t[0])}),o=A.a.of(k.scaling),r=A.a.of(k.position);return n.prodVec(o.mul(A.a.ofBabylon(e))).add(r).map((function(e){return Math.abs(e)<1e-5?0:e})).toBabylon()}}]),n}(b.a);y()(C,"TYPE","GlobalRef"),y()(C,"NAME","Global ref"),t.a=C},function(e,t){e.exports=require("@babel/runtime/helpers/esm/asyncToGenerator")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),u=n.n(c),s=function(){function e(t,n){r()(this,e),this.vec=[t,n].map((function(e){return e||0}))}return i()(e,[{key:"x",get:function(){return this.vec[0]}},{key:"y",get:function(){return this.vec[1]}},{key:"toArray",value:function(){return this.vec}},{key:"add",value:function(e){return this.op(e,(function(e,t){return e+t}))}},{key:"sub",value:function(e){return this.op(e,(function(e,t){return e-t}))}},{key:"mul",value:function(e){return this.op(e,(function(e,t){return e*t}))}},{key:"div",value:function(e){return this.op(e,(function(e,t){return e/t}))}},{key:"dot",value:function(e){return this.vec.reduce((function(t,n,o){return t+n*e.vec[o]}),0)}},{key:"prod",value:function(t){return new e(this.x*t.x-this.y*t.y,this.x*t.y+this.y*t.x)}},{key:"length",value:function(){return Math.sqrt(this.dot(this))}},{key:"normalize",value:function(){return this.scale(1/this.length())}},{key:"dual",value:function(){return new e(-this.y,this.x)}},{key:"sym",value:function(){return this.scale(-1)}},{key:"conj",value:function(){return new e(this.x,-this.y)}},{key:"scale",value:function(e){return this.map((function(t){return t*e}))}},{key:"map",value:function(t){return e.fromArray(this.vec.map(t))}},{key:"op",value:function(t,n){return e.fromArray(this.vec.map((function(e,o){return n(e,t.vec[o])})))}},{key:"reduce",value:function(e,t){return this.vec.reduce(e,t)}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}},{key:"toString",value:function(){return"{x: ".concat(this.x,", y:").concat(this.y,"}")}}],[{key:"fromArray",value:function(t){if(t.length<2)throw new Error("array must have size > 2");return new e(t[0],t[1])}},{key:"of",value:function(t,n){return new e(t,n)}},{key:"ofBabylon",value:function(t){return new e(t.x,t.y)}}]),e}();u()(s,"ZERO",new s(0,0)),u()(s,"e1",new s(1,0)),u()(s,"e2",new s(0,1)),t.a=s},function(e,t){e.exports=require("lodash/get")},function(e,t,n){"use strict";var o=n(18),r=n.n(o),a=n(17),i=n.n(a),c=n(14),u=n.n(c),s=n(7),l=n.n(s),f=n(9),d=n.n(f),h=n(3),m=n.n(h),p=n(16),v=n.n(p),g=n(15),y=n.n(g),b=n(13),A=n.n(b),w=n(5),M=n.n(w),E=n(1),P=n.n(E),x=n(23),k=n(8),C=n(2),S=n(20),O=n(108),N=n(21),T=n.n(N),I=n(10),B=new WeakMap,R=new WeakMap,D=new WeakMap,F=function(){function e(){l()(this,e),B.set(this,{writable:!0,value:{}}),R.set(this,{writable:!0,value:{}}),D.set(this,{writable:!0,value:{}})}return d()(e,[{key:"addVertex",value:function(e){e in T()(this,R)||(T()(this,R)[e]={},T()(this,B)[e]={})}},{key:"delVertex",value:function(t){var n=this;t in T()(this,R)&&(delete T()(this,R)[t],Object.keys(T()(this,B)[t]).forEach((function(o){delete T()(n,D)[e.edgeKey(t,o)],delete T()(n,D)[e.edgeKey(o,t)]})),delete T()(this,B)[t],Object.keys(T()(this,B)).forEach((function(e){t in T()(n,B)[e]&&delete T()(n,B)[e][t]})))}},{key:"addEdge",value:function(t,n){this.addVertex(t),this.addVertex(n);var o=this.getEdge(t,n).orSome({});return T()(this,D)[e.edgeKey(t,n)]=o,T()(this,D)[e.edgeKey(n,t)]=o,T()(this,B)[t][n]=!0,T()(this,B)[n][t]=!0,this}},{key:"delEdge",value:function(t,n){var o=this,r=e.edgeKey(t,n),a=e.edgeKey(n,t);(r in T()(this,D)||a in T()(this,D))&&(delete T()(this,D)[r],delete T()(this,D)[a],delete T()(this,B)[t][n],delete T()(this,B)[n][t]),[t,n].forEach((function(e){0===o.getNeighbors(e).length&&o.delVertex(e)}))}},{key:"hasEdge",value:function(e,t){return this.getEdge(e,t).isSome()}},{key:"getNeighbors",value:function(e){return e in T()(this,B)?Object.keys(T()(this,B)[e]):[]}},{key:"getEdge",value:function(t,n){var o=e.edgeKey(t,n);return o in T()(this,D)?I.Maybe.some(T()(this,D)[o]):I.Maybe.none()}},{key:"getVertex",value:function(e){return e in T()(this,R)?I.Maybe.some(T()(this,R)[e]):I.Maybe.none()}},{key:"getEdges",value:function(){return T()(this,D)}},{key:"getVertices",value:function(){return T()(this,R)}},{key:"getAdjMap",value:function(){return T()(this,B)}}]),e}();P()(F,"edgeKey",(function(e,t){return"".concat(e,"_").concat(t)})),P()(F,"key2Edge",(function(e){return e.split("_")}));var L=F,j=n(6),V=n(0),U=n.n(V),z=n(28),K=n.n(z),G=n(11),q=n(24);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){P()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=M()(e);if(t){var r=M()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return A()(this,n)}}var Y=function(e){y()(n,e);var t=H(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.NAME,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};l()(this,n);var c=e.getUniqueId();if(c in Q&&!Q[c].mesh.isDisposed())return A()(r,Q[c]);var s=Z(e,a);return s.onClick=function(){return r.graphFormMapper=r.getDefaultFormMapper()},r=t.call(this,s,i),P()(m()(r),"getType",(function(){return n.TYPE})),P()(m()(r),"getEdgeMouseCtxActions",(function(e){return function(){return[{title:"Delete",onClick:function(){return r.mainView.getUndoManager().doIt(r.getUndoDeleteEdge(e))}}]}})),P()(m()(r),"getEdgeObs",(function(){return function(e){var t=e.updatedPointMesh,n=e.is2updateServer,o=e.displacement,a=j.a.ofBabylon(o),i=k.a.getLocalCoordFromWorld(r.mesh,a,!1);t.position=t.position.add(i.scale(-1).toBabylon()),n&&(r.graphFormMapper=r.getToFormEdge(t),r.mainView.setProperties(r.toForm()))}})),P()(m()(r),"getOnClickEdge",(function(e){return function(){var t=[];t.push({icon:function(e){return U.a.createElement("i",u()({className:"fas fa-trash"},e))},action:function(){r.mainView.getUndoManager().doIt(r.getUndoDeleteEdge(e))},name:"Delete Edge [Del]"}),r.mainView.setContextActions(t)}})),P()(m()(r),"isMeshBelong2Path",(function(e){var t=e.parent;return r.mainView.getNodeFromTree(null==t?void 0:t.name).filter((function(e){return e.item.getType()===q.a.TYPE})).orSome(!1)})),P()(m()(r),"exportBelongToData",(function(e){var t,n=e.index,o=e.name;return null==n?{name:o}:r.mainView.getNodeFromTree(null==e||null===(t=e.parent)||void 0===t?void 0:t.name).map((function(e){return{name:e.item.name,index:n>0?-1:n}})).orUndefined()})),Q[c]=m()(r),r.graph=new L,r.scene=e,r.mainView=o,r.meshByEdgeId={},r.graphFormMapper=r.getDefaultFormMapper(),r.vertexGenerator=0,r}return d()(n,[{key:"toDict",value:function(){var e=this,t=v()(M()(n.prototype),"toDict",this).call(this),o=this.graph,a=_({},o.getVertices()),c=_({},o.getEdges());return Object.keys(a).forEach((function(e){o.getVertex(e).forEach((function(t){var n=t.data;a[e]={position:j.a.ofBabylon(n.position).toArray(),id:String(e)}}))})),Object.keys(c).forEach((function(t){var n=L.key2Edge(t);o.getEdge.apply(o,i()(n)).forEach((function(o){var a=o.data,u=n.map((function(e){return Number(e)})),s=r()(u,2),l=s[0],f=s[1],d=a.edge.map((function(e){return e.mesh})),h=r()(d,2),m=h[0],p=h[1];c[t]={ids:n,keyValueMap:a.keyValueMap,weight:a.weight,belongsSrc:l<f?e.exportBelongToData(m):e.exportBelongToData(p),belongsTrg:l<f?e.exportBelongToData(p):e.exportBelongToData(m)},e.doMeshesBelong2SamePath.apply(e,i()(d))?l>f&&delete c[t]:e.checkInvalidEdges.apply(e,i()(d).concat([c[t]]))&&delete c[t]}))})),t.vertices=a,t.edges=c,t}},{key:"toForm",value:function(){var e=v()(M()(n.prototype),"toForm",this).call(this);return delete e.jsonSchema.properties.position,delete e.jsonSchema.properties.rotation,delete e.jsonSchema.properties.color,delete e.uiSchema.position,delete e.uiSchema.rotation,delete e.uiSchema.color,delete e.data.position,delete e.data.rotation,delete e.data.color,this.graphFormMapper.toForm(e)}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.graphFormMapper.ofForm(e)}},{key:"getDefaultFormMapper",value:function(){var e=this;return{toForm:function(e){return e},ofForm:function(t){return e.keyValueMap=_({},t.annotations)}}}},{key:"getToFormEdge",value:function(e){var t=this.graph;return{toForm:function(n){return t.getEdge.apply(t,i()(e.edgeIndexes)).map((function(t){var o=t.data;return n.jsonSchema.properties.weight={type:"number",title:"Weight"},n.data.weight=o.weight,x.a.setAnnotations2Form(n,o.keyValueMap),n.jsonSchema.properties.annotations.title="Annotations Edge ".concat(e.edgeIndexes),n})).orSome(n)},ofForm:function(n){var o=e.edgeIndexes;t.getEdge.apply(t,i()(o)).forEach((function(e){var t=e.data;t.keyValueMap=_({},K()(n,"annotations",{})),t.weight=Number.parseFloat(n.weight)}))}}}},{key:"delVertex",value:function(){var e=this.mainView.getRootNode();this.delVertexRecursively(null==e?void 0:e.children)}},{key:"addEdge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=r()(n,2),a=o[0],i=o[1];if(!this.hasEdge(e,t))return this.buildVertex(e,a),this.buildVertex(t,i),this.buildEdge(e,t),this}},{key:"getEdge",value:function(e,t){var n=this.graph,o=[e,t].map(this.getVertexIdFromMesh),a=r()(o,2),i=a[0],c=a[1];return n.getEdge(i,c).map((function(e){return e.data}))}},{key:"delEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t].map(this.getVertexIdFromMesh),i=r()(a,2),c=i[0],u=i[1];o.getEdge(c,u).forEach((function(e){e.data;var t=L.edgeKey(c,u),r=L.edgeKey(u,c);I.Maybe.fromNull(n.meshByEdgeId[t]).forEach((function(e){e.dispose(),delete n.meshByEdgeId[t],delete n.meshByEdgeId[r]})),o.delEdge(c,u)})),this.mainView.setProperties()}},{key:"hasEdge",value:function(e,t){var n=[e,t].map(this.getVertexIdFromMesh),o=r()(n,2),a=o[0],i=o[1];return this.graph.hasEdge(a,i)}},{key:"delVertexFromMesh",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=this.graph,r=this.getVertexIdFromMesh(e);o.getVertex(r).forEach((function(a){o.getNeighbors(r).map((function(e){return o.getVertex(e)})).forEach((function(n){return n.forEach((function(n){var o=n.data.mesh;t.delEdge(e,o)}))})),o.delVertex(r),e.graphVertex=void 0,n&&t.mainView.updateNodeInServer(t.name)}))}},{key:"getVertex",value:function(e){var t=this.graph,n=this.getVertexIdFromMesh(e);return t.getVertex(n).map((function(e){return e.data}))}},{key:"getNeighbors",value:function(e){var t=this.graph,n=this.getVertexIdFromMesh(e);return t.getNeighbors(n).map((function(e){return t.getVertex(e).orNull()})).map((function(e){return e.data})).filter((function(e){return!!e}))}},{key:"doMeshesBelong2SamePath",value:function(e,t){var n,o,r=null==e||null===(n=e.parent)||void 0===n?void 0:n.nodeItem,a=null==t||null===(o=t.parent)||void 0===o?void 0:o.nodeItem;return!!r&&!!a&&r.name===a.name&&r.getType()===q.a.TYPE&&a.getType()===q.a.TYPE}},{key:"updateVertexPosition",value:function(e,t){var n=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=this.graph;a.getVertex(e).forEach((function(e){e.data.position=t})),a.getNeighbors(e).forEach((function(t){var i=e,c=L.edgeKey(i,t);n.meshByEdgeId[c]&&n.meshByEdgeId[c].dispose(),a.getEdge(i,t).forEach((function(e){var t=e.data,o=r()(t.edge,2),a=o[0],i=o[1];n.buildEdge(a.mesh,i.mesh)})),o&&n.mainView.updateNodeInServer(n.name)}))}},{key:"delVertexRecursively",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.forEach((function(t){t.item.getType()!==n.TYPE&&(t.item.delVertex(),e.delVertexRecursively(t.children))}))}},{key:"getVertexIdFromMesh",value:function(e){var t,n;return null==e||null===(t=e.graphVertex)||void 0===t||null===(n=t.vertex)||void 0===n?void 0:n.id}},{key:"buildVertex",value:function(e,t){var n=this,o=this.getVertexIdFromMesh(e);this.graph.getVertex(o).orElseRun((function(){var o=t||n.vertexGenerator++;n.graph.addVertex(o),n.graph.getVertex(o).forEach((function(t){t.data=J.builder()(o,e),n.addObs2VertexMesh(t.data)}))}))}},{key:"addObs2VertexMesh",value:function(e){var t=this,n=e.mesh;void 0!==n&&(n.graphVertex={vertex:e,delVertex:function(){return t.delVertexFromMesh(n)},vertexObs:this.getVertexMeshObs(e)})}},{key:"getVertexMeshObs",value:function(e){var t=this;return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;n._;if(!o.isDisposed()){var a=k.a.getGlobalCoordinates(o,o.position).toBabylon();t.updateVertexPosition(e.id,a,r)}}}},{key:"buildEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t].map(this.getVertexIdFromMesh).sort((function(e,t){return e-t})),i=r()(a,2),c=i[0],u=i[1];o.addEdge(c,u),o.getVertex(c).forEach((function(r){var a=r.data;return o.getVertex(u).forEach((function(r){var i=r.data;if(o.getEdge(c,u).forEach((function(e){e.data?e.data.edge=[a,i]:e.data=new $(a,i)})),!n.doMeshesBelong2SamePath(e,t)){var s=[e,t].map(n.isMeshBelong2Path).every((function(e){return e})),l=n.getEdgeMesh(a,i,s);n.meshByEdgeId[L.edgeKey(c,u)]=l,n.meshByEdgeId[L.edgeKey(u,c)]=l}}))}))}},{key:"getEdgeMesh",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=[e,t].map((function(e){var t=e.mesh;return k.a.getGlobalCoord(t,t.position)})),a=n.getEdgeMesh(this.scene,r,"edgeMesh".concat(e.id,"_").concat(t.id),C.Color3.Yellow());return a.visibility=.99,a.material=n.getEdgeMaterial(this.scene,{speed:o?8:0}),a.parent=this.mesh,a.edgeIndexes=[e,t].map((function(e){return e.id})),a.getMouseContextActions=this.getEdgeMouseCtxActions(a),this.addObserver2EdgeMesh(a),this.addOnClickEdge(a),a}},{key:"addObserver2EdgeMesh",value:function(e){e.observers=new C.Observable,e.observers.add(this.getEdgeObs())}},{key:"addOnClickEdge",value:function(e){e.onClick=this.getOnClickEdge(e)}},{key:"getUndoDeleteEdge",value:function(e){var t=this.graph,n=e.edgeIndexes.map((function(e){return t.getVertex(e)})).map((function(e){return e.some()})).map((function(e){return e.data})),o=r()(n,2),a=o[0],i=o[1];return this.getUndoDelLineEdge(a,i)}},{key:"getUndoDelLineEdge",value:function(e,t){var n=this,o=this.graph,a=[e,t],c=a.map((function(e){return e.id})),u=r()(c,2),s=u[0],l=u[1],f=a.map((function(e){return e.mesh})),d={keyValueMap:{},weight:1,edge:{}};return o.getEdge(s,l).forEach((function(e){var t=e.data;d.keyValueMap=t.keyValueMap,d.weight=t.weight,d.edge=t.edge})),G.UndoManager.actionBuilder().doAction((function(){n.delEdge.apply(n,i()(f)),n.mainView.closeContextDial(),n.mainView.updateNodeInServer(n.name)})).undoAction((function(e){var t=e.is2UpdateInServer,r=void 0===t||t;n.addEdge.apply(n,i()(f).concat([[s,l]])),o.getEdge(s,l).forEach((function(e){var t=e.data;t.keyValueMap=d.keyValueMap,t.weight=d.weight,t.edge=d.edge})),r&&n.mainView.updateNodeInServer(n.name)})).build()}},{key:"checkInvalidEdges",value:function(e,t,o){if(![e,t].map(this.isMeshBelong2Path).every((function(e){return e})))return!1;var r=[e,t].filter((function(e){return e.parent.name===o.belongsSrc.name}))[0],a=[e,t].filter((function(e){return e.parent.name===o.belongsTrg.name}))[0];return!(!r||!a)&&n.isInvalidEdge(r,a)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing graphItem or null mainView");var a=new n(e,o,t.name,t.keyValueMap),c=t.edges,u=Number.MIN_VALUE;return Object.values(c).forEach((function(e){var t=e.ids,n=e.belongsSrc,s=e.belongsTrg,l=t.map((function(e){return Number(e)})),f=r()(l,2),d=f[0],h=f[1];u=Math.max(u,Math.max(d,h));var m=X(o,{belongsSrc:n,belongsTrg:s});m.reduce((function(e,t){return e&&null!=t}),!0)&&(a.addEdge.apply(a,i()(m).concat([[d,h]])),a.graph.getEdge(d,h).forEach((function(e){var t=e.data,n=c[L.edgeKey(d,h)];t.importFeatures(n)})))})),a.vertexGenerator=u+1,a}},{key:"getVertexMesh",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.Color3.Gray(),o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:S.b.RADIUS,r=k.a.createSphere(e,n,o);return r.position=t,r}},{key:"getEdgeMesh",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C.Color3.Gray(),r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:S.b.RADIUS/4;return k.a.createTubeFromPoints(e,t,o,r,n)}},{key:"getEdgeMaterial",value:function(e,t){var n=t.color,o=void 0===n?C.Color3.Yellow():n,r=t.frequency,a=void 0===r?8:r,i=t.speed,c=void 0===i?0:i;return k.a.getShaderMaterial({vertex:ee,frag:te(a,c,[o.r,o.g,o.b])})(e)}}]),n}(x.a);P()(Y,"TYPE","GraphItem"),P()(Y,"NAME","LogicGraph"),P()(Y,"createGraphItemIfNone",(function(e,t){return t.getGraph().orElseRun((function(){var n=new Y(e,t);n.mesh.parent=t.getRootNode().item.mesh,t.addNodeItem2Tree(n)}))})),P()(Y,"isInvalidEdge",(function(e,t){var n,o,r=null===(n=e.parent)||void 0===n?void 0:n.nodeItem,a=null===(o=t.parent)||void 0===o?void 0:o.nodeItem,i=[];if(r.getType()===q.a.TYPE&&a.getType()===q.a.TYPE){var c=e.index/(r.keyPoints.length-1),u=t.index/(a.keyPoints.length-1);0===c&&1===u&&i.push(1),1===c&&1===u&&i.push(2)}return i.length>0}));var Q={},Z=function(e,t){var n=k.a.createSphere(e,C.Color3.Gray(),Number.MIN_VALUE,t,!1);return n.position=C.Vector3.Zero(),n.scaling=C.Vector3.One(),n.rotationQuaternion=O.Quaternion.Identity(),n.visibility=0,n},X=function(e,t){return[t.belongsSrc,t.belongsTrg].map((function(t){var n=t.name,o=t.index;return e.getNodeFromTree(n).map((function(e){var t=e.item;if(null==o)return t.mesh;var n=o<0?t.keyPoints.length-1:o;return t.keyPoints[n]})).orUndefined()}))},J=function(){function e(t,n,o){l()(this,e),this.id=t,this.mesh=n,this.position=o}return d()(e,null,[{key:"builder",value:function(){return function(t,n){return new e(t,n,k.a.getGlobalCoordinates(n,n.position).toBabylon())}}}]),e}(),$=function(){function e(t,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};l()(this,e),this.edge=[t,n],this.keyValueMap=o,this.weight=1}return d()(e,[{key:"importFeatures",value:function(e){var t=e.keyValueMap,n=e.weight;this.keyValueMap=t,this.weight=n}}]),e}(),ee="\nprecision highp float;\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n    vec4 outPosition = worldViewProjection * vec4(position, 1.0);\n    gl_Position = outPosition;\n\n    vUV = uv;\n    vPosition = position;\n    vNormal = normal;\n}",te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2?arguments[2]:void 0;return"\n#define PI 3.1415926538\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n// Refs\nuniform float time;\n\nvoid main(void) {\n    vec3 color = vec3(".concat(n[0],", ").concat(n[1],", ").concat(n[2],");\n    float frequency = ").concat(Number(e).toFixed(1),";\n    float speed = ").concat(Number(t).toFixed(1),";\n    gl_FragColor = vec4(color, max(0.,sin(2. * PI * vUV.y * frequency - speed * time)));\n}")};t.a=Y},function(e,t){e.exports=require("@material-ui/core/MenuItem")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/objectWithoutProperties")},function(e,t){e.exports=require("@material-ui/core/Typography")},function(e,t){e.exports=require("@material-ui/core/IconButton")},function(e,t){e.exports=require("@material-ui/core/FormControl")},function(e,t){e.exports=require("@material-ui/core/Divider")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(11),u=0,s=function(){function e(){r()(this,e)}return i()(e,null,[{key:"copy",value:function(e){c.Clipboard.write("scene",e)}},{key:"paste",value:function(){return c.Clipboard.read("scene")}},{key:"getUID",value:function(){return u++}}]),e}()},function(e,t){e.exports=require("@material-ui/icons/Search")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),u=n.n(c),s=n(10);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t,n){if(e.length===t.length){for(var o=!0,r=0;r<e.length;r++){var a=e[r],i=t[r];if(!n(a,i))return!1;o=o&&d(a.children,i.children,n)}return o}return!1}function h(e){return e.expanded=!0,e}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var o=f({},e);if(t(o)){var r=h(o);r.children=m(r.children,t),n.push(r)}else if(o.children){var a=m(o.children,t);0!==a.length&&(o.children=a,n.push(h(o)))}})),n}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return!0};if(!e||0===e.length)return[];var n=[];return e.forEach((function(e){var o=f({},e);t(o)&&n.push(o),n=n.concat(p(o.children,t))})),n}var v=function(){function e(t){r()(this,e),this.tree=t}return i()(e,[{key:"getNode",value:function(e){return function e(t,n){for(var o=0;o<t.length;o++){var r=t[o];if(n(r))return s.Maybe.some(r);var a=e(r.children,n);if(a.isSome())return a}return s.Maybe.none()}(this.tree,e)}},{key:"getParentNode",value:function(e){return function e(t,n,o){if(t.map((function(e){return n(e)})).reduce((function(e,t){return e||t}),!1))return s.Maybe.fromNull(o);for(var r=0;r<t.length;r++){var a=t[r],i=e(a.children,n,a);if(i.isSome())return i}return s.Maybe.none()}(this.tree,e,null)}},{key:"equals",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return e===t};return t.constructor===e?d(this.tree,t.tree,n):d(this.tree,t,n)}},{key:"map",value:function(t){return new e(function e(t,n,o){return t.forEach((function(t){var r=f({},t),a=o(r);a.children=e(r.children,[],o),n.push(a)})),n}(this.tree,[],t))}},{key:"filter",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return new e(m(this.tree,t))}},{key:"flatten",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return!0};return p(this.tree,e)}},{key:"forEach",value:function(e){!function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};t.forEach((function(t){n(t),e(t.children,n)}))}(this.tree,e)}}]),e}();t.a=v},function(e,t){e.exports=require("@material-ui/core/Grid")},function(e,t){e.exports=require("@material-ui/icons/ChevronRight")},function(e,t,n){"use strict";var o=n(110),r=n.n(o),a=n(18),i=n.n(a),c=n(17),u=n.n(c),s=n(7),l=n.n(s),f=n(9),d=n.n(f),h=n(3),m=n.n(h),p=n(16),v=n.n(p),g=n(15),y=n.n(g),b=n(13),A=n.n(b),w=n(5),M=n.n(w),E=n(1),P=n.n(E),x=n(23),k=n(8),C=n(10),S=n(2),O=n(6),N=n(20),T=n(59),I=n(64),B=n(11);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=M()(e);if(t){var r=M()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return A()(this,n)}}var D="Fail to generate navigation preview.",F=function(e){y()(n,e);var t=R(n);function n(e,o,r,a,i){var c;return l()(this,n),c=t.call(this,e,{}),P()(m()(c),"getType",(function(){return n.TYPE})),c.poses=o,c.robotConfig=r,c.scene=a,c.mainView=i,c.arrowMeshes=c.createArrowMeshes(),c.navPath=c.createNavPath(),c}return d()(n,[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"dispose",value:function(){this.navPath&&this.navPath.dispose(),this.arrowMeshes.forEach((function(e){return e.dispose()}))}},{key:"toDict",value:function(){var e=v()(M()(n.prototype),"toDict",this).call(this);return e.poses=this.poses,e.robotConfig=this.robotConfig,e}},{key:"toForm",value:function(){var e=v()(M()(n.prototype),"toForm",this).call(this);return delete e.jsonSchema.properties.position,delete e.jsonSchema.properties.rotation,delete e.jsonSchema.properties.color,delete e.jsonSchema.properties.annotations,delete e.uiSchema.position,delete e.uiSchema.rotation,delete e.uiSchema.color,delete e.data.position,delete e.data.rotation,delete e.data.color,delete e.data.annotations,e.jsonSchema.properties.config={type:"string",title:"Robot Configuration"},e.uiSchema.config={"ui:widget":"selectScopeModal","ui:options":{scopeList:"Configuration",name:"Robot Config",filter:function(e){return!0}}},e.data.config=this.robotConfig,e}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.robotConfig=e.config}},{key:"createArrowMeshes",value:function(){var e=this;return this.poses.map((function(t,n){var o=O.a.of(t.position).toBabylon(),r=2*Math.atan2(t.orientation[3],t.orientation[0]),a=new S.Vector3(Math.cos(r),Math.sin(r),0).add(o),i=k.a.getArrow(e.scene,"".concat(e.name,"Pose").concat(n),o,a,N.b.RADIUS/6);return i.parent=e.mesh,i.getChildren().forEach((function(t){t.material=k.a.getMaterialFromColor(n%2==0?S.Color3.Red():S.Color3.Green()),t.material.freeze(),t.observers=new S.Observable,t.observers.add(e.getArrowObserver(e.mainView)),t.onClick=function(){e.mainView.highlightNodesInTree([e.name]),e.mainView.setProperties(e.toForm()),setTimeout((function(){e.mainView.highlightMeshesInScene(e.arrowMeshes.flatMap((function(e){return e.getChildren()})))}))},t.onDel=function(){return e.mainView.deleteNodeFromTreeUsingName(e.name)}})),i}))}},{key:"createNavPath",value:function(){var e=new L(this);return e.play(),e}},{key:"getArrowObserver",value:function(e){var t=this;return function(n){var o=n.updatedPointMesh,r=n.is2updateServer,a=n.displacement,i=O.a.ofBabylon(a),c=k.a.getLocalCoordFromWorld(t.mesh,i,!1);o.position=o.position.add(c.scale(-1).toBabylon()),r&&e.setProperties(t.toForm())}}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=C.Maybe.fromNull(t).map((function(e){return e.name})).orSome("NavPreview".concat(Math.floor(1e3*Math.random()))),a=new S.Mesh(r,e);a.position=S.Vector3.Zero(),a.scaling=S.Vector3.One(),a.rotationQuaternion=S.Quaternion.Identity(),a.isPickable=!1;var i=new n(a,t.poses,t.robotConfig,e,o);return i}}]),n}(x.a);P()(F,"TYPE","NavigationPreviewItem");var L=function(){function e(t){var n=this;l()(this,e),this.navItem=t,this.scene=t.scene,this.mainView=t.mainView,this.pathPromise=this.getPathFromService(this.navItem.poses,this.navItem.robotConfig),this.pathPromise.then((function(e){var t=e.path;n.pathPoses=t.poses.map((function(e){return e.pose})),n.mesh=n.getNavigationPathMesh(n.pathPoses),n.animator=n.getAnimator()}))}return d()(e,[{key:"play",value:function(){var e=this;this.pathPromise.then((function(){e.animator.play()}))}},{key:"stop",value:function(){var e=this;this.pathPromise.then((function(){e.animator.stop()}))}},{key:"dispose",value:function(){this.mesh&&this.mesh.dispose(),this.stop()}},{key:"getAnimator",value:function(){var e=this,t=this.pathPoses.length;return T.a.builder().initialState({time:0,T:(new Date).getTime(),indices:u()(Array(t)).map((function(e,t){return t}))}).nextState((function(n){var o=n.time,r=n.T,a=n.indices,i=((new Date).getTime()-r)/1e3,c=u()(Array(t));return a.forEach((function(e,n){return a[n]=(e+3*i)%t})),c.forEach((function(n,o){var r=Math.floor(a[o]),i=Math.ceil(a[o]),u=(a[o]-r)/(i-r);a[o]>t-1&&(r=0,i=1),c[o]=O.a.of([e.pathPoses[r].position.x,e.pathPoses[r].position.y,e.pathPoses[r].position.z]).scale(1-u).add(O.a.of([e.pathPoses[i].position.x,e.pathPoses[i].position.y,e.pathPoses[i].position.z]).scale(u)).toArray()})),e.mesh.updateVerticesData(S.VertexBuffer.PositionKind,c.flatMap((function(e){return e}))),{time:o+i,T:(new Date).getTime(),indices:a}})).while((function(t){return!e.scene.isDisposed})).build()}},{key:"getNavigationPathMesh",value:function(e){var t=new S.Mesh("cloudPoint".concat(this.navItem.name),this.scene),n=new S.StandardMaterial("cloudPoint".concat(this.navItem.name,"Material"),this.scene);n.emissiveColor=new S.Color3(1,1,1),n.disableLighting=!0,n.pointsCloud=!0,n.pointSize=5,t.material=n,t.isPickable=!1;var o=new S.VertexData,r=e.map((function(e){var t=e.position;return[t.x,t.y,t.z]}));o.positions=r.flatMap((function(e){return e}));var a=new Array(4*r.length);return o.colors=a.fill(1),o.applyToMesh(t,!0),t.parent=this.navItem.mesh,t}},{key:"getPathFromService",value:function(e,t){var n=this,o=i()(e,2),r=o[0],a=o[1],c=new I.Ros({url:K}),u={scene:this.mainView.sceneName,robot_config:this.navItem.robotConfig,initial_pose:V(r),final_pose:V(a)};return new Promise((function(e){c.on("error",(function(t){console.log("Navigation Service ",t),n.getDefaultPath(u,e)})),c.on("connection",(function(){console.log("Navigation Service Connection made!")})),c.on("close",(function(){console.log("Navigation Service Connection closed.")}));var t=new I.Service({ros:c,name:U,serviceType:z}),o=new I.ServiceRequest(u);t.callService(o,(function(t){c.close(),e(t)}),(function(t){n.getDefaultPath(u,e)}))}))}},{key:"getDefaultPath",value:function(e,t){var n=this;B.MasterDB.cloudFunction(N.b.NAV_CLOUD_NAME,"generate_path",[e.scene,e.initial_pose,e.final_pose,e.robot_config],(function(e){console.log("Got default path",e.success),e.success?t({path:e.result}):(console.log("Caught exception in default path",e.error),n.getPathFromPoses(n.navItem.poses).then((function(e){return t({path:e})})).catch((function(e){console.log("Caught error in getPathFromPoses",e),n.mainView.showAlert(D,"error")})))})).catch((function(e){console.log("debug couldn't execute default generate path",e),n.getPathFromPoses(n.navItem.poses).then((function(e){return t({path:e})})).catch((function(e){console.log("Caught error in getPathFromPoses",e),n.mainView.showAlert(D,"error")}))}))}},{key:"getPathFromPoses",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,n=i()(e,2),o=n[0],r=n[1],a=O.a.of(o.position),c=O.a.of(r.position),s=c.sub(a),l=a.add(s.scale(.5)).add(O.a.of([o.orientation[0],o.orientation[3],0]).scale(2)),f=c.add(s.scale(-.5)).add(O.a.of([r.orientation[0],r.orientation[3],0]).scale(2)),d=[a,l,f,c],h=u()(Array(t)),m=0;m<t;m++)h[m]=j(d,m/(t-1)).toArray();return new Promise((function(e){return e({poses:h.map((function(e){return{pose:{position:{x:e[0],y:e[1],z:e[2]},orientation:{x:0,y:0,z:0,w:1}}}}))})}))}}]),e}();function j(e,t){if(1===e.length)return e[0];var n,o=r()(e).slice(1),a=(n=o,e.map((function(e,t){return[e,n[t]]})));return a.splice(-1,1),j(a.map((function(e){var n=i()(e,2);return function(e,t){return function(n){return e.scale(1-n).add(t.scale(n))}}(n[0],n[1])(t)})),t)}function V(e){var t=e.position,n=e.orientation;return{position:{x:t[0],y:t[1],z:t[2]},orientation:{w:n[0],x:n[1],y:n[2],z:n[3]}}}var U="/generate_path/path_points/in",z="movai_common/GeneratePath",K="ws://localhost:9090";t.a=F},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("@material-ui/core/Input")},function(e,t){e.exports=require("@material-ui/core/Menu")},function(e,t){e.exports=require("@babylonjs/gui/2D")},function(e,t){e.exports=require("@material-ui/core/Select")},function(e,t){e.exports=require("@material-ui/core/Avatar")},function(e,t){e.exports=require("@babylonjs/gui")},function(e,t){e.exports=require("@material-ui/icons/Clear")},function(e,t){e.exports=require("@material-ui/core/InputLabel")},function(e,t){e.exports=require("clsx")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=function(){function e(t,n,o,a,i){var c=arguments.length>5&&void 0!==arguments[5]&&arguments[5];r()(this,e),this.title=t,this.item=n,this.children=o,this.expanded=a,this.isVisible=i,this.isStatic=c}return i()(e,null,[{key:"dispose",value:function(t){t.item.dispose(),t.children.forEach((function(t){e.dispose(t)}))}},{key:"toDict",value:function(t){return{name:t.title,item:t.item.toDict(),children:t.children.map((function(t){return e.toDict(t)}))}}},{key:"builder",value:function(){return new u}}]),e}(),u=function(){function e(){r()(this,e),this._title=null,this._item={},this._children=[],this._expanded=!1,this._isVisible=!0,this._isStatic=!1}return i()(e,[{key:"title",value:function(e){return this._title=e,this}},{key:"item",value:function(e){return this._item=e,this}},{key:"children",value:function(e){return this._children=e,this}},{key:"expanded",value:function(e){return this._expanded=e,this}},{key:"isVisible",value:function(e){return this._isVisible=e,this}},{key:"isStatic",value:function(e){return this._isStatic=e,this}},{key:"build",value:function(){return Object.values(this).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a TreeNode, e.g ".concat(e))})),new c(this._title,this._item,this._children,this._expanded,this._isVisible,this._isStatic)}}]),e}();t.a=c},function(e,t){e.exports=require("@material-ui/core/Button")},function(e,t){e.exports=require("@material-ui/icons/Close")},function(e,t){e.exports=require("@material-ui/core/Drawer")},function(e,t){e.exports=require("@material-ui/icons/ExpandMore")},function(e,t){e.exports=require("react-resize-detector")},function(e,t,n){"use strict";var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(3),u=n.n(c),s=n(16),l=n.n(s),f=n(15),d=n.n(f),h=n(13),m=n.n(h),p=n(5),v=n.n(p),g=n(1),y=n.n(g),b=n(23),A=n(10),w=n(8),M=n(2);function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v()(e);if(t){var r=v()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return m()(this,n)}}var P=function(e){d()(n,e);var t=E(n);function n(e){var o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_SIZE,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return r()(this,n),o=t.call(this,e,i),y()(u()(o),"getType",(function(){return n.TYPE})),o.size=a,o}return i()(n,[{key:"toDict",value:function(){var e=l()(v()(n.prototype),"toDict",this).call(this);return e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=A.Maybe.fromNull(t),r=o.flatMap((function(e){return A.Maybe.fromNull(e.size)})).orSome(n.DEFAULT_SIZE),a=o.flatMap((function(e){return A.Maybe.fromNull(e.name)})).orSome("Box".concat(Math.floor(1e3*Math.random()))),i=o.flatMap((function(e){return A.Maybe.fromNull(e.keyValueMap)})).orUndefined(),c=w.a.createBox(e,new M.Color3(Math.random(),Math.random(),Math.random()),r,a);return b.a.mapDict2Mesh(t,c),new n(c,r,i)}}]),n}(b.a);y()(P,"DEFAULT_SIZE",.5),y()(P,"TYPE","Box"),t.a=P},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=function(){function e(t,n,o){r()(this,e),this.state=t,this.next=n,this.while=o,this.requestAnimeId=null}return i()(e,[{key:"play",value:function(){var e=this;return this.requestAnimeId=requestAnimationFrame((function(){if(!e.while(e.state))return e.stop();e.state=e.next(e.state),e.play()})),this}},{key:"stop",value:function(){return cancelAnimationFrame(this.requestAnimeId),this}}],[{key:"builder",value:function(){return new u}}]),e}(),u=function(){function e(){r()(this,e),this._state=null,this._next=null,this._end=null}return i()(e,[{key:"initialState",value:function(e){return this._state=e,this}},{key:"nextState",value:function(e){return this._next=e,this}},{key:"while",value:function(e){return this._end=e,this}},{key:"build",value:function(){if([this._state,this._next,this._end].some((function(e){return null==e})))throw new Error("Animator properties are missing");return new c(this._state,this._next,this._end)}}]),e}()},function(e,t){e.exports=require("@material-ui/icons/Settings")},function(e,t){e.exports=require("lodash/isEqual")},function(e,t){e.exports=require("@material-ui/core/CircularProgress")},function(e,t){e.exports=require("@material-ui/core/colors")},function(e,t){e.exports=require("roslib")},function(e,t,n){"use strict";(function(e){var o=n(7),r=n.n(o),a=n(9),i=n.n(a),c=n(1),u=n.n(c),s=n(38),l=n(52),f=n(25),d=n(11),h=n(20),m=n(29),p=n(41),v=n(111),g=n.n(v),y=h.b.CLOUD_FUNCTION_NAME,b=function(){function t(n,o){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:window.alert;r()(this,t),u()(this,"getNodeFromTree",(function(e,t){return new s.a(t).getNode((function(t){return e===t.title}))})),u()(this,"getParentFromChild",(function(e,t){return new s.a(t).getParentNode((function(t){return e===t.title}))})),u()(this,"deleteNodeFromTreeUsingName",(function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return a.getNodeFromTree(e,t).forEach((function(o){l.a.dispose(o),n&&a.deleteNodeInServer(e),a.getParentFromChild(e,t).forEach((function(t){t.children=t.children.filter((function(t){return t.title!==e}))})),t=t.filter((function(t){return t.title!==e}))})),t})),u()(this,"getNodeFromTreeWithPredicate",(function(e,t){return new s.a(t).getNode(e)})),u()(this,"addNodeItem2Tree",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:f.a.NAME,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];a.deleteNodeFromTreeUsingName(t.name,e,o);var i=a.staticNodeTypes.includes(t.getType()),c=l.a.builder().title(t.name).item(t).isVisible(r).isStatic(i).build();if(n){var u=a.getNodeFromTree(n,e);u.forEach((function(e){o&&a.addNodeItem2Server(c,e.title),e.children.push(c)}))}else e.push(c),o&&a.addNodeItem2Server(c,null);return e})),u()(this,"lostConnection",(function(){a.undoManager.undo({is2UpdateInServer:!1}),e((function(){a.alert("Sorry, work not saved. Please check internet connection","error")}))})),u()(this,"updateNodeInServer",(function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;console.log("updateNodeInServer!",e,a.sceneName),a.getNodeFromTree(e,n).forEach((function(r){var i=a.getParentFromChild(e,n).map((function(e){return e.title})).orNull();d.MasterDB.cloudFunction(y,"updateNode",[l.a.toDict(r),i,o,a.sceneName],(function(e){console.log("Update node with success?",e.success,e.error)})).catch((function(n){console.warn("Update node error",e,n),t.undoAction(a)}))}))})),u()(this,"addNodeItem2Server",(function(e,n){d.MasterDB.cloudFunction(y,"addNodeItem",[l.a.toDict(e),n,a.sceneName],(function(e){console.log("Add node with success?",e.success)})).catch((function(n){console.warn("Add node error",e.title,n),t.undoAction(a)}))})),u()(this,"deleteNodeInServer",(function(e){d.MasterDB.cloudFunction(y,"deleteNodeByName",[e,a.sceneName],(function(e){console.log("Deleted node with success?",e.success)})).catch((function(n){console.warn("Deleted node error",e,n),t.undoAction(a)}))})),this.sceneName=n,this.undoManager=o,this.alert=function(e,t){return i(e,t)},this.staticNodeTypes=[m.a.TYPE,p.a.TYPE]}return i()(t,null,[{key:"ofScene",value:function(e,n,o){return new t(e,n,o)}}]),t}();u()(b,"undoAction",g()((function(e){return e.lostConnection()}),500)),t.a=b}).call(this,n(133).setImmediate)},function(e,t){e.exports=require("@material-ui/core/InputAdornment")},function(e,t){e.exports=require("@material-ui/core/ListItemText")},function(e,t){e.exports=require("@material-ui/core/Checkbox")},function(e,t){e.exports=require("@material-ui/pickers")},function(e,t){e.exports=require("react-virtualized")},function(e,t){e.exports=require("lodash/set")},function(e,t){e.exports=require("lodash/cloneDeep")},function(e,t){e.exports=require("@material-ui/core/List")},function(e,t){e.exports=require("lodash/capitalize")},function(e,t){e.exports=require("@material-ui/core/TableCell")},function(e,t){e.exports=require("@material-ui/core/FormHelperText")},function(e,t){e.exports=require("@material-ui/lab/Alert")},function(e,t,n){"use strict";var o,r=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function c(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function u(e,t){for(var n={},o=[],r=0;r<e.length;r++){var a=e[r],u=t.base?a[0]+t.base:a[0],s=n[u]||0,l="".concat(u," ").concat(s);n[u]=s+1;var f=c(l),d={css:a[1],media:a[2],sourceMap:a[3]};-1!==f?(i[f].references++,i[f].updater(d)):i.push({identifier:l,updater:v(d,t),references:1}),o.push(l)}return o}function s(e){var t=document.createElement("style"),o=e.attributes||{};if(void 0===o.nonce){var r=n.nc;r&&(o.nonce=r)}if(Object.keys(o).forEach((function(e){t.setAttribute(e,o[e])})),"function"==typeof e.insert)e.insert(t);else{var i=a(e.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(t)}return t}var l,f=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function d(e,t,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(e.styleSheet)e.styleSheet.cssText=f(t,r);else{var a=document.createTextNode(r),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function h(e,t,n){var o=n.css,r=n.media,a=n.sourceMap;if(r?e.setAttribute("media",r):e.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),e.styleSheet)e.styleSheet.cssText=o;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(o))}}var m=null,p=0;function v(e,t){var n,o,r;if(t.singleton){var a=p++;n=m||(m=s(t)),o=d.bind(null,n,a,!1),r=d.bind(null,n,a,!0)}else n=s(t),o=h.bind(null,n,t),r=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return o(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;o(e=t)}else r()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=r());var n=u(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var o=0;o<n.length;o++){var r=c(n[o]);i[r].references--}for(var a=u(e,t),s=0;s<n.length;s++){var l=c(n[s]);0===i[l].references&&(i[l].updater(),i.splice(l,1))}n=a}}}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var r=(i=o,c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c),"/*# ".concat(u," */")),a=o.sources.map((function(e){return"/*# sourceURL=".concat(o.sourceRoot||"").concat(e," */")}));return[n].concat(a).concat([r]).join("\n")}var i,c,u;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,o){"string"==typeof e&&(e=[[null,e,""]]);var r={};if(o)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(var c=0;c<e.length;c++){var u=[].concat(e[c]);o&&r[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),t.push(u))}},t}},function(e,t){e.exports=require("@material-ui/icons/Schedule")},function(e,t){e.exports=require("@material-ui/icons/Warning")},function(e,t){e.exports=require("@material-ui/icons/ViewModule")},function(e,t){e.exports=require("@material-ui/icons/Chat")},function(e,t){e.exports=require("@material-ui/core/Collapse")},function(e,t){e.exports=require("material-table")},function(e,t){e.exports=require("@material-ui/icons/AddBox")},function(e,t){e.exports=require("@material-ui/icons/ArrowDownward")},function(e,t){e.exports=require("@material-ui/icons/Check")},function(e,t){e.exports=require("@material-ui/icons/ChevronLeft")},function(e,t){e.exports=require("@material-ui/icons/DeleteOutline")},function(e,t){e.exports=require("@material-ui/icons/Edit")},function(e,t){e.exports=require("@material-ui/icons/FilterList")},function(e,t){e.exports=require("@material-ui/icons/FirstPage")},function(e,t){e.exports=require("@material-ui/icons/LastPage")},function(e,t){e.exports=require("@material-ui/icons/Remove")},function(e,t){e.exports=require("@material-ui/icons/SaveAlt")},function(e,t){e.exports=require("@material-ui/icons/ViewColumn")},function(e,t){e.exports=require("@material-ui/core/Tabs")},function(e,t){e.exports=require("@material-ui/core/Tab")},function(e,t){e.exports=require("@material-ui/core/TextField")},function(e,t){e.exports=require("@material-ui/core/FormControlLabel")},function(e,t){e.exports=require("@material-ui/core/Switch")},function(e,t){e.exports=require("@material-ui/core/InputBase")},function(e,t){e.exports=require("@material-ui/core/Breadcrumbs")},function(e,t){e.exports=require("@material-ui/icons/NavigateNext")},function(e,t){e.exports=require("earcut")},function(e,t){e.exports=require("lodash/uniqBy")},function(e,t){e.exports=require("@babylonjs/core/Maths/math")},function(e,t){e.exports=require("lodash.isequal")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/toArray")},function(e,t){e.exports=require("lodash/debounce")},function(e,t){e.exports=require("@material-ui/core/utils")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/taggedTemplateLiteral")},function(e,t){e.exports=require("styled-components")},function(e,t){e.exports=require("@material-ui/core/styles/colorManipulator")},function(e,t){e.exports=require("@material-ui/icons/Label")},function(e,t){e.exports=require("@material-ui/core/Chip")},function(e,t){e.exports=require("@material-ui/icons/Add")},function(e,t){e.exports=require("@material-ui/icons/Today")},function(e,t){e.exports=require("@date-io/date-fns")},function(e,t){e.exports=require("@babel/runtime/helpers/esm/typeof")},function(e,t){e.exports=require("lodash/isEmpty")},function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' version='1.0' width='400.000000' height='400.000000' preserveAspectRatio='xMidYMid meet'%3E%3Crect id='backgroundrect' width='100%25' height='100%25' x='0' y='0' fill='none' stroke='none'/%3E %3Cg class='currentLayer' style=''%3E%3Ctitle%3ELayer 1%3C/title%3E%3Cg transform='translate(0,400) scale(0.10000000149011612,-0.10000000149011612) ' fill='%23d31b1b' stroke='none' id='svg_1' class='' fill-opacity='1'%3E %3Cpath d='M1770 3990 c-682 -83 -1271 -501 -1570 -1115 -103 -211 -167 -437 -191 -673 -14 -129 -6 -404 14 -522 85 -495 339 -929 729 -1242 232 -187 539 -332 836 -393 957 -199 1909 314 2272 1224 204 512 180 1116 -64 1606 -115 232 -229 387 -412 565 -296 286 -639 460 -1059 536 -106 19 -443 27 -555 14z m-998 -1105 c3 -3 -23 -48 -57 -99 -113 -172 -182 -338 -226 -546 -32 -149 -33 -448 -1 -593 31 -145 70 -258 134 -387 65 -132 64 -140 -28 -140 -66 0 -100 13 -143 53 -74 70 -71 38 -71 748 0 555 2 642 16 690 43 144 129 236 248 265 54 13 119 18 128 9z m2621 -21 c99 -34 192 -157 216 -288 14 -78 15 -1256 1 -1307 -13 -48 -82 -125 -124 -139 -55 -18 -166 -12 -166 9 0 4 25 57 55 118 195 391 215 839 55 1247 -41 105 -117 247 -176 327 -18 25 -30 49 -26 54 10 11 109 -2 165 -21z m-251 -61 c128 -170 217 -370 265 -594 13 -63 18 -129 18 -264 0 -199 -13 -285 -66 -448 -33 -101 -114 -277 -128 -277 -26 0 -31 80 -32 549 0 267 -4 495 -8 505 -6 16 -20 4 -87 -77 -43 -53 -81 -96 -84 -96 -3 -1 -16 41 -29 92 -27 106 -74 215 -132 304 -32 48 -38 66 -31 80 34 61 243 273 271 273 4 0 23 -21 43 -47z m-2206 15 c52 -39 95 -82 171 -170 l74 -88 -42 -61 c-23 -34 -54 -89 -69 -123 -35 -76 -80 -219 -80 -252 0 -13 -4 -24 -8 -24 -4 0 -43 43 -87 95 -43 52 -83 95 -87 95 -4 0 -8 -224 -9 -497 0 -492 -5 -565 -34 -565 -16 0 -94 166 -130 279 -52 159 -69 294 -62 493 8 230 47 384 147 585 56 112 154 255 174 255 7 0 26 -10 42 -22z m458 -511 l133 -157 -20 -58 c-13 -39 -19 -85 -19 -147 -1 -150 44 -260 151 -365 107 -105 214 -150 361 -150 241 0 443 162 500 399 16 69 8 222 -15 278 l-17 43 132 157 c73 87 136 159 140 161 24 9 119 -186 148 -303 11 -44 22 -104 25 -134 l4 -54 -329 -388 c-343 -405 -362 -424 -466 -455 -101 -31 -258 -12 -341 41 -48 29 -83 69 -607 691 -52 62 -94 121 -94 131 0 52 33 202 60 271 33 86 99 204 112 200 5 -2 68 -74 142 -161z m376 -444 c85 -102 167 -194 182 -204 62 -45 81 -30 292 224 76 92 142 165 146 162 13 -8 20 -110 10 -167 -27 -170 -153 -299 -324 -334 -130 -27 -257 9 -356 102 -61 57 -116 162 -125 239 -8 57 1 165 13 164 4 0 77 -84 162 -186z' id='svg_2' fill='%23d31b1b' fill-opacity='1'/%3E %3C/g%3E%3C/g%3E%3C/svg%3E"},function(e,t){e.exports=require("@material-ui/core/Paper")},function(e,t){e.exports=require("react-virtualized-tree")},function(e,t){e.exports=require("@material-ui/core/Box")},function(e,t){e.exports=require("@material-ui/core/Backdrop")},function(e,t){e.exports=require("@material-ui/styles")},function(e,t){e.exports=require("jwt-decode")},function(e,t){e.exports=require("@babylonjs/core/Debug/debugLayer")},function(e,t){e.exports=require("@babylonjs/inspector")},function(e,t){e.exports=require("@babylonjs/loaders")},function(e,t,n){(function(e){var o=void 0!==e&&e||"undefined"!=typeof self&&self||window,r=Function.prototype.apply;function a(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new a(r.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new a(r.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},a.prototype.unref=a.prototype.ref=function(){},a.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(135),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(134))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=require("setimmediate")},function(e,t,n){var o=n(78),r=n(137);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};o(r,a);e.exports=r.locals||{}},function(e,t,n){(t=n(79)(!1)).push([e.i,"body.react-confirm-alert-body-element {\n  overflow: hidden;\n}\n\n.react-confirm-alert-blur {\n  filter: url(#gaussian-blur);\n  filter: blur(2px);\n  -webkit-filter: blur(2px);\n}\n\n.react-confirm-alert-overlay {\n  position: fixed;\n  top: calc(100vh - 300px);\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 99;\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  -ms-align-items: center;\n  align-items: flex-end;\n  opacity: 1;\n}\n\n.react-confirm-alert-body {\n  width: 400px;\n  padding: 30px;\n}\n\n.react-confirm-alert-svg {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n.react-confirm-alert-body > h1 {\n  margin-top: 0;\n}\n\n.react-confirm-alert-body > h3 {\n  margin: 0;\n  font-size: 16px;\n}\n\n.react-confirm-alert-button-group {\n  display: -webkit-flex;\n  display: -moz-flex;\n  display: -ms-flex;\n  display: -o-flex;\n  display: flex;\n  justify-content: flex-start;\n  margin-top: 20px;\n}\n\n.react-confirm-alert-button-group > button {\n  outline: none;\n  background: #333;\n  border: none;\n  display: inline-block;\n  padding: 6px 18px;\n  color: #eee;\n  margin-right: 10px;\n  border-radius: 5px;\n  font-size: 12px;\n  cursor: pointer;\n}\n\n.icon-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.icon-container:hover {\n  cursor: pointer;\n}\n",""]),e.exports=t},function(e,t){e.exports=require("fontsource-roboto")},function(e,t){e.exports=require("fontsource-open-sans")},function(e,t,n){var o=n(78),r=n(141);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[e.i,r,""]]);var a={insert:"head",singleton:!1};o(r,a);e.exports=r.locals||{}},function(e,t,n){(t=n(79)(!1)).push([e.i,".flow-action {\n  display: flex;\n  background: transparent;\n  width: 35px;\n  height: 35px;\n  margin: 6px;\n  border-radius: 50%;\n  justify-content: center;\n  align-items: center;\n  transition: background-color 0.5s;\n}\n\n.flow-action:hover {\n  background: rgba(11, 106, 138, 0.2);\n  cursor: pointer;\n}\n\n.robot-logs-container {\n  display: flex;\n  flex-direction: column;\n  height: 1px;\n  flex-grow: 1;\n}\n\n.tree-grow-overflow {\n  flex-grow: 0.5;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.logs-grow-overflow {\n  flex-grow: 1;\n  overflow-y: auto;\n  min-height: 0;\n  height: 100%;\n}\n\n.saving {\n  /* font-size: 40px; */\n  margin: 0;\n}\n\n.saving span {\n  font-size: 15px;\n  animation-name: blink;\n  animation-duration: 1.4s;\n  animation-iteration-count: infinite;\n  animation-fill-mode: both;\n}\n\n.saving span:nth-child(2) {\n  animation-delay: 0.2s;\n}\n\n.saving span:nth-child(3) {\n  animation-delay: 0.4s;\n}\n\n@keyframes blink {\n  0% {\n    opacity: 0.2;\n  }\n  20% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0.2;\n  }\n}\n",""]),e.exports=t},function(e,t){e.exports=require("material-icons/css/material-icons.css")},function(e,t){e.exports=require("react-virtualized/styles.css")},function(e,t){e.exports=require("react-virtualized-tree/lib/main.css")},function(e,t,n){"use strict";n.r(t),n.d(t,"withOfflineValidation",(function(){return Xc})),n.d(t,"withAuthentication",(function(){return eu})),n.d(t,"Button",(function(){return l})),n.d(t,"AbstractModal",(function(){return w})),n.d(t,"ConfirmAlertModal",(function(){return E})),n.d(t,"SelectScopeModal",(function(){return _c})),n.d(t,"RobotLogModal",(function(){return te})),n.d(t,"Drawer",(function(){return ae})),n.d(t,"Collapse",(function(){return ge})),n.d(t,"VerticalBar",(function(){return Ae})),n.d(t,"ContextMenu",(function(){return ke})),n.d(t,"Table",(function(){return ct})),n.d(t,"Tabs",(function(){return vt})),n.d(t,"Text",(function(){return At})),n.d(t,"Themes",(function(){return Xa})),n.d(t,"Toggle",(function(){return Nt})),n.d(t,"SearchInput",(function(){return Dt})),n.d(t,"Breadcrumb",(function(){return Kt})),n.d(t,"SceneViewer",(function(){return ba})),n.d(t,"Select",(function(){return Sa})),n.d(t,"snackbar",(function(){return Ga})),n.d(t,"Style",(function(){return ti})),n.d(t,"Logs",(function(){return oc})),n.d(t,"FilterIcon",(function(){return ui})),n.d(t,"LoginForm",(function(){return mc})),n.d(t,"ProfileMenu",(function(){return bc}));var o=n(0),r=n.n(o),a=n(53),i=n.n(a),c=n(4),u=n.n(c),s=function(e){return r.a.createElement(i.a,{className:e.className,style:e.style,onClick:e.onClick,color:e.color,variant:e.variant,size:e.size,startIcon:e.startIcon,disabled:e.disabled},e.children)};s.propTypes={style:u.a.object,onClick:u.a.func,color:u.a.string,variant:u.a.string.isRequired,size:u.a.string,startIcon:u.a.element,children:u.a.node.isRequired,disabled:u.a.bool},s.defaultProps={style:{},onClick:function(){return console.log("Click MOV.AI button")},color:"default",variant:"contained",size:"medium",startIcon:void 0,children:r.a.createElement("div",null),disabled:!1};var l=s,f=n(1),d=n.n(f),h=n(54),m=n.n(h),p=n(19),v=n(12);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=Object(p.makeStyles)((function(e){return{card:{margin:"auto",position:"absolute",overflow:"auto",display:"flex",flexDirection:"column",maxHeight:"98%"},closeButton:{cursor:"pointer",position:"absolute",color:e.textColor,top:15,right:15,"&:hover":{color:"gray"}}}})),A=function(e){var t=b(),n=function(){e.onSubmit()},o=function(){e.onCancel()};return r.a.createElement(v.Modal,{onKeyPress:function(e){"Enter"===e.key&&n()},open:e.open,onClose:o,style:{display:"flex",alignItems:"center",justifyContent:"center"}},r.a.createElement(v.Card,{className:t.card,style:y(y({},e.style),{},{minWidth:e.width,minHeight:e.height})},r.a.createElement(v.CardContent,{style:{flexGrow:1,maxHeight:"calc(100% - 70px)",overflowY:"auto"}},r.a.createElement(v.Typography,{variant:"h5"},e.title),r.a.createElement(v.Typography,{component:"div",className:t.closeButton,onClick:function(){return e.onCancel()}},r.a.createElement(m.a,null)),r.a.createElement(v.Divider,{style:{marginBottom:"12px"}}),r.a.createElement("div",{style:{maxHeight:"calc(100% - 35px)",overflowY:"auto",paddingTop:5}},e.children)),r.a.createElement(v.Divider,null),r.a.createElement(v.CardActions,null,e.hasSubmitButton&&r.a.createElement(v.Button,{color:e.submitColor,onClick:n},e.submitText),e.hasCancelButton&&r.a.createElement(v.Button,{onClick:o,color:e.cancelColor},e.cancelText))))};A.propTypes={onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,title:u.a.string,submitText:u.a.string,submitColor:u.a.string,cancelText:u.a.string,cancelColor:u.a.string,width:u.a.string,height:u.a.string,style:u.a.object,hasSubmitButton:u.a.bool,hasCancelButton:u.a.bool},A.defaultProps={onSubmit:function(){},onCancel:function(){},open:!1,title:"New",submitText:"Confirm",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary",width:"25%",height:"25%",style:{},hasSubmitButton:!0,hasCancelButton:!0};var w=A,M=function(e){return r.a.createElement(w,{onSubmit:e.onSubmit,onCancel:e.onCancel,open:e.open,title:e.title,submitText:e.submitText,submitColor:e.submitColor,cancelText:e.cancelText,cancelColor:e.cancelColor},r.a.createElement("div",null,e.message),r.a.createElement("div",null,e.children))};M.propTypes={title:u.a.string,message:u.a.string,onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,submitText:u.a.string,submitColor:u.a.string,cancelText:u.a.string,cancelColor:u.a.string},M.defaultProps={title:"Insert Text here",message:"Are you sure?",onSubmit:function(){},onCancel:function(){},open:!1,submitText:"Delete",submitColor:"secondary",cancelText:"Cancel",cancelColor:"primary"};var E=M,P=n(7),x=n.n(P),k=n(9),C=n.n(k),S=n(3),O=n.n(S),N=n(15),T=n.n(N),I=n(13),B=n.n(I),R=n(5),D=n.n(R),F=n(73),L=n.n(F),j=n(47),V=n.n(j),U=n(35),z=n.n(U),K=n(32),G=n.n(K),q=n(80),W=n.n(q),_=n(81),H=n.n(_),Y=n(82),Q=n.n(Y),Z=n(83),X=n.n(Z),J=n(11);function $(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var ee=function(e){T()(n,e);var t=$(n);function n(){var e;x()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(O()(e),"state",{data:{},open:!1,hasButton:!1}),d()(O()(e),"open",(function(t){var n=e.state.data,o=new Date(1e3*t.time),r=t.button?JSON.parse(t.button.replace(/'/g,'"')):null;n.time="".concat(o.toLocaleTimeString("pt")),n.action=t.action,n.message=t.message,n.robot=t.robot,n.service=t.service,n.module=t.module,r&&(n.buttonText=r.label,n.buttonAction=e.getRobotAlertAction(r)),e.setState({data:n,open:!0,hasButton:!!r})})),d()(O()(e),"getRobotAlertAction",(function(t){var n=t.callback,o=t.data;return n?function(){J.MasterDB.cloudFunction(n,"",o,(function(t){e.setState({open:!1})}))}:function(){return e.setState({open:!1})}})),d()(O()(e),"renderAlertInfo",(function(){var t=e.state.data,n=e.props,o=n.props,a=n.classes;return r.a.createElement(G.a,{component:"div"},r.a.createElement(L.a,{style:{width:"100%"}},r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemAvatar,null,r.a.createElement(V.a,null,r.a.createElement("i",{className:"fas fa-robot"}))),r.a.createElement(v.ListItemText,{primary:t.robot})),r.a.createElement(z.a,{variant:"inset",component:"li"}),r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemAvatar,null,r.a.createElement(V.a,null,r.a.createElement(W.a,null))),r.a.createElement(v.ListItemText,{primary:t.time})),r.a.createElement(z.a,{variant:"inset",component:"li"}),o.includes("service")&&r.a.createElement("div",null,r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemAvatar,null,r.a.createElement(V.a,null,r.a.createElement(H.a,null))),r.a.createElement(v.ListItemText,{primary:t.service,className:a.breakWord})),r.a.createElement(z.a,{variant:"inset",component:"li"})),o.includes("module")&&r.a.createElement("div",null,r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemAvatar,null,r.a.createElement(V.a,null,r.a.createElement(Q.a,null))),r.a.createElement(v.ListItemText,{primary:t.module,className:a.breakWord})),r.a.createElement(z.a,{variant:"inset",component:"li"})),r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemAvatar,null,r.a.createElement(V.a,null,r.a.createElement(X.a,null))),r.a.createElement(v.ListItemText,{primary:t.message,className:a.breakWord}))),t.action&&r.a.createElement("div",null,r.a.createElement(z.a,null),r.a.createElement(L.a,{style:{width:"100%"}},r.a.createElement(v.ListItem,null,r.a.createElement(v.ListItemText,{primary:t.action,className:a.breakWord})))))})),e}return C()(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.data,o=t.open,a=t.hasButton,i=this.props.title;return r.a.createElement(w,{open:o,title:i,style:{maxWidth:500},onCancel:function(){return e.setState({open:!1})},onSubmit:n.buttonAction,submitText:n.buttonText,submitColor:"primary",hasSubmitButton:a,hasCancelButton:!1},this.renderAlertInfo())}}]),n}(o.Component);ee.propTypes={title:u.a.string,props:u.a.array},ee.defaultProps={title:"Log Details",props:[]};var te=Object(p.withStyles)((function(e){return{breakWord:{wordBreak:"break-all"}}}),{withTheme:!0})(ee),ne=n(55),oe=n.n(ne),re=function(e){return r.a.createElement(oe.a,{style:e.style,anchor:e.anchor,open:e.open,onClose:e.onClose},e.children)};re.propTypes={style:u.a.object,anchor:u.a.string,open:u.a.bool,children:u.a.object},re.defaultProps={style:{},anchor:"left",open:!1,children:r.a.createElement("div",null)},re.ANCHOR={left:"left",right:"right",top:"top",bottom:"bottom"};var ae=re,ie=n(18),ce=n.n(ie),ue=n(40),se=n.n(ue),le=n(56),fe=n.n(le),de=n(84),he=n.n(de);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=function(e){var t=r.a.useState(e.open),n=ce()(t,2),o=n[0],a=n[1];r.a.useEffect((function(){e.open!==o&&a(e.open)}),[e.open]);var i;return r.a.createElement(v.List,null,r.a.createElement(v.ListItem,{button:!0,onClick:(i=e.onClick,function(){a(!o),i()})},o?r.a.createElement(fe.a,{style:pe({},e.iconStyle)}):r.a.createElement(se.a,{style:pe({},e.iconStyle)}),r.a.createElement("div",{style:{width:"100%"}},e.item)),e.divided?r.a.createElement(v.Divider,null):[],r.a.createElement(he.a,{className:e.className,style:e.style,in:o},e.children))};ve.propTypes={item:u.a.object,onClick:u.a.func,open:u.a.bool,divided:u.a.bool,iconStyle:u.a.object},ve.defaultProps={item:r.a.createElement("div",null),onClick:function(){},open:!1,divided:!1,style:{},iconStyle:{}};var ge=ve,ye=Object(p.makeStyles)((function(e){return{drawerClose:{overflowX:"hidden",width:65},logoArea:{padding:"17px",textAlign:"center",alignItems:"center",justifyContent:"center"},navigationArea:{flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center"},accountArea:{padding:function(e){return e.unsetAccountAreaPadding?"unset":"17px"},textAlign:"center",alignItems:"center",justifyContent:"center"}}})),be=function(e){var t=ye(e);return r.a.createElement(oe.a,{open:!1,variant:"permanent",className:t.drawerClose,classes:{paper:t.drawerClose}},r.a.createElement("div",{className:t.logoArea},e.upperElement),r.a.createElement("div",{className:t.navigationArea},e.navigationList.map((function(e,t){return r.a.createElement("div",{key:t,style:{padding:"15px 0px"}},e)}))),r.a.createElement("div",{className:t.accountArea},e.lowerElement))};be.propTypes={upperElement:u.a.node,navigationList:u.a.array,lowerElement:u.a.node.isRequired,unsetAccountAreaPadding:u.a.bool},be.defaultProps={upperElement:r.a.createElement("div",null),navigationList:[r.a.createElement("div",null)],lowerElement:r.a.createElement("div",null),unsetAccountAreaPadding:!1};var Ae=be,we=n(44),Me=n.n(we),Ee=n(30),Pe=n.n(Ee),xe=function(e){var t=e.style,n=r.a.useState(null),o=ce()(n,2),a=o[0],i=o[1],c=function(){i(null)};return r.a.createElement("div",{style:t},r.a.cloneElement(e.element,{onClick:function(t){void 0!==e.element.props.onClick&&e.element.props.onClick(),i(t.currentTarget)}}),r.a.createElement(Me.a,{id:"simple-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:c},e.menuList.reduce((function(e,t,n){return t&&"function"!=typeof t&&e.push(r.a.createElement(Pe.a,{onClick:function(){t.onClick(),(t.onClose||void 0===t.onClose)&&c()},key:n},t.element)),e}),[])))};xe.propTypes={element:u.a.node.isRequired,navigationList:u.a.array,lowerElement:u.a.node.isRequired,width:u.a.string,backgroundColor:u.a.string},xe.defaultProps={element:r.a.createElement("div",null,"Ahaha"),menuList:[{onClick:function(){return console.log("clicked 1")},element:"Profile",onClose:!0}],lowerElement:r.a.createElement("div",null),width:"68px",backgroundColor:"#424242",style:{}};var ke=xe,Ce=n(14),Se=n.n(Ce),Oe=n(85),Ne=n.n(Oe),Te=n(86),Ie=n.n(Te),Be=n(87),Re=n.n(Be),De=n(88),Fe=n.n(De),Le=n(89),je=n.n(Le),Ve=n(49),Ue=n.n(Ve),ze=n(90),Ke=n.n(ze),Ge=n(91),qe=n.n(Ge),We=n(92),_e=n.n(We),He=n(93),Ye=n.n(He),Qe=n(94),Ze=n.n(Qe),Xe=n(95),Je=n.n(Xe),$e=n(96),et=n.n($e),tt=n(37),nt=n.n(tt),ot=n(97),rt=n.n(ot),at={Add:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ie.a,Se()({},e,{ref:t}))})),Check:Object(o.forwardRef)((function(e,t){return r.a.createElement(Fe.a,Se()({},e,{ref:t}))})),Clear:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ue.a,Se()({},e,{ref:t}))})),Delete:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ke.a,Se()({},e,{ref:t}))})),DetailPanel:Object(o.forwardRef)((function(e,t){return r.a.createElement(se.a,Se()({},e,{ref:t}))})),Edit:Object(o.forwardRef)((function(e,t){return r.a.createElement(qe.a,Se()({},e,{ref:t}))})),Export:Object(o.forwardRef)((function(e,t){return r.a.createElement(et.a,Se()({},e,{ref:t}))})),Filter:Object(o.forwardRef)((function(e,t){return r.a.createElement(_e.a,Se()({},e,{ref:t}))})),FirstPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ye.a,Se()({},e,{ref:t}))})),LastPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ze.a,Se()({},e,{ref:t}))})),NextPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(se.a,Se()({},e,{ref:t}))})),PreviousPage:Object(o.forwardRef)((function(e,t){return r.a.createElement(je.a,Se()({},e,{ref:t}))})),ResetSearch:Object(o.forwardRef)((function(e,t){return r.a.createElement(Ue.a,Se()({},e,{ref:t}))})),Search:Object(o.forwardRef)((function(e,t){return r.a.createElement(nt.a,Se()({},e,{ref:t}))})),SortArrow:Object(o.forwardRef)((function(e,t){return r.a.createElement(Re.a,Se()({},e,{ref:t}))})),ThirdStateCheck:Object(o.forwardRef)((function(e,t){return r.a.createElement(Je.a,Se()({},e,{ref:t}))})),ViewColumn:Object(o.forwardRef)((function(e,t){return r.a.createElement(rt.a,Se()({},e,{ref:t}))}))},it=function(e){return r.a.createElement(Ne.a,{style:e.style,title:e.title,columns:e.columns,data:e.data,icons:at,actions:e.actions,options:e.options,components:e.components,localization:e.localization})};it.propTypes={style:u.a.object,title:u.a.string,columns:u.a.array,data:u.a.array,actions:u.a.array,options:u.a.object,components:u.a.object,localization:u.a.object},it.defaultProps={style:{},title:"",columns:[],data:[],actions:[],options:{actionsColumnIndex:-1,draggable:!1,grouping:!1,search:!1,toolbar:!1,searchFieldAlignment:"left",paging:!1},components:{}};var ct=it,ut=n(31),st=n.n(ut),lt=n(98),ft=n.n(lt),dt=n(99),ht=n.n(dt);function mt(e){var t=e.children,n=e.selectedTab,o=e.index,a=st()(e,["children","selectedTab","index"]);return r.a.createElement(G.a,Se()({component:"div",role:"tabpanel",hidden:n!==o,id:"tabpanel-".concat(o),"aria-labelledby":"tab-".concat(o)},a),n===o&&t)}mt.propTypes={children:u.a.node,index:u.a.any.isRequired,selectedTab:u.a.any.isRequired};var pt=Object(p.makeStyles)((function(e){return{root:{flexGrow:1,height:"100%"},tabPanel:{flexGrow:1,minHeight:0,height:"calc(100% - 48px)",overflowY:"auto"}}}));function vt(e){var t=pt(),n=r.a.useState(e.selectedTab),o=ce()(n,2),a=o[0],i=o[1];r.a.useEffect((function(){e.selectedTab!==a&&i(e.selectedTab)}),[e.selectedTab]);return r.a.createElement("div",{className:t.root},r.a.createElement(ft.a,{value:a,onChange:function(e,t){i(t)},indicatorColor:"primary",textColor:"primary"},e.tabList.map((function(e,t){return r.a.createElement(ht.a,Se()({key:t,label:e.label},function(e){return{id:"tab-".concat(e),"aria-controls":"tabpanel-".concat(e)}}(t)))}))),e.tabList.map((function(n,o){return r.a.createElement(mt,{key:o,selectedTab:a,index:o,className:e.scrollable?t.tabPanel:void 0},n.component)})))}vt.propTypes={tabList:u.a.array,selectedTab:u.a.number,scrollable:u.a.bool},vt.defaultProps={tabList:[{label:"Tab 1",component:r.a.createElement("div",null,"Component 1")},{label:"Tab 2",component:r.a.createElement("div",null,"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.")},{label:"Tab 3",component:r.a.createElement("div",null,"Component 3")}],selectedTab:0,scrollable:!0};var gt=n(100),yt=n.n(gt),bt=function(e){return r.a.createElement(yt.a,e)};bt.propTypes={},bt.defaultProps={};var At=bt,wt=n(101),Mt=n.n(wt),Et=n(102),Pt=n.n(Et),xt=n(63);function kt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kt(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var St=Object(p.makeStyles)((function(e){return{label:{fontFamily:"Roboto",fontStyle:"normal",fontWeight:"normal",fontSize:"14px",marginLeft:0,marginRight:0,marginBottom:0},colorSwitchBase:{color:xt.grey[300],"&$colorChecked":{color:xt.green[500],"& + $colorBar":{backgroundColor:xt.green[500]}}},colorBar:{},colorChecked:{}}})),Ot=function(e){var t=St();return r.a.createElement(Mt.a,{control:r.a.createElement(Pt.a,{checked:e.toggle,onChange:e.onToggle,color:e.color,disabled:e.disabled,hidden:e.hidden,size:e.size,classes:{switchBase:t.colorSwitchBase,checked:t.colorChecked,track:t.colorBar}}),labelPlacement:e.labelPlacement,label:e.label,classes:{label:t.label},style:Ct(Ct({},e.style),{},{marginLeft:0,marginRight:0,marginBottom:0})})};Ot.propTypes={toggle:u.a.bool,onToggle:u.a.func,label:u.a.string,color:u.a.string,labelPlacement:u.a.string,style:u.a.object},Ot.defaultProps={color:"primary"};var Nt=Ot,Tt=n(103),It=n.n(Tt);function Bt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Rt=function(e){T()(n,e);var t=Bt(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"searchInput",void 0),d()(O()(e),"timer",void 0),d()(O()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.props.enableTimeout?(e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,e.props.time)):e.handleSearch()})),d()(O()(e),"handleSearch",(function(){void 0!==e.searchInput&&e.props.onChange(e.searchInput)})),e}return C()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=e.style,o=e.placeholder;return r.a.createElement("div",{className:t.search,style:n},r.a.createElement("div",{className:t.searchIcon},r.a.createElement(nt.a,null)),r.a.createElement(It.a,{ref:this.setSearchInput,placeholder:o,classes:{root:t.inputRoot,input:t.inputInput},inputProps:{"aria-label":"search"},onChange:this.handleChange}))}}]),n}(o.Component);Rt.propTypes={placeholder:u.a.string,onChange:u.a.func,time:u.a.number,enableTimeout:u.a.bool,style:u.a.object},Rt.defaultProps={placeholder:"Search...",onChange:function(e){console.log(e)},time:250,enableTimeout:!0,style:{}};var Dt=Object(p.withStyles)((function(e){return{search:d()({position:"relative",borderRadius:e.shape.borderRadius,backgroundColor:Object(p.fade)(e.palette.common.white,.15),"&:hover":{backgroundColor:Object(p.fade)(e.palette.common.white,.25)},marginRight:e.spacing(2),marginLeft:0,width:"100%"},e.breakpoints.up("sm"),{marginLeft:e.spacing(3),width:"auto"}),searchIcon:{width:e.spacing(7),height:"100%",position:"absolute",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},inputRoot:{color:"inherit"},inputInput:d()({padding:e.spacing(1,1,1,7),transition:e.transitions.create("width"),width:"100%"},e.breakpoints.up("md"),{width:200})}}),{withTheme:!0})(Rt),Ft=n(104),Lt=n.n(Ft),jt=n(105),Vt=n.n(jt),Ut=Object(p.makeStyles)((function(e){return{root:{"& > * + *":{marginTop:e.spacing(2)}},link:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans","&:hover":{cursor:"pointer",textDecoration:"underline"}},lastLabel:{fontSize:"24px",fontWeight:800,fontFamily:"Open Sans"}}})),zt=function(e){var t=Ut();return r.a.createElement("div",{className:t.root},r.a.createElement(Lt.a,{separator:r.a.createElement(Vt.a,{fontSize:"small"}),"aria-label":"breadcrumb",style:e.style},e.pathList.map((function(n,o){if(e.pathList.length-1!==o)return r.a.createElement(G.a,{key:o,color:"primary",variant:"inherit",className:t.link,onClick:n.function},n.label)})),r.a.createElement(G.a,{color:"textPrimary",className:t.lastLabel},e.pathList[e.pathList.length-1].label)))};zt.propTypes={pathList:u.a.array},zt.defaultProps={pathList:[{label:"Mov.ai",function:function(){return console.log("pth1/")}},{label:"User",function:function(){return console.log("path1/path2")}},{label:"John Doe"}]};var Kt=zt,Gt=n(26),qt=n.n(Gt),Wt=n(17),_t=n.n(Wt),Ht=n(22),Yt=n.n(Ht),Qt=n(2),Zt=n(57),Xt=n.n(Zt),Jt=n(20);function $t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tn=Object(p.makeStyles)((function(e){return{root:{}}})),nn={display:"flex",flexDirection:"column",flexGrow:1},on=function(e){var t=e.antialias,n=e.engineOptions,a=e.adaptToDeviceRatio,i=e.sceneOptions,c=e.onRender,u=e.onSceneReady,s=e.is2render,l=e.sceneFactory,f=st()(e,["antialias","engineOptions","adaptToDeviceRatio","sceneOptions","onRender","onSceneReady","is2render","sceneFactory"]),d=Object(p.useTheme)(),h=tn(),m=Object(o.useRef)(null),v=Object(o.useState)(!1),g=ce()(v,2),y=g[0],b=g[1],A=Object(o.useState)(null),w=ce()(A,2),M=w[0],E=w[1],P=Object(o.useState)({width:100,height:100}),x=ce()(P,2),k=x[0],C=x[1];return Object(o.useEffect)((function(){if(!y){b(!0);var e=new Qt.Engine(m.current,t,n,a);!function(e,t){s&&e.runRenderLoop((function(){"function"==typeof c&&c(t),t&&t.render()}))}(e,function(e){var t=l?l(e):new Qt.Scene(e,i);return E(t),t.isReady()?u(t):t.onReadyObservable.addOnce((function(e){return u(e)})),t}(e))}return function(){console.log("Disposing engine and scene"),M&&M.dispose(),M&&M.getEngine()&&M.getEngine().dispose()}}),[m,y,M]),Object(o.useEffect)((function(){M&&(M.clearColor=Jt.a[(null==d?void 0:d.label)||"default"])}),[h,d.label,M]),r.a.createElement("div",{style:en(en({},nn),{},{maxHeight:"100%"})},r.a.createElement("canvas",Se()({ref:m,width:k.width,height:k.height},f)),r.a.createElement(Xt.a,{handleWidth:!0,handleHeight:!0,onResize:function(e,t){C({width:e,height:t}),M&&M.getEngine().resize()}}))};on.propTypes={antialias:u.a.bool,engineOptions:u.a.object,adaptToDeviceRatio:u.a.bool,sceneOptions:u.a.object,onSceneReady:u.a.func,onRender:u.a.func,is2render:u.a.bool,sceneFactory:u.a.func},on.defaultProps={antialias:!0,onSceneReady:function(e){},is2render:!0,engineOptions:{preserveDrawingBuffer:!0,stencil:!0}};var rn=on,an=n(10),cn=n(25),un=n(16),sn=n.n(un),ln=n(8),fn=n(6),dn=function(){function e(){x()(this,e),this.memory={}}return C()(e,[{key:"action",value:function(e){e.getSceneMemory().forEach((function(e){e.gizmoManager.attachedMesh=null,e.camera.attachControl(e.canvas,!0)})),e.closeContextDial&&e.closeContextDial(),e.setContextActionIndex&&e.setContextActionIndex()}},{key:"onChange",value:function(e){}}]),e}(),hn=n(23);function mn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var pn=function(e){T()(n,e);var t=mn(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return x()(this,n),r=t.call(this,e,a),d()(O()(r),"getCopyFunction",(function(){return function(e,t){}})),r.assetName=o,r}return C()(n,[{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.assetName=this.assetName,e}}]),n}(hn.a);function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function gn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var yn=function(e){T()(n,e);var t=gn(n);function n(e,o,r,a){var i;return x()(this,n),i=t.call(this,e,a),d()(O()(i),"getType",(function(){return n.TYPE})),i.size=o,i.textureSrc=r,i}return C()(n,[{key:"dispose",value:function(){sn()(D()(n.prototype),"dispose",this).call(this)}},{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.size=this.size,e.textureSrc=this.textureSrc,e}},{key:"toForm",value:function(){var e=this.toDict();return{jsonSchema:{type:"object",properties:{oldName:{type:"string"},name:{type:"string",title:"Name"},type:{type:"string",title:"Type"},assetName:{type:"string",title:"Asset Name"}}},uiSchema:{type:{"ui:disabled":!0},assetName:{"ui:disabled":!0},oldName:{"ui:widget":"hidden"}},data:{oldName:e.name,name:e.name,type:e.type,assetName:e.assetName}}}},{key:"ofForm",value:function(e){this.name=e.name,this.mesh.name=e.name,this.keyValueMap=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.annotations)}}]),n}(pn);d()(yn,"TYPE","Map");var bn=yn,An=n(45),wn=(n(130),n(131),function e(){x()(this,e)});d()(wn,"createGizmo",(function(e){var t=new Qt.RotationGizmo(new Qt.UtilityLayerRenderer(e));return t.xGizmo.dragBehavior.detach(),t.xGizmo.scaleRatio=0,t.yGizmo.dragBehavior.detach(),t.yGizmo.scaleRatio=0,t})),d()(wn,"createCamera",(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){},o=1,r=ln.a.cameraBuilder(e).sphericalCoordinates(new Qt.Vector3(0,0,14)).target(Qt.Vector3.Zero()).name("camera").build();return r.attachControl(t,!1),r.inertia=.7,r.collisionRadius=new Qt.Vector3(o,o,o),r.panningInertia=.5,r.checkCollisions=!0,r.panningSensibility=0,r.lowerRadiusLimit=2,n(r),r})),d()(wn,"createLight",(function(e){return ln.a.directionalLightBuilder(e).name("light").direction(new Qt.Vector3(0,-1,0)).intensity(.35).build()})),d()(wn,"createMeshGround",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,o=Qt.Mesh.CreateGround("groundMesh",t,n,20,e);return o.translate(new Qt.Vector3(0,-1,0),.01,Qt.Space.WORLD),o.material=new Qt.StandardMaterial("wireframe",e),o.material.wireframe=!0,o.isPickable=!1,o.checkCollisions=!0,o})),d()(wn,"createScene",(function(e){var t=new Qt.Scene(e);return t.collisionsEnabled=!0,t._uid=t.getUniqueId(),Jt.b.DEBUG&&t.debugLayer.show({embedMode:!0,globalRoot:document.body,overlay:!0}),t})),d()(wn,"createMouseLocationText",(function(e){var t=An.AdvancedDynamicTexture.CreateFullscreenUI("UI",!0,e),n=new An.TextBlock;return n.text="",n.color="white",n.fontSize=17,n.left=-560,n.top=-145,t.addControl(n),n}));var Mn=wn;function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Pn=function(e){T()(n,e);var t=En(n);function n(){return x()(this,n),t.apply(this,arguments)}return C()(n,[{key:"onPointerDown",value:function(e,t){}},{key:"onPointerMove",value:function(e,t){}},{key:"onPointerUp",value:function(e,t){}},{key:"onKeyUp",value:function(e,t){}},{key:"onWheel",value:function(e,t){}}]),n}(dn),xn=n(36);function kn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(n){e.push({predicate:function(e){return!0},action:t});for(var o=0;o<e.length;o++){var r=e[o];if(r.predicate(n)){r.action();break}}}}var Cn=n(107),Sn=n.n(Cn);function On(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Nn=function(e){T()(n,e);var t=On(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"getType",(function(){return n.TYPE})),e}return C()(n,[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=an.Maybe.fromNull(t).map((function(e){return e.name})).orSome("KeyPoint".concat(Math.floor(1e3*Math.random()))),r=Qt.MeshBuilder.CreatePolyhedron(o,{custom:Tn,size:n.DEFAULT_SIZE},e),a=new Qt.StandardMaterial("KeyPointMaterial".concat(o),e);r.material=a,r.convertToFlatShadedMesh(),r.rotationQuaternion=Qt.Quaternion.Identity();var i=ln.a.referentialBuilder(e).isPickable(!1).boxParams({isVisible:!1,size:.1*n.DEFAULT_SIZE}).name("".concat(o,"Axis")).build();return i.parent=r,hn.a.mapDict2Mesh(t,r),new n(r,t.keyValueMap)}}]),n}(hn.a);d()(Nn,"TYPE","KeyPoint"),d()(Nn,"DEFAULT_SIZE",.25);var Tn={name:"Triangular Antiprism (Octahedron)",category:["Antiprism"],vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},In=Nn,Bn=n(27),Rn=function(){function e(t){var n=this;return x()(this,e),t.getSceneMemory().map((function(e){var o=e.scene,r=o._uid;return r in Dn?Dn[r]:(n.scene=o,n.mainView=t,n.meshSelectionSet=new Set,Dn[r]=n,n)})).orSome(this)}return C()(e,[{key:"add",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.meshSelectionSet.has(e)?t&&this.meshSelectionSet.delete(e):this.meshSelectionSet.add(e),this}},{key:"addArray",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.forEach((function(e){return t.add(e,n)})),this}},{key:"clear",value:function(){return this.meshSelectionSet=new Set,this}},{key:"meshes",value:function(){return _t()(this.meshSelectionSet)}},{key:"has",value:function(e){return this.meshSelectionSet.has(e)}},{key:"filter",value:function(e){var t=new Set;return this.meshSelectionSet.forEach((function(n){e(n)&&t.add(n)})),this.meshSelectionSet=t,this}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),Dn={},Fn=function(){function e(t){var n=this;return x()(this,e),t.getSceneMemory().map((function(e){var o=e.scene,r=o._uid;return r in Un?Un[r]:(n.scene=o,n.mesh=null,n.arrayOfMeshes=[],n.angleByMeshName={},n.mainView=t,n.theta=0,Un[r]=n,n)})).orSome(this)}return C()(e,[{key:"push",value:function(e){if(0===e.length)return this;e=Array.isArray(e)?e:[e],this.arrayOfMeshes=Sn()(this.arrayOfMeshes.concat(e),(function(e){return e.name})),this.angleByMeshName=this.arrayOfMeshes.reduce((function(e,t){return e[t.name]=Vn(t),e}),{});var t=ln.a.pointAverage(this.arrayOfMeshes.map((function(e){return ln.a.getGlobalCoordinates(e,e.position).toBabylon()})));return this.createPlaceHolderIn(t),this}},{key:"clear",value:function(){return this.arrayOfMeshes=[],this.mesh&&this.mesh.dispose(),this}},{key:"createPlaceHolderIn",value:function(t){var n=this;(null===this.mesh||this.mesh.isDisposed())&&(this.mesh=In.ofDict(this.scene,{name:zn,type:e,position:[0,0,0],quaternion:Qt.Quaternion.Identity(),color:[.5,.5,.5],keyValueMap:{},isVisible:!0}).mesh,this.mesh.material=this.getSelPlaceHolderShader());var o=this;return this.mesh.getMouseContextActions=function(){return[{title:"Delete",onClick:function(){o.mainView.addGizmo2Mesh(),o.clear(),Rn.ofMainView(n.mainView).clear(),o.mainView.highlightMeshesInScene(),o.mainView.highlightNodesInTree()}}]},this.mesh.onClick=function(){},this.mesh.isSelectionPlaceHolder=!0,this.mesh.parent=this.mainView.getRootNode().item.mesh,this.mesh.position=t.add(new Qt.Vector3(0,0,Kn)),this.mesh.observers=new Qt.Observable,this.mesh.observers.add(this.getPlaceHolderObs()),this.mesh}},{key:"getSelPlaceHolderShader",value:function(){return ln.a.getShaderMaterial({name:"placeHolderShader",vertex:Ln,frag:jn})(this.scene)}},{key:"getPlaceHolderObs",value:function(){var e=this;return function(t){var n=t.updatedPointMesh,o=t.is2updateServer,r=t.displacement,a=e.arrayOfMeshes.filter((function(e){return!e.isDisposed()})),i=Vn(n),c=i-e.theta;e.theta=i,a.forEach((function(t){!function(e,t,n,o,r,a){Math.abs(r)<.001?function(e,t){var n=ln.a.getLocalCoordFromWorld(e,fn.a.ofBabylon(t),!1),o=fn.a.ofBabylon(e.position).add(n);e.position=o.toBabylon()}(t,n):function(e,t,n,o,r){var a=fn.a.ofBabylon(e.position),i=fn.a.ofBabylon(t.position).sub(a).toVec2(),c=Bn.a.of(Math.cos(n),Math.sin(n)).prod(i),u=fn.a.of([c.x,c.y,0]).toBabylon();t.position=new Qt.Vector3(e.position.x,e.position.y,t.position.z).add(u);var s=o.angleByMeshName[t.name]+r;t.rotationQuaternion=new Qt.Quaternion(0,0,Math.sin(s/2),Math.cos(s/2))}(o,t,r,a,e)}(i,t,r,n,c,e),o&&e.mainView.updateNodeInServer(t.name),an.Maybe.fromNull(t.observers).forEach((function(e){return e.notifyObservers({updatedPointMesh:t,is2updateServer:o,displacement:r})})),an.Maybe.fromNull(t.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:t,is2updateServer:o,displacement:r})}))})),0===a.length&&e.clear()}}}],[{key:"ofMainView",value:function(t){return new e(t)}}]),e}(),Ln="precision highp float;\n\n// Attributes\nattribute vec3 position;\nattribute vec3 normal;\n\n// Uniforms\nuniform mat4 worldViewProjection;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = worldViewProjection * vec4(position, 1.0);\n    vPosition = position;\n    vNormal = normal;\n}",jn="\nprecision highp float;\n\n// Varying\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n\n// Uniforms\nuniform mat4 world;\nuniform float time;\n\nvoid main(void) {\n    // World values\n    vec3 p = vec3(world * vec4(vPosition, 1.0));\n    vec3 n = normalize(vec3(world * vec4(vNormal, 0.0)));\n    vec3 nColor = n * 0.5 + 0.5;\n    float spatialFreq = 20.;\n    float timeFreq = 10.;\n    float power = sin(spatialFreq * p.y - timeFreq * time);\n    power *= power;\n    vec3 color = power *  nColor + (1. - power) * vec3(1,1,1);\n    gl_FragColor = vec4(color, 1.);\n}",Vn=function(e){return an.Maybe.fromNull(e.rotationQuaternion).map((function(e){return 2*Math.atan2(e.z,e.w)})).orSome(0)},Un={},zn="placeholder",Kn=1.5;var Gn=Fn,qn=n(42),Wn=n.n(qn),_n=n(38),Hn=n(29),Yn=n(24);function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Jn=function(e){T()(n,e);var t=Xn(n);function n(){var e,o,a;return x()(this,n),a=t.call(this),d()(O()(a),"action",(function(t){sn()((e=O()(a),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(a))})),d()(O()(a),"onPointerDown",(function(e,t){1!==e.buttons&&2!==e.buttons||e.ctrlKey||t.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;a.maybeSelectedMesh=ln.a.pickMesh(o,r),a.maybeSelectedMesh.forEach((function(n){return a.dragDownMesh(n,t,e)})),a.maybeSelectedMesh.orLazy((function(){a.dragDownWithoutMesh(t,e)}))}))})),d()(O()(a),"onPointerMove",(function(e,t){1!==e.buttons||e.ctrlKey||t.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;a.maybeSelectedMesh.forEach((function(e){ln.a.getGroundPosition(o,r).forEach((function(e){a.dragMoveMesh(t,e)}))})),a.maybeSelectedMesh.orLazy((function(){a.dragMoveWithoutMesh(e)}))}))})),d()(O()(a),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.camera,o=e.scene,r=e.ground,i=e.canvas;a.maybeSelectedMesh.forEach((function(e){a.dragUpMesh(e,t,o,r)})),a.maybeSelectedMesh.orLazy((function(){a.dragUpWithoutMesh(t,o)})),n.attachControl(i,!0),a.maybeSelectedMesh=an.Maybe.none(),a.destroySelectionDiv(),a.corners=[]}))})),d()(O()(a),"onKeyUp",(function(e,t){kn([{predicate:function(e){return["Backspace","Delete"].includes(e.code)},action:a.getDeleteButtonAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyC"===e.code},action:a.getCopyAction(t)},{predicate:function(e){return e.ctrlKey&&"KeyV"===e.code},action:a.getPasteAction(t)}],(function(){return sn()((o=O()(a),D()(n.prototype)),"onKeyUp",o).call(o,e,t)}))(e)})),d()(O()(a),"handleMeshRightClick",(function(e,t,n){2===e.buttons&&n&&n.getMouseContextActions&&t.setMouseContextActions(e,n.getMouseContextActions(t))})),d()(O()(a),"handleRightClickWithoutMesh",(function(e,t,n){2===e.buttons&&t.setMouseContextActions(e,[{title:"Paste",onClick:a.getPasteOnClick(n,t)}])})),d()(O()(a),"getPasteOnClick",(function(e,t){return function(){var n=xn.a.paste();n&&"function"==typeof n&&n(e,t)}})),d()(O()(a),"notifyChildrenObserversRecursively",(function(e,t,n,o){e.forEach((function(e){(e.observers||e.graphVertex)&&o.getNodeFromTree(e.name).isSome()&&a.notifyObservers(e,t,n,o),e._children&&e._children.length&&a.notifyChildrenObserversRecursively(e._children,t,n,o)}))})),d()(O()(a),"setProperties",(function(e,t){return e.setPropertiesWithName(t)})),a.key="dragObject",a.name="Grab Objects [1]",a.icon=function(e){return r.a.createElement("i",Se()({className:"far fa-hand-paper"},e))},a.maybeSelectedMesh=an.Maybe.none(),a.clickPointInWorld=fn.a.ZERO,a.movePointInWorld=fn.a.ZERO,a.startDivPos=Bn.a.ZERO,a.corners=[],a}return C()(n,[{key:"dragDownMesh",value:function(e,t,n){var o=this;e.isStatic||t.getSceneMemory().forEach((function(r){var a=r.camera,i=r.canvas,c=r.scene,u=r.ground;a.detachControl(i),o.addSelectedMesh(n,e,t),o.handleMeshRightClick(n,t,e),ln.a.getGroundPosition(c,u).forEach((function(n){o.updateMouseVars(n),e.onClick?e.onClick():t.closeContextDial(),e.isSelectionPlaceHolder?t.addGizmo2Mesh(e,(function(){o.notifyObservers(e,!1,fn.a.ZERO,t)}),(function(){o.notifyObservers(e,!0,fn.a.ZERO,t)})):o.selectMeshUpdateUI(t)}))}))}},{key:"selectMeshUpdateUI",value:function(e){var t=this,n=Rn.ofMainView(e),o=Gn.ofMainView(e),r=n.meshes();e.highlightMeshesInScene(r),e.highlightNodesInTree(r.map((function(e){return e.name}))),r.length>1?(e.addGizmo2Name(),o.clear(),o.push(r),this.setProperties(e,r[0].name)):(o.clear(),e.addGizmo2Name(),r.forEach((function(n){e.addGizmo2Name(n.name),t.setProperties(e,n.name)})))}},{key:"dragDownWithoutMesh",value:function(e,t){var n=this;e.getMouseCoordsFromRoot().forEach((function(o){return n.handleRightClickWithoutMesh(t,e,o)})),e.getSceneMemory().forEach((function(e){var o=e.camera,r=e.canvas,a=e.scene;t.shiftKey&&(o.detachControl(r),n.createSelectionDiv(t),n.corners.push(Bn.a.of(a.pointerX,a.pointerY)))}))}},{key:"dragMoveMesh",value:function(e,t){var n=this,o=Rn.ofMainView(e).meshes(),r=Gn.ofMainView(e),a=fn.a.ofBabylon(t),i=a.sub(this.movePointInWorld);if(o.forEach((function(t){var o=ln.a.getLocalCoordFromWorld(t,i,!1);o=new Qt.Vector3(o.x,o.y,0),t.position=t.position.add(o),n.notifyObservers(t,!1,i,e)})),o.length>1){var c=ln.a.getLocalCoordFromWorld(r.mesh,i,!1);c=new Qt.Vector3(c.x,c.y,0),r.mesh.position=r.mesh.position.add(c)}this.movePointInWorld=a}},{key:"dragMoveWithoutMesh",value:function(e){this.updateSelectionDiv(e)}},{key:"dragUpMesh",value:function(e,t,n,o){var r=this,a=Rn.ofMainView(t),i=a.meshes(),c=Gn.ofMainView(t);ln.a.getGroundPosition(n,o).forEach((function(u){var s=fn.a.ofBabylon(u).sub(r.clickPointInWorld),l=s.length()>.001;i.forEach((function(e){var n=l||!!e.edgeIndexes;r.notifyObservers(e,n,fn.a.ZERO,t),l&&t.updateNodeInServer(e.name)})),r.setProperties(t,e.name),l&&t.getUndoManager().addIt(r.getUndoAbleAction(i,s,t)),e.isSelectionPlaceHolder&&(a.clear(),a.addArray(c.arrayOfMeshes)),r.mergePathsIfAny(e,t,n,o)}))}},{key:"dragUpWithoutMesh",value:function(e,t){this.selectObjectsInside(t,e)}},{key:"updateMouseVars",value:function(e){var t=fn.a.ofBabylon(e);this.movePointInWorld=t,this.clickPointInWorld=t}},{key:"addSelectedMesh",value:function(e,t,n){var o=Rn.ofMainView(n);if(t.edgeIndexes)return o.clear(),void o.add(t);if(o.filter((function(e){return!e.edgeIndexes})),e.shiftKey)o.add(t);else{if(o.has(t))return;o.clear(),o.add(t)}}},{key:"getDeleteButtonAction",value:function(e){return function(){var t=Rn.ofMainView(e),n=t.meshes(),o=1===n.length;n.forEach((function(t){var n=e.getNodeFromTree(t.name);n.forEach((function(t){return e.onDeleteNode(t,o,o)})),n.orElseRun((function(){if(o){var n=e.getContextActions();n[0]&&n[0].action(e),t.onDel&&t.onDel()}}))})),e.highlightNodesInTree(),e.highlightMeshesInScene(),e.addGizmo2Mesh(),t.clear(),Gn.ofMainView(e).clear(),e.renderMenus()}}},{key:"getCopyAction",value:function(e){var t=this,n=Rn.ofMainView(e).meshes(),o=Gn.ofMainView(e).mesh;return function(){n.length<=1?t.copyOne(n):t.copyMany(n,o)}}},{key:"copyOne",value:function(e){xn.a.copy((function(t,n){var o=xn.a.getUID(),r=e.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})).map((function(e){return e.getCopyFunction(!0,(function(e){return e+"_copy"+o}))}));if(0!==r.length){var a=function(){var e=r[0](t,n);return e.forEach((function(e){var t=e.mesh;n.addGizmo2Name(t.name),n.highlightMeshesInScene([t]),n.highlightNodesInTree([t.name]),Rn.ofMainView(n).clear().add(t),n.setProperties(e.toForm()),n.renderMenus()})),e},i=a();n.getUndoManager().addIt(J.UndoManager.actionBuilder().doAction(a).undoAction((function(){i.forEach((function(e){var t=e.mesh;n.deleteNodeFromTreeUsingName(t.name),n.highlightMeshesInScene(),n.highlightNodesInTree(),n.renderMenus()}))})).build())}}))}},{key:"copyMany",value:function(e,t){xn.a.copy((function(n,o){var r=e.filter((function(e){return!!e.nodeItem})).map((function(e){return e.nodeItem})),a=r.map((function(){return xn.a.getUID()})),i=r.map((function(e,t){return e.getCopyFunction(!1,(function(e){return e+"_copy"+a[t]}))})),c=function(){var e=i.map((function(e,a){return e(ln.a.toGlobalCoord(o)(r[a].mesh.absolutePosition).subtract(t.position).add(n),o)})).filter((function(e){return e.isSome()})).map((function(e){return e.some()})),a=e.map((function(e){return e.mesh})),c=e.map((function(e){return e.name}));return o.addGizmo2Name(),o.highlightMeshesInScene(a),o.highlightNodesInTree(c),Rn.ofMainView(o).clear().addArray(a),Gn.ofMainView(o).clear().push(a),o.renderMenus(),o.forceUpdate(),e},u=c();o.getUndoManager().addIt(J.UndoManager.actionBuilder().doAction(c).undoAction((function(){u.forEach((function(e){var t=e.mesh;o.deleteNodeFromTreeUsingName(t.name,!0,!1)})),o.highlightMeshesInScene(),o.highlightNodesInTree(),Rn.ofMainView(o).clear(),Gn.ofMainView(o).clear(),o.renderMenus(),o.forceUpdate()})).build())}))}},{key:"getPasteAction",value:function(e){var t=this;return function(){e.getMouseCoordsFromRoot().forEach((function(n){return t.getPasteOnClick(n,e)()}))}}},{key:"notifyObservers",value:function(e,t,n,o){an.Maybe.fromNull(e.observers).forEach((function(o){o.notifyObservers({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),an.Maybe.fromNull(e.graphVertex).forEach((function(o){(0,o.vertexObs)({updatedPointMesh:e,is2updateServer:t,displacement:n.toBabylon()})})),o.getNodeFromTree(e.name).isSome()&&this.notifyChildrenObserversRecursively((null==e?void 0:e._children)||[],t,n,o)}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this,r=_t()(e).map((function(e){return{mesh:e,parent:e.parent,keypointIndex:e.index||-1}})),a=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=ln.a.getLocalCoordFromWorld(e,t,!1),i=fn.a.ofBabylon(e.position).add(a);e.position=i.toBabylon(),o.notifyObservers(e,r,t,n)},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(r){var i=r.mesh,c=r.parent,u=r.keypointIndex,s=t.scale(e),l=an.Maybe.None();u>=0?((l=n.getNodeFromTree(c.name)).forEach((function(e){var t=e.item,r=t.keyPoints[u];a(r,s,o),o&&n.updateNodeInServer(t.name)})),l.orElseRun((function(){}))):(l=n.getNodeFromTree(i.name)).forEach((function(e){var t=e.item.mesh;a(t,s,o),o&&n.updateNodeInServer(t.name)})),l.orElseRun((function(){a(i,s,o),o&&n.updateNodeInServer(i.name)}))}};return J.UndoManager.actionBuilder().doAction((function(){r.forEach(i())})).undoAction((function(e){var t=e.is2UpdateInServer,n=void 0===t||t;r.forEach(i(-1,n))})).build()}},{key:"createSelectionDiv",value:function(e){this.startDivPos=this.findMouseInDom(e);var t=this.startDivPos,n=t.x,o=t.y,a=document.createElement("div");a.id=eo,document.body.appendChild(a),Wn.a.render(r.a.createElement($n,{left:n,top:o}),document.getElementById(eo))}},{key:"updateSelectionDiv",value:function(e){var t=this.findMouseInDom(e),n=this.startDivPos,o=t.op(n,Math.min),a=o.x,i=o.y,c=t.op(n,Math.max),u=c.x,s=c.y,l=document.getElementById(eo);l&&Wn.a.render(r.a.createElement($n,{left:a,top:i,width:u-a,height:s-i,style:{zIndex:999}}),l)}},{key:"destroySelectionDiv",value:function(){var e=document.getElementById(eo);e&&e.parentNode.removeChild(e)}},{key:"findMouseInDom",value:function(e){var t=e.clientX,n=e.clientY;return new Bn.a(t,n)}},{key:"selectObjectsInside",value:function(e,t){var n=this;if(0!==this.corners.length){this.corners.push(Bn.a.of(e.pointerX,e.pointerY));var o=ce()(this.corners,2),r=o[0],a=o[1],i=a.op(r,Math.min),c=a.op(r,Math.max),u=[i,Bn.a.of(c.x,i.y),c,Bn.a.of(i.x,c.y)].map((function(e){return n.pickPoints(e,t)}));if(!u.some((function(e){return null==e}))){var s=new _n.a(t.getObjectTree()).flatten(this.isItemInsideBox(u,t)).map((function(e){return e.item.mesh})),l=Rn.ofMainView(t);l.clear(),0!==s.length&&l.addArray(s,!1),this.selectMeshUpdateUI(t)}}}},{key:"pickPoints",value:function(e,t){return t.getSceneMemory().flatMap((function(n){var o=n.scene,r=n.ground,a=o.pick(e.x,e.y,(function(e){return e===r}));if(a.hit){var i=ln.a.toGlobalCoord(t)(a.pickedPoint);return an.Maybe.some(Bn.a.of(i.x,i.y))}return an.Maybe.none()})).orNull()}},{key:"isItemInsideBox",value:function(e,t){var n=this;return function(o){var r,a=o.item,i=a.getType();if(i===cn.a.TYPE||i===bn.TYPE||i===Hn.a.TYPE||null!=a&&null!==(r=a.mesh)&&void 0!==r&&r.isSelectionPlaceHolder)return!1;var c=a.mesh;return n.isMeshInsideBox(e,t)(c)}}},{key:"isMeshInsideBox",value:function(e,t){var n=this;return function(o){var r=ln.a.toGlobalCoord(t)(o.absolutePosition),a=new Bn.a(r.x,r.y);return n.isPointInsideBox(e)(a)}}},{key:"isPointInsideBox",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.001;return function(n){for(var o=0,r=e.length,a=0;a<r;a++){var i=e[a].sub(n),c=e[(a+1)%r].sub(n);o+=Math.acos(i.dot(c)/(i.length()*c.length()))}return Math.abs(o-2*Math.PI)<t}}},{key:"mergePathsIfAny",value:function(e,t,n,o){if(Yn.a.isKeyPointMesh(e,t)){var r=n.pick(n.pointerX,n.pointerY,(function(e){return e!==o&&e.isEnabled()}));if(r.hit){var a=r.ray,i=n.multiPickWithRay(a);if(i){var c=i.map((function(e){return e.pickedMesh})).filter((function(e){return Yn.a.isKeyPointMesh(e,t)}));if(c.length>=2){var u=ce()(c,2),s=u[0],l=u[1],f=s.index>l.index?s:l,d=s.index<=l.index?s:l;f.parent.name!==d.parent.name&&Yn.a.areKeyPointsCompatible(f,d,t)&&t.getNodeFromTree(f.parent.name).forEach((function(e){var n=e.item;t.getNodeFromTree(d.parent.name).forEach((function(e){var o=e.item,r=[n,o].map((function(e){return{parent:e.mesh.parent,dict:e.toDict(),children:_t()(e.mesh._children)}})),a=n.name+"_"+o.name;t.getUndoManager().doIt(J.UndoManager.actionBuilder().doAction((function(){Yn.a.mergePaths(n.name,o.name,a,t)})).undoAction((function(e){var n=e.is2UpdateInServer,o=void 0===n||n;Yn.a.unMergePaths(r,a,t,o)})).build())}))}))}}}}}}]),n}(Pn),$n=function(e){var t=e.left,n=e.top,o=e.width,a=e.height,i=e.style;return r.a.createElement("div",{style:Zn({position:"absolute",top:n,left:t,width:o,height:a,borderRadius:10,border:"solid",borderColor:"#c7c7c7"},i)})};$n.defaultProps={left:0,top:0,width:0,height:0};var eo="SELECTION_TOOL_ID",to=Jn;function no(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var oo=function(e){T()(n,e);var t=no(n);function n(){var e,o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(t){sn()((e=O()(o),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(o))})),d()(O()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,r=e.camera;o.maybeMousePos=ln.a.getGroundPosition(t,n),o.maybeMousePos.forEach((function(t){r.detachControl(e.canvas)}))}))})),d()(O()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground;ln.a.getGroundPosition(n,r).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose(),o.tempMesh=o.createKeyPoint(e,ro,n,t,!1)}))}))}))})),d()(O()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.camera,a=e.ground,i=e.canvas;ln.a.getGroundPosition(n,a).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose();var a="KeyPoint".concat(Math.floor(1e3*Math.random())),i=o.createKeyPoint(e,a,n,t,!0,new Qt.Color3(Math.random(),Math.random(),Math.random()));t.setPropertiesWithName(a),t.getUndoManager().addIt(o.getUndoAbleAction(i,n,t))}))})),o.maybeMousePos=an.Maybe.none(),r.attachControl(i,!0)}))})),o.key="addKeyPoint",o.name="Add Key Point [4]",o.maybeMousePos=an.Maybe.none(),o.tempMesh=null,o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-map-marker"},e))},o}return C()(n,[{key:"createKeyPoint",value:function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Qt.Color3.Gray(),i=o.getRootNode().item.mesh,c=In.ofDict(n,{name:t,color:[a.r,a.g,a.b]}),u=c.mesh;u.parent=i;var s=ln.a.getLocalCoordFromWorld({parent:i},fn.a.ofBabylon(e)).toBabylon();return u.setPositionWithLocalVector(s.add(Qt.Axis.Z.scale(In.DEFAULT_SIZE))),r&&o.addNodeItem2Tree(c,i.name,r),u}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this;return J.UndoManager.actionBuilder().doAction((function(){o.createKeyPoint(Qt.Vector3.Zero(),e.name,t,n,!0,e.material.diffuseColor).position=e.position,n.updateNodeInServer(e.name)})).undoAction((function(t){var o=t.is2UpdateInServer,r=void 0===o||o;n.deleteNodeFromTreeUsingName(e.name,r)})).build()}}]),n}(Pn),ro="temp_key_point",ao=oo,io=n(109),co=n.n(io);function uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var so=function(e){T()(n,e);var t=uo(n);function n(e,o,r){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return x()(this,n),a=t.call(this,e,i),d()(O()(a),"getType",(function(){return n.TYPE})),a.corners=o,a.keyPoints=r,a}return C()(n,[{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.corners=this.corners,e}},{key:"toForm",value:function(){var e=sn()(D()(n.prototype),"toForm",this).call(this);e.jsonSchema.properties.dimensions={type:"object",title:"Dimensions",properties:{lower:{type:"object",title:"Lower Corner",properties:{x:{type:"number",title:"x"},y:{type:"number",title:"y"}}},size:{type:"object",title:"Size",properties:{scaleX:{type:"number",title:"scale-X"},scaleY:{type:"number",title:"scale-Y"}}}}},e.uiSchema.dimensions={"ui:widget":"collapse"};var t=this.keyPoints.map((function(e){return ln.a.getGlobalCoordinates(e,e.position)})).map((function(e){return e.toArray()}));return e.data.dimensions={lower:{x:t[0][0],y:t[0][1]},size:{scaleX:this.corners[1][0]-this.corners[0][0],scaleY:this.corners[1][1]-this.corners[0][1]}},e}},{key:"ofForm",value:function(e){var t=this.toForm().data.dimensions;co()(t,e.dimensions)?sn()(D()(n.prototype),"ofForm",this).call(this,e):this.ofFormDimensions(e)}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"ofFormDimensions",value:function(e){var t=this,n=Qt.Vector3.FromArray([e.dimensions.lower.x,e.dimensions.lower.y,0].map(Number.parseFloat)),o=[e.dimensions.size.scaleX,e.dimensions.size.scaleY].map(Number.parseFloat),r=ln.a.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),a=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t.keyPoints[e].observers.notifyObservers({updatedPointMesh:t.keyPoints[e],is2updateServer:n})};this.keyPoints[0].position=new Qt.Vector3(r[0],r[1],this.keyPoints[0].position.z),a(0),r=ln.a.getLocalCoordFromGlobal(this.keyPoints[0],n).toArray(),this.keyPoints[1].position=new Qt.Vector3(r[0]+o[0],r[1]+o[1],this.keyPoints[1].position.z),a(1)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing Box region");var r=an.Maybe.fromNull(t.name).orSome("BoxRegion".concat(Math.floor(1e3*Math.random()))),a=ho(t,r,e),i=new Qt.StandardMaterial("BoxRegionMaterial".concat(r),e),c=new Qt.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,i.backFaceCulling=!1,a.material=i,a.visibility=t.color[3]||vo,an.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new Qt.Quaternion(e[1],e[2],e[3],e[0]);a.rotationQuaternion=t.normalize()}));var u=po(e,t.corners.map((function(e){return fn.a.of(e).toBabylon()})),a,o);return new n(a,t.corners,u,t.keyValueMap)}}]),n}(hn.a);d()(so,"TYPE","BoxRegion");var lo=Jt.b.RADIUS,fo=[[0,1,2],[2,3,0],[4,5,6],[6,7,4],[0,1,5],[5,4,0],[3,2,6],[6,7,3],[1,2,6],[6,5,1],[0,3,7],[7,4,0]];function ho(e,t,n){var o=e.corners.map((function(e){return fn.a.of(e).toBabylon()})),r=o[1].subtract(o[0]),a=fn.a.of(e.position).toBabylon(),i=[o[0],o[0].add(Qt.Axis.X.scale(r.x)),o[0].add(new Qt.Vector3(r.x,r.y,0)),o[0].add(Qt.Axis.Y.scale(r.y))],c=new Qt.Vector3(0,0,r.z),u={positions:[i[0],i[1],i[2],i[3],i[0].add(c),i[1].add(c),i[2].add(c),i[3].add(c)],faces:fo},s=ln.a.meshFromPositionAndFaces(t,n,u.positions,u.faces);return s.position=a,s.rotationQuaternion=Qt.Quaternion.Identity(),s}var mo=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;e.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh,u=c.name,s={position:fn.a.ofBabylon(c.position).toArray(),corners:i.corners};s.corners[a]=[o.position.x,o.position.y,s.corners[a][2]],function(e,t,n,o){var r=ln.a.pointAverageVec3(e.corners.map((function(e){return fn.a.of(e)})));e.position=r.toArray(),e.corners=e.corners.map((function(e){return fn.a.of(e).sub(r).toArray()}));var a=ln.a.getRotationMatrix(n),i=fn.a.ofBabylon(n.scaling),c=a.prodVec(r.mul(i)).toBabylon(),u=ho(e,n.name,t);u.parent=n.parent,u.rotationQuaternion=n.rotationQuaternion,u.position=c.add(n.position),u.material=n.material,u.visibility=n.visibility,u.getMouseContextActions=n.getMouseContextActions,u.nodeItem=n.nodeItem,u.observers=n.observers,n.graphVertex&&(u.graphVertex=n.graphVertex,u.graphVertex.vertex.mesh=u),o.mesh=u,o.corners=e.corners,_t()(n._children).forEach((function(e){e.parent=u})),o.keyPoints.forEach((function(t,n){var o=t.position.z;t.position=fn.a.of(e.corners[n]).toBabylon(),t.position.z=o})),n.dispose()}(s,t,c,i),e.addGizmo2Name(),r&&(e.updateNodeInServer(u),e.getNodeFromTree(u).forEach((function(t){e.setProperties(t.item.toForm())}))),an.Maybe.fromNull(i.mesh.observers).forEach((function(e){e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:r,displacement:Qt.Vector3.Zero()})})),an.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){(0,e.vertexObs)({updatedPointMesh:i.mesh,is2updateServer:r,displacement:Qt.Vector3.Zero()})}))}))}},po=function(e,t,n,o){var r=[],a=t.reduce((function(e,t){return Math.max(e,t.z)}),Number.MIN_VALUE);return t.forEach((function(t,i){var c=t,u=ln.a.createSphere(e,new Qt.Color3(.25,.25,.25),lo,"".concat(n.name,"keyPoint").concat(i),!0);u.parent=n,u.position=c,u.position.z=a,u.index=i,u.observers=new Qt.Observable,u.observers.add(mo(o,e)),r.push(u)})),r},vo=.25,go=so;function yo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var bo=function(e){T()(n,e);var t=yo(n);function n(){var e,o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(t){sn()((e=O()(o),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(o))})),d()(O()(o),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var t=e.scene,n=e.ground,r=e.camera,a=ln.a.getGroundPosition(t,n);o.maybeMousePos=a,a.forEach((function(t){r.detachControl(e.canvas)}))}))})),d()(O()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground;ln.a.getGroundPosition(n,r).forEach((function(e){o.maybeMousePos.forEach((function(r){o.tempMesh&&o.tempMesh.dispose(),o.tempMesh=o.createBoxRegion([r,e],Ao,n,t,!1)}))}))}))})),d()(O()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.camera,a=e.ground;ln.a.getGroundPosition(n,a).forEach((function(e){o.maybeMousePos.forEach((function(r){if(!(e.subtract(r).length()<.01)){o.tempMesh.dispose();var a="BoxRegion".concat(Math.floor(1e3*Math.random())),i=o.createBoxRegion([r,e],a,n,t,!0);t.setPropertiesWithName(a),t.getUndoManager().addIt(o.getUndoAbleAction([r,e],i,n,t))}}))})),o.maybeMousePos=an.Maybe.none(),r.attachControl(e.canvas,!0)}))})),d()(O()(o),"createBoxRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Qt.Color3.Red(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=o.getRootNode().item.mesh,u=e.map((function(e){return ln.a.getLocalCoordFromWorld({parent:c},fn.a.ofBabylon(e))}));u[1]=u[1].add(fn.a.of([0,0,i]));var s=u[0].add(u[1]).scale(.5),l=u.map((function(e){return e.sub(s)})),f=go.ofDict(n,{name:t,position:s.toArray(),color:[a.r,a.g,a.b],corners:l.map((function(e){return e.toArray()}))},o);return f.mesh.parent=c,r&&o.addNodeItem2Tree(f,c.name,r),f.mesh})),o.key="drawBoxRegion",o.name="Draw Box Region [3]",o.maybeMousePos=an.Maybe.none(),o.tempMesh=null,o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-square"},e))},o}return C()(n,[{key:"getUndoAbleAction",value:function(e,t,n,o){var r=this;return J.UndoManager.actionBuilder().doAction((function(){r.createBoxRegion(e,t.name,n,o,!0)})).undoAction((function(e){var n=e.is2UpdateInServer,r=void 0===n||n;o.deleteNodeFromTreeUsingName(t.name,r)})).build()}}]),n}(Pn),Ao="temp_box_region",wo=bo;function Mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Eo=function(e){T()(n,e);var t=Mo(n);function n(){var e,o,a;return x()(this,n),a=t.call(this),d()(O()(a),"action",(function(t){sn()((e=O()(a),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(a))})),d()(O()(a),"onChange",(function(e){a.mouseCurve.length>1&&e.getSceneMemory().forEach((function(t){var n=t.scene;e.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,e))}))})),d()(O()(a),"onPointerDown",(function(e,t){1===e.buttons&&(a.spherePlaceHolder.isDisposed()?t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground,r=e.camera,i=e.canvas;ln.a.getGroundPosition(n,o).forEach((function(o){r.detachControl(i),a.mouseCurve.push(o),t.getUndoManager().doIt(a.getUndoAbleClickAction(a.mouseCurve,n,t,e))}))})):a.createPointInCurve(t))})),d()(O()(a),"onPointerMove",(function(e,t){a.addKeyPointPlaceHolder(t)})),d()(O()(a),"onPointerUp",(function(e,t){})),d()(O()(a),"onKeyUp",(function(e,t){var r=function(){return sn()((o=O()(a),D()(n.prototype)),"onKeyUp",o).call(o,e,t)};t.getSceneMemory().forEach((function(n){var o=n.scene,i=n.camera,c=n.canvas,u=a.getDrawPathContextAction(i,c,o);kn([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return u[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return u[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){u[0].action(t)}}],r)(e)}))})),d()(O()(a),"createCurve",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Qt.Color3.Gray(),i=o.getRootNode().item.mesh,c=ln.a.toGlobalCoord(o)(e),u=ln.a.pointAverage(c),s=c.map((function(e){return e.subtract(u)})),l=Yn.a.ofDict(n,{name:t,position:fn.a.ofBabylon(u).toArray(),color:[a.r,a.g,a.b],localPath:s.map((function(e){return fn.a.ofBabylon(e).toArray()}))},o);return l.mesh.parent=i,o.addNodeItem2Tree(l,i.name,r,!0,r),l})),d()(O()(a),"getDrawPathContextAction",(function(e,t,n){var o=[];return o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(Po,!1),a.mouseCurve=[],n.closeContextDial()},name:"Clear Path [ESC | DEL | Backspace]"}),a.mouseCurve.length>1&&o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-check"},e))},action:function(o){e.attachControl(t,!0),o.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,o))},name:"Create Path [Enter]"}),o})),a.key="drawPath",a.name="Draw Path [2]",a.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-bezier-curve"},e))},a.mouseCurve=[],a.spherePlaceHolder={dispose:function(){},isDisposed:function(){return!0}},a}return C()(n,[{key:"getUndoAbleClickAction",value:function(e,t,n,o){var r=this,a=o.camera,i=o.canvas,c=_t()(e);return J.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:c;n.deleteNodeFromTreeUsingName(Po,!1,!1),r.createCurve(e,Po,t,n,!1),c.length<=2&&n.setContextActions(r.getDrawPathContextAction(a,i,t)),r.mouseCurve=c})).undoAction((function(e){var o=e.is2UpdateInServer,a=void 0===o||o;n.deleteNodeFromTreeUsingName(Po,a);var i=c.slice(0,c.length-1),u=1===i.length?[i[0],i[0]]:i;a?(i.length>0&&r.createCurve(u,Po,t,n,!1),r.mouseCurve=i):r.mouseCurve=[]})).build()}},{key:"getUndoAbleEnterAction",value:function(e,t,n){var o=this,r=_t()(e),a="Path".concat(Math.floor(1e3*Math.random()));return J.UndoManager.actionBuilder().doAction((function(){n.deleteNodeFromTreeUsingName(Po,!1);var e=o.createCurve(r,a,t,n,!0);if(o.mouseCurve=[],n.setPropertiesWithName(a),n.closeContextDial(),e&&e.keyPoints){var i=e.keyPoints;Yn.a.addEdgesInKeyPoints(i,t,n)}})).undoAction((function(e){var i=e.is2UpdateInServer,c=void 0===i||i;o.deleteEdgeInKeyPoints(a,n,c),n.deleteNodeFromTreeUsingName(a,c),c?(o.createCurve(r,Po,t,n,!1),o.mouseCurve=r):(o.mouseCurve=[],n.deleteNodeFromTreeUsingName(Po,!1))})).build()}},{key:"deleteEdgeInKeyPoints",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.getGraph().forEach((function(o){var r=o.item;t.getNodeFromTree(e).forEach((function(e){var o=e.item.keyPoints,a=[o[0],o[o.length-1]];r.delEdge.apply(r,a),n&&t.updateNodeInServer(r.name)}))}))}},{key:"addKeyPointPlaceHolder",value:function(e){var t=this;this.spherePlaceHolder.dispose(),e.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;ln.a.pickMesh(o,r).forEach((function(n){n.name!==Po&&e.getNodeFromTree(n.name).forEach((function(n){n.item.getType()===Yn.a.TYPE&&ln.a.getGroundPosition(o,r).forEach((function(n){var r=e.getRootNode().item.mesh;t.spherePlaceHolder=ln.a.createSphere(o,Qt.Color3.Gray(),Jt.b.RADIUS,"sphereInsertPlaceHolder",!1),t.spherePlaceHolder.parent=r,t.spherePlaceHolder.position=ln.a.toGlobalCoord(e)(n),t.spherePlaceHolder.visibility=.5}))}))}))}))}},{key:"createPointInCurve",value:function(e){var t=this;e.getSceneMemory().forEach((function(n){var o=n.scene,r=n.ground;t.spherePlaceHolder.dispose(),ln.a.pickMesh(o,r).forEach((function(n){var a=n.name;e.getNodeFromTree(a).forEach((function(n){var a=n.item;ln.a.getGroundPosition(o,r).forEach((function(n){var r=_t()(a.localPath).map((function(e){return fn.a.of(e).toBabylon()})),i=a.mesh.position;e.getUndoManager().doIt(J.UndoManager.actionBuilder().doAction((function(){t.insertPointInCurve(o,e,a,n),e.updateNodeInServer(a.name)})).undoAction((function(t){var n=t.is2UpdateInServer,c=void 0===n||n;Yn.a.createNewMeshFromOldUsingNewPoints(r,o,a,e,Yn.a.onAddNewPointKeyPointUpdate),a.mesh.position=i,c&&e.updateNodeInServer(a.name)})).build())}))}))}))}))}},{key:"insertPointInCurve",value:function(e,t,n,o){var r=ln.a.getLocalCoordFromWorld({parent:n.mesh},fn.a.ofBabylon(o)),a=n.localPath.map((function(e){return fn.a.of(e)})),i=a.map((function(e,t){return{distance:r.sub(e).length(),index:t}})).sort((function(e,t){return e.distance-t.distance})),c=Math.min(i[0].index,i[1].index),u=a.map((function(e){return e.toBabylon()})),s=[].concat(_t()(u.slice(0,c+1)),[r.toBabylon()],_t()(u.slice(c+1)));Yn.a.createNewMeshFromOldUsingNewPoints(s,e,n,t,Yn.a.onAddNewPointKeyPointUpdate)}}]),n}(Pn),Po="temp_curve",xo=Eo;function ko(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Co(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ko(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ko(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function So(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Oo=Jt.b.RADIUS,No=J.Utils.mod,To=function(e){T()(n,e);var t=So(n);function n(e,o,r,a){var i,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];return x()(this,n),i=t.call(this,e,c),d()(O()(i),"getType",(function(){return n.TYPE})),i.localPolygon=o,i.height=r,i.keyPoints=a,i.navigationAllowed=u,i}return C()(n,[{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.localPolygon=this.localPolygon,e.height=this.height,e.navigationAllowed=this.navigationAllowed,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}},{key:"toForm",value:function(){var e=sn()(D()(n.prototype),"toForm",this).call(this),t=Co({},e.jsonSchema.properties),o={type:"object",properties:{oldName:t.oldName,name:t.name,type:t.type,navigationAllowed:{type:"boolean",title:"Navigation allowed"},position:t.position,rotation:t.rotation,color:t.color,annotations:t.annotations}};return e.jsonSchema=o,e.data.navigationAllowed=this.navigationAllowed,e}},{key:"ofForm",value:function(e){sn()(D()(n.prototype),"ofForm",this).call(this,e),this.navigationAllowed=Boolean(e.navigationAllowed)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing polygon or null mainView");var r=t.localPolygon.map((function(e){return fn.a.of(e).toBabylon()})),a=fn.a.of(t.position).toBabylon(),i=Bo(e,r,t.height,t.name);i.position=a,i.rotationQuaternion=Qt.Quaternion.Identity();var c=new Qt.StandardMaterial("PolygonMaterial".concat(t.name),e),u=new Qt.Color3(t.color[0],t.color[1],t.color[2]);c.diffuseColor=u,c.emissiveColor=u,i.material=c,i.visibility=t.color[3]||Lo,an.Maybe.fromNull(t.quaternion).forEach((function(e){var t=new Qt.Quaternion(e[1],e[2],e[3],e[0]);i.rotationQuaternion=t.normalize()}));var s=Fo(e,r,i,o);return new n(i,r.map((function(e){return[e.x,e.y,e.z]})),t.height,s,t.keyValueMap,t.navigationAllowed)}},{key:"createNewMeshFromOldUsingNewPoints",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ro,a=n.mesh,i=ln.a.pointAverage(e);e=e.map((function(e){return e.subtract(i)}));var c=ln.a.getRotationMatrix(a),u=fn.a.ofBabylon(a.scaling),s=c.prodVec(fn.a.ofBabylon(i).mul(u)).toBabylon(),l=Bo(t,e,n.height,a.name);l.parent=a.parent,l.rotationQuaternion=a.rotationQuaternion,l.position=s.add(a.position),l.material=a.material,l.visibility=a.visibility,l.onClick=a.onClick,l.getMouseContextActions=a.getMouseContextActions,l.nodeItem=a.nodeItem,l.observers=a.observers,a.graphVertex&&(l.graphVertex=a.graphVertex,l.graphVertex.vertex.mesh=l),n.localPolygon=e.map((function(e){return fn.a.ofBabylon(e).toArray()})),n.mesh=l,n.keyPoints=r(t,o,a,n);var f=_t()(a._children);return f.filter((function(e){return o.getNodeFromTree(e.name).isJust()})).forEach((function(e){e.parent=n.mesh})),a.dispose(),e}},{key:"deleteKeyPoint",value:function(e,t,o){var r=t.index,a=t.parent.name;o.getNodeFromTree(a).forEach((function(t){var i=t.item,c=Co({},i.mesh.position),u=i.localPolygon.map((function(e){return fn.a.of(e).toBabylon()}));o.getUndoManager().doIt(n.getUndoDeleteKeyPoint(a,r,c,u,e,i,o))}))}},{key:"getUndoDeleteKeyPoint",value:function(e,t,o,r,a,i,c){return J.UndoManager.actionBuilder().doAction((function(){var o=_t()(r);o.splice(t,1),n.createNewMeshFromOldUsingNewPoints(o,a,i,c,n.onAddNewPointKeyPointUpdate),c.updateNodeInServer(e)})).undoAction((function(t){var u=t.is2UpdateInServer,s=void 0===u||u,l=_t()(r);i.mesh.position=o,n.createNewMeshFromOldUsingNewPoints(l,a,i,c,n.onAddNewPointKeyPointUpdate),s&&c.updateNodeInServer(e)})).build()}},{key:"onAddNewPointKeyPointUpdate",value:function(e,t,n,o){return Fo(e,o.localPolygon.map((function(e){return fn.a.of(e).toBabylon()})),o.mesh,t)}},{key:"getUndoAddKeyPointInBetween",value:function(e,t,o,r,a,i,c,u){return J.UndoManager.actionBuilder().doAction((function(){for(var i=a.length,s=No(t+o,i),l=[],f=t+Math.max(0,o),d=0;d<f;d++)l.push(a[d]);l.push(a[s].add(a[t]).scale(.5));for(var h=f;h<i;h++)l.push(a[h]);n.createNewMeshFromOldUsingNewPoints(l,c,r,u,n.onAddNewPointKeyPointUpdate),u.updateNodeInServer(e)})).undoAction((function(t){var o=t.is2UpdateInServer,s=void 0===o||o,l=_t()(a);r.mesh.position=i,n.createNewMeshFromOldUsingNewPoints(l,c,r,u,n.onAddNewPointKeyPointUpdate),s&&u.updateNodeInServer(e)})).build()}}]),n}(hn.a);d()(To,"TYPE","PolygonRegion"),d()(To,"addKeyPointInBetween",(function(e,t,n,o){var r=t.index,a=t.parent.name;n.getNodeFromTree(a).forEach((function(t){var i=t.item,c=Co({},i.mesh.position),u=i.localPolygon.map((function(e){return fn.a.of(e).toBabylon()}));n.getUndoManager().doIt(To.getUndoAddKeyPointInBetween(a,r,o,i,u,c,e,n))}))}));var Io=function(e){var t=[];return t.push(e[1]),t.push(e[0]),t.push(e[2]),t},Bo=function(e,t,n,o){var r=new Qt.Vector3(0,0,n),a={positions:[],faces:[]};a.positions=_t()(t);for(var i=0;i<t.length;i++)a.positions.push(t[i].add(r));var c=t.length,u=ln.a.triangulatePolygon(t),s=ln.a.triangulatePolygon(a.positions.slice(c)).map((function(e){return e.map((function(e){return e+c}))})).map(Io),l=function(e){for(var t=e.length,n=ln.a.computeOrientation(e),o=[],r=0;r<t;r++){var a=(r+1)%t;o.push([r,t+a,a]),o.push([r,t+r,t+a])}return n>0?o:o.map(Io)}(t);return a.faces=u.concat(s).concat(l),ln.a.meshFromPositionAndFaces(o,e,a.positions,a.faces)};function Ro(e,t,n,o){return _t()(n._children).forEach((function(e){e.parent=o.mesh,console.log("Moving parents of child",e.name)})),o.keyPoints.map((function(r,a){return r.observers=new Qt.Observable,r.observers.add(Do(e,t)),r.index=a,r.name="".concat(n.name,"keyPoint").concat(a),r.position=fn.a.of(o.localPolygon[a]).toBabylon(),r}))}var Do=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;o.parent&&t.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh.name,u=i.localPolygon.map((function(e){return fn.a.of(e).toBabylon()}));u[a]=o.position,To.createNewMeshFromOldUsingNewPoints(u,e,i,t),r&&t.updateNodeInServer(c),an.Maybe.fromNull(i.mesh.observers).forEach((function(e){i.mesh.getAbsolutePosition(),e.notifyObservers({updatedPointMesh:i.mesh,is2updateServer:r,displacement:Qt.Vector3.Zero()})})),an.Maybe.fromNull(i.mesh.graphVertex).forEach((function(e){var t=e.vertexObs;i.mesh.getAbsolutePosition(),t({updatedPointMesh:i.mesh,is2updateServer:r,displacement:Qt.Vector3.Zero()})}))}))}},Fo=function(e,t,n,o){var a=[];return t.forEach((function(t,r){var i=new Qt.Color3(.25,.25,.25),c=ln.a.createSphere(e,i,Oo,"".concat(n.name,"keyPointPolygon").concat(r),!0);c.parent=n,c.position=t,c.index=r,c.observers=new Qt.Observable,a.push(c),c.observers.add(Do(e,o))})),a.forEach((function(t){t.onClick=function(){o.setContextActions(function(e,t,n){var o=[];return n.getNodeFromTree(t.parent.name).forEach((function(n){n.item.localPolygon.length>3&&o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-trash"},e))},action:function(n){To.deleteKeyPoint(e,t,n),n.closeContextDial()},name:"Delete node [DEL]"}),o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-less-than"},e))},action:function(n){To.addKeyPointInBetween(e,t,n,-1),n.closeContextDial()},name:"Add previous"}),o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-greater-than"},e))},action:function(n){To.addKeyPointInBetween(e,t,n,1),n.closeContextDial()},name:"Add next"})})),o}(e,t,o))}})),a},Lo=.5,jo=To;function Vo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Uo=function(e){T()(n,e);var t=Vo(n);function n(){var e,o,a;return x()(this,n),a=t.call(this),d()(O()(a),"action",(function(t){sn()((e=O()(a),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(a))})),d()(O()(a),"onChange",(function(e){a.mouseCurve.length>2&&e.getSceneMemory().forEach((function(t){var n=t.scene;e.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,e))}))})),d()(O()(a),"onPointerDown",(function(e,t){1===e.buttons&&t.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground,r=e.camera;ln.a.getGroundPosition(n,o).forEach((function(o){r.detachControl(e.canvas),a.mouseCurve.push(o),t.getUndoManager().doIt(a.getUndoAbleClickAction(a.mouseCurve,n,t,e))}))}))})),d()(O()(a),"getDrawPolygonContextAction",(function(e,t,n){var o=[];return o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-trash"},e))},action:function(n){e.attachControl(t,!0),n.deleteNodeFromTreeUsingName(zo,!1),a.mouseCurve=[],n.closeContextDial()},name:"Clear Polygon [ESC | DEL | Backspace]"}),a.mouseCurve.length>2&&o.push({icon:function(e){return r.a.createElement("i",Se()({className:"fas fa-check"},e))},action:function(o){e.attachControl(t,!0),o.getUndoManager().doIt(a.getUndoAbleEnterAction(a.mouseCurve,n,o))},name:"Create Polygon [Enter]"}),o})),d()(O()(a),"onPointerMove",(function(e,t){})),d()(O()(a),"onPointerUp",(function(e,t){})),d()(O()(a),"onKeyUp",(function(e,t){var r=function(){return sn()((o=O()(a),D()(n.prototype)),"onKeyUp",o).call(o,e,t)};t.getSceneMemory().forEach((function(n){var o=n.scene,i=n.camera,c=n.canvas,u=a.getDrawPolygonContextAction(i,c,o);kn([{predicate:function(e){return"Enter"===e.code||"NumpadEnter"===e.code},action:function(){return u[1].action(t)}},{predicate:function(e){return"Delete"===e.code||"Backspace"===e.code},action:function(){return u[0].action(t)}},{predicate:function(e){return"Escape"===e.code},action:function(){u[0].action(t)}}],r)(e)}))})),d()(O()(a),"createPolygonRegion",(function(e,t,n,o){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Qt.Color3.Yellow(),i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=o.getRootNode().item.mesh,u=e.map((function(e){return ln.a.getLocalCoordFromWorld({parent:c},fn.a.ofBabylon(e))})),s=ln.a.pointAverageVec3(u),l=u.map((function(e){return e.sub(s)})),f=jo.ofDict(n,{name:t,position:s.toArray(),color:[a.r,a.g,a.b],localPolygon:l.map((function(e){return e.toArray()})),height:i},o);f.mesh.parent=c,o.addNodeItem2Tree(f,c.name,r,!0,r)})),a.key="drawPolygonRegion",a.name="Draw Polygon Region [5]",a.mouseCurve=[],a.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-draw-polygon"},e))},a}return C()(n,[{key:"getUndoAbleClickAction",value:function(e,t,n,o){var r=this,a=o.camera,i=o.canvas,c=_t()(e);return J.UndoManager.actionBuilder().doAction((function(){var e=1===c.length?[c[0],c[0]]:c;n.deleteNodeFromTreeUsingName(zo,!1,!1),r.createPolygonRegion(e,zo,t,n,!1),n.setContextActions(r.getDrawPolygonContextAction(a,i,t)),r.mouseCurve=c})).undoAction((function(e){var o=e.is2UpdateInServer,a=void 0===o||o;n.deleteNodeFromTreeUsingName(zo,a);var i=c.slice(0,c.length-1),u=1===i.length?[i[0],i[0]]:i;a&&i.length>0&&r.createPolygonRegion(u,zo,t,n,!1),r.mouseCurve=i})).build()}},{key:"getUndoAbleEnterAction",value:function(e,t,n){var o=this,r=_t()(e),a="PolygonRegion".concat(Math.floor(1e3*Math.random()));return J.UndoManager.actionBuilder().doAction((function(){n.deleteNodeFromTreeUsingName(zo,!1),o.createPolygonRegion(r,a,t,n,!0),o.mouseCurve=[],n.setPropertiesWithName(a),n.closeContextDial()})).undoAction((function(e){var i=e.is2UpdateInServer,c=void 0===i||i;n.deleteNodeFromTreeUsingName(a,c),c&&(o.createPolygonRegion(r,zo,t,n,!1),o.mouseCurve=r)})).build()}}]),n}(Pn),zo="temp_polygon_region",Ko=Uo;function Go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var qo=function(e){T()(n,e);var t=Go(n);function n(){var e,o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(t){sn()((e=O()(o),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(o))})),d()(O()(o),"onPointerDown",(function(e,t){})),d()(O()(o),"onPointerMove",(function(e,t){})),d()(O()(o),"onPointerUp",(function(e,t){})),o.key="orbit",o.name="Orbit [ESC]",o.maybeSelectedMesh=an.Maybe.none(),o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-globe"},e))},o}return n}(Pn);function Wo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var _o=function(e){T()(n,e);var t=Wo(n);function n(){var e,o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(t){sn()((e=O()(o),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(o)),t.getGraph().forEach((function(e){e.isVisible||e.item.mesh.setEnabled(!0)}))})),d()(O()(o),"onPointerDown",(function(e,t){1===e.buttons&&o.mousePosConsumer(t)((function(e,n){var r=n.scene,a=n.ground,i=ln.a.pickMesh(r,a).filter(o.isConnectableMesh(t));i.forEach((function(r){t.highlightMeshesInScene([r],Qt.Color3.Green()),o.onPointerDownLine(e,r,n,t)})),i.orElseRun((function(){t.highlightMeshesInScene(),o.resetPreview()}))}))})),d()(O()(o),"onPointerMove",(function(e,t){o.mousePosConsumer(t)((function(e,n){var r=n.scene,a=n.ground;ln.a.pickMesh(r,a).filter(o.isConnectableMesh(t)).cata((function(){return t.highlightMeshesInScene()}),(function(e){return t.highlightMeshesInScene([e],Qt.Color3.Green())})),o.firstMousePos&&o.onPointerMoveLine(e,n,t)}))})),d()(O()(o),"onPointerUp",(function(e,t){})),d()(O()(o),"onKeyUp",(function(e,t){kn([{predicate:function(e){return["Backspace","Delete","Escape"].includes(e.code)},action:function(){return o.resetPreview()}}])(e)})),d()(O()(o),"resetPreview",(function(){o.firstMousePos&&(o.deletePreviewMeshes(),o.firstMousePos=void 0,o.firstClickedMesh=void 0)})),d()(O()(o),"deletePreviewMeshes",(function(){o.previewMeshes.forEach((function(e){return e.dispose()})),o.previewMeshes=[]})),d()(O()(o),"mousePosConsumer",(function(e){return function(t){e.getSceneMemory().forEach((function(e){var n=e.scene,o=e.ground;ln.a.getGroundPosition(n,o).forEach((function(n){return t(n,e)}))}))}})),d()(O()(o),"isConnectableMesh",(function(e){return function(t){return e.getNodeFromTree(t.name).cata((function(){var n,o=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(o).filter((function(e){return e.item.getType()===Yn.a.TYPE})).filter((function(e){var n=e.item,o=t.index;return 0===o||o===n.keyPoints.length-1}))}),(function(e){var n=e.item;return an.Maybe.some(t).filter((function(e){return n.getType()!==Yn.a.TYPE&&n.getType()!==cn.a.TYPE}))})).orSome(!1)}})),d()(O()(o),"belongsToPath",(function(e){return function(t){var n,o=(null==t||null===(n=t.parent)||void 0===n?void 0:n.name)||"";return e.getNodeFromTree(o).filter((function(e){return e.item.getType()===Yn.a.TYPE})).map((function(e){return e.item.name}))}})),d()(O()(o),"belongs2SamePath",(function(e){return function(t,n){var r=o.belongsToPath(e);return r(t).flatMap((function(e){return r(n).map((function(t){return e===t}))})).orSome(!1)}})),d()(O()(o),"onPointerDownLine",(function(e,t,n,r){var a=n.scene;o.firstMousePos?o.belongs2SamePath(r)(t,o.firstClickedMesh)||Hn.a.isInvalidEdge(o.firstClickedMesh,t)||o.firstClickedMesh.name===t.name?o.resetPreview():r.getUndoManager().doIt(o.getUndoAbleLineEdge([o.firstClickedMesh,t],a,r,t)):(o.firstMousePos=e,o.firstClickedMesh=t)})),d()(O()(o),"getUndoAbleLineEdge",(function(e,t,n){return J.UndoManager.actionBuilder().doAction((function(){o.createEdge(e,t,n),o.resetPreview()})).undoAction((function(t){var r=t.is2UpdateInServer,a=void 0===r||r;o.deleteEdge(e,n,a)})).build()})),d()(O()(o),"onPointerMoveLine",(function(e,t,n){var r=t.scene,a=n.getRootNode().item.mesh,i=Ho(n)([o.firstMousePos,e]);o.deletePreviewMeshes(),o.previewMeshes=[Hn.a.getEdgeMesh(r,i,"previewEdge",Qt.Color3.Blue(),Jt.b.RADIUS/4)],o.previewMeshes.forEach((function(e){e.visibility=.25,e.parent=a,e.isPickable=!1}))})),d()(O()(o),"createEdge",(function(e,t,n){Hn.a.createGraphItemIfNone(t,n),n.getGraph().forEach((function(t){var o=t.item;o.addEdge.apply(o,_t()(e)),n.updateNodeInServer(o.name)}))})),d()(O()(o),"deleteEdge",(function(e,t,n){t.getGraph().forEach((function(o){var r=o.item;r.delEdge.apply(r,_t()(e)),n&&t.updateNodeInServer(r.name)}))})),o.key="drawGraph",o.name="Draw Graph [6]",o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-project-diagram"},e))},o.previewMeshes=[],o.firstMousePos=void 0,o.firstClickedMesh=void 0,o}return C()(n,[{key:"onChange",value:function(){this.resetPreview()}}]),n}(Pn),Ho=ln.a.toGlobalCoord,Yo=_o;function Qo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Zo=function(e){T()(n,e);var t=Qo(n);function n(){var e,o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(t){sn()((e=O()(o),D()(n.prototype)),"action",e).call(e,t),t.setSelectedAction(O()(o))})),d()(O()(o),"onChange",(function(e){o.resetMeasure(e)})),d()(O()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground,i=n.camera,c=n.canvas;ln.a.getGroundPosition(r,a).forEach((function(n){var a=ln.a.toGlobalCoord(t)(n);o.ruler.push(a),o.ruler.length>2?o.resetMeasure(t):2===o.ruler.length?(o.rulerMesh&&o.rulerMesh.dispose(),o.rulerMesh=o.createRulerMesh(o.ruler,r,t),o.addTextGUI(r,o.calculateDistance(o.ruler[0],a),e),i.attachControl(c,!0)):i.detachControl(c)}))}))})),d()(O()(o),"onPointerMove",(function(e,t){t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;ln.a.getGroundPosition(r,a).forEach((function(n){var a=ln.a.toGlobalCoord(t)(n);o.ruler.length>=2&&(4===e.buttons||.5===e.pressure)&&o.resetMeasure(t),1===o.ruler.length&&(o.rulerMesh&&o.rulerMesh.dispose(),o.rulerMesh=o.createRulerMesh([o.ruler[0],a],r,t),o.addTextGUI(r,o.calculateDistance(o.ruler[0],a),e))}))}))})),d()(O()(o),"onPointerUp",(function(e,t){})),d()(O()(o),"onWheel",(function(e,t){Math.abs(e.deltaY)>0&&o.resetMeasure(t)})),d()(O()(o),"calculateDistance",(function(e,t){var n=Bn.a.ofBabylon(e),o=Bn.a.ofBabylon(t);return n.sub(o).length().toFixed(3)})),d()(O()(o),"addTextGUI",(function(e,t,n){this.advancedTexture||(this.advancedTexture=An.AdvancedDynamicTexture.CreateFullscreenUI("UI Ruler",!0,e)),this.text&&this.advancedTexture.removeControl(this.text),this.text=new An.TextBlock,this.text.text="".concat(t,"m"),this.text.fontSize=17,this.text.left=e.pointerX-n.target.width/2+20,this.text.top=e.pointerY-n.target.height/2+20,this.text.color="white",this.advancedTexture.addControl(this.text)})),o.key="drawWall",o.name="Measure [7]",o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-ruler"},e))},o.ruler=[],o.rulerMesh=null,o.advancedTexture=null,o.text=null,o}return C()(n,[{key:"resetMeasure",value:function(e){this.rulerMesh&&this.rulerMesh.dispose(),this.text&&this.text.dispose(),this.ruler=[],e&&e.getSceneMemory().forEach((function(e){var t=e.camera,n=e.canvas;t.attachControl(n,!0)}))}},{key:"createRulerMesh",value:function(e,t,n){var o=Qt.MeshBuilder.CreateLines("ruler",{points:e,updatable:!0},t),r=n.getRootNode().item.mesh;return o.parent=r,o}}]),n}(Pn),Xo=n(41);function Jo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var $o=function(e){T()(n,e);var t=Jo(n);function n(e){var o;return x()(this,n),o=t.call(this),d()(O()(o),"action",(function(e){setTimeout((function(){o.uIInOut("Navigation preview params",(function(){return r.a.createElement("div",{style:{marginTop:"7px"}})}))})),e.setSelectedAction(O()(o))})),d()(O()(o),"onPointerDown",(function(e,t){0===e.button&&t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,a=e.camera,i=e.canvas;ln.a.getGroundPosition(n,r).forEach((function(e){a.detachControl(i),o.poses.length>=2&&o.resetData(),o.maybeFirstClickPos=an.Maybe.some(ln.a.toGlobalCoord(t)(e))}))}))})),d()(O()(o),"onPointerMove",(function(e,t){o.maybeFirstClickPos.forEach((function(e){t.getSceneMemory().forEach((function(n){var r=n.scene,a=n.ground;ln.a.getGroundPosition(r,a).forEach((function(n){var a=ln.a.toGlobalCoord(t)(n);o.previewPoseMesh&&o.previewPoseMesh.dispose(),o.previewPoseMesh=o.createPreviewPose(r,t,e,a)}))}))}))})),d()(O()(o),"onPointerUp",(function(e,t){t.getSceneMemory().forEach((function(e){var n=e.scene,r=e.ground,a=e.camera,i=e.canvas;o.maybeFirstClickPos.forEach((function(e){ln.a.getGroundPosition(n,r).forEach((function(r){var a=ln.a.toGlobalCoord(t)(r),i=o.createPreviewPose(n,t,e,a,!0);i.material=o.poseMeshes.push(i);var c=fn.a.ofBabylon(e),u=fn.a.ofBabylon(a).sub(c),s=Math.atan2(u.y,u.x);o.poses.push({position:c.toArray(),orientation:[Math.cos(s/2),0,0,Math.sin(s/2)]}),2===o.poses.length&&(o.createNavPreviewNode(n,t),o.resetData())}))})),a.attachControl(i,!0),o.previewPoseMesh&&o.previewPoseMesh.dispose(),o.maybeFirstClickPos=an.Maybe.none()}))})),o.key="navigationPreviewAction",o.name="Add navigation preview [8]",o.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-road"},e))},o.uIInOut=e,o.maybeFirstClickPos=an.Maybe.none(),o.previewPoseMesh=void 0,o.poses=[],o.poseMeshes=[],o.schema={jsonSchema:{type:"object",properties:{type:{type:"string",title:"Type"},config:{type:"string",title:"Robot Configuration"}}},uiSchema:{type:{"ui:disabled":!0},config:{"ui:widget":"selectScopeModal","ui:options":{scopeList:"Configuration",name:"Robot Config",filter:function(e){return!0}}}},data:{type:Xo.a.TYPE,config:""}},o}return C()(n,[{key:"onChange",value:function(e){e.renderMenus(),this.resetData()}},{key:"resetData",value:function(){this.maybeFirstClickPos=an.Maybe.none(),this.previewPoseMesh&&this.previewPoseMesh.dispose(),this.poses=[],this.poseMeshes.forEach((function(e){return e.dispose()})),this.poseMeshes=[]}},{key:"createPreviewPose",value:function(e,t,n,o){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=1.3,i=o.subtract(n),c=i.length(),u=r?a/c:Math.min(a/c,c),s=n.add(i.scale(u)),l=ln.a.getArrow(e,"previewPose",n,s,Jt.b.RADIUS/6),f=t.getRootNode().item.mesh;return l.parent=f,l}},{key:"createNavPreviewNode",value:function(e,t){var n="Navigation".concat(Math.floor(100*Math.random())),o=_t()(this.poses),r=this.schema.data.config;t.getUndoManager().doIt(J.UndoManager.actionBuilder().doAction((function(){var a=t.getRootNode().item.mesh,i=Xo.a.ofDict(e,{name:n,poses:o,robotConfig:r},t);i.mesh.parent=a,t.addNodeItem2Tree(i,a.name)})).undoAction((function(){t.deleteNodeFromTreeUsingName(n)})).build())}}]),n}(Pn),er=function(e){return e?{measure:new Zo,orbit:new qo}:{robotPreview:new $o((function(e,t){})),measure:new Zo,drawGraph:new Yo,drawRegion:new Ko,addKeyPoint:new ao,drawBoxRegion:new wo,drawPath:new xo,dragObjects:new to,orbit:new qo}},tr=function(){function e(t){x()(this,e),this.yamlSrc=t,this.cachedMap=null}var t,n;return C()(e,[{key:"load",value:(n=qt()(Yt.a.mark((function t(){var n,o,r;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cachedMap){t.next=2;break}return t.abrupt("return",this.cachedMap);case 2:return t.next=4,fetch(e.getMapUrl(this.yamlSrc));case 4:return n=t.sent,t.t0=this,t.next=8,n.text();case 8:return t.t1=t.sent,t.next=11,t.t0.parseYaml.call(t.t0,t.t1);case 11:return o=t.sent,r={textureSrc:o.image,resolution:o.resolution,origin:o.origin,imageSize:o.size},this.cachedMap=r,t.abrupt("return",r);case 15:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"parseYaml",value:(t=qt()(Yt.a.mark((function t(n){var o,r;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o={},r={image:function(t,n){return o[t]=e.getMapUrl(n)},resolution:function(e,t){return o[e]=Number.parseFloat(t)},origin:function(e,t){return o[e]=JSON.parse(t)}},console.log("Yaml text",n),n.split("\n").map((function(e){return e.split(": ")})).filter((function(e){return e.length>=2})).filter((function(e){return e[0]in r})).forEach((function(e){return r[e[0]](e[0],e[1])})),t.next=6,this.getImageSize(o.image);case 6:return o.size=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getImageSize",value:function(e){return new Promise((function(t,n){var o=new Image;o.src=e,o.onload=function(){return t([o.naturalWidth,o.naturalHeight])}}))}}]),e}();d()(tr,"getMapUrl",(function(e){return"/static/maps/".concat(e)}));var nr=n(28),or=n.n(nr);function rr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ar(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var ir=function(e){T()(n,e);var t=ar(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0,c=arguments.length>4?arguments[4]:void 0;x()(this,n),r=t.call(this,e.mesh,o,a),d()(O()(r),"updateRobot",(function(e,t,n){var o=(new Date).getTime();n(e,.001*(o-t)),r.requestAnimationFrameId=requestAnimationFrame((function(){return r.updateRobot(e,o,n)}))})),d()(O()(r),"animate",(function(e){r.requestAnimationFrameId=requestAnimationFrame((function(){return r.updateRobot(O()(r),(new Date).getTime(),e)}))})),d()(O()(r),"getType",(function(){return n.TYPE})),r.robot=c.getRobotManager().getRobot(e.id),r.loggerSubscription=null,r.parentView=c,r.requestAnimationFrameId=null,r.meshTree=e,r.scene=i,r.alert=null,r.timeSinceLastUpdate=0,r.isOnline=!0,r.isSubscribedToLogs=!0,r.speed=Qt.Vector3.Zero(),r.qSpeed=Qt.Quaternion.Zero(),r.newPos=Qt.Vector3.Zero(),r.newOri=Qt.Quaternion.Identity(),r.alertMesh=r.buildAlertMesh(e,i);var u=r.robot.getIP(r.onGetIP(O()(r)));return u&&r.startLogger(),ln.a.addClickActionToMesh(r.alertMesh,i,r.onMeshAlertClick(O()(r))),r}return C()(n,[{key:"buildAlertMesh",value:function(e,t){if(this.alertMesh)return this.alertMesh;var n=Qt.MeshBuilder.CreateDisc("AlertDisc".concat(e.name),{radius:.2,sideOrientation:Qt.Mesh.DOUBLESIDE}),o=new Qt.StandardMaterial("AlertMat".concat(e.name),t);return o.emissiveColor=new Qt.Color3.White,o.ambientTexture=new Qt.Texture("data:image/png;base64,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",t),o.freeze(),n.material=o,n.isStatic=!0,n.position.y=-1.5,n.parent=e.mesh,n.setEnabled(!1),n.billboardMode=Qt.Mesh.BILLBOARDMODE_ALL,n}},{key:"onMeshAlertClick",value:function(e){return function(){e.parentView.showRobotAlertModal(e.alert)}}},{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.isSubscribedToLogs=this.isSubscribedToLogs,e}},{key:"toForm",value:function(){var e=sn()(D()(n.prototype),"toForm",this).call(this),t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.jsonSchema.properties),o={type:"object",properties:{oldName:t.oldName,name:t.name,type:t.type,position:t.position,rotation:t.rotation,color:t.color,annotations:t.annotations}};return e.jsonSchema=o,e.data.isSubscribedToLogs=this.isSubscribedToLogs,e}},{key:"ofForm",value:function(e){sn()(D()(n.prototype),"ofForm",this).call(this,e),this.isSubscribedToLogs=Boolean(e.isSubscribedToLogs),e.isSubscribedToLogs&&this.robot.ip?this.startLogger():this.stopLogger(!0)}},{key:"dispose",value:function(){sn()(D()(n.prototype),"dispose",this).call(this),this.robot.unsubscribe({property:"Parameter",propValue:"tf"}),window.cancelAnimationFrame(this.requestAnimationFrameId)}},{key:"toOffline",value:function(){this.mesh.isDisposed()||(this.mesh._children[0]._children[0].visibility=.1,this.speed=Qt.Vector3.Zero(),this.qSpeed=Qt.Quaternion.Zero(),this.isOnline=!1,this.stopLogger())}},{key:"toOnline",value:function(){this.mesh.isDisposed()||(this.mesh._children[0]._children[0].visibility=1,this.isOnline=!0,this.startLogger())}},{key:"startLogger",value:function(){this.loggerSubscription||(this.loggerSubscription=this.robot.subscribeToLogs(this.updateAlertState(this)))}},{key:"stopLogger",value:function(e){this.loggerSubscription&&(this.robot.unsubscribeToLogs(this.loggerSubscription),this.loggerSubscription=null),e&&this.alertMesh.setEnabled(!1)}},{key:"updateAlertState",value:function(e){return function(t){e.timeSinceLastUpdate=0,"ERROR"===t[0].level||"CRITICAL"===t[0].level?(e.alert=t[0],e.alertMesh.setEnabled(!0)):e.alertMesh.setEnabled(!1)}}},{key:"onGetIP",value:function(e){return function(t){t&&e.startLogger()}}}],[{key:"updateRobotMeshTree",value:function(e,t){var n=t.mesh.position,o=t.mesh.rotationQuaternion,r=new Qt.Vector3(e.position.x,e.position.y,e.position.z),a=new Qt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w).normalize(),i=1/t.timeSinceLastUpdate;t.speed=r.subtract(n).scale(i),t.qSpeed=a.subtract(o).scale(i),t.newPos=r,t.newOri=a,t.timeSinceLastUpdate=0}},{key:"setOnOffLine",value:function(e){e.timeSinceLastUpdate>n.TIME_2_BE_OFFLINE_IN_SEC?e.isOnline&&e.toOffline():e.isOnline||e.toOnline()}},{key:"createRobotMeshTreeRecursive",value:function(e,t,n,o){var r=this;t||(t=ln.a.createSphere(o,new Qt.Color3(0,0,0),.5,e.name,!1));var a={mesh:t,children:[]},i=new Qt.Vector3(e.position.x,e.position.y,e.position.z),c=new Qt.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w);return t.position=i,t.rotationQuaternion=c,n&&(t.parent=n),a.children=e.child.map((function(e){return r.createRobotMeshTreeRecursive(e,ln.a.referentialBuilder(o).boxParams({isVisible:!1,size:.1}).build(),t,o)})),a}},{key:"createRobotMeshTree",value:function(e,t,o){return n.createRobotMeshTreeRecursive(e,t,null,o)}},{key:"builder",value:function(){return new cr}}]),n}(pn);d()(ir,"ROBOT_MESH_NAME","Tugbot.stl"),d()(ir,"TYPE","Robot"),d()(ir,"TIME_2_BE_OFFLINE_IN_SEC",10),d()(ir,"createBaseObject",(function(e){var t=e.robotName,n=e.robotMeshName,o=void 0===n?ir.ROBOT_MESH_NAME:n,r=e.id,a=void 0===r?ir.randomId():r,i=e.nodeDict,c=void 0===i?{position:[0,0,0],quaternion:[1,0,0,0]}:i;return{id:a,name:t,type:ir.TYPE,meshName:o,robotTree:{name:t,child:[],position:{x:c.position[0],y:c.position[1],z:c.position[2]},orientation:{w:c.quaternion[0],x:c.quaternion[1],y:c.quaternion[2],z:c.quaternion[3]}}}})),d()(ir,"getDefaultAnimator",(function(e){return function(e,t){var n=e.mesh,o=ln.a.getRotationMatrix(n).prodVec(new fn.a([3,0,0])).toBabylon();n.position=n.position.add(o.scale(t)),n.rotate(Qt.Axis.Z,-Math.PI/2*t,Qt.Space.LOCAL)}})),d()(ir,"getSocketAnimator",(function(e,t){var n=function(t){var n=or()(t,"Robot.".concat(e.meshTree.id,".Parameter.tf.Value"),void 0);n&&ir.updateRobotMeshTree(n,e)};return e.robot.subscribe({property:"Parameter",propValue:"tf",onLoad:function(e){return n(null==e?void 0:e.value)},onUpdate:function(e){return n(null==e?void 0:e.key)}}),function(t,n){var o=t.timeSinceLastUpdate%100;t.timeSinceLastUpdate+=n,fn.a.ofBabylon(t.speed).someNaNOrInfinite()||fn.a.ofBabylon(t.qSpeed).someNaNOrInfinite()||(t.mesh.position=o?t.newPos:t.mesh.position.add(t.speed.scale(n)),t.mesh.rotationQuaternion=o?t.newOri:t.mesh.rotationQuaternion.add(e.qSpeed.scale(n)).normalize(),ir.setOnOffLine(t))}}));var cr=function(){function e(){x()(this,e),this._name=null,this._meshTree=null,this._parentMesh=null,this._parentView=null,this._scene=null,this._isPickable=!0,this._id=null,this._keyValueMap={},this._assetName=null}return C()(e,[{key:"name",value:function(e){return this._name=e,this}},{key:"meshTree",value:function(e){return this._meshTree=e,this}},{key:"parentMesh",value:function(e){return this._parentMesh=e,this}},{key:"parentView",value:function(e){return this._parentView=e,this}},{key:"scene",value:function(e){return this._scene=e,this}},{key:"isPickable",value:function(e){return this._isPickable=e,this}},{key:"id",value:function(e){return this._id=e,this}},{key:"keyValueMap",value:function(e){return this._keyValueMap=e,this}},{key:"assetName",value:function(e){return this._assetName=e,this}},{key:"build",value:function(){var e=this;return Object.keys(this).filter((function(e){return"_parentMesh"!==e})).map((function(t){return e[t]})).forEach((function(e){if(null===e)throw new Error("There are missing variables to build a robot, e.g ".concat(e))})),this._meshTree.id=this._id,this._meshTree.name=this._name,this._meshTree.mesh.name=this._name,this._meshTree.mesh.isPickable=this._isPickable,this._meshTree.mesh.parent=this._parentMesh,ln.a.referentialBuilder(this._scene).isPickable(!1).boxParams({isVisible:!1,size:.1}).name("".concat(this._name,"Axis")).build().parent=this._meshTree.mesh,new ir(this._meshTree,this._assetName,this._keyValueMap,this._scene,this._parentView)}}]),e}(),ur=ir;function sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}var lr=function(){function e(){var t=this;if(x()(this,e),d()(this,"getAssets",(function(){return t.assets})),d()(this,"getAssetsActionMap",(function(){return t.assetsActionMap})),d()(this,"load",qt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.retrieveAssetsFromDb();case 2:return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e)})))),d()(this,"signalObservers",(function(){Object.keys(t.observersBySceneId).forEach((function(e){t.observersBySceneId[e].forEach((function(e){return e(t)}))}))})),d()(this,"subs",[function(e){return J.MasterDB.subscribe({Scope:"Robot",Name:"*",RobotName:"*"},t.getRobotUpdate(),(function(n){return t.getRobotNameSub(n.value,(function(){t.addRobots(),t.finishSub("RobotName",e)}))}))},function(e){return J.MasterDB.subscribe({Scope:"Robot",Name:"*",Parameter:"mesh"},t.getRobotUpdate(),(function(n){return t.getRobotMeshSub(n.value,(function(){t.addRobots(),t.finishSub("RobotMesh",e)}))}))},function(e){return J.MasterDB.subscribe({Scope:"Package",File:"*",Name:"maps",FileLabel:"*"},t.getMapUpdater((function(e){return e.key})),t.getMapSubscriber((function(e){return e.value}),(function(){return t.finishSub("Maps",e)})))},function(e){return J.MasterDB.subscribe({Scope:"Package",File:"*",Name:"meshes",FileLabel:"*"},t.getMeshUpdater(),t.getMeshSubscriber((function(e){return e.value}),(function(){return t.finishSub("Meshes",e)})))}]),d()(this,"finishSub",(function(e,n){console.log("FINISH SUB ",e,t.finishInitialSubscribers),++t.finishInitialSubscribers>t.subs.length-1&&(t.afterLoad.forEach((function(e){return e(t)})),t.afterLoad=[],t.isLoading=!1,n(!0))})),d()(this,"deleteRobot",(function(e){t.robots.hasOwnProperty(e)&&(t.delAsset(t.robots[e].name),e in t.robots&&delete t.robots[e])})),d()(this,"getMapSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(o){return t.getMapFileData(e,o).forEach((function(e){Object.keys(e).filter((function(e){return e.includes(".yaml")})).forEach(t.addMap),n()}))}})),d()(this,"getMapUpdater",(function(e){var n={del:function(n){t.getMapFileData(e,n).forEach((function(e){var n=Object.keys(e)[0];n=n.split(".")[0],t.delAsset(n)}))},set:t.getMapSubscriber(e),subscribe:t.getMapSubscriber(e)};return function(e){console.log("MAP UPDATE",e),n[e.event](e)}})),d()(this,"addMap",(function(e){var n={name:e.split(".")[0],loader:new tr(e),type:qr.Map};t.addAsset(n.name,n)})),d()(this,"getMapFileData",(function(e,t){return dr(e(t)).flatMap(hr("Package")).flatMap(hr("maps")).flatMap(hr("File"))})),d()(this,"getMeshSubscriber",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return function(o){t.getMeshFileData(e,o).forEach((function(e){return Object.keys(e).forEach((function(n){var o={id:n,name:e[n].FileLabel,type:qr.Mesh};t.addAsset(o.name,o)}))})),n()}})),d()(this,"getMeshUpdater",(function(){var e={del:function(e){t.getMeshFileData((function(e){return e.key}),e).forEach((function(e){var n=Object.keys(e)[0];t.delAsset(n)}))},set:t.getMeshSubscriber((function(e){return e.key})),subscribe:t.getMeshSubscriber((function(e){return e.key}))};return function(t){return e[t.event](t)}})),d()(this,"getMeshFileData",(function(e,t){return dr(e(t)).flatMap(hr("Package")).flatMap(hr("meshes")).flatMap(hr("File"))})),fr)return fr;fr=this,this.assets={},this.assetsActionMap={},this.robots={},this.observersBySceneId={},this.afterLoad=[],this.finishInitialSubscribers=0,this.isLoading=!0}return C()(e,[{key:"addAfterLoad",value:function(e){return this.afterLoad.push(e),this}},{key:"addObserver",value:function(e,t){var n=e._uid;return n in this.observersBySceneId||(this.observersBySceneId[n]=[]),this.observersBySceneId[n].push(t),this}},{key:"addAsset",value:function(e,t){try{this.assets[e]=t,this.assetsActionMap[e]=Wr[t.type](t),this.isLoading||this.signalObservers()}catch(e){throw console.log("Caught exception while adding asset",e),Error("Caught exception while adding asset ".concat(e))}}},{key:"delAsset",value:function(e){e in this.assets&&delete this.assets[e],e in this.assetsActionMap&&delete this.assetsActionMap[e],this.signalObservers()}},{key:"clearObserver",value:function(e){var t=e._uid;t in this.observersBySceneId&&(console.log("Clear asset observer",t),delete this.observersBySceneId[t])}},{key:"retrieveAssetsFromDb",value:function(){var e=this;return new Promise((function(t,n){e.subs.forEach((function(e){return e(t)}))}))}},{key:"setRobot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e in this.robots||(this.robots[e]={id:e,name:null,meshName:null}),dr(n).forEach((function(n){return t.robots[e].name=n})),dr(o).forEach((function(n){return t.robots[e].meshName=n}))}},{key:"addRobots",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.robots;Object.keys(t).forEach((function(t){if(Object.values(e.robots[t]).every((function(e){return null!==e}))){var n=e.robots[t];e.addAsset(n.name,ur.createBaseObject({robotName:n.name,robotMeshName:n.meshName,id:t}))}}))}},{key:"getRobotNameSub",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};dr(e).flatMap(hr("Robot")).forEach((function(e){return Object.keys(e).forEach((function(n){return t.setRobot(n,e[n].RobotName)}))})),n()}},{key:"getRobotMeshSub",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};dr(e).flatMap(hr("Robot")).forEach((function(e){return Object.keys(e).forEach((function(n){return t.setRobot(n,e[n].RobotName,e[n].Parameter.mesh.Value)}))})),Object.keys(this.robots).forEach((function(e){t.robots[e].meshName=t.robots[e].meshName?t.robots[e].meshName:ur.ROBOT_MESH_NAME})),n()}},{key:"getRobotUpdate",value:function(){var e=this,t={del:function(t){var n=t.patterns[0];n.hasOwnProperty("RobotName")?dr(t.key).flatMap(hr("Robot")).forEach((function(t){return Object.keys(t).forEach(e.deleteRobot)})):n.hasOwnProperty("Parameter")&&dr(t.key).flatMap(hr("Robot")).forEach((function(t){return Object.keys(t).forEach((function(t){e.robots[t].meshName=ur.ROBOT_MESH_NAME}))}))},set:function(t){var n=t.patterns[0],o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.key.Robot);n.hasOwnProperty("RobotName")?e.getRobotNameSub(t.key,(function(){return e.addRobots(o)})):n.hasOwnProperty("Parameter")&&e.getRobotMeshSub(t.key,(function(){return e.addRobots(o)}))}};return function(e){console.log("Robot NAME UPDATE",e),t[e.event](e)}}}],[{key:"getInstance",value:function(){return new e}}]),e}(),fr=null,dr=an.Maybe.fromNull,hr=function(e){return(t=dr,function(e){return function(n){return t(e(n))}})(function(e){return function(t){return t[e]}}(e));var t},mr=lr;function pr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var vr=function(e){T()(n,e);var t=pr(n);function n(e,o){var a;return x()(this,n),a=t.call(this),d()(O()(a),"getType",(function(){return n.TYPE})),d()(O()(a),"deleteAsset",(function(){})),d()(O()(a),"download",qt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),a.name=e,a.key="addMap".concat(e),a.mapLoader=o,a.icon=function(e){return r.a.createElement("i",Se()({},e,{className:"fas fa-map"}))},a.firstTimeLoad=!0,a}return C()(n,[{key:"addMap",value:function(e){var t=this;e.getSceneMemory().forEach(function(){var n=qt()(Yt.a.mark((function n(o){var r,a,i,c,u,s,l,f,d,h,m,p,v,g,y,b;return Yt.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=o.scene,a=o.camera,n.next=3,t.mapLoader.load();case 3:i=n.sent,c=i.textureSrc,u=i.resolution,s=i.origin,l=i.imageSize,f=u*l[0],d=u*l[1],h=ln.a.groundBuilder(r).name(an.Maybe.fromNull(t.memory.name).orSome(t.name)).width(f).height(d).textureSrc(c).build(),m=fn.a.of([-f/2,-d/2,0]).sub(fn.a.of(s)),p=e.getRootNode(),(v=p.item.mesh.parent).position=cn.a.inverseCoordinates(m.toBabylon()),a.setTarget(new Qt.Vector3(v.position.x,v.position.y,v.position.z)),g=new bn(h,[f,d],t.textureSrc,an.Maybe.fromNull(t.memory.assetName).orSome(t.name)),y=an.Maybe.fromNull(t.memory.isVisible).orSome(!0),b=an.Maybe.fromNull(t.memory.isImport).map((function(e){return!e})).orSome(!0),h.setEnabled(y),e.addNodeItem2Tree(g,null,b,y),o.ground.dispose(),o.ground=Mn.createMeshGround(r,f,d),t.memory.isImport=!1;case 24:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}},{key:"action",value:function(e){var t=this;sn()(D()(n.prototype),"action",this).call(this,e),e.getNodeFromTree(this.name).orElseRun((function(){t.memory.isImport?(t.addMap(e),t.firstTimeLoad=!1):e.getUndoManager().doIt(t.getUndoAction(e))})),e.setSelectedAction(er().orbit)}},{key:"getUndoAction",value:function(e){var t=this;if(e.getObjectTree().length<2)return J.UndoManager.actionBuilder().doAction((function(){t.addMap(e)})).undoAction((function(t){var n=t.is2UpdateInServer,o=void 0===n||n,r=e.getObjectTree()[1].title;e.deleteNodeFromTreeUsingName(r,o)})).build();var n=e.getObjectTree()[1].title,o=this.name;return J.UndoManager.actionBuilder().doAction((function(){t.switchMaps(n,o,e)})).undoAction((function(t){var r=t.is2UpdateInServer,a=void 0===r||r;e.deleteNodeFromTreeUsingName(o,a),an.Maybe.fromNull(mr.getInstance().getAssetsActionMap()[n]).forEach((function(t){return t.action(e)}))})).build()}},{key:"switchMaps",value:function(e,t,n){}}]),n}(dn);d()(vr,"TYPE","AddMapAction");var gr=vr;function yr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var br=J.Utils.ofNull,Ar=function(e){T()(n,e);var t=yr(n);function n(e,o){var r;return x()(this,n),r=t.call(this,e),d()(O()(r),"getType",(function(){return n.TYPE})),r.robot=o,r.pointCloudSubscribe(),r}return C()(n,[{key:"pointCloudSubscribe",value:function(){var e=this;J.MasterDB.subscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"},(function(t){an.Maybe.fromNull(t).flatMap((function(e){return br(e.key)})).flatMap((function(t){return br(t.Robot[e.robot.id])})).flatMap((function(e){return br(e.Parameter)})).flatMap((function(e){return br(e.front_lidar)})).flatMap((function(e){return br(e.Value)})).flatMap((function(e){return br(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}),(function(t){an.Maybe.fromNull(t.value).flatMap((function(e){return br(e.Robot)})).flatMap((function(t){return br(t[e.robot.id])})).flatMap((function(e){return br(e.Parameter)})).flatMap((function(e){return br(e.front_lidar)})).flatMap((function(e){return br(e.Value)})).flatMap((function(e){return br(e.points)})).forEach((function(t){return e.updatePointCloud(t)}))}))}},{key:"updatePointCloud",value:function(e){var t=new Qt.VertexData;t.positions=e.flatMap((function(e){return e}));var n=new Array(4*e.length);t.colors=n.fill(1),t.applyToMesh(this.mesh,!0)}},{key:"dispose",value:function(){sn()(D()(n.prototype),"dispose",this).call(this),J.MasterDB.unsubscribe({Scope:"Robot",Name:this.robot.id,Parameter:"front_lidar"})}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||!o)throw new Error("null dictionary describing point cloud or null mainView");var r=new Qt.Mesh("cloudPoint".concat(t.name),e),a=new Qt.StandardMaterial("cloudPoint".concat(t.name,"Material"),e);return a.emissiveColor=new Qt.Color3(1,1,1),a.disableLighting=!0,a.pointsCloud=!0,a.pointSize=2,r.material=a,new n(r,t)}}]),n}(hn.a);d()(Ar,"TYPE","PointCloud");var wr=Ar,Mr=function(){function e(){if(x()(this,e),Pr)return Pr;Pr=this,this.meshCacheBySceneId={},this.count=0}return C()(e,[{key:"hasKey",value:function(e,t){var n=t._uid;return an.Maybe.fromNull(this.meshCacheBySceneId[n]).flatMap((function(t){return Er(t[e])})).cata((function(){return!1}),(function(){return!0}))}},{key:"put",value:function(e,t,n){var o=t._uid;return o in this.meshCacheBySceneId||(this.meshCacheBySceneId[o]={}),this.meshCacheBySceneId[o][e]=n,n.setEnabled(!1),this}},{key:"get",value:function(e,t){var n=this,o=t._uid;return an.Maybe.fromNull(this.meshCacheBySceneId[o]).flatMap((function(t){return Er(t[e])})).map((function(t){console.log("#Mesh: Found Mesh in cache, retrieving copy number",n.count);var o=t.clone("".concat(e).concat(n.count++));return console.log("#Mesh:",o),o.setEnabled(!0),o})).orNull()}},{key:"del",value:function(e){var t=e._uid;t in this.meshCacheBySceneId&&delete this.meshCacheBySceneId[t]}}],[{key:"getInstance",value:function(){return new e}}]),e}(),Er=function(e){return an.Maybe.fromNull(e)},Pr=null,xr=Mr,kr=(n(132),function(){function e(t){var n=this;x()(this,e),d()(this,"load",(function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transformMesh;return new Promise((function(e,r){var a=xr.getInstance();if(a.hasKey(t,n.scene))console.log("Found Mesh ".concat(t," in cache for scene ").concat(n.scene)),e(a.get(t,n.scene));else{console.log("Loading mesh....");var i=new Qt.AssetsManager(n.scene),c=i.addMeshTask("","",Cr,t);c.onSuccess=function(e){console.log("Load Success",t);var o=e.loadedMeshes[0];o.name=t,o.rotationQuaternion=Qt.Quaternion.Identity(),o.position=Qt.Vector3.Zero(),a.put(t,n.scene,o)},c.onError=function(e,n,o){console.log("Load error =>",n),r({message:n,exception:o,assetName:t,assetType:qr.Mesh})},i.onFinish=function(r){console.log("Load finish ");var i=a.get(t,n.scene);null!==i&&e(o(i))},i.load()}}))})),this.scene=t}return C()(e,null,[{key:"of",value:function(t){return new e(t)}},{key:"transformMesh",value:function(e){for(var t=Math.PI/2,n=e.getVerticesData(Qt.VertexBuffer.PositionKind),o=e.getVerticesData(Qt.VertexBuffer.NormalKind),r=new Float32Array(n.length),a=new Float32Array(n.length),i=Math.cos(t),c=Math.sin(t),u=n.length/3,s=0;s<u;s++)r[3*s]=n[3*s],r[3*s+1]=n[3*s+1]*i-n[3*s+2]*c,r[3*s+2]=n[3*s+1]*c-n[3*s+2]*i,a[3*s]=o[3*s],a[3*s+1]=o[3*s+1]*i-o[3*s+2]*c,a[3*s+2]=o[3*s+1]*c-o[3*s+2]*i;return e.setVerticesData(Qt.VertexBuffer.PositionKind,r,!0),e.setVerticesData(Qt.VertexBuffer.NormalKind,a,!0),e}}]),e}());d()(kr,"getMeshUrl",(function(e){return"".concat(Cr).concat(e)}));var Cr="/static/meshes/",Sr=kr;function Or(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Nr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Or(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Or(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Tr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Ir=function(e){T()(n,e);var t=Tr(n);function n(e){var o,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e,t){return ur.getDefaultAnimator(t)};return x()(this,n),a=t.call(this),d()(O()(a),"action",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};sn()((o=O()(a),D()(n.prototype)),"action",o).call(o,e),e.getNodeFromTree(a.robot.name).orElseRun((function(){return a.addRobot(e,t)})),e.getNodeFromTree(a.robot.name).forEach((function(n){n.item.mesh.id.includes(a.robot.meshName)||(e.deleteNodeFromTreeUsingName(a.name,!0,!0),a.addRobot(e,t))})),e.setSelectedAction(er().dragObjects)})),d()(O()(a),"getRobot",(function(e,t,n,o){var r=ur.createRobotMeshTree(a.robot.robotTree,t,e),i=an.Maybe.fromNull(a.memory.nodeItemDict);return ur.builder().id(a.robot.id).name(an.Maybe.fromNull(a.memory.name).orSome(a.robot.name)).assetName(an.Maybe.fromNull(a.memory.assetName).orSome(a.robot.name)).meshTree(r).parentMesh(n).parentView(o).scene(e).keyValueMap(i.map((function(e){return e.keyValueMap})).orSome({})).build()})),d()(O()(a),"getCloudPoint",(function(e,t,n){var o=wr.ofDict(e,{name:a.robot.name,id:a.robot.id},t);return o.mesh.parent=n.mesh,o})),d()(O()(a),"getParentMesh",(function(e){return an.Maybe.fromNull(a.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(O()(a),"getType",(function(){return n.TYPE})),a.key="robotAction".concat(e.name),a.name=e.name,a.robot=e,a.robotAnimatorFactory=i,a.icon=function(e){return r.a.createElement("i",Se()({className:"fas fa-robot"},e))},a}return C()(n,[{key:"addRobot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.getSceneMemory().forEach((function(o){var r=o.scene,a=Nr({},t.memory);a.isImport?t.loadRobot(r,e,a,n):e.getUndoManager().doIt(t.getUndoAbleAction(e,r,a))})),this.memory.isImport=!1}},{key:"getUndoAbleAction",value:function(e,t,n){var o=this;return J.UndoManager.actionBuilder().doAction((function(){o.loadRobot(t,e,n)})).undoAction((function(t){var n=t.is2UpdateInServer,r=void 0===n||n;e.deleteNodeFromTreeUsingName(o.name,r)})).build()}},{key:"loadRobot",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};Sr.of(e).load(this.robot.meshName).then((function(r){return o.createRobotFromMesh(r,e,t,n)})).catch((function(e){return r(e)}))}},{key:"createRobotFromMesh",value:function(e,t,n,o){var r=this.getParentMesh(n),a=an.Maybe.fromNull(o.isImport).orSome(!1),i=an.Maybe.fromNull(o.isVisible).orSome(!0);e.setEnabled(i);var c=this.getRobot(t,e,r,n);c.animate(this.robotAnimatorFactory(c,n)),n.addNodeItem2Tree(c,r.name,!a,i);var u=this.getCloudPoint(t,n,c);n.addNodeItem2Tree(u,c.name,!1,i)}}]),n}(dn);d()(Ir,"TYPE","RobotAction");var Br=Ir;function Rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Dr=function(e){T()(n,e);var t=Rr(n);function n(e,o){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return x()(this,n),r=t.call(this,e,o,a),d()(O()(r),"getType",(function(){return n.TYPE})),r}return C()(n,[{key:"toDict",value:function(){return sn()(D()(n.prototype),"toDict",this).call(this)}},{key:"getMouseContextActions",value:function(e){return sn()(D()(n.prototype),"getMouseContextActions",this).call(this,e).filter((function(e){return"Delete"===e.title}))}}]),n}(pn);d()(Dr,"TYPE","Mesh");var Fr=Dr;function Lr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Vr=function(e){T()(n,e);var t=jr(n);function n(e){var o;return x()(this,n),o=t.call(this),d()(O()(o),"addMesh",(function(e){e.getSceneMemory().forEach((function(t){var n=t.scene,r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lr(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.memory),a=o.getIsImport(r),i=o.getFinalNameFromMemory(r,a);a?o.loadMesh(e,n,r,a,i):e.getUndoManager().doIt(o.getUndoAbleAction(e,n,r,a,i))})),o.memory.isImport=!1})),d()(O()(o),"transformMesh",(function(e,t,n,r){return function(a){var i=o.getParentMesh(e);a.parent=i,a.createNormals();var c=Ur(n.nodeItemDict);a.position=c.flatMap((function(e){return r?Kr(e.position):zr()})).map(Qt.Vector3.FromArray).orSome(Qt.Vector3.Zero()),a.rotationQuaternion=c.flatMap((function(e){return r?Kr(e.quaternion):zr()})).map((function(e){return new Qt.Quaternion(e[1],e[2],e[3],e[0])})).orSome(Qt.Quaternion.Identity());var u=new Qt.StandardMaterial("Mesh".concat(a.name),t),s=c.flatMap((function(e){return r?Kr(e.color):zr()})).map(Qt.Color3.FromArray).orSome(Qt.Color3.Gray());return u.diffuseColor=s,u.emissiveColor=s,a.material=u,a}})),d()(O()(o),"addMesh2Scene",(function(e,t,n,r){return function(a){var i=o.getParentMesh(e);a.name=r;var c=new Fr(a,o.name,Ur(t.nodeItemDict).flatMap((function(e){return n?Kr(e.keyValueMap):zr()})).orSome({}));e.addNodeItem2Tree(c,i.name,!n),e.renderMenus()}})),d()(O()(o),"getParentMesh",(function(e){return Ur(o.memory.parentObj).map((function(e){return e.parent})).flatMap((function(t){return e.getNodeFromTree(t)})).map((function(e){return e.item.mesh})).orSome(e.getRootNode().item.mesh)})),d()(O()(o),"getType",(function(){return n.TYPE})),d()(O()(o),"deleteAsset",(function(){})),d()(O()(o),"download",qt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))),o.key=e.id,o.name=e.name,o.icon=function(e){return r.a.createElement("i",Se()({},e,{className:"fas fa-draw-polygon"}))},o}return C()(n,[{key:"action",value:function(e){sn()(D()(n.prototype),"action",this).call(this,e),console.log("Mesh ".concat(this.key," : ").concat(this.name),this.memory),this.addMesh(e),e.setSelectedAction(er().dragObjects)}},{key:"getIsImport",value:function(e){return Ur(e.isImport).orSome(!1)}},{key:"getFinalNameFromMemory",value:function(e,t){return Ur(e.nodeItemDict).flatMap((function(e){return t?Kr(e.name):zr()})).orSome("".concat(this.name).concat(Math.floor(100*Math.random())))}},{key:"getUndoAbleAction",value:function(e,t,n,o,r){var a=this;return J.UndoManager.actionBuilder().doAction((function(){a.loadMesh(e,t,n,o,r)})).undoAction((function(t){var n=t.is2UpdateInServer,o=void 0===n||n;e.deleteNodeFromTreeUsingName(r,o)})).build()}},{key:"loadMesh",value:function(e,t,n,o,r){Sr.of(t).load(this.key).then(this.transformMesh(e,t,n,o)).then(this.addMesh2Scene(e,n,o,r))}}]),n}(dn);d()(Vr,"TYPE","AddMeshAction");var Ur=an.Maybe.fromNull,zr=an.Maybe.none,Kr=an.Maybe.some,Gr=Vr,qr={Map:"Map",Robot:"Robot",Mesh:"Mesh"},Wr={Map:function(e){return new gr(e.name,e.loader)},Robot:function(e){return new Br(e,ur.getSocketAnimator)},Mesh:function(e){return new Gr(e)}},_r=n(58);function Hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Yr=function(e){T()(n,e);var t=Hr(n);function n(e,o,r){var a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return x()(this,n),a=t.call(this,e,c),d()(O()(a),"getType",(function(){return n.TYPE})),a.localWall=o,a.size=r,a.keyPoints=i,a}return C()(n,[{key:"toDict",value:function(){var e=sn()(D()(n.prototype),"toDict",this).call(this);return e.localWall=this.localWall,e.size=this.size,e}},{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return n.ofDict(e,t,o)}}],[{key:"ofDict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("null dictionary describing wall");var r=an.Maybe.fromNull(t.name).orSome("Wall".concat(Math.floor(1e3*Math.random()))),a=Xr(t,r,e),i=new Qt.StandardMaterial("WallMaterial".concat(r),e),c=new Qt.Color3(t.color[0],t.color[1],t.color[2]);i.diffuseColor=c,i.emissiveColor=c,a.material=i,a.position.z+=.001;var u=$r(e,t.localWall.map((function(e){return fn.a.of(e).toBabylon()})),a,o);return new n(a,t.localWall,t.size,u,t.keyValueMap)}}]),n}(hn.a);d()(Yr,"TYPE","Wall");var Qr=Jt.b.RADIUS,Zr=[[0,1,2],[2,3,0],[4,6,5],[6,4,7],[0,5,1],[5,0,4],[3,2,6],[6,7,3],[1,6,2],[6,1,5],[0,3,7],[7,4,0]];function Xr(e,t,n){var o=e.localWall.map((function(e){return fn.a.of(e).toBabylon()})),r=fn.a.of(e.position).toBabylon(),a=o[1].subtract(o[0]).normalize(),i=new Qt.Vector3(-a.y,a.x,0),c=[o[0].add(i.scale(e.size.width)),o[0].subtract(i.scale(e.size.width)),o[1].subtract(i.scale(e.size.width)),o[1].add(i.scale(e.size.width))],u=new Qt.Vector3(0,0,e.size.height),s={positions:[c[0],c[1],c[2],c[3],c[0].add(u),c[1].add(u),c[2].add(u),c[3].add(u)],faces:Zr},l=ln.a.meshFromPositionAndFaces(t,n,s.positions,s.faces);return l.position=r,l}var Jr=function(e,t){return function(n){var o=n.updatedPointMesh,r=n.is2updateServer;e.getNodeFromTree(o.parent.name).forEach((function(n){var a=o.index,i=n.item,c=i.mesh,u={position:fn.a.ofBabylon(c.position).toArray(),localWall:i.localWall,size:i.size};u.localWall[a]=fn.a.ofBabylon(o.position).toArray(),function(e,t,n,o){var r=ln.a.pointAverageVec3(e.localWall.map((function(e){return fn.a.of(e)})));e.position=r.toArray(),e.localWall=e.localWall.map((function(e){return fn.a.of(e).sub(r).toArray()}));var a=Xr(e,n.name,t);a.position=n.position,a.rotationQuaternion=n.rotationQuaternion,a.locallyTranslate(r.toBabylon()),a.material=n.material,a.visibility=n.visibility,a.parent=n.parent,a.getMouseContextActions=n.getMouseContextActions,a.nodeItem=n.nodeItem,o.mesh=a,o.localWall=e.localWall,_t()(n._children).forEach((function(e){n.removeChild(e),e.parent=a})),o.keyPoints.forEach((function(t,n){t.position=fn.a.of(e.localWall[n]).toBabylon()})),n.dispose()}(u,t,c,i),r&&e.updateNodeInServer(c.name)}))}},$r=function(e,t,n,o){var r=[];return t.forEach((function(t,a){var i=ln.a.createSphere(e,new Qt.Color3(.25,.25,.25),Qr,"".concat(n.name,"keyPointWall").concat(a),!0);i.parent=n,i.position=t,i.index=a,i.observers=new Qt.Observable,i.observers.add(Jr(o,e)),r.push(i)})),r},ea=Yr,ta={GlobalRef:cn.a,Box:_r.a,KeyPoint:In,Path:Yn.a,Wall:ea,BoxRegion:go,PolygonRegion:jo,GraphItem:Hn.a,NavigationPreviewItem:Xo.a},na=function(){function e(){x()(this,e)}return C()(e,null,[{key:"importScene",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){};console.log("Importing scene...",t,n),e.updateErrorList=a;var i=[];return n.length>0?aa(t,n,o,i,r):ia(t),console.log("End Importing scene"),i}},{key:"importNodeItem",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=ta[t.type];r&&e.getSceneMemory().forEach((function(a){var i=a.scene,c=r.ofDict(i,t,e),u=void 0===t.isVisible||t.isVisible;c.mesh.setEnabled(u),e.getNodeFromTree(n).forEach((function(e){c.mesh.parent=e.item.mesh})),e.addNodeItem2Tree(c,n,o,u,!1)}))}}]),e}();function oa(e){return e.type in qr}function ra(e,t,n,o){var r=t.type,a=an.Maybe.fromNull(t.assetName).orSome(t.name),i=e.getAssetsActionMap(),c=an.Maybe.fromNull(i[a]).orLazy((function(){return i[a.split(".")[0]]}));if(!c&&r===qr.Robot){var u=ur.createBaseObject({robotName:a,nodeDict:t});c=Wr.Robot(u)}c?(c.memory.parentObj={parent:n},c.memory.nodeItemDict=t,c.memory.assetName=a,c.memory.name=t.name,c.memory.isImport=!0,c.memory.isVisible=void 0===t.isVisible||t.isVisible,c.action(e,(function(e){var t;"RequestFileError"===(null==e||null===(t=e.exception)||void 0===t?void 0:t.name)&&(o.push({cause:"Asset of type ".concat(e.assetType," with name ").concat(e.assetName,", was not found"),solution:"please upload ".concat(e.assetType," ").concat(e.assetName)}),na.updateErrorList(o))}))):o.push({cause:"Asset of type ".concat(r," with name ").concat(a,", was not found"),solution:"please upload ".concat(r," ").concat(a)})}function aa(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(t){var a=t.sort((function(e,t){return e.item.type===ta.GlobalRef.TYPE?-1:t.item.type===ta.GlobalRef.TYPE||e.item.type===ta.GraphItem.TYPE?1:t.item.type===ta.GraphItem.TYPE||e.name<t.name?-1:e.name>t.name?1:0}));a.forEach((function(t){oa(t.item)?ra(e,t.item,n,o):na.importNodeItem(e,t.item,n,r),t.children.length>0&&aa(e,t.children,t.name,o,r)}))}}function ia(e){e.getSceneMemory().forEach((function(t){var n=t.scene;e.addNodeItem2Tree(cn.a.ofDict(n),null,!0)}))}d()(na,"updateErrorList",(function(){}));var ca=na,ua=function e(){x()(this,e)};d()(ua,"retrieveScene",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:la,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sa("retrieving scene");J.MasterDB.cloudFunction(Jt.b.CLOUD_FUNCTION_NAME,"retrieveScene",e,(function(e){return fa(e,t,n)}))}));var sa=function(e){return function(e){}},la=function(e){},fa=function(e,t,n){e.success?t(e):n(e)},da=ua,ha=n(65),ma=n(59),pa=function e(){x()(this,e)};function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ga(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}d()(pa,"onPointerDown",(function(e){return function(t){e.mousePosClick=e.getMouseCoordsFromRoot().orSome(Qt.Vector3.Zero()),e.mousePosMove=e.mousePosClick,e.sceneMemory.forEach((function(e){var n=e.camera,o=e.canvas;(2===t.buttons||4===t.buttons||t.ctrlKey)&&n.detachControl(o)}))}})),d()(pa,"onPointerUp",(function(e){return function(){e.sceneMemory.forEach((function(e){var t=e.camera,n=e.canvas;t.attachControl(n,!0)}))}})),d()(pa,"onPointerMove",(function(e){return function(t){e.sceneMemory.forEach((function(n){var o=n.mouseLocationText,r=n.camera;e.getMouseCoordsFromRoot().forEach((function(n){!function(e,t){e.text="x: ".concat(t.x.toFixed(2),", y: ").concat(t.y.toFixed(2))}(o,n);var a=function(){var t=n.subtract(e.mousePosMove),o=ln.a.getBabylonCoordinates(t).scale(-1);!function(e,t){ma.a.builder().initialState({camera:e,time:0,T:(new Date).getTime()}).nextState((function(e){var n=e.camera,o=e.time,r=t.scale(.1);return n.position=n.position.add(r),n.setTarget(n.target.add(r)),{camera:n,time:o+.1,T:(new Date).getTime()}})).while((function(e){return e.time<=1})).build().play()}(r,o),e.mousePosMove=n},i=[{predicate:t.ctrlKey&&1===t.buttons,action:a},{predicate:4===t.buttons,action:a}].filter((function(e){return e.predicate}));i.length>0&&i[0].action()}))}))}}));var ya=function(e){T()(n,e);var t=ga(n);function n(e){var o;return x()(this,n),o=t.call(this,e),d()(O()(o),"getRobotManager",(function(){return o.robotManager})),d()(O()(o),"getSceneMemory",(function(){return o.sceneMemory})),d()(O()(o),"getAssetsActionMap",(function(){return mr.getInstance().getAssetsActionMap()})),d()(O()(o),"getRootNode",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_t()(o.objectTree);return e.filter((function(e){return e.title===cn.a.NAME}))[0]})),d()(O()(o),"getObjectTree",(function(){return o.objectTree})),d()(O()(o),"setSelectedAction",(function(){})),d()(O()(o),"getUndoManager",(function(){return o.undoManager})),d()(O()(o),"getNodeFromTree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_t()(o.objectTree);return ha.a.ofScene(o.sceneName,o.undoManager).getNodeFromTree(e,t)})),d()(O()(o),"deleteNodeFromTreeUsingName",(function(){throw new Error("Delete Node in viewer Exception")})),d()(O()(o),"updateNodeInServer",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;ha.a.ofScene(o.sceneName,o.undoManager).updateNodeInServer(e,_t()(o.objectTree),t)})),d()(O()(o),"addNodeItem2Tree",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn.a.NAME,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=ha.a.ofScene(o.sceneName,o.undoManager).addNodeItem2Tree(_t()(o.objectTree),e,t,n,r);o.objectTree=a})),d()(O()(o),"setCameraToTarget",(function(){o.sceneMemory.forEach((function(e){var t=e.camera,n=o.isPanned?"":o.props.focusObject.Value;o.getNodeFromTree(n).forEach((function(e){console.log("Set Camera, Found Object",e.item.mesh);var n=.001*(new Date).getTime()-o.time;o.time=.001*(new Date).getTime();var r=e.item.mesh._absolutePosition.clone();o.cameraSpeed=o.targetPos?r.subtract(o.targetPos):Qt.Vector3.Zero(),o.targetPos=r,t.setTarget(r),t.position=t.position.add(o.cameraSpeed.scale(n)),t.beta=o.isRotated?t.beta:0}))}))})),d()(O()(o),"onPointerDown",(function(e){o.isRotated=!0,pa.onPointerDown(O()(o))(e)})),d()(O()(o),"onPointerUp",(function(e){pa.onPointerUp(O()(o))(e)})),d()(O()(o),"onPointerMove",(function(e){4===e.buttons&&(o.isPanned=!0),pa.onPointerMove(O()(o))(e)})),d()(O()(o),"onResize",(function(e,t){0===e&&0===t||o.getSceneMemory().forEach((function(n){var o=n.mouseLocationText;o.left=-e/2+e/17,o.top=-t/2+t/30}))})),d()(O()(o),"retrieveSceneFromServer",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};da.retrieveScene(o.sceneName,(function(t){var n=ca.importScene(O()(o),t.result);o.setState({errorList:n}),e()}))})),d()(O()(o),"loadAssets",qt()(Yt.a.mark((function e(){var t;return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=mr.getInstance(),0!==Object.values(t.getAssets()).length){e.next=4;break}return e.next=4,t.load();case 4:case"end":return e.stop()}}),e)})))),d()(O()(o),"loadScene",qt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadAssets();case 2:o.retrieveSceneFromServer(o.renderScene);case 3:case"end":return e.stop()}}),e)})))),d()(O()(o),"renderScene",(function(){o.getSceneMemory().forEach((function(e){var t=e.engine,n=e.scene;return t.runRenderLoop((function(){o.time=.001*(new Date).getTime(),n.render(),o.setCameraToTarget()}))}))})),d()(O()(o),"onSceneReady",(function(e){var t=e.getEngine(),n=t.getRenderingCanvas();o.addCanvasEventListeners(n);var r=Mn.createMouseLocationText(e);return o.sceneMemory=an.Maybe.some({engine:t,canvas:n,scene:e,camera:Mn.createCamera(e,n),light:Mn.createLight(e),ground:Mn.createMeshGround(e),gizmoManager:Mn.createGizmo(e),highlightLayer:{layer:new Qt.HighlightLayer("hl1",e),lastHlMeshes:[]},mouseLocationText:r}),e})),d()(O()(o),"showRobotAlertModal",(function(e){o.robotAlertModal.current.open(e)})),d()(O()(o),"showAlert",(function(e,t){alert("type:".concat(t," ")+e)})),d()(O()(o),"renderMenus",(function(){})),d()(O()(o),"componentDidUpdate",(function(e){[{propVar:function(e){return e.sceneName.Value},action:function(){return o.sceneName=o.props.sceneName.Value}},{propVar:function(e){return e.focusObject.Value},action:function(){o.isPanned=!1,o.isRotated=!1,o.setCameraToTarget()}}].forEach((function(t){var n=t.propVar,r=t.action;n(o.props)!==n(e)&&r()}))})),d()(O()(o),"componentDidMount",(function(){console.log("SceneViewer Did Mount!! "),o.loadScene()})),o.state={errorList:[]},o.sceneName=e.sceneName.Value,o.sceneMemory=an.Maybe.none(),o.objectTree=[],o.undoManager=new J.UndoManager,o.isPanned=!1,o.isRotated=!1,o.targetPos=void 0,o.cameraSpeed=Qt.Vector3.Zero(),o.time=.001*(new Date).getTime(),o.robotManager=new J.RobotManager,o.robotAlertModal=r.a.createRef(),o}return C()(n,[{key:"getGraph",value:function(){return new _n.a(this.objectTree).getNode((function(e){return Hn.a.TYPE===e.item.getType()}))}},{key:"addCanvasEventListeners",value:function(e){var t=this;[{name:"pointerdown",function:function(e){return t.onPointerDown(e)}},{name:"pointerup",function:function(e){return t.onPointerUp(e)}},{name:"pointermove",function:function(e){return t.onPointerMove(e)}}].forEach((function(t){return e.addEventListener(t.name,t.function,!1)}))}},{key:"getMouseCoordsFromRoot",value:function(){var e=this;return this.sceneMemory.flatMap((function(t){var n=t.scene,o=t.ground;return ln.a.getGroundPosition(n,o).flatMap((function(t){return an.Maybe.fromNull(e.getRootNode()).map((function(e){return ln.a.getLocalCoordFromWorld(e.item.mesh,fn.a.ofBabylon(t)).toBabylon()}))}))}))}},{key:"render",value:function(){var e=this,t=this.state.errorList,n=function(){return e.setState({errorList:[]})};return r.a.createElement("div",{style:{display:"flex",flexGrow:1,maxHeight:"100%"}},r.a.createElement(rn,{onSceneReady:this.onSceneReady,is2render:!1,sceneFactory:Mn.createScene}),r.a.createElement(E,{onSubmit:n,onCancel:n,open:(null==t?void 0:t.length)>0,title:"Scene Viewer",message:"An error occurred while loading the scene",submitText:"OK",submitColor:"primary",cancelText:"Cancel",cancelColor:"secondary"},function(e){return e?r.a.createElement("ul",null,e.map((function(e,t){var n=e.cause,o=e.solution;return r.a.createElement("li",{key:"error"+t},"".concat(n,", ").concat(o))}))):[]}(t)),r.a.createElement(te,{ref:this.robotAlertModal,title:"Alert"}),r.a.createElement(Xt.a,{handleWidth:!0,handleHeight:!0,onResize:this.onResize}))}}],[{key:"getComponentFactory",value:function(e){return function(t){var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({sceneName:e},t);return r.a.createElement(n,o)}}}]),n}(o.Component);d()(ya,"EXTENSION",".3d"),ya.propTypes={sceneName:u.a.shape({Value:u.a.string}),focusObject:u.a.shape({Value:u.a.string})},ya.defaultProps={sceneName:{Value:"Pedro"},focusObject:{Value:""}};var ba=ya,Aa=n(50),wa=n.n(Aa),Ma=n(34),Ea=n.n(Ma),Pa=n(46),xa=n.n(Pa),ka=Object(p.makeStyles)((function(e){return{formControl:{margin:e.spacing(1),minWidth:120}}})),Ca=function(e){var t=ka(),n=r.a.createElement("div",null);return e.noneOption&&(n=r.a.createElement(Pe.a,{value:""},r.a.createElement("em",null,"None"))),r.a.createElement(Ea.a,{variant:e.variant,className:t.formControl,style:e.style,hiddenLabel:void 0===e.label},r.a.createElement(wa.a,{id:"movai-react-select"},e.label),r.a.createElement(xa.a,{labelId:"movai-react-select",id:e.id,value:e.value,onChange:e.onChange,inputProps:e.inputProps},n,e.options.map((function(e,t){return r.a.createElement(Pe.a,{key:t,value:e},e)}))))};Ca.propTypes={value:u.a.string,options:u.a.array,noneOption:u.a.bool,label:u.a.string,variant:u.a.string,style:u.a.object,onChange:u.a.func,id:u.a.string,inputProps:u.a.object},Ca.defaultProps={value:"option2",options:["option1","option2","option3"],variant:"filled",noneOption:!0,onChange:function(e){return console.log(e.target.value)},id:"movai-react-select"};var Sa=Ca,Oa=n(51),Na=n.n(Oa),Ta=n(33),Ia=n.n(Ta),Ba=n(112),Ra=function(e){var t=e.path,n=void 0===t?"":t,o=e.style,a=void 0===o?{}:o,i=e.fill,c=void 0===i?"#fff":i,u=e.width,s=void 0===u?"100%":u,l=e.height,f=void 0===l?"100%":l,d=e.className,h=void 0===d?"":d,m=e.viewBox,p=void 0===m?"0 0 24 24":m;return r.a.createElement("svg",{width:s,style:a,height:f,viewBox:p,xmlns:"http://www.w3.org/2000/svg",className:"svg-icon ".concat(h||""),xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("path",{fill:c,d:n}))},Da={Close:r.a.createElement(Ra,{width:24,path:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),ErrorOutline:r.a.createElement(Ra,{width:24,path:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),InfoOutlined:r.a.createElement(Ra,{width:24,path:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"}),ReportProblemOutlined:r.a.createElement(Ra,{width:24,path:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"}),SuccessOutlined:r.a.createElement(Ra,{width:24,path:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"})},Fa={success:Da.SuccessOutlined,warning:Da.ReportProblemOutlined,error:Da.ErrorOutline,info:Da.InfoOutlined},La=function(e){var t=e.action,n=e.children,r=e.classes,a=e.className,i=e.closeText,c=void 0===i?"Close":i,u=e.color,s=e.icon,l=e.iconMapping,f=void 0===l?Fa:l,d=e.onClose,h=(e.role,e.severity),m=void 0===h?"success":h,p=e.variant,v=void 0===p?"standard":p,g=(e.theme,st()(e,["action","children","classes","className","closeText","color","icon","iconMapping","onClose","role","severity","variant","theme"]));return o.createElement("div",Se()({className:Na()(r.root,r["".concat(v).concat(Object(Ba.capitalize)(u||m))],a)},g),!1!==s?o.createElement("div",{className:r.icon},s||f[m]||Fa[m]):null,o.createElement("div",{className:r.message},n),null!=t?o.createElement("div",{className:r.action},t):null,null==t&&d?o.createElement("div",{className:r.action},o.createElement(Ia.a,{size:"small","aria-label":c,title:c,color:"inherit",onClick:d},Da.Close)):null)};La.propTypes={action:u.a.node,children:u.a.node,classes:u.a.object,className:u.a.string,closeText:u.a.string,color:u.a.oneOf(["error","info","success","warning"]),icon:u.a.node,iconMapping:u.a.shape({error:u.a.node,info:u.a.node,success:u.a.node,warning:u.a.node}),onClose:u.a.func,role:u.a.string,severity:u.a.oneOf(["error","info","success","warning"]),variant:u.a.oneOf(["filled","outlined","standard"])};var ja=Object(p.withStyles)((function(){return{root:{backgroundColor:"transparent",display:"flex",padding:"6px 16px"},filledSuccess:{color:"#fff",backgroundColor:"#4caf50"},filledInfo:{color:"#fff",backgroundColor:"#2196f3"},filledWarning:{color:"#fff",backgroundColor:"#ff9800"},filledError:{color:"#fff",backgroundColor:"#f44336"},icon:{marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9},message:{padding:"8px 0",display:"flex",flexDirection:"column",justifyContent:"center"},action:{display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}}}),{name:"MuiAlert"})(La);n(136);function Va(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Ua=function(e){T()(n,e);var t=Va(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"autoClose",null),d()(O()(e),"handleClickButton",(function(t){t.onClick&&t.onClick(),e.close()})),d()(O()(e),"handleClickOverlay",(function(t){var n=e.props,o=n.closeOnClickOutside,r=n.onClickOutside,a=t.target===e.overlay;o&&a&&(r(),e.close())})),d()(O()(e),"close",(function(){Ka(),za()})),d()(O()(e),"keyboardClose",(function(t){var n=e.props,o=n.closeOnEscape,r=n.onKeypressEscape,a=27===t.keyCode;o&&a&&(r(t),e.close())})),d()(O()(e),"componentDidMount",(function(){document.addEventListener("keydown",e.keyboardClose,!1),e.autoClose=setTimeout((function(){(document.getElementById("react-confirm-alert")||document.getElementById("react-confirm-alert-body-element"))&&e.close()}),e.props.autoHideDuration)})),d()(O()(e),"componentWillUnmount",(function(){document.removeEventListener("keydown",e.keyboardClose,!1),clearTimeout(e.autoClose),e.props.willUnmount()})),d()(O()(e),"renderCustomUI",(function(){var t=e.props,n=t.title,o=t.message;return(0,t.customUI)({title:n,message:o,onClose:e.close})})),e}return C()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.message,o=t.customUI,a=t.severity,i=t.closeText,c=t.closable,u=t.theme;return r.a.createElement("div",{className:"react-confirm-alert-overlay",ref:function(t){return e.overlay=t},onClick:this.handleClickOverlay},r.a.createElement("div",{className:"react-confirm-alert"},o?this.renderCustomUI():r.a.createElement("div",{className:"react-confirm-alert-body"},r.a.createElement(ja,{theme:u,elevation:6,variant:"filled",severity:a,closeText:i,action:c?r.a.createElement("div",{className:"icon-container",onClick:function(){return e.close()}},Da.Close):void 0},n))))}}]),n}(o.Component);function za(){var e=document.getElementById("react-confirm-alert");Object(qn.unmountComponentAtNode)(e),e.parentNode.removeChild(e)}function Ka(){document.body.classList.remove("react-confirm-alert-body-element")}function Ga(e,t){document.body.classList.add("react-confirm-alert-body-element"),function(e,t){var n=document.getElementById("react-confirm-alert");n||(document.body.children[0].classList.add("react-confirm-alert-blur"),(n=document.createElement("div")).id="react-confirm-alert",document.body.appendChild(n)),Object(qn.render)(r.a.createElement(Ua,Se()({},e,{theme:t})),n)}(e,t)}d()(Ua,"propTypes",{message:u.a.string,customUI:u.a.func,closeOnClickOutside:u.a.bool,closeOnEscape:u.a.bool,willUnmount:u.a.func,onClickOutside:u.a.func,onKeypressEscape:u.a.func,severity:u.a.string,closeText:u.a.string,autoHideDuration:u.a.number,closable:u.a.bool}),d()(Ua,"defaultProps",{closeOnClickOutside:!0,closeOnEscape:!0,willUnmount:function(){return null},onClickOutside:function(){return null},onKeypressEscape:function(){return null},severity:"info",closeText:"Close",autoHideDuration:6e3,closable:!0});n(138),n(139);function qa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Wa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qa(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _a,Ha={borderBottom:"1px solid #212121",textColor:"white",background:{primary:"#424242",secondary:"#212121"}},Ya={borderBottom:"1px solid #ccc",textColor:"rgba(0, 0, 0, 0.87)",background:{primary:"#e2e2e2",secondary:"#b2b2b2"}},Qa=function(e){return Wa(Wa({},e),{},{typography:{fontFamily:"Open Sans",h1:{fontFamily:"Open Sans"},h2:{fontFamily:"Open Sans"},h3:{fontFamily:"Open Sans"},h4:{fontFamily:"Open Sans"},h5:{fontFamily:"Open Sans"},h6:{fontFamily:"Open Sans"},body1:{fontFamily:"Roboto"}},cursorDefault:{cursor:"default"},cursorPointer:{cursor:"pointer"}})},Za={dark:Object(p.createMuiTheme)(Qa({label:"dark",textColor:Ha.textColor,backgroundColor:"linear-gradient(114.01deg, #212121 0%, #050505 100.43%)",bottomNavigation:{background:"#212121"},globalStats:{borderColor:"#474747",subTextColor:"#CDCDCD",upperTextColor:"#E6E6E6"},palette:{type:"dark",primary:{main:"#36b5e6"},secondary:{main:"#CF6679"},green:{main:"#03DAC5"},background:{primary:Ha.background.primary,secondary:Ha.background.secondary},accent:{background:"#f5f5f9",color:"rgba(0, 0, 0, 0.87)",border:"#dadde9"}},icon:{color:"#c6c6c6",hoverColor:"white"},table:{stripColor:"#505050"},verticalBar:{iconColor:"#9e9e9e"},overrides:{MuiTableCell:{body:{color:Ha.textColor}},MuiAppBar:{colorDefault:{color:Ha.textColor,borderColor:"black",backgroundColor:Ha.background.secondary},colorInherit:{color:Ha.textColor,backgroundColor:"#353535"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"inherit",margin:"8px"},containedSecondary:{color:"inherit",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#36b5e6"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(255,255,255,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}}}})),light:Object(p.createMuiTheme)(Qa({font:{Roboto:{fontFamily:"Roboto"},OpenSans:{fontFamily:"Open Sans"}},label:"light",textColor:Ya.textColor,backgroundColor:"linear-gradient(122.19deg, #FFFFFF 2.58%, #FFFFFF 76.23%)",bottomNavigation:{background:"#c3c3c3"},icon:{color:"#757575",hoverColor:"black"},table:{stripColor:"whitesmoke"},globalStats:{borderColor:"#E6E6E6",subTextColor:"#717171",upperTextColor:"#474747"},palette:{primary:{main:"#007197"},secondary:{main:"#BE2424"},green:{main:"#03DAC5"},background:{primary:Ya.background.primary,secondary:Ya.background.secondary},accent:{background:"whitesmoke",color:Ya.textColor,border:"darkgray"}},verticalBar:{iconColor:"#616161"},overrides:{MuiTableCell:{body:{color:Ya.textColor}},MuiAppBar:{colorDefault:{color:Ya.textColor,borderColor:Ya.borderBottom,backgroundColor:Ya.background.secondary},colorInherit:{color:Ya.textColor,backgroundColor:"#d2d2d2"}},MuiButton:{outlined:{margin:"8px"},text:{margin:"8px"},contained:{margin:"8px"},containedPrimary:{color:"white",margin:"8px"},containedSecondary:{color:"white",margin:"8px"}},MuiButtonGroup:{root:{margin:"0"},groupedContainedPrimary:{margin:"0"},groupedOutlined:{margin:"0"},groupedText:{margin:"0"}},MuiIconButton:{root:{color:"#007197"}},MuiListItem:{button:{"&:hover":{backgroundColor:"rgba(0,113,151, 0.15)"}}},MuiFormControlLabel:{label:{color:"rgba(0,0,0,0.8)"}},MuiInputBase:{input:{font:"Roboto"}},MuiFilledInput:{root:{border:"4px"},underline:{"&::before":{borderRadius:"4px"}}},MuiPaper:{root:{color:"#272727",backgroundColor:Ya.background.primary}},MuiTableRow:{head:{"& th":{backgroundColor:Ya.background.primary,borderBottom:Ya.borderBottom}},root:{"& td":{borderBottom:Ya.borderBottom}}}}})),getTheme:function(){var e=window.localStorage.getItem("movai.theme");return e||"dark"},setTheme:function(e){window.localStorage.setItem("movai.theme",e)}},Xa=Za,Ja=n(113),$a=n.n(Ja),ei=n(114),ti=Object(ei.createGlobalStyle)(_a||(_a=$a()(["",""])),J.Style),ni=n(66),oi=n.n(ni),ri=n(115);function ai(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var ii=Object(p.withStyles)((function(e){return{paper:{borderRadius:"8px",width:"242px",height:"411px",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.25)"}}}))((function(e){return r.a.createElement(Me.a,Se()({elevation:0,getContentAnchorEl:null,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},autoFocus:!1},e))})),ci=function(e){T()(n,e);var t=ai(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"state",{anchorEl:null,otherFilters:[]}),d()(O()(e),"handleClick",(function(t){e.setState({anchorEl:t.currentTarget})})),d()(O()(e),"handleClose",(function(){e.setState({anchorEl:null,otherFilters:[]})})),e}return C()(n,[{key:"render",value:function(){var e=this.props,t=e.classes,n=(e.t,e.disabled),o=e.tooltip,a=e.title;return r.a.createElement(r.a.Fragment,null,r.a.createElement(v.Tooltip,{title:o||a},r.a.createElement(Ia.a,{size:"small",onClick:this.handleClick,disabled:n,className:this.props.isActive?t.iconActive:t.icon},this.props.icon)),r.a.createElement(ii,{id:"customized-menu",anchorEl:this.state.anchorEl,open:Boolean(this.state.anchorEl),onClose:this.handleClose,className:t.height},r.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"-webkit-fill-available"}},r.a.createElement(v.Typography,{component:"div",style:{padding:"10px 10px 0px 20px",display:"flex",flexDirection:"row"}},r.a.createElement(v.Typography,{component:"div",style:{fontSize:"24px",fontFamily:"Open Sans",fontWeight:500}},this.props.title),r.a.createElement(v.Typography,{component:"div",style:{flexGrow:1}}),r.a.createElement(v.Typography,{component:"div",onClick:this.handleClose,className:t.icon},r.a.createElement("i",{className:"fas fa-times"}))),r.a.createElement("div",{style:{flexGrow:1,display:"flex",flexDirection:"column",margin:"10px 0px 0px 10px"}},this.props.children))))}}]),n}(o.Component);ci.propTypes={isActive:u.a.bool,disabled:u.a.bool,tooltip:u.a.string,title:u.a.string},ci.defaultProps={isActive:!1,disabled:!1,tooltip:"",title:"Filters"};var ui=Object(p.withStyles)((function(e){return{button:{margin:e.spacing(1),color:e.palette.primary.main,borderColor:e.palette.primary.main},iconActive:{color:e.palette.primary.main,borderColor:e.palette.primary.main,backgroundColor:Object(ri.fade)(e.palette.primary.main,.1)},buttonApplyFilters:{background:e.palette.primary.main,fontFamily:"Roboto",fontStyle:"normal",fontWeight:"bold",fontSize:"14px",color:"#FAFAFA",margin:"0px 20px 10px 20px","&:hover":{background:e.palette.primary.dark}},icon:{"&:hover":{cursor:"pointer"}},height:{height:"100%"},checkbox:{marginLeft:"10px"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)}}}),{withTheme:!0})(ci),si=n(116),li=n.n(si),fi=n(117),di=n.n(fi),hi=n(118),mi=n.n(hi),pi=n(119),vi=n.n(pi),gi=n(43),yi=n.n(gi),bi=n(67),Ai=n.n(bi),wi=n(60),Mi=n.n(wi),Ei=n(68),Pi=n.n(Ei),xi=n(69),ki=n(120),Ci=n.n(ki),Si=n(61),Oi=n.n(Si),Ni=Object(p.makeStyles)((function(e){return{input:{flex:1,paddingLeft:"10px",fontSize:"medium"},searchText:{minWidth:150,paddingLeft:e.spacing(3)},addTagText:{width:"100%"},limitText:{width:"50px",margin:e.spacing(0,3,0,3)},toggleContainer:{margin:e.spacing(2)},tagsContainer:{display:"flex",flexDirection:"column",padding:e.spacing(.5),margin:e.spacing(0,3,0,3)},tagsList:{marginTop:e.spacing(3)},chip:{margin:e.spacing(.5)},formControl:{margin:e.spacing(1),minWidth:120,maxWidth:300},filtersButton:{display:"flex",flexDirection:"row"},columnsFilter:{display:"flex",flexDirection:"column",marginTop:6},iconButton:{color:"#0B6A8A","&:hover":{color:"#22c7ff"}}}})),Ti=function(e){var t,n=Ni(),o=r.a.useState(""),a=ce()(o,2),i=a[0],c=a[1],u=function(t){var n,o=null==t||null===(n=t.target)||void 0===n?void 0:n.value,r=o[o.length-1];e.updateRobotSelection(r)};return r.a.createElement(v.AppBar,{position:"static",color:"inherit"},r.a.createElement(v.Toolbar,{variant:"dense"},r.a.createElement("div",{className:n.toggleContainer},r.a.createElement("svg",{width:"20",height:"18",viewBox:"0 0 30 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{paddingTop:"5px",paddingRight:"5px"}},r.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.7753 1.35706L15.9587 2.61119L16.3648 2.87846L18.4001 4.18898L17.1052 6.20016H25.437C26.5487 6.20016 27.45 7.10137 27.45 8.21307V12.8244H28.0955C28.6514 12.8244 29.102 13.275 29.102 13.8308V16.0643C29.102 16.6201 28.6514 17.0707 28.0955 17.0707H27.45V21.2901C27.45 22.4018 26.5487 23.303 25.437 23.303H4.12161C3.00991 23.303 2.1087 22.4017 2.1087 21.29V17.0707H1.42467C0.868819 17.0707 0.418213 16.6201 0.418213 16.0643V13.8308C0.418213 13.275 0.868819 12.8244 1.42467 12.8244H2.1087V8.21307C2.1087 7.10137 3.00991 6.20016 4.12161 6.20016H13.5141L14.8252 4.16395L13.2875 3.15192L13.2966 3.13812L13.2875 3.1322L15.1377 0.290771L16.7753 1.35706ZM24.4306 9.21953H5.12807V20.2836H24.4306V9.21953ZM7.18098 12.1324C6.68518 12.1324 6.28325 12.5343 6.28325 13.0301C6.28325 13.5259 6.68518 13.9278 7.18098 13.9278H9.04635C9.54216 13.9278 9.94409 13.5259 9.94409 13.0301C9.94409 12.5343 9.54216 12.1324 9.04635 12.1324H7.18098ZM20.6901 12.1324C20.1943 12.1324 19.7924 12.5343 19.7924 13.0301C19.7924 13.5259 20.1943 13.9278 20.6901 13.9278H22.5555C23.0513 13.9278 23.4532 13.5259 23.4532 13.0301C23.4532 12.5343 23.0513 12.1324 22.5555 12.1324H20.6901ZM9.17669 17.6512H11.3239V19.253H9.17669V17.6512ZM14.3432 17.6513H12.196V19.253H14.3432V17.6513ZM15.2154 17.6513H17.3626V19.253H15.2154V17.6513ZM20.382 17.6513H18.2348V19.253H20.382V17.6513ZM10.9568 23.69H18.6019V25.7029C18.6019 26.2587 18.1513 26.7093 17.5954 26.7093H11.9632C11.4074 26.7093 10.9568 26.2587 10.9568 25.7029V23.69Z",fill:"#9E9E9E"})),r.a.createElement(Ea.a,{className:n.formControl},r.a.createElement(xa.a,{labelId:"select-label",id:"select",multiple:!0,value:e.selectedRobots,onChange:u,renderValue:function(e){var t=e.filter((function(e){return e.isSelected})).map((function(e){return e.name}));return t.length>2?[t[0],t[1]].join(" , ")+"...":t.join(" , ")},input:r.a.createElement(yi.a,null),MenuProps:Ii},e.selectedRobots.map((function(e,t){return r.a.createElement(Pe.a,{key:"robotList-".concat(t),value:e.id},r.a.createElement(Pi.a,{checked:e.isSelected}),r.a.createElement(Ai.a,{primary:e.name}))}))))),r.a.createElement(v.TextField,{className:n.searchText,label:"",placeholder:"Search (regex)",value:e.messageRegex,onChange:function(t){return e.handleMessageRegex(t.target.value)},InputProps:{startAdornment:r.a.createElement(oi.a,{style:{paddingRight:8}},r.a.createElement(nt.a,{fontSize:"small"})),endAdornment:r.a.createElement(oi.a,{position:"end"},r.a.createElement(Ia.a,{disabled:!e.messageRegex,onClick:function(){return e.handleMessageRegex("")}},r.a.createElement(m.a,{color:"inherit",fontSize:"small"})))},size:"small"}),r.a.createElement("div",{className:n.toggleContainer},r.a.createElement(Ea.a,{className:n.formControl},r.a.createElement(xa.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",style:{minWidth:"290px"},multiple:!0,value:e.levels,onChange:e.handleLevels,input:r.a.createElement(yi.a,null),renderValue:function(t){return e.levelsList.filter((function(e){return t.includes(e.value)})).map((function(e){return e.label})).join(", ")},MenuProps:Ii},e.levelsList.map((function(t){return r.a.createElement(Pe.a,{key:t.value,value:t.value},r.a.createElement(Pi.a,{checked:e.levels.indexOf(t.value)>-1}),r.a.createElement(Ai.a,{primary:t.label}))}))))),(t=e.advancedMode,r.a.createElement(ui,{icon:r.a.createElement(li.a,null),title:"Tags",disabled:!t,isActive:e.tags.length>0},r.a.createElement("div",{className:n.tagsContainer},r.a.createElement(v.TextField,{className:n.addTagText,value:i,onChange:function(e){return c(e.target.value)},onKeyUp:function(t){13===t.keyCode&&(e.handleAddTag(i),c(""))},label:"Add Tag",InputProps:{endAdornment:r.a.createElement(oi.a,null,r.a.createElement(Ia.a,{onClick:function(){e.handleAddTag(i),c("")}},r.a.createElement(mi.a,null)))},size:"small"}),r.a.createElement("div",{className:n.tagsList},e.tags.map((function(t){return r.a.createElement("li",{key:t.key},r.a.createElement(di.a,{label:t.label,onDelete:function(){return e.handleDeleteTag(t)},className:n.chip,size:"small"}))})))))),r.a.createElement(ui,{icon:r.a.createElement(vi.a,null),title:e.t("Date Range"),isActive:null!==e.selectedFromDate||null!==e.selectedToDate},r.a.createElement(xi.MuiPickersUtilsProvider,{utils:Ci.a},r.a.createElement(xi.KeyboardDateTimePicker,{key:"time-picker",size:"small",variant:"inline",ampm:!1,label:e.t("From date"),value:e.selectedFromDate,onChange:function(t){return e.handleDateChange(t,"selectedFromDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}),r.a.createElement(xi.KeyboardDateTimePicker,{key:"time-picker2",size:"small",variant:"inline",ampm:!1,label:e.t("To date"),value:e.selectedToDate,onChange:function(t){return e.handleDateChange(t,"selectedToDate")},onError:console.log,format:"yyyy/MM/dd HH:mm"}))),r.a.createElement("div",{style:{flexGrow:1}}),r.a.createElement(ui,{icon:r.a.createElement(Mi.a,null),title:e.t("Configuration")},r.a.createElement(v.FormControlLabel,{control:r.a.createElement(v.Switch,{checked:e.advancedMode,onChange:e.handleAdvancedMode}),label:e.advancedMode?"Advanced":"Simple"}),r.a.createElement("div",{className:n.filtersButton},r.a.createElement(v.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Limit p/Robot"),":")),r.a.createElement(v.TextField,{value:e.limit,onChange:e.handleLimit,className:n.limitText,id:"outlined-number",placeholder:e.t("limit"),type:"number",InputLabelProps:{shrink:!0},size:"small"})),r.a.createElement("div",{className:n.columnsFilter},r.a.createElement(v.Typography,{component:"div",style:{fontSize:"1rem",fontFamily:"Open Sans",fontWeight:500}},"".concat(e.t("Columns"),":")),r.a.createElement(Ea.a,{className:n.formControl},r.a.createElement(xa.a,{labelId:"demo-mutiple-checkbox-label",id:"demo-mutiple-checkbox",multiple:!0,value:e.columns,onChange:e.handleColumns,input:r.a.createElement(yi.a,null),renderValue:function(t){return t.map((function(t){return or()(e,"columnList[".concat(t,"].label"),"")})).join(", ")},MenuProps:Ii},Object.keys(e.columnList).map((function(t,n){return r.a.createElement(Pe.a,{key:n,value:t},r.a.createElement(Pi.a,{checked:e.columns.indexOf(t)>-1}),r.a.createElement(Ai.a,{primary:e.columnList[t].label}))}))))))))},Ii={PaperProps:{style:{maxHeight:224,width:250}},getContentAnchorEl:null};function Bi(e,t){return Oi()(e,t)}Ti.propTypes={levels:u.a.array,levelsList:u.a.array,handleLevels:u.a.func,limit:u.a.number,handleLimit:u.a.func,columns:u.a.array,columnList:u.a.object,handleColumns:u.a.func,handleDeleteTag:u.a.func,messageRegex:u.a.string,handleMessageRegex:u.a.func,selectedFromDate:u.a.string,selectToDate:u.a.string,handleDateChange:u.a.func,selectedRobots:u.a.array,updateRobotSelection:u.a.func,advancedMode:u.a.bool,handleAdvancedMode:u.a.func,t:u.a.func},Ti.defaultProps={levels:[],levelsList:[],handleLevels:function(){},limit:1,handleLimit:function(){},columns:[],columnList:{},handleColumns:function(){},handleDeleteTag:function(){},messageRegex:"",handleMessageRegex:function(){},selectedFromDate:"",selectToDate:"",handleDateChange:function(){},selectedRobots:[],updateRobotSelection:function(){},advancedMode:!1,handleAdvancedMode:function(){},t:function(e){return e}};var Ri=Object(o.memo)(Ti,Bi),Di=(n(140),n(121),n(122)),Fi=n.n(Di);var Li={INFO:{backgroundColor:"rgba(33, 150, 243, 0.1)"},WARNING:{backgroundColor:"rgba(255, 152, 0, 0.1)"},DEBUG:{backgroundColor:"rgba(76, 175, 80, 0.1)"},ERROR:{backgroundColor:"rgba(244, 67, 54, 0.1)"},CRITICAL:{backgroundColor:"rgba(255, 19, 1, 0.1)"}};function ji(e,t){var n=e.length;if(0===n||void 0===e)return 0;for(var o=0;o<n;o++)for(var r=0;r<n&&o!==e[r][t];r++)if(r===n-1)return o;return n}function Vi(e,t){var n="";if(Array.isArray(e)&&e.length===t.length)return n;try{return e.forEach((function(e){n=""===n?"".concat(e.toLowerCase()):"".concat(n,",").concat(e.toLowerCase())})),"level=".concat(n)}catch(e){return""}}function Ui(e){var t="";return Fi()(e)?t:(e.forEach((function(e){t=""===t?"".concat(e.label):"".concat(t,",").concat(e.label)})),"&tags=".concat(t))}function zi(e){return e&&""!==e?"&message=".concat(e):""}function Ki(e,t){for(var n,o=0,r=e.length-1,a=null;o<=r;){var i=t(e[n=(o+r)/2|0]);"right"===i[0]?o=n+1:r=n-1,i[1]&&(a=n)}return a}var Gi=function(e,t,n){if(!e)return[];var o=0,r=e.length;if(!t&&!n)return e;var a=e.map((function(e){return e.time}));return n&&(o=Ki(a,(function(e){return e>=n.getTime()/1e3?["right",!1]:["left",!0]}))),t&&(r=Ki(a,(function(e){return e<=t.getTime()/1e3?["left",!1]:["right",!0]}))),e.slice(o,r+1)},qi=n(75),Wi=n.n(qi),_i=n(70);function Hi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Hi(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Hi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qi=Object(p.makeStyles)((function(e){return Yi({flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:"rgba(0, 5, 58, 0.3)"}},tableCell:{flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"inline-block"},flexColumn:{flex:1,alignItems:"center"},noClick:{cursor:"initial"}},Li)})),Zi=function(e){var t=e.columns,n=e.rowHeight,o=e.headerHeight,a=e.onRowClick,i=st()(e,["columns","rowHeight","headerHeight","onRowClick"]),c=Qi(),u=function(t){var n=t.index,o=e.data[n];return Na()(c.tableRow,c.flexContainer,-1!==n&&c[o.level],d()({},c.tableRowHover,-1!==n&&null!=a))},s=function(e){return function(o){var a=o.cellData,i=o.columnIndex;return r.a.createElement(Wi.a,{component:"div",className:"".concat(c.tableCell," ").concat(c.flexContainer),variant:"body",style:{height:n},align:null!=i&&t[i].numeric?"right":"left"},e?e(a):a)}};return r.a.createElement(_i.AutoSizer,null,(function(e){var l=e.height,f=e.width;return r.a.createElement(_i.Table,Se()({height:l,width:f,onRowClick:a,rowHeight:n,gridStyle:{direction:"inherit"},headerHeight:o,className:c.table},i,{rowClassName:u}),t.map((function(e,n){var a=e.dataKey,i=e.render,u=st()(e,["dataKey","render"]);return r.a.createElement(_i.Column,Se()({key:a,headerRenderer:function(e){return a=Yi(Yi({},e),{},{columnIndex:n}),i=a.label,u=a.columnIndex,r.a.createElement(Wi.a,{component:"div",className:Na()(c.tableCell,c.flexContainer,c.noClick),variant:"head",style:{height:o},align:t[u].numeric?"right":"left"},r.a.createElement("span",null,i));var a,i,u},flexGrow:"message"===a?1:void 0,className:c.flexContainer,cellRenderer:s(i),dataKey:a},u))})))}))};function Xi(e){return r.a.createElement(Zi,{rowHeight:48,headerHeight:48,rowCount:e.logsData.length,rowGetter:function(t){var n=t.index;return e.logsData[n]},data:e.logsData,columns:e.columns.map((function(t){return e.columnList[t]})),onRowClick:e.onRowClick})}function Ji(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function $i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ji(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ji(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ec(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}Xi.propTypes={columns:u.a.array,columnList:u.a.object,logsData:u.a.array,height:u.a.number,onRowClick:u.a.func},Xi.defaultProps={columns:[],columnList:{},logsData:[],height:10};var tc={key:0,label:"ui"},nc=function(e){T()(n,e);var t=ec(n);function n(){var e;x()(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(O()(e),"state",{selectedRobots:[],levels:["INFO","ERROR"],limit:50,logsData:[],messageRegex:"",selectedFromDate:null,selectedToDate:null,columns:["Time","Robot","Message"],tags:e.props.advancedMode?[]:[tc],height:0,levelsList:e.props.advancedMode?[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]:[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}],advancedMode:e.props.advancedMode}),d()(O()(e),"logsTimeout",void 0),d()(O()(e),"logModal",Object(o.createRef)()),d()(O()(e),"simpleLevelsList",[{value:"INFO",label:"Robot Status"},{value:"ERROR",label:"Alerts"}]),d()(O()(e),"advancedLevelsList",[{value:"INFO",label:"Info"},{value:"WARNING",label:"Warnings"},{value:"DEBUG",label:"Debug"},{value:"ERROR",label:"Error"},{value:"CRITICAL",label:"Critical"}]),d()(O()(e),"updateSelectedRobots",(function(){e.props.robotsData.length&&e.props.robotsData.filter((function(e){return e.ip})).length&&e.setSelectedRobots(e.props.robotsData.map((function(e){return $i($i({},e),{},{isSelected:!0})})))})),d()(O()(e),"updateRobotSelection",(function(t){var n=_t()(e.state.selectedRobots),o=n[n.findIndex((function(e){return e.id===t}))];o.isSelected=!o.isSelected,e.setState({selectedRobots:n})})),d()(O()(e),"setSelectedRobots",(function(t){clearTimeout(e.logsTimeout),e.setState({selectedRobots:t}),e.getLogs(t)})),d()(O()(e),"getLogs",function(){var t=qt()(Yt.a.mark((function t(n){return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(n.filter((function(t){return t.robotState!==e.props.robotStates.off})).filter((function(e){return e.isSelected})).map((function(t){return e.getRobotLogData(t)}))).then((function(t){e.setState((function(n){var o=t.reduce((function(e,t){return t&&t.forEach((function(t){return e.push(t)})),e}),[]);return e.logsTimeout=setTimeout(e.getLogs,3e3,n.selectedRobots),{logsData:o.sort((function(e,t){return t.time-e.time}))}}))}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),d()(O()(e),"getRobotLogData",(function(t){return new Promise((function(n,o){var r=setTimeout((function(){console.error("MOV.AI: One of the promises reached timeout"),n([])}),2e3);if(t.ip){var a="http://".concat(t.ip,"/api/v1/logs/?").concat(Vi(e.state.levels,e.state.levelsList),"&limit=").concat(e.state.limit).concat(Ui(e.state.tags)).concat(zi(e.state.messageRegex));J.MasterDB.get(a,(function(e,t){n((null==e?void 0:e.data)||[]),clearTimeout(r)}))}else n([])})).catch((function(){return console.log("Failed getRobotLogData")}))})),d()(O()(e),"onRowClick",(function(t){e.logModal.current.open(t.rowData)})),e}return C()(n,[{key:"resizeHandler",value:function(){var e=this.divElement.clientHeight;this.setState({height:e})}},{key:"componentDidMount",value:function(){this.updateSelectedRobots()}},{key:"componentDidUpdate",value:function(e,t){Oi()(e.robotsData,this.props.robotsData)||this.updateSelectedRobots()}},{key:"componentWillUnmount",value:function(){this.logsTimeout&&clearTimeout(this.logsTimeout)}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column"}},r.a.createElement("div",{style:{flexGrow:"1",height:"100%",display:"flex",flexDirection:"column"}},r.a.createElement(Ri,{selectedRobots:this.state.selectedRobots,updateRobotSelection:this.updateRobotSelection,levels:this.state.levels,levelsList:this.state.levelsList,handleLevels:function(t){e.setState({levels:t.target.value})},limit:this.state.limit,handleLimit:function(t){""===t.target.value?e.setState({limit:0}):e.setState({limit:t.target.value})},columns:this.state.columns,columnList:this.props.columnList,handleColumns:function(t){var n=Object.keys(e.props.columnList).filter((function(e){return t.target.value.includes(e)}));e.setState({columns:n})},tags:this.state.tags,handleAddTag:function(t){var n=e.state.tags;""!==t&&n.findIndex((function(e){return e.label===t}))<0&&(n.push({key:ji(n,"key"),label:t}),e.setState({tags:n}))},handleDeleteTag:function(t){var n=e.state.tags.filter((function(e){return e.key!==t.key}));e.setState({tags:n})},messageRegex:this.state.messageRegex,handleMessageRegex:function(t){return e.setState({messageRegex:t})},selectedFromDate:this.state.selectedFromDate,selectedToDate:this.state.selectedToDate,handleDateChange:function(t,n){e.setState(d()({},n,t))},advancedMode:this.state.advancedMode,handleAdvancedMode:function(t){var n=!e.state.advancedMode;e.setState({advancedMode:n,levelsList:e.state.advancedMode?e.simpleLevelsList:e.advancedLevelsList,tags:n?[]:[tc]})}}),r.a.createElement("div",{ref:function(t){e.divElement=t},className:this.props.classes.tableContainer},r.a.createElement(Xi,{columns:this.state.columns,columnList:this.props.columnList,logsData:Gi(this.state.logsData,this.state.selectedFromDate,this.state.selectedToDate),height:this.state.height,levelsList:this.state.levelsList,onRowClick:this.onRowClick}))),r.a.createElement(te,{ref:this.logModal,props:["module","service"]}))}}]),n}(o.Component);nc.propTypes={robotsData:u.a.array,robotStates:u.a.object,columnList:u.a.object,advancedMode:u.a.bool},nc.defaultProps={robotsData:[{name:"robot",id:"032cf6207ff34ad0a68cc45034f61b41",timestamp:1604334778.6494586,robotState:"okay",battery:78,ip:"127.0.0.1"},{name:"robot_test",id:"4df900e30cb44adba33ae74bb2596d88",timestamp:1603969723.997914,robotState:"off",battery:22,ip:"127.0.0.1"}],robotStates:{error:"error",temp:"temp",okay:"okay",off:"off"},columnList:{Date:{label:"Date",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleDateString("pt"))}(e)}},Time:{label:"Time",dataKey:"time",width:100,render:function(e){return function(e){var t=new Date(1e3*e);return"".concat(t.toLocaleTimeString("pt"))}(e)}},Level:{label:"Level",dataKey:"level",width:100},Module:{label:"Module",dataKey:"module",width:100},Robot:{label:"Robot",dataKey:"robot",width:100},Message:{label:"Message",dataKey:"message",width:100}},advancedMode:!1};var oc=Object(p.withStyles)((function(e){return{tableContainer:{flexGrow:1,minHeight:0,overflow:"hidden"}}}),{withTheme:!0})(nc),rc=n(39),ac=n.n(rc),ic=n(123),cc=n.n(ic),uc=n(124),sc=n.n(uc),lc=n(76),fc=n.n(lc);function dc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var hc=function(e){T()(n,e);var t=dc(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"state",{username:"",password:"",remember:!1,error:!1,errorMessage:"",capsLockOn:!1}),d()(O()(e),"sendCreds",qt()(Yt.a.mark((function t(){var n;return Yt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,J.Authentication.login(e.state.username,e.state.password,e.state.remember);case 3:(n=t.sent).error?e.setState({error:!0,errorMessage:n.error}):e.props.setLoggedIn(!0),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.setState({error:!0,errorMessage:t.t0});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))),d()(O()(e),"checkCapsLock",(function(t){if("CapsLock"===t.key&&e.state.capsLockOn)e.setState({capsLockOn:!1});else{var n=t.getModifierState("CapsLock");e.setState({capsLockOn:n})}})),e}return C()(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.classes,o=t.logo;return r.a.createElement(ac.a,{style:{paddingTop:"5%"},container:!0,direction:"column",alignItems:"center",justify:"space-evenly"},r.a.createElement(sc.a,{elevation:10,className:n.root},r.a.createElement(ac.a,{item:!0},r.a.createElement("img",{src:o||cc.a,className:"center",alt:"logo",style:{display:"block",marginLeft:"auto",marginRight:"auto",width:"50%"}})),r.a.createElement(ac.a,null,r.a.createElement(G.a,{align:"center",variant:"subtitle1",gutterBottom:!0},r.a.createElement(Ea.a,{className:n.formControl,error:this.state.error},r.a.createElement(wa.a,{htmlFor:"component-username-error"},"Username"),r.a.createElement(yi.a,{id:"component-username-error",value:this.state.username,"aria-describedby":"component-username-error-text",onChange:function(t){return e.setState({username:t.target.value})}})))),r.a.createElement(ac.a,null,r.a.createElement(G.a,{align:"center",variant:"subtitle1",gutterBottom:!0},r.a.createElement(Ea.a,{className:n.formControl,error:this.state.error},r.a.createElement(wa.a,{htmlFor:"component-password-error"},"Password"),r.a.createElement(yi.a,{id:"component-password-error",type:"password",value:this.state.password,"aria-describedby":"component-password-error-text",onChange:function(t){return e.setState({password:t.target.value})},onKeyUp:function(t){e.checkCapsLock(t),"Enter"===t.key&&e.sendCreds()}}),this.state.error&&r.a.createElement(fc.a,{id:"component-error-text"},this.state.errorMessage),this.state.capsLockOn&&r.a.createElement(fc.a,{id:"component-warning-text"},"Warning: Caps lock is ON!")))),r.a.createElement(ac.a,null,r.a.createElement(G.a,{align:"center",gutterBottom:!0},r.a.createElement(i.a,{onClick:function(){return e.sendCreds()}},"Login")))))}}]),n}(o.Component);hc.propTypes={logs:u.a.any,setLoggedIn:u.a.func},hc.defaultProps={setLoggedIn:function(e){return console.log(e)}};var mc=Object(p.withStyles)((function(e){return{root:{padding:e.spacing(4,4),borderRadius:10}}}),{withTheme:!0})(hc);function pc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function vc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gc=Object(p.makeStyles)((function(e){return{menuItemSpacing:vc({fontSize:"18px",minHeight:"18px",padding:e.spacing(1.25,2)},e.cursorDefault),profileMenuFooter:{fontSize:"14px",textAlign:"end"}}})),yc=function(e){var t,n=gc(),o=r.a.useState(null),a=ce()(o,2),i=a[0],c=a[1];return r.a.createElement("div",null,r.a.createElement(Ia.a,{"aria-controls":"simple-menu","aria-haspopup":"true",onClick:function(e){c(e.currentTarget)}},r.a.createElement(Mi.a,null)),r.a.createElement(Me.a,{id:"simple-menu",anchorEl:i,keepMounted:!0,open:Boolean(i),onClose:function(){c(null)}},r.a.createElement(v.Typography,{component:"div",variant:"body1"},r.a.createElement("div",{className:n.menuItemSpacing},e.welcomeLabel,", ",e.userName),r.a.createElement(z.a,{variant:"middle"}),null===(t=e.extraItems)||void 0===t?void 0:t.map((function(e){return r.a.createElement(Pe.a,{className:n.menuItemSpacing,onClick:function(){return e.func}},e.label)})),r.a.createElement("div",{className:n.menuItemSpacing},e.darkThemeLabel,r.a.createElement(Nt,{onToggle:function(){return e.handleToggleTheme()},toggle:e.isDarkTheme})),r.a.createElement(Pe.a,{className:(n.menuItemSpacing,n.cursorPointer),onClick:e.handleLogout},e.logoutLabel),r.a.createElement(z.a,{variant:"middle"}),r.a.createElement("div",{className:n.menuItemSpacing+" "+n.profileMenuFooter},e.version))))};yc.propTypes={welcomeLabel:u.a.string,userName:u.a.string,darkThemeLabel:u.a.string,logoutLabel:u.a.string,version:u.a.string,extraItems:u.a.array,isDarkTheme:u.a.bool,handleLogout:u.a.func,handleToggleTheme:u.a.func},yc.defaultProps={welcomeLabel:"Hello",userName:"User",darkThemeLabel:"Dark Theme",logoutLabel:"Logout",version:"",extraItems:[],isDarkTheme:!0,handleLogout:function(){return console.log("logout")},handleToggleTheme:function(){return console.log("toggle")}};var bc=yc,Ac=n(71),wc=n.n(Ac),Mc=n(72),Ec=n.n(Mc),Pc=n(125),xc=n.n(Pc),kc=(n(142),n(143),n(144),n(126)),Cc=n.n(kc);function Sc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Oc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}var Tc=function(e){T()(n,e);var t=Nc(n);function n(){var e;x()(this,n);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return e=t.call.apply(t,[this].concat(a)),d()(O()(e),"searchInput",null),d()(O()(e),"timer",null),d()(O()(e),"inputRef",r.a.createRef()),d()(O()(e),"handleChange",(function(t){e.searchInput=t.target.value,e.timer&&clearTimeout(e.timer),e.timer=setTimeout(e.handleSearch,250)})),d()(O()(e),"handleSearch",(function(){null!==e.searchInput&&e.props.search(e.searchInput)})),e}return C()(n,[{key:"resetValue",value:function(){var e=this.inputRef.current.children[0];e.value="",e.focus(),this.searchInput="",this.handleSearch(),this.forceUpdate()}},{key:"isEmpty",value:function(){return null===this.searchInput||""===this.searchInput.trim()}},{key:"render",value:function(){var e=this;return r.a.createElement(v.Typography,{component:"div",style:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%"}},r.a.createElement(v.InputBase,{ref:this.inputRef,style:{marginLeft:10,flex:1},placeholder:"Search",onChange:this.handleChange}),r.a.createElement(v.IconButton,{style:{padding:10},onClick:function(){e.isEmpty()||e.resetValue()}},this.isEmpty()?r.a.createElement(nt.a,null):r.a.createElement(Ue.a,null)))}}]),n}(o.Component),Ic=function(e){return r.a.createElement(v.List,{style:Oc({paddingLeft:"0px",paddingRight:"0px"},e.style),dense:!0,component:"div",onKeyUp:e.onKeyUp},e.children)},Bc=function(e){return r.a.createElement(Ic,{style:{flexGrow:1,paddingBottom:"0px",paddingTop:"0px"},onKeyUp:e.onKeyUp},r.a.createElement(v.ListItem,null,r.a.createElement(Tc,{search:function(t){return e.onSearch(t)}})),r.a.createElement(v.Divider,null),r.a.createElement(v.Typography,{style:e.style,component:"div"},r.a.Children.map(e.children,(function(e){return e}))))};function Rc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Dc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rc(Object(n),!0).forEach((function(t){d()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=D()(e);if(t){var r=D()(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return B()(this,n)}}Bc.propTypes={onSearch:u.a.func},Bc.defaultProps={onSearch:function(e){return console.log(e)}};for(var Lc=[],jc=0;jc<100;jc++)Lc.push({id:jc,name:"1.0.".concat(jc)});var Vc=function(e){T()(n,e);var t=Fc(n);function n(){var e;x()(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return e=t.call.apply(t,[this].concat(r)),d()(O()(e),"state",{selectedGroup:"EXPANDED",groupsEnabled:!0,searchValue:""}),d()(O()(e),"searchFilter",(function(e,t){var n=t.toLowerCase(),o=e.filter((function(e){return!e.name.includes("@SM")&&e.name.toLowerCase().includes(n)||e.children.findIndex((function(e){return e.name.toLowerCase().includes(n)}))>=0})).map((function(e){return Dc(Dc({},e),{},{children:((null==e?void 0:e.children)||[]).filter((function(t){return t.name&&!t.name.includes("@SM")&&(e.name.toLowerCase().includes(n)||t.name.toLowerCase().includes(n))}))})}));return o.forEach((function(e){e.children.forEach((function(e,t){e.id=e.id?e.id:t,e.children&&e.children.forEach((function(e,t){e.id=e.id?e.id:t}))}))})),o})),d()(O()(e),"handleSelectedGroupChange",(function(t){e.setState({selectedGroup:t})})),d()(O()(e),"handleExpansion",(function(e,t,n,o){})),e}return C()(n,[{key:"render",value:function(){var e=this,t=this.props.classes,n=r.a.createElement("i",{className:"fas fa-home"}),o=this.props.data;return r.a.createElement("div",null,r.a.createElement(Bc,{style:{overflow:"auto"},icon:n,onSearch:function(t){e.setState({searchValue:t})}},r.a.createElement("div",{style:{height:this.props.height}},r.a.createElement(xc.a,{nodes:this.searchFilter(o,this.state.searchValue),onChange:this.props.handleChange},(function(n){var a,i,c=n.style,u=n.node;st()(n,["style","node"]);return c.paddingLeft=c.marginLeft/1.5,c.marginLeft=0,r.a.createElement("div",{style:c,onClick:function(){return e.props.onClickNode(u)},onDoubleClick:function(){return e.props.onDoubleClickNode(u)},p:2,className:or()(u,"children",!1)?"":t.preContainer},r.a.createElement(Cc.a,{p:1,className:t.inlineFlex},r.a.createElement(ac.a,{alignContent:"space-between",container:!0},or()(u,"children",!1)&&(null===(a=u.state)||void 0===a?void 0:a.expanded)&&r.a.createElement(fe.a,{onClick:function(t){return e.handleExpansion(t,o,u,!1)}}),or()(u,"children",!1)&&!(null!==(i=u.state)&&void 0!==i&&i.expanded)&&r.a.createElement(se.a,{onClick:function(t){return e.handleExpansion(t,o,u,!0)}}),r.a.createElement("div",{className:or()(u,"children",!1)?"":t.spaceBetween},r.a.createElement("div",{className:t.ellipsis},u.name)))))})))))}}]),n}(o.Component);Vc.propTypes={data:u.a.array,onClickNode:u.a.func,onDoubleClickNode:u.a.func,handleChange:u.a.func,height:u.a.oneOfType([u.a.string,u.a.number])},Vc.defaultProps={data:[],onClickNode:function(){},onDoubleClickNode:function(){},handleChange:function(){},height:700};var Uc=Object(p.withStyles)((function(e){return{horizFlex:{display:"flex",flexDirection:"row",alignItems:"center"},spaceBetween:{display:"flex",width:"100%",justifyContent:"space-between"},preContainer:{justifyContent:"space-between","& button":{display:"none"},"&:hover":{backgroundColor:"rgba(54,181,230, 0.15)","& button":{display:"inline-flex"}}},ellipsis:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flex:2},iconSpace:{flex:1,textAlign:"right",minWidth:"45px","& button":{position:"relative",bottom:"7px",padding:"7px"}}}}),{withTheme:!0})(Vc),zc=n(127),Kc=n.n(zc),Gc=n(62),qc=n.n(Gc),Wc=function(e){var t=[{id:0,name:"Annotations",scope:"Annotation",children:[]},{id:1,name:"Callback",scope:"Callback",children:[]},{id:2,name:"Configuration",scope:"Configuration",children:[]},{id:3,name:"Flow",scope:"Flow",children:[]},{id:4,name:"Nodes",scope:"Node",children:[]},{id:5,name:"Layouts",scope:"Layout",children:[]},{id:6,name:"Scenes",scope:"GraphicScene",children:[]}],n=r.a.useState(t),o=ce()(n,2),a=o[0],i=o[1],c=r.a.useState("global"),u=ce()(c,2),s=u[0],l=u[1],f=r.a.useState(e.selected),d=ce()(f,2),h=d[0],m=d[1],p=r.a.useState({}),g=ce()(p,2),y=g[0],b=g[1],A=r.a.useState(!0),M=ce()(A,2),E=M[0],P=M[1],x=t.filter((function(t){return e.scopeList.includes(t.scope)}));r.a.useEffect((function(){return J.Workspace.getAll().then((function(e){return b(e)})).catch((function(e){return console.log(e)})),S(s),function(){}}),[]),r.a.useEffect((function(){if(!E&&"global"===s&&e.filter){var t=Ec()(a);a.forEach((function(n,o){t[o].children=n.children.filter(e.filter)})),i(t)}}),[e.filter,E]);var k,C,S=function(e){var t=Ec()(x);t.forEach((function(n,o){J.Workspace.getDocs({workspace:e,scope:n.scope}).then((function(e){var n=e.scopes.sort((function(e,t){return e.ref.localeCompare(t.ref)})).map((function(e,t){return{id:t,url:e.url,name:e.ref,children:[{name:""}]}}));t[o].children=n,i(t),P(!1)})).catch((function(e){return console.error(e)}))}))};return r.a.createElement(w,{onSubmit:function(){return e.onSubmit(h)},onCancel:e.onCancel,open:e.open,title:(k=e.scopeList[0],C=["a","e","i","o","u"].includes(k[0].toLowerCase())?"an":"a","Select ".concat(C," ").concat(k)),width:"50%"},r.a.createElement(v.Grid,{container:!0},r.a.createElement(v.Grid,{item:!0,xs:12,style:{textAlign:"center",paddingBottom:"6px",paddingTop:"10px"}},r.a.createElement(v.FormControl,{style:{width:"50%"}},r.a.createElement(v.InputLabel,null,"Workspace"),r.a.createElement(v.Select,{value:s,onChange:function(e){l(e.target.value),S(e.target.value),P(!0)}},Object.keys(y).map((function(e,t){return r.a.createElement(v.MenuItem,{key:t,value:e},y[e].label)}))))),r.a.createElement(v.Typography,{component:"div",style:{overflowY:"auto",overflowX:"hidden",justifyContent:"center",width:"100%"}},E?r.a.createElement(Kc.a,{style:{position:"relative",height:"50vh",width:"inherit",color:"#fff",zIndex:99999},open:E},r.a.createElement(qc.a,{color:"inherit"})):r.a.createElement(Uc,{onClickNode:function(e){return function(e){var t=Ec()(a),n={0:function(){var n=t.findIndex((function(t){return t.id===e.id})),o=or()(t,[n,"state","expanded"],!1);wc()(t,[n,"state"],{expanded:!o}),i(t)},1:function(){var n=t.findIndex((function(t){return t.id===e.parents[0]}));J.Workspace.getDocs({workspace:s,scope:t[n].scope,id:e.name}).then((function(o){var r=o.versions.map((function(e,t){return{url:e.url,name:e.tag,id:t}})),a=t[n].children.findIndex((function(t){return t.id===e.id})),c=or()(t,[n,"children",a,"state","expanded"],!1);wc()(t,[n,"children",a,"state"],{expanded:!c}),wc()(t,[n,"children",a,"children"],r),i(t)})).catch((function(e){return console.error(e)}))},2:function(){m("".concat(e.url))}};or()(n,e.deepness,(function(){}))()}(e)},onDoubleClickNode:function(t){return n=t,void("global"!==s&&n.deepness<=1||(m(n.url),e.onSubmit(n.url)));var n},data:a,handleChange:function(e){return i(e)},showIcons:!1,height:"400px"})),r.a.createElement(v.Grid,{item:!0,xs:12,style:{textAlign:"center"}},r.a.createElement(v.Typography,{label:"Message",value:"selected",margin:"normal"},""===h?"Nothing selected":h))))};Wc.propTypes={onSubmit:u.a.func,onCancel:u.a.func,open:u.a.bool,scopeList:u.a.array,message:u.a.string,selected:u.a.string,filter:u.a.func},Wc.defaultProps={title:"Insert Text here",message:"Are you sure?",onSubmit:function(){},onCancel:function(){},open:!1,scopeList:["Callback"],selected:""};var _c=Wc,Hc=n(77),Yc=n.n(Hc),Qc=n(128),Zc=Object(Qc.makeStyles)((function(e){return{alert:{position:"absolute",bottom:0,width:"100%"}}}));function Xc(e){return function(t){var n=r.a.useState(!0),a=ce()(n,2),i=a[0],c=a[1],u=r.a.useState(!1),s=ce()(u,2),l=s[0],f=s[1],d=r.a.useState(null),h=ce()(d,2),m=h[0],p=h[1],g=r.a.useState(!1),y=ce()(g,2),b=y[0],A=y[1],w=Zc();Object(o.useEffect)((function(){var e=J.MasterDB.offlineValidation({onOnline:M,onOffline:E});p(e)}),[]);var M=function(){c(!0),f(!0),setTimeout((function(){return f(!1)}),2e3)},E=function(){c(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(r.a.Fragment,null,r.a.createElement(e,t),!i&&r.a.createElement(Yc.a,{className:w.alert,variant:"filled",severity:"error",action:r.a.createElement(v.Button,{color:"inherit",size:"small",onClick:function(){A(!0),m.retryConnection().then((function(){return A(!1)}))}},b?r.a.createElement(qc.a,{size:20,color:"inherit"}):"RETRY")},"Connection failed... You're now in offline mode, please wait to reconnect."),i&&l&&r.a.createElement(Yc.a,{className:w.alert,variant:"filled",severity:"success"},"You're now online!")))}}var Jc=n(129),$c=n.n(Jc);function eu(e){return function(t){var n=Object(o.useRef)(!0),a=Object(o.useState)(!1),i=ce()(a,2),c=i[0],u=i[1],s=Object(o.useState)(0),l=ce()(s,2),f=l[0],d=l[1];Object(o.useEffect)((function(){function e(){return(e=qt()(Yt.a.mark((function e(){return Yt.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J.Authentication.checkLogin();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u(function(){return e.apply(this,arguments)}())}),[]),Object(o.useEffect)((function(){var e=Math.floor(.001*Date.now()),t=window.localStorage.getItem("movai.refreshToken");try{var n=($c()(t).exp||e)-e;if(n<=0)throw new Error("Token expired");setTimeout((function(){return d(e)}),1e3*n+2e3),u(!0)}catch(e){u(!1)}}),[f,c]);return r.a.createElement(r.a.Fragment,null,!c&&n.current?(n.current=!1,r.a.createElement(mc,{setLoggedIn:function(e){return u(e)}})):r.a.createElement(r.a.Fragment,null,r.a.createElement(e,Se()({handleLogOut:function(){J.Authentication.logout()},loggedIn:c},t)),r.a.createElement(v.Modal,{open:!c},r.a.createElement(mc,{setLoggedIn:function(e){return u(e)}}))))}}}])}));
//# sourceMappingURL=index.js.map